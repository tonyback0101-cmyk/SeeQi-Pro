(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9403],{59501:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/video/action-sync-video",function(){return r(79890)}])},44006:function(e,t,r){"use strict";r.d(t,{Cq:function(){return k},DP:function(){return x},Dt:function(){return m},EU:function(){return v},Fd:function(){return j},UG:function(){return p},d_:function(){return w},ez:function(){return C},tf:function(){return h}});var i=r(75271),o=r(75616),a=r(21964),n=r(10986),l=r(26930),s=r(46973),d=r(47485),c=r(93928),u=r(65027);let p=30,m=()=>/Android/i.test(navigator.userAgent),h=()=>{let{enqueueSnackbar:e}=(0,n.Ds)(),t=(0,o.NL)();return(0,a.D)({mutationFn:async e=>{let t=c.zK.safeParse(e);if(!t.success)throw Error(`Validation failed: ${t.error.errors.map(e=>e.message).join(", ")}`);return(await s.ZP.post("/action-video/create",t.data,{headers:{"Content-Type":"application/json"}})).data},onSuccess:async e=>{await t.invalidateQueries([u.B4])},onError:t=>{var r;let i="Failed to create action video";(null===(r=t.response)||void 0===r?void 0:r.data)&&"object"==typeof t.response.data?i=t.response.data.error||t.message:t.message&&(i=t.message),e(i,{variant:"error"}),console.error("Failed to create action video:",t)}})};function x(e){return c.zK.safeParse(e).success}async function g(e){return new Promise(t=>{let r=0,i=0,o=0,a=setTimeout(()=>{r>=2?t(Math.max(15,Math.min(60,Math.round((r-1)*1e3/(o-i))))):t(30)},5e3),n=(l,s)=>{if(1==++r&&(i=l),o=l,r>=30){clearTimeout(a),t(Math.max(15,Math.min(60,Math.round((r-1)*1e3/(o-i)))));return}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(n)};"requestVideoFrameCallback"in e?e.requestVideoFrameCallback(n):(clearTimeout(a),t(30))})}async function v(e,t){if(!(e.type.includes("webm")||t.toLowerCase().includes(".webm")))return new File([e],t,{type:e.type});try{return await f(e,t)}catch(r){return console.warn("⚠️ WebM metadata enhancement failed, using original file:",r),new File([e],t,{type:e.type})}}async function f(e,t){if(!e||0===e.size)throw Error("Invalid video blob: blob is null, undefined, or has zero size");if(!t||""===t.trim())throw Error("Invalid fileName: filename is empty or null");try{var i;let o;let a=30;try{let t=URL.createObjectURL(e),r=await new Promise((e,r)=>{let i=document.createElement("video");i.preload="metadata",i.muted=!0;let a=setTimeout(()=>{i.remove(),URL.revokeObjectURL(t),r(Error("Timeout waiting for video metadata"))},1e4);i.addEventListener("loadedmetadata",async()=>{clearTimeout(a);let o=i.duration;if(Number.isNaN(o)||!Number.isFinite(o)||o<=0){i.remove(),URL.revokeObjectURL(t),r(Error(`Invalid video duration: ${o}`));return}let n=30;if("requestVideoFrameCallback"in i)try{n=await g(i)}catch(e){console.warn("Failed to estimate FPS, using default:",e)}i.remove(),URL.revokeObjectURL(t),e({duration:o,fps:n})}),i.addEventListener("error",e=>{clearTimeout(a),i.remove(),URL.revokeObjectURL(t),r(Error(`Failed to load video metadata: ${e.type}`))}),i.addEventListener("canplay",async()=>{if(i.duration&&i.duration>0&&!o){clearTimeout(a);let r=i.duration,o=30;if("requestVideoFrameCallback"in i)try{o=await g(i)}catch(e){console.warn("Failed to estimate FPS for webm, using default:",e)}i.remove(),URL.revokeObjectURL(t),e({duration:r,fps:o})}}),i.src=t});o=r.duration,a=r.fps}catch(e){console.warn("Failed to extract video metadata:",e)}let n=(i=a)>=15&&i<=60?i:[24,25,30,60].reduce((e,t)=>Math.abs(t-i)<Math.abs(e-i)?t:e),{FFmpeg:l}=await Promise.resolve().then(r.bind(r,52846)),{fetchFile:s}=await r.e(5635).then(r.bind(r,75635)),d=new l;d.on("log",e=>{let{message:t}=e}),await d.load();let c=Date.now(),u={"video/webm":"webm","video/mp4":"mp4","video/avi":"avi","video/mov":"mov","video/quicktime":"mov","video/x-msvideo":"avi"}[e.type]||"webm",p=`input_${c}.${u}`,m=`output_${c}.mp4`,h=["-i",p,"-c","copy","-avoid_negative_ts","make_zero","-fflags","+genpts","-movflags","+faststart"],x=["-i",p,"-c:v","libx264","-preset","ultrafast","-crf","28","-r",n.toString(),"-vsync","cfr","-c:a","copy","-avoid_negative_ts","make_zero","-fflags","+genpts","-movflags","+faststart"];"webm"===u&&(h.push("-f","mp4"),x.push("-f","mp4")),o&&o>0&&(h.push("-metadata",`duration=${o}`),x.push("-metadata",`duration=${o}`)),h.push(m),x.push(m),await d.writeFile(p,await s(e));try{await d.exec(h)}catch(e){console.warn("Fast copy failed, trying re-encode approach:",e);try{await d.exec(x)}catch(t){console.warn("Re-encode failed, trying alternative approach:",t);let e=["-i",p,"-c:v","libx264","-preset","ultrafast","-crf","30","-r",n.toString(),"-g","60","-c:a","copy","-f","mp4",m];await d.exec(e)}}let v=await d.readFile(m);if(await d.deleteFile(p),await d.deleteFile(m),!v||0===v.length)throw Error("FFmpeg output is empty or invalid");let f=new Blob([v],{type:"video/mp4"});if(0===f.size)throw Error("Generated blob has zero size");return new File([f],t,{type:"video/mp4"})}catch(r){if(console.error("Failed to fix video metadata with FFmpeg:",r),0===e.size)throw Error("Original video blob has zero size, cannot create valid file");return new File([e],t,{type:e.type||"video/webm"})}}async function b(e){let t=(await fetch(e,{method:"HEAD"})).headers.get("content-length");return t?Number.parseInt(t):0}async function y(e){return new Promise((t,r)=>{let i=new Image,o=e instanceof File?URL.createObjectURL(e):e;i.addEventListener("load",()=>{t({width:i.width,height:i.height})}),i.addEventListener("error",()=>{r(Error(`Failed to load image from ${e instanceof File?"file":"URL"}`))}),i.src=o})}let w=3,j=30,C=(e,t)=>{let{mutateAsync:r}=(0,d.x)();return(0,i.useCallback)(async(i,o)=>{try{let{validateDuration:a=!1}=o||{},n=0,s=0;if("string"==typeof i){let e=await r(i);s=e.duration,n=e.size}else n=i.size,s=await (0,l.u5)(i);if(e.maxVideoSize&&n>1048576*e.maxVideoSize)return t(`Video file size must be ${e.maxVideoSize}MB or less`),!1;if(a){let r=function(e,t){let r=(null==t?void 0:t.minVideoDuration)??w,i=(null==t?void 0:t.maxVideoDuration)??j;return e<r?`Video too short. Minimum: ${r}s, your video: ${e.toFixed(1)}s`:e>i?`Video too long. Maximum: ${i}s, your video: ${e.toFixed(1)}s`:""}(s,e);if(r)return t(r),!1}return!0}catch(e){return console.error("Failed to validate video file:",e),!0}},[r,e,t])},k=(e,t)=>(0,i.useCallback)(async r=>{try{let i=0;if(i="string"==typeof r?await b(r):r.size,e.maxImageSize&&i>1048576*e.maxImageSize)return t(`Image file size must be ${e.maxImageSize}MB or less`),!1;if(e.imageAspectRatios&&e.imageAspectRatios.length>0){let i=await y(r),o=i.width/i.height;if(o<e.imageAspectRatios[0]||o>e.imageAspectRatios[1])return t(`Image aspect ratio must be between ${e.imageAspectRatios[0]} and ${e.imageAspectRatios[1]}`),!1}return!0}catch(e){return console.error("Failed to validate image file:",e),!0}},[e,t])},45308:function(e,t,r){"use strict";r.d(t,{o:function(){return x}});var i=r(52676),o=r(75271),a=r(77379),n=r(56407),l=r(22988),s=r(80110),d=r(60588),c=r(76651),u=r(39204),p=r(23638),m=r(27806),h=r(97779);function x(e){let{value:t,onChange:r,supportMediaTypes:x,modelOptions:g}=e,{isMobile:v}=(0,h.j)(),[f,b]=(0,o.useState)(null),y=(0,o.useRef)(null),w=(0,o.useMemo)(()=>Object.entries(g).filter(e=>{let[t,r]=e;return!r.hidden}).map(e=>{let[t,r]=e;return{value:t,...r}}).filter(e=>x.includes(e.mediaType)),[g,x]),j=w.find(e=>e.value===t)||{value:"",displayName:"Select Model",iconUrl:"",iconColor:""},C=!!f,k=()=>{b(null)},Z=e=>{r(e),k()};return(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&k()};return C&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[C]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.Z,{ref:y,variant:"outlined",fullWidth:!0,onClick:w.length>1?e=>{b(e.currentTarget)}:void 0,endIcon:w.length>1?v?(0,i.jsx)(u.E.div,{animate:{rotate:C?180:0},transition:{duration:.2},children:(0,i.jsx)(m.PhCaretDown,{size:24})}):(0,i.jsx)(u.E.div,{animate:{rotate:C?180:0},transition:{duration:.2},children:(0,i.jsx)(m.PhCaretRight,{size:24})}):null,sx:{justifyContent:"space-between",backgroundColor:"transparent",borderColor:e=>e.palette.Colors.Gray["300"],color:e=>e.palette.text.primary,textTransform:"none",px:1.5,py:1.5,minHeight:48,"&:hover":{borderColor:e=>e.palette.Colors.Gray["400"],backgroundColor:e=>e.palette.Colors.Gray["50"]},"&.Mui-focused":{borderColor:e=>e.palette.Colors.Blue["500"]},mb:2},children:(0,i.jsxs)(n.Z,{direction:"row",alignItems:"center",spacing:1,children:[j.iconUrl?(0,i.jsx)(l.Z,{component:"img",src:j.iconUrl,alt:j.displayName,sx:{width:18,height:18,borderRadius:.5,objectFit:"contain"}}):(0,i.jsx)(m.PhCircle,{size:14,style:{color:j.iconColor||"#666"}}),(0,i.jsx)(s.Z,{variant:"body2",fontWeight:500,sx:{fontSize:"14px"},children:j.displayName})]})}),(0,i.jsx)(d.ZP,{open:C,anchorEl:f,onClose:k,anchorOrigin:{vertical:v?"bottom":"top",horizontal:v?"left":"right"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{...v?{mt:.5}:{ml:.5},minWidth:280,maxWidth:350,backgroundColor:"#101010",color:"white",borderRadius:2,boxShadow:"0px 8px 32px rgba(0, 0, 0, 0.3)",border:"1px solid",borderColor:"#202020"}}},disableScrollLock:!0,children:(0,i.jsx)(n.Z,{spacing:0,sx:{p:1},children:w.map(e=>(0,i.jsx)(u.E.div,{whileTap:{scale:.98},children:(0,i.jsx)(l.Z,{onClick:()=>Z(e.value),sx:{my:.5,p:2,borderRadius:1,cursor:"pointer",transition:"background-color 0.2s",position:"relative",backgroundColor:e.value===t?"rgba(59, 130, 246, 0.15)":"transparent",border:e.value===t?"1px solid rgba(59, 130, 246, 0.3)":"1px solid transparent","&:hover":{backgroundColor:e.value===t?"rgba(59, 130, 246, 0.2)":"rgba(255, 255, 255, 0.05)"}},children:(0,i.jsxs)(n.Z,{spacing:1,children:[(0,i.jsxs)(n.Z,{direction:"row",alignItems:"center",spacing:1,children:[e.iconUrl?(0,i.jsx)(l.Z,{component:"img",src:e.iconUrl,alt:e.displayName,sx:{width:20,height:20,borderRadius:1,objectFit:"contain"}}):(0,i.jsx)(m.PhCircle,{size:14,style:{color:e.iconColor||"#666"}}),(0,i.jsx)(s.Z,{variant:"body1",fontWeight:600,color:"white",children:e.displayName}),e.tag?(0,i.jsx)(c.Z,{label:e.tag,size:"small",sx:{backgroundColor:e.tagColor||"#4CAF50",color:"white",fontSize:"10px",height:20}}):null,(0,i.jsx)(l.Z,{sx:{ml:"auto"},children:(0,i.jsx)(p.M,{children:e.value===t&&(0,i.jsx)(u.E.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},children:(0,i.jsx)(m.PhCheck,{size:16,style:{color:"#4CAF50"}})})})})]}),(0,i.jsx)(s.Z,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)",lineHeight:1.3,fontSize:"12px"},children:e.description}),(0,i.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,i.jsx)(s.Z,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",fontSize:"11px",px:1,py:.25,backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:.5},children:(0,i.jsx)("span",{children:"image"===e.mediaType?"Image":"Video"})})})]})})},e.value))})})]})}},93928:function(e,t,r){"use strict";r.d(t,{NT:function(){return n},ak:function(){return a},zK:function(){return o}});var i=r(84291);let o=i.Ry({characterUrl:i.Z_().url("Must be a valid media URL"),characterType:i.Km(["image","video"]),referenceUrl:i.Z_().url("Must be a valid video URL"),referenceType:i.Km(["video"]),model:i.Km(["runway-act2","wan2.2-v1"],{errorMap:()=>({message:"Invalid model selected"})}),ratio:i.Km(["1280:720","720:1280","960:960","1104:832","832:1104","1584:672"]).catch("1280:720"),expressionIntensity:i.Rx().min(1).max(5).optional(),description:i.Z_().optional(),prompt:i.Z_().default("Imitate the actions in the video"),segmentTarget:i.Z_().default("object"),wan22Type:i.Km(["motion_sync","full_scene"]).optional(),resolution:i.Rx().optional()}),a={"runway-act2":{featureKeys:["app.action-video.runway-act2"],mediaType:"video",name:"runway-act2",displayName:"Runway Act-Two",minVideoDuration:3,maxVideoDuration:30,maxVideoSize:32,maxImageSize:16,imageAspectRatios:[.5,2],supportDescription:!1,description:"Perfect for natural, multi-speaker conversations.",iconColor:"#E91E63",iconUrl:"https://cdn.openart.ai/assets/runway-icon.png"},"wan2.2-v1":{featureKeys:["app.action-video.wan2.2-v1"],mediaType:"image",name:"wan2.2-v1",displayName:"OpenArt Motion",minVideoDuration:3,maxVideoDuration:30,supportDescription:!1,description:"seamlessly swaps faces or features in videos for realistic human transformations.",iconColor:"#E91E63",iconUrl:"https://cdn.openart.ai/music_video/openart_model_log.png"}},n=["video/mp4","video/webm","video/ogg","video/mov","video/quicktime","video/h264"]},3689:function(e,t,r){"use strict";var i=r(99664),o=r(52676);t.Z=(0,i.Z)((0,o.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-4.86 8.86-3 3.87L9 13.14 6 17h12z"}),"ImageOutlined")},79890:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return eE},default:function(){return ez}});var i=r(52676),o=r(87345),a=r(15830),n=r(75271),l=r(56407),s=r(80110),d=r(22988),c=r(75616),u=r(67197),p=r(86547),m=r(29984),h=r(46890),x=r(77379),g=r(60588),v=r(89228),f=r(20198),b=r(60464),y=r(59147),w=r(39204),j=r(23638),C=r(44006),k=r(2345),Z=r(47469),R=r(26930);let S={prompt:"",segmentTarget:"",wan22Type:"full_scene",resolution:720,visual:null,content:null,selectedModel:null,isProcessingVisual:!1,isProcessingContent:!1,ratio:"1280:720",expressionIntensity:3};async function P(e,t,r,i){let o=e.split("/").pop()||"Reused Video",a="video"===r?await (0,R.Mf)(e):void 0;return{id:(0,u.x0)(),url:e,name:o,type:r,source:t,description:i||void 0,duration:a}}let E=(0,k.U)()((0,Z.n)((e,t)=>({...S,setVisual:t=>e(e=>{e.visual=t}),clearVisual:()=>e(e=>{e.visual=null}),setContent:t=>e(e=>{e.content=t}),clearContent:()=>e(e=>{e.content=null}),setSelectedModel:t=>e(e=>{e.selectedModel=t}),setPrompt:t=>e(e=>{e.prompt=t}),getPrompt:()=>t().prompt||"",setSegmentTarget:t=>e(e=>{e.segmentTarget=t}),getSegmentTarget:()=>t().segmentTarget||"",setWan22Type:t=>e(e=>{e.wan22Type=t}),getWan22Type:()=>t().wan22Type||"full_scene",setResolution:t=>e(e=>{e.resolution=t}),getResolution:()=>t().resolution||720,setIsProcessingVisual:t=>e(e=>{e.isProcessingVisual=t}),setIsProcessingContent:t=>e(e=>{e.isProcessingContent=t}),setVisualFromHistory:async t=>{let{url:r,source:i,mediaType:o,description:a}=t;e(e=>{e.isProcessingVisual=!0});let n=await P(r,i,"video"===o?"video":"image",a);e(e=>{e.visual=n,e.isProcessingVisual=!1})},setRatio:t=>e(e=>{e.ratio=t}),setExpressionIntensity:t=>e(e=>{e.expressionIntensity=t}),reset:()=>e(()=>({...S}))})));var z=r(8765),D=r(97792),_=r(72660),I=r(6721),T=r(23187),M=r(27806);function V(e){let{open:t,onClose:r,onConfirm:o,minDuration:a=1,maxDuration:c=300}=e,[u,p]=(0,n.useState)("idle"),[m,h]=(0,n.useState)(0),[g,v]=(0,n.useState)(null),[f,b]=(0,n.useState)(null),y=(0,n.useRef)(null),j=(0,n.useRef)([]),k=(0,n.useRef)(null),Z=(0,n.useRef)(null),R=(0,n.useRef)(null),S=(0,n.useRef)(null),P=(0,n.useRef)(!1),{showModal:E}=(0,z.dd)(),V=(0,n.useCallback)(()=>{P.current=!1,p("idle"),h(0),b(null),k.current&&clearInterval(k.current),y.current&&"recording"===y.current.state&&y.current.stop(),y.current=null,S.current&&(S.current.getTracks().forEach(e=>e.stop()),S.current=null),Z.current&&(Z.current.srcObject=null),R.current&&(R.current.src=""),v(null)},[]),L=(0,n.useCallback)(()=>{Z.current&&S.current&&(Z.current.srcObject=S.current,Z.current.play().catch(console.error))},[]),U=(0,n.useCallback)(()=>{if(!S.current)return null;let e=W(),t={mimeType:e};(0,C.Dt)()?e.includes("webm")?(t.videoBitsPerSecond=15e5,t.audioBitsPerSecond=96e3):(t.videoBitsPerSecond=2e6,t.audioBitsPerSecond=128e3):(t.videoBitsPerSecond=25e5,t.audioBitsPerSecond=128e3);let r=new MediaRecorder(S.current,t);return"idle"===u&&(j.current=[]),r.ondataavailable=e=>{e.data.size>0&&j.current.push(e.data)},r.onstop=()=>{let t=new Blob(j.current,{type:e});if(0===t.size){console.error("Video blob is empty"),b(null);return}b(t)},r},[u]),W=()=>{for(let e of['video/mp4; codecs="avc1.42E01E"','video/mp4; codecs="avc1.4D401E"','video/mp4; codecs="avc1.640028"',"video/mp4",'video/webm; codecs="vp8"','video/webm; codecs="vp9"',"video/webm"])if(MediaRecorder.isTypeSupported(e))return e;return console.warn("⚠️ No supported format found, using fallback"),"video/mp4"},O=(0,n.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280,max:1280},height:{ideal:720,max:720},facingMode:"user",frameRate:{ideal:24,max:30}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:(0,C.Dt)()?44100:48e3}});v(!0),S.current=e;let t=e.getVideoTracks()[0];t&&t.getSettings()}catch(e){console.error("Camera permission denied:",e),v(!1)}},[]),G=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.current&&"recording"===y.current.state&&y.current.stop(),e&&p("completed"),P.current=!1,k.current&&clearInterval(k.current)},[]),A=(0,n.useCallback)(()=>{if(g&&S.current){let e=U();if(e){y.current=e,P.current=!0,p("recording"),h(0),b(null);try{e.start(),k.current=setInterval(()=>{h(e=>{let t=e+1;return t>=c?(G(!0),c):t})},1e3)}catch(e){console.error("Failed to start recording:",e),p("idle"),P.current=!1}}}},[g,U,c,G]),H=(0,n.useCallback)(()=>{G(),p("idle"),h(0),b(null),j.current=[]},[G]),N=(0,n.useCallback)(()=>{switch(u){case"idle":A();break;case"recording":G(!0);break;case"completed":h(0),b(null),j.current=[],setTimeout(()=>{A()},100)}},[u,A,G]),$=(0,n.useCallback)(()=>{if(f){let e=URL.createObjectURL(f),{destroy:t}=E(F,{videoUrl:e,onClose:()=>{URL.revokeObjectURL(e),t()}})}},[f,E]);(0,n.useEffect)(()=>{t&&null===g&&O()},[t,g,O]),(0,n.useEffect)(()=>{g&&S.current&&L()},[g,L]);let[B,K]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(B&&f){K(!1);let e=URL.createObjectURL(f);E(F,{videoUrl:e,onClose:()=>URL.revokeObjectURL(e)})}},[B,f,E]),(0,n.useEffect)(()=>{t||V()},[t,V]);let q="completed"===u&&f&&m>=a;return(0,i.jsx)(D.Z,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:3,bgcolor:"#1a1a1a",color:"white"}},children:(0,i.jsx)(_.Z,{sx:{paddingX:0},children:(0,i.jsxs)(l.Z,{spacing:3,alignItems:"center",children:[(0,i.jsxs)(l.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{paddingX:2},children:[(0,i.jsx)(s.Z,{variant:"h6",fontWeight:600,children:"Record Video"}),(0,i.jsx)(I.Z,{onClick:r,sx:{color:"white"},children:(0,i.jsx)(M.PhX,{size:24})})]}),!1===g&&(0,i.jsx)(w.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:(0,i.jsxs)(l.Z,{spacing:2,alignItems:"center",sx:{py:4},children:[(0,i.jsx)(M.PhWarning,{size:48,color:"#ff6b35"}),(0,i.jsx)(s.Z,{variant:"h6",textAlign:"center",children:"Camera Permission Required"}),(0,i.jsx)(s.Z,{variant:"body2",textAlign:"center",color:"rgba(255,255,255,0.7)",children:"Please allow access to camera and microphone to record video"}),(0,i.jsx)(x.Z,{variant:"contained",onClick:O,sx:{bgcolor:"#013ffe","&:hover":{bgcolor:"#0056b3"}},children:"Request Permission"})]})}),(0,i.jsxs)(d.Z,{sx:{position:"relative",width:"100%",aspectRatio:"16/9",bgcolor:"#000",overflow:"hidden"},children:[(0,i.jsx)("video",{ref:Z,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),!!g&&(0,i.jsxs)(d.Z,{sx:{position:"absolute",bottom:13,left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:"4px"},children:[(0,i.jsx)(M.CustomRecord,{color:"#FE3666",sx:{fontSize:"8px"}}),(0,i.jsx)(s.Z,{variant:"body2",fontWeight:700,fontFamily:"Inter",fontSize:"14px",children:`${Math.floor(m/60).toString().padStart(2,"0")}:${(m%60).toString().padStart(2,"0")}`})]})]}),!!g&&(0,i.jsx)(l.Z,{spacing:2,alignItems:"center",sx:{marginY:2},children:(0,i.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:3},children:["completed"!==u&&(0,i.jsx)(w.E.div,{whileHover:{scale:1.05},whileTap:{scale:.95},animate:{scale:"recording"===u?[1,1.1,1]:1},children:(0,i.jsx)(d.Z,{onClick:N,sx:{width:50,height:50,borderRadius:"50%",border:"2px solid var(--Gray-700, #CCC)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.3s ease",..."recording"===u?{backgroundColor:"#FE3666",border:"none"}:{}},children:"recording"===u?(0,i.jsx)(d.Z,{sx:{display:"inline-block",width:24,height:24,backgroundColor:"#fff",borderRadius:"6px",transition:"all 0.3s ease"}}):(0,i.jsx)(d.Z,{sx:{display:"inline-block",width:24,height:24,backgroundColor:"#FE3666",borderRadius:"6px",transition:"all 0.3s ease"}})})}),"completed"===u&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,i.jsx)(d.Z,{onClick:H,sx:{width:50,height:50,borderRadius:"50%",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"2px solid rgba(239, 68, 68, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.3s ease","&:hover":{backgroundColor:"rgba(239, 68, 68, 0.2)",borderColor:"rgba(239, 68, 68, 0.5)"}},children:(0,i.jsx)(M.PhTrash,{size:24,color:"#ef4444"})})}),(0,i.jsx)(w.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,i.jsx)(d.Z,{onClick:$,sx:{width:50,height:50,borderRadius:"50%",backgroundColor:"rgba(59, 130, 246, 0.1)",border:"2px solid rgba(59, 130, 246, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.3s ease","&:hover":{backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgba(59, 130, 246, 0.5)"}},children:(0,i.jsx)(M.PhPlayFill,{size:24,color:"#3b82f6"})})})]})]})}),(0,i.jsx)(T.Z,{sx:{width:"100%",height:"1px",backgroundColor:"var(--Gray-200, #2E2E2E)"}}),(0,i.jsxs)(l.Z,{direction:"row",justifyContent:"space-between",spacing:2,sx:{width:"100%",paddingY:2,paddingX:3},children:[(0,i.jsx)(x.Z,{variant:"outlined",onClick:()=>{V(),r()},sx:{flex:1,py:1.5,color:"rgba(255, 255, 255, 0.9)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:2,textTransform:"none",fontSize:"16px",fontWeight:500,"&:hover":{borderColor:"rgba(255, 255, 255, 0.4)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),(0,i.jsx)(x.Z,{variant:"contained",onClick:()=>{if(!f){console.warn("Cannot confirm: No video blob available");return}if(m<a){console.warn(`Cannot confirm: Recording time (${m}s) is less than minimum duration (${a}s)`);return}o(f,m),V(),r()},disabled:!q,sx:{flex:1,py:1.5,borderRadius:2,textTransform:"none",fontSize:"16px",fontWeight:500,backgroundColor:q?"#3b82f6":"rgba(255, 255, 255, 0.2)",color:q?"white":"rgba(255, 255, 255, 0.5)","&:hover":{backgroundColor:q?"#2563eb":"rgba(255, 255, 255, 0.25)"},"&:disabled":{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},children:"Confirm"})]})]})})})}function F(e){let{videoUrl:t,onClose:r}=e;return(0,i.jsx)(D.Z,{open:!0,onClose:r,maxWidth:"md",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:3,bgcolor:"#1a1a1a",color:"white"}},children:(0,i.jsx)(_.Z,{children:(0,i.jsxs)(l.Z,{spacing:2,alignItems:"center",children:[(0,i.jsxs)(l.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,i.jsx)(s.Z,{variant:"h6",fontWeight:600,children:"Video Preview"}),(0,i.jsx)(I.Z,{onClick:r,sx:{color:"white"},children:(0,i.jsx)(M.PhX,{size:24})})]}),(0,i.jsx)(d.Z,{sx:{width:"100%",aspectRatio:"16/9",bgcolor:"#000",overflow:"hidden"},children:(0,i.jsx)("video",{src:t,controls:!0,style:{width:"100%",height:"100%",objectFit:"cover"},autoPlay:!0,playsInline:!0,muted:!0})})]})})})}function L(e){let{videoUrl:t,onDelete:r,poster:o}=e,[a,l]=(0,n.useState)(!1),[s,c]=(0,n.useState)(!1),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=u.current;if(!e)return;let t=()=>{c(!1)};return e.addEventListener("ended",t),()=>{e.removeEventListener("ended",t)}},[t]),(0,n.useCallback)(()=>{let e=u.current;e&&(s?e.pause():e.play(),c(!s))},[s]);let p=(0,n.useCallback)(e=>{e.stopPropagation(),u.current&&u.current.pause(),c(!1),null==r||r()},[r]);return(0,i.jsxs)(d.Z,{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),sx:{position:"relative",width:"100%",height:158,borderRadius:1,overflow:"hidden",backgroundSize:"100% 100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,i.jsx)("video",{ref:u,src:t,poster:o,controls:!0,style:{width:"100%",height:"100%"},preload:"metadata",playsInline:!0,onTouchEnd:()=>l(!0)}),(0,i.jsx)(j.M,{children:a&&r?(0,i.jsx)(w.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{position:"absolute",top:8,right:8},children:(0,i.jsx)(I.Z,{size:"small",onClick:p,sx:{color:"white",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"5px","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:(0,i.jsx)(M.PhTrash,{size:16,color:"var(--Gray-900, #FFF)"})})}):null})]})}var U=r(49218),W=r(49049),O=r(47485),G=r(93928);let A=e=>new Promise(t=>{try{let r=document.createElement("video");r.preload="metadata";let i=URL.createObjectURL(e);r.addEventListener("loadedmetadata",()=>{URL.revokeObjectURL(i);let e=r.videoWidth,o=r.videoHeight,a=e/o;a<.5||a>2?t(!1):t(!0)}),r.src=i}catch(e){return console.error("Failed to validate aspect ratio:",e),!0}}),H=e=>({"video/webm":"webm","video/mp4":"mp4","video/avi":"avi","video/mov":"mov","video/quicktime":"mov","video/x-msvideo":"avi","video/3gpp":"3gp","video/x-flv":"flv","video/x-ms-wmv":"wmv","video/matroska":"mkv"})[e.split(";")[0].trim()]||"webm",N=[{id:"upload",label:"Upload",icon:M.PhCloudArrowUp},{id:"history",label:"History",icon:M.PhClockCounterClockwise}],$=G.NT;function B(e){let{content:t,modelConfig:r,onSelectSource:o,onRemove:a}=e,[c,u]=(0,n.useState)(!1),[p,k]=(0,n.useState)(!1),[Z,R]=(0,n.useState)(""),[S,P]=(0,n.useState)(null),D=(0,n.useRef)(null),_=(0,n.useRef)(null),I=(0,n.useRef)(null),{mutateAsync:T}=(0,O.x)(),{isProcessingContent:F,setIsProcessingContent:G}=E(),B=(0,C.ez)(r,R),{uploadFile:K,isUploading:q,progress:X,reset:Y}=(0,W.k)({cdnFolder:"video/action-video",onSuccess:async e=>{try{let t=await T(e.url),r=(e.url.split("/").pop()||"Uploaded Video").replace(/\.[^/.]+$/,"");o("video","upload",e.url,{duration:t.duration,name:r})}catch(t){console.error("Failed to get video duration:",t),o("video","upload",e.url)}G(!1)},onError:e=>{R(e.message),G(!1)}}),Q=(0,n.useCallback)(async e=>{R(""),Y();try{if(G(!0),!await B(e,{validateDuration:!0}))return;if(!await A(e)){R("Video aspect ratio must be between 0.5 and 2");return}await K(e)}catch(e){console.error("Video validation failed:",e),R("Failed to validate video")}finally{G(!1)}},[Y,G,K,B]),{showModal:J}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onConfirm:t,minDuration:r=1,maxDuration:i=300}=e,{showModal:o}=(0,z.dd)();return{showModal:()=>{o(V,{minDuration:r,maxDuration:i,onConfirm:(e,r)=>{null==t||t(e,r)},onClose:()=>{}})}}}({minDuration:(null==r?void 0:r.minVideoDuration)??C.d_,maxDuration:(null==r?void 0:r.maxVideoDuration)??C.Fd,onConfirm:async(e,t)=>{try{I.current=t,Y(),G(!0);try{let t=Date.now(),r=`recording-${t}.${H(e.type)}`,i=await (0,C.EU)(e,r);await K(i)}finally{G(!1)}}catch(e){console.error("Video recording upload failed:",e),G(!1)}}}),{handleShowModal:ee}=(0,U.p)({type:"video",maxSelectionCount:1,onClose:async e=>{if(e&&e.length>0){let t=e[0];if(t.match(/\.(mp4|webm|mov|avi|mkv|qt)$/i)){if(!await B(t,{validateDuration:!0}))return;let e=await T(t);o("video","history",t,{duration:e.duration,name:"History Video"})}}}}),et=(e,t)=>{if(t.stopPropagation(),t.preventDefault(),"upload"===e.id){var r;null===(r=D.current)||void 0===r||r.click(),er()}else"history"===e.id&&(ee(),er())},er=()=>{P(null),u(!1)},ei=(0,n.useCallback)(async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(await Q(r),u(!1)),D.current&&(D.current.value="")},[Q]);(0,n.useEffect)(()=>{let e=e=>{_.current&&!_.current.contains(e.target)&&u(!1)};return c&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[c]);let eo=async e=>{e.preventDefault(),e.stopPropagation(),k(!1);let t=Array.from(e.dataTransfer.files)[0];if(t&&t.type.startsWith("video/")){if(!await B(t,{validateDuration:!0}))return;if(!await A(t)){R("Video aspect ratio must be between 0.5 and 2");return}await Q(t)}};return q||F?(0,i.jsxs)(d.Z,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,p:2,borderRadius:2,border:"2px dashed",borderColor:e=>e.palette.Colors.Gray["300"],height:158,backgroundColor:e=>e.palette.Colors.Gray["100"]},children:[(0,i.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"center"},children:[(0,i.jsx)(m.Z,{size:16,sx:{mr:1}}),(0,i.jsx)(s.Z,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:q?`Uploading... ${X}%`:F?"Processing...":"Preparing video..."})]}),q?(0,i.jsx)(d.Z,{sx:{width:"100%",mt:2},children:(0,i.jsx)(h.Z,{variant:"determinate",value:X,sx:{height:4,borderRadius:2,backgroundColor:"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:e=>e.palette.primary.main}}})}):null]}):t&&t.url?(0,i.jsx)(w.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,ease:"easeOut"},children:(0,i.jsx)(L,{videoUrl:t.url,onDelete:()=>{null==a||a(),I.current=null}})},"video-player"):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{ref:_,onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),k(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&k(!1)},onDrop:eo,sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,p:2,px:1,borderRadius:1,border:"1px dashed",borderColor:"transparent",cursor:"pointer",transition:"all 0.2s",backgroundColor:p?"rgba(0, 0, 0, 0.1)":"transparent","&:hover":{borderColor:e=>e.palette.Colors.Gray["300"]}},children:(0,i.jsx)(j.M,{mode:"wait",children:p?(0,i.jsxs)(w.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,padding:"16px 24px",borderRadius:8},children:[(0,i.jsx)(M.PhUploadSimple,{size:40}),(0,i.jsx)(s.Z,{variant:"body2",fontWeight:500,children:"Drop video here"})]},"dragover"):(0,i.jsxs)(w.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,borderRadius:8},children:[(0,i.jsxs)(l.Z,{direction:"column",spacing:1,alignItems:"center",children:[(0,i.jsx)(d.Z,{sx:{width:298,height:146,orderRadius:"8px"},children:(0,i.jsx)("video",{src:"https://cdn.openart.ai/production/2025-09/uploads/nIp59rPDHPc0MRaW2DWt/file_Rt9nh7vY_1758159737331.mp4",autoPlay:!0,muted:!0,loop:!0,style:{width:"100%",objectFit:"cover",borderRadius:"8px"}})}),(0,i.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,i.jsxs)(x.Z,{variant:"contained",sx:{background:"var(--Gray-300, #444)",color:"var(--Gray-700, #CCC)"},onClick:e=>{P(e.currentTarget)},children:[(0,i.jsx)(M.PhUploadSimple,{size:24,sx:{mr:.5},color:"#fff"}),(0,i.jsx)(s.Z,{variant:"body2",fontWeight:500,children:"Select Video"})]}),(0,i.jsxs)(x.Z,{variant:"contained",sx:{background:"var(--Gray-300, #444)",color:"var(--Gray-700, #CCC)",textTransform:"none"},onClick:e=>{e.stopPropagation(),e.preventDefault(),J(),u(!1)},children:[(0,i.jsx)(M.CustomRecord,{size:8,color:"#FA4D56",sx:{mr:.5}}),(0,i.jsx)(s.Z,{variant:"body2",fontWeight:500,children:"Record a Video"})]})]})]}),!!Z&&(0,i.jsx)(s.Z,{variant:"caption",sx:{color:"#ff4444",fontSize:"11px",textAlign:"center",fontWeight:500},children:Z})]},"default")})}),(0,i.jsx)(g.ZP,{open:!!S,anchorEl:S,onClose:er,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{mt:.5,boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.1)",minWidth:120}}},disableScrollLock:!0,children:(0,i.jsx)(v.Z,{sx:{p:0},children:null==N?void 0:N.map(e=>(0,i.jsxs)(f.Z,{onClick:t=>et(e,t),sx:{py:1,px:2,"&:hover":{backgroundColor:e=>e.palette.Colors.Gray["100"]}},children:[(0,i.jsx)(b.Z,{children:(0,i.jsx)(e.icon,{size:18})}),(0,i.jsx)(y.Z,{primary:e.label,primaryTypographyProps:{fontSize:14}})]},e.id))})}),(0,i.jsx)("input",{ref:D,type:"file",accept:$.join(","),onChange:ei,style:{display:"none"}})]})}var K=r(24475),q=r(76651),X=r(45138),Y=r(92832),Q=r(76602);let J={video:{id:"video",label:"Select Video",icon:M.PhVideoCamera,sx:{background:"#297743"}},image:{id:"image",label:"Select Image",icon:M.PhImage,sx:{background:"#846C10"}},character:{id:"character",label:"Character",icon:M.PhPersonArmsSpread,sx:{background:"#0063C5"}}},ee=[{id:"upload",label:"Upload",icon:M.PhUploadSimple},{id:"history",label:"History",icon:M.PhClockCounterClockwise}],et=(e,t)=>{let r=[];return e===a.V.VIDEO_ACTION_SYNC_VIDEO?(null==t||t.mediaType,[{...J.image,subOptions:ee},J.character]):[{id:"history",label:"History",icon:M.PhClockCounterClockwise}]};function er(e){var t;let{mode:r=a.V.VIDEO_ACTION_SYNC_VIDEO,modelConfig:o,visual:c,onSelectSource:u,onRemove:p,onDescriptionChange:x}=e,[k,Z]=(0,n.useState)(!1),[R,S]=(0,n.useState)(!1),[P,z]=(0,n.useState)(!1),[D,_]=(0,n.useState)(null),[T,V]=(0,n.useState)(null),[F,L]=(0,n.useState)(""),[O,G]=(0,n.useState)((null==c?void 0:c.description)||""),[A,H]=(0,n.useState)(!1),[N,$]=(0,n.useState)(null),B=(0,n.useRef)(null),J=(0,n.useRef)(null),ee=et(r,o),{isProcessingVisual:er}=E(),ei=(0,C.ez)(o,L),eo=(0,C.Cq)(o,L),{uploadFile:ea,isUploading:en,progress:el,reset:es}=(0,W.k)({cdnFolder:(null==T?void 0:T.id)==="video"?"videos/action-video":"images/action-video",onSuccess:async e=>{H(!0),$(e.url),u((null==T?void 0:T.id)||"image","upload",e.url,O),(0,K.setTimeout)(()=>{A&&(H(!1),$(null))},5e3)},onError:e=>{L(e.message),H(!1)}}),ed=(0,Y.Z)(T),ec=(0,n.useCallback)(async e=>{if(ed.current){L(""),es();try{let t="video"===ed.current.id||e.type.startsWith("video/"),r="image"===ed.current.id||e.type.startsWith("image/");if(t&&!await ei(e)||r&&!await eo(e))return;await ea(e)}catch(e){console.error("Validation failed:",e),L("Failed to validate media")}}},[ed,es,ea,ei,eo]),{handleShowModal:eu}=(0,U.p)({type:(null==T?void 0:T.id)==="video"?"video":"image",maxSelectionCount:1,onClose:async e=>{if(e&&e.length>0){let t=e[0],r=t.match(/\.(mp4|webm|mov|avi|mkv|qt)$/i)?"video":"image";if("image"!==r||await eo(t)){if("video"===r){if(!await ei(t))return;H(!0),$(t)}u(r,"history",t,O),(0,K.setTimeout)(()=>{A&&(H(!1),$(null))},5e3)}}}}),{showModal:ep}=(0,Q.x)({onCharacterSelect:async e=>{var t;let r=(null===(t=e.sample_images)||void 0===t?void 0:t.at(-1))||e.image_url||e.thumbnail;if(r){if(!await eo(r))return;u("image","character",r,O)}}}),em=(e,t)=>{t.stopPropagation(),t.preventDefault(),S(!0),e.subOptions?(_(t.currentTarget),V(e)):("character"===e.id?ep():u(e.id,e.id,void 0,O),S(!1))},eh=(e,t)=>{if(t.stopPropagation(),t.preventDefault(),"history"===e.id)eu(),ex();else if("upload"===e.id){var r;null===(r=J.current)||void 0===r||r.click(),ex()}else T&&(u(T.id,e.id,void 0,O),ex())},ex=()=>{_(null),S(!1)};(0,n.useEffect)(()=>{G((null==c?void 0:c.description)||"")},[null==c?void 0:c.description]),(0,n.useEffect)(()=>{if(A&&N&&(null==c?void 0:c.url)===N){let e="video"===c.type;(!e||e&&"number"==typeof c.duration)&&(H(!1),$(null))}},[c,A,N]);let eg=(0,n.useCallback)(async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&await ec(r),J.current&&(J.current.value="")},[ec]);(0,n.useEffect)(()=>{let e=e=>{B.current&&!B.current.contains(e.target)&&S(!1)};return R&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[R]);let ev=async e=>{e.preventDefault(),e.stopPropagation(),z(!1);let t=Array.from(e.dataTransfer.files)[0];if(t){let e=ee.find(e=>"video"===e.id),r=t.type.startsWith("video/"),i=t.type.startsWith("image/");if(r&&(!e||!await ei(t))||i&&!await eo(t))return;(r||i)&&(V({id:r?"video":"image",label:"",icon:null}),(0,K.setTimeout)(()=>{ec(t)},0))}};return en||A||er||el>0&&el<100?(0,i.jsxs)(d.Z,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,p:2,borderRadius:2,border:"2px dashed",borderColor:e=>e.palette.Colors.Gray["300"],height:158,backgroundColor:e=>e.palette.Colors.Gray["100"]},children:[(0,i.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"center"},children:[(0,i.jsx)(m.Z,{size:16,sx:{mr:1}}),(0,i.jsx)(s.Z,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:A||er?"Processing...":`Uploading... ${el}%`})]}),en?(0,i.jsx)(d.Z,{sx:{width:"100%",mt:2},children:(0,i.jsx)(h.Z,{variant:"determinate",value:el,sx:{height:4,borderRadius:2,backgroundColor:"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:e=>e.palette.primary.main}}})}):null]}):c?(0,i.jsxs)(l.Z,{spacing:1,children:[(0,i.jsxs)(d.Z,{ref:B,onMouseEnter:()=>Z(!0),onMouseLeave:()=>Z(!1),sx:{position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"#000",aspectRatio:"16/9",cursor:"pointer",height:158,border:"1px solid",borderColor:e=>e.palette.Colors.Gray["300"]},children:["image"===c.type||"character"===c.type?(0,i.jsx)(d.Z,{component:"img",src:c.url,alt:c.name,sx:{width:"100%",height:"100%",objectFit:"contain"}}):"video"===c.type?(0,i.jsx)(d.Z,{component:"video",src:c.url,controls:!0,sx:{width:"100%",height:"100%",objectFit:"contain"},playsInline:!0,onTouchEnd:()=>Z(!0)}):null,(0,i.jsx)(q.Z,{label:"character"===c.source?"character":c.type,size:"small",sx:{position:"absolute",top:8,left:8,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white"}}),(0,i.jsx)(j.M,{children:k?(0,i.jsx)(w.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"absolute",top:8,right:8},children:(0,i.jsx)(I.Z,{size:"small",onClick:e=>{e.stopPropagation(),null==p||p()},sx:{color:"white",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"5px","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:(0,i.jsx)(M.PhTrash,{size:16,color:"var(--Gray-900, #FFF)"})})}):null})]}),("image"===c.type||"character"===c.type)&&(null==o?void 0:o.supportDescription)!==!1&&(0,i.jsxs)(d.Z,{sx:{position:"relative"},children:[(0,i.jsx)(X.Z,{multiline:!0,minRows:4,maxRows:6,value:O,onChange:e=>{let t=e.target.value;G(t),null==x||x(t)},placeholder:"[Optional] Please provide a detailed description of the actions unfolding in the scene.",variant:"outlined",inputProps:{maxLength:800},sx:{width:"100%","& .MuiOutlinedInput-root":{paddingBottom:"24px",backgroundColor:"var(--Gray-100)",borderRadius:1,fontSize:"12px",lineHeight:"20px","& fieldset":{borderColor:"var(--Gray-300)"},"&:hover fieldset":{borderColor:"var(--Gray-400)"},"&.Mui-focused fieldset":{borderColor:"var(--Blue-500)",borderWidth:"1px"}},"& .MuiInputBase-input":{color:"var(--Gray-900)",fontSize:"12px",lineHeight:"20px","&::placeholder":{color:"var(--Gray-500)",opacity:1}}}}),(0,i.jsx)(d.Z,{sx:{position:"absolute",bottom:8,right:8,display:"flex",justifyContent:"flex-end",mt:.5},children:(0,i.jsxs)(s.Z,{variant:"caption",sx:{fontSize:"12px",color:O.length>720?"var(--Error)":O.length>600?"var(--Warning)":"var(--Gray-500)",fontWeight:O.length>720?500:400},children:[O.length,"/800"]})})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{ref:B,onMouseEnter:()=>Z(!0),onMouseLeave:()=>{Z(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),z(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&z(!1)},onDrop:ev,sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,p:2,borderRadius:1,border:"1px dashed",borderColor:"transparent",cursor:"pointer",transition:"all 0.2s",height:158,background:"url(https://cdn.openart.ai/assets/internal/uploads/image_RDHgIYnu_335x168_1758160435092.webp)",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",backgroundBlendMode:"lighten",mixBlendMode:"difference","&:hover":{borderColor:e=>e.palette.Colors.Gray["300"]}},children:(0,i.jsx)(j.M,{mode:"wait",children:P?(0,i.jsxs)(w.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,padding:"16px 24px",borderRadius:8},children:[(0,i.jsx)(M.PhUploadSimple,{size:40}),(0,i.jsx)(s.Z,{variant:"body2",fontWeight:500,children:"Drop image or video here"})]},"dragover"):k||R||F?(0,i.jsxs)(w.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,i.jsx)(l.Z,{direction:"row",spacing:1,sx:{p:2,borderRadius:2},children:ee.map(e=>(0,i.jsxs)(l.Z,{flexDirection:"column",alignItems:"center",sx:{p:1,px:.5,borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.16)",backdropilter:"blur(6.5px)",color:"#fff",transition:"all 0.2s","&:hover":{transform:"scale(1.05)"},...e.sx},onClick:t=>em(e,t),children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(e.icon,{size:24})}),(0,i.jsx)(s.Z,{variant:"body2",sx:{fontSize:"12px",minWidth:90,textAlign:"center"},children:e.label})]},e.id))}),!!((null==o?void 0:o.mediaType)==="video"&&(o.minVideoDuration||o.maxVideoDuration))&&(0,i.jsx)(s.Z,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"11px",textAlign:"center"},children:`Duration: ${o.minVideoDuration||0}s - ${o.maxVideoDuration||"∞"}s`}),!!F&&(0,i.jsx)(s.Z,{variant:"caption",sx:{color:"#ff4444",fontSize:"11px",textAlign:"center",fontWeight:500},children:F})]},"hover"):(0,i.jsxs)(w.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,padding:"8px",borderRadius:8},children:[(0,i.jsx)(d.Z,{component:"img",src:"https://cdn.openart.ai/assets/internal/uploads/image_UQHqCZu6_191x122_1761558546521.webp",sx:{height:69}}),(0,i.jsx)(s.Z,{variant:"body2",fontWeight:500,children:"+ Select Motion Visual"})]},"default")})}),(0,i.jsx)(g.ZP,{open:!!D,anchorEl:D,onClose:ex,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{mt:.5,boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.1)",minWidth:120}}},disableScrollLock:!0,children:(0,i.jsx)(v.Z,{sx:{p:0},children:null==T?void 0:null===(t=T.subOptions)||void 0===t?void 0:t.map(e=>(0,i.jsxs)(f.Z,{onClick:t=>eh(e,t),sx:{py:1,px:2,"&:hover":{backgroundColor:e=>e.palette.Colors.Gray["100"]}},children:[(0,i.jsx)(b.Z,{children:(0,i.jsx)(e.icon,{size:18})}),(0,i.jsx)(y.Z,{primary:e.label,primaryTypographyProps:{fontSize:14}})]},e.id))})}),(0,i.jsx)("input",{ref:J,type:"file",accept:(null==T?void 0:T.id)==="video"?"video/*":"image/*",onChange:eg,style:{display:"none"}})]})}var ei=r(19005),eo=r(38218);let ea=(e,t)=>Math.ceil(t),en=(e,t,r,i)=>{let o={};return"wan2.2-v1"===e&&r.forEach(e=>{let r=(0,eo.UC)(e),a=(null==r?void 0:r.credit)??0,n=0;"full_scene"===t?1080===i&&(n=5):"motion_sync"===t&&(n=1080===i?15:5),o[e]=a+n}),o};var el=r(16585),es=r(63659),ed=r(67936),ec=r(70811),eu=r(32964),ep=r(89252);function em(e){return(0,i.jsx)(es.X,{sx:{height:32},label:(0,i.jsx)(ec.Z,{children:(0,i.jsx)(s.Z,{fontSize:12,fontWeight:500,children:"ExpressionIntensity"})}),labelWidth:"40%",contentWidth:"60%",content:(0,i.jsxs)(ec.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,i.jsx)(ed.ZP,{value:e.value,onChange:(t,r)=>{e.onChange(r)},min:1,max:5,step:1,sx:{"& .MuiSlider-root":{touchAction:"none"},"& .MuiSlider-thumb":{backgroundColor:"white",border:`3px solid ${ep.Hp}`,width:16,height:16,touchAction:"none"},"& .MuiSlider-rail":{backgroundColor:"#555"},"& .MuiSlider-track":{backgroundColor:ep.te,opacity:1}}}),(0,i.jsx)(eu.Z,{sx:{backgroundColor:"#333",borderRadius:ep.zO,padding:"1px 7px",minWidth:32,textAlign:"center"},children:(0,i.jsx)(s.Z,{fontWeight:400,color:"white",fontSize:12,children:e.value})})]})})}var eh=r(8740),ex=r(3689),eg=(0,r(99664).Z)((0,i.jsx)("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zM6 20V4h7v5h5v11zm8-6 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFileOutlined"),ev=r(22339),ef=r(45308);let eb="runway-act2",ey={"action-sync":{title:"Motion-Sync Video",description:"Sync your character with motion from a reference video. ",supportMediaTypes:["image","video"]}},ew=[{value:"motion_sync",label:"Character-Guided",icon:(0,i.jsx)(ex.Z,{sx:{marginRight:1}}),placement:"bottom-start",ariaLabel:"Character-Guided",exampleImageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_H1c-TLjj_1024x1024_1758183262519.webp",exampleVideoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nIp59rPDHPc0MRaW2DWt/file_bSbZwbKE_1758183189132.mp4",outputVideoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nIp59rPDHPc0MRaW2DWt/file_bSbZwbKE_1758183189132.mp4",description:"Your character's form leads the motion for a more natural fit.",title:"Your character's form leads the motion for a more natural fit."},{value:"full_scene",label:"Video-Guided",icon:(0,i.jsx)(eg,{sx:{marginRight:1}}),placement:"bottom-end",ariaLabel:"Video-Guided",exampleImageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_H1c-TLjj_1024x1024_1758183262519.webp",exampleVideoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nIp59rPDHPc0MRaW2DWt/file_bSbZwbKE_1758183189132.mp4",outputVideoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nIp59rPDHPc0MRaW2DWt/file_bSbZwbKE_1758183189132.mp4",description:"The video's movement and rhythm drive your character's motion.",title:"The video's movement and rhythm drive your character's motion."}];function ej(e){let{mode:t,...r}=e,{visual:o,content:a,selectedModel:m,setVisual:h,setVisualFromHistory:x,clearVisual:g,setContent:v,clearContent:f,setSelectedModel:b,ratio:y,setRatio:w,expressionIntensity:j,setExpressionIntensity:k,prompt:Z,setPrompt:R,getSegmentTarget:S,wan22Type:P,setWan22Type:z,resolution:D,setResolution:_}=E(),{type:I}=r,{title:T,description:M,supportMediaTypes:V=[]}=ey[I]||{},F=(0,C.tf)();(0,n.useEffect)(()=>{b(eb),z(ew[0].value),_(720)},[]);let{addMockingGeneration:L,removeMockingGenerationByRequestId:U,updateResourceIdByRequestId:W}=(0,p.F)(),O=(0,c.NL)(),A=async()=>{if(!m){console.error("No model selected");return}let e={characterUrl:(null==o?void 0:o.url)||"",characterType:null==o?void 0:o.type,referenceUrl:(null==a?void 0:a.url)||"",referenceType:"video",model:m,ratio:y,expressionIntensity:j,prompt:Z,segmentTarget:S(),wan22Type:P,resolution:D};if(!(0,C.DP)(e))return;let t=L({turbo_mode:"normal"});try{let r=await F.mutateAsync(e);W(t,[r.generation_media_resource_id]),await O.invalidateQueries([ei.uE]),await O.invalidateQueries({queryKey:["useGenerationHistories"],exact:!1}),(0,el.B)("asset_created",{creation_source:"actionsync",image_num:1,credits_num:K||0,model_name:m,page_type:I})}catch(e){console.error("Creation failed:",e),U(t)}},H=async(e,t,r,i)=>{r&&await x({url:r,source:t,mediaType:e,description:i})},N=(e,t,r,i)=>{r?v({id:(0,u.x0)(),url:r,name:(null==i?void 0:i.name)||r.split("/").pop()||("record"===e?"Video Recording":"Uploaded Video"),type:e,duration:null==i?void 0:i.duration}):v({id:(0,u.x0)(),type:e})},$=(null==o?void 0:o.url)&&(null==a?void 0:a.url)&&m&&!F.isLoading,K=(0,n.useMemo)(()=>{if(!m)return 0;let e=G.ak[m];if(e){let t=e.featureKeys;return(0,eo.du)(t,t.reduce((e,t)=>(e[t]=ea(m,(null==a?void 0:a.duration)??0),e),{}),en(m,P,t,D))}return 0},[m,null==a?void 0:a.duration,null==o?void 0:o.duration,P,D]);return(0,i.jsxs)(l.Z,{direction:"column",spacing:2,sx:{position:"relative",height:"100%",py:1.5,px:.5,backgroundColor:"#1a1a1a",color:"white"},children:[(0,i.jsxs)(l.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{pb:2,borderBottom:"1px solid",borderColor:e=>e.palette.Colors.Gray["200"]},children:[(0,i.jsx)(s.Z,{variant:"h6",fontWeight:600,sx:{whiteSpace:"nowrap",color:"white",fontSize:"18px"},children:T}),(0,i.jsx)(eh.oK,{handleTryExample:()=>{H("image","example","https://cdn.openart.ai/assets/internal/uploads/image_H1c-TLjj_1024x1024_1758183262519.webp"),N("video","example","https://cdn.openart.ai/production/2025-09/uploads/nIp59rPDHPc0MRaW2DWt/file_bSbZwbKE_1758183189132.mp4",{duration:11,name:"Example Video"}),b(eb)}})]}),(0,i.jsxs)(d.Z,{sx:{flex:"1 1 auto",overflowY:"auto",overflowX:"hidden"},children:[(0,i.jsx)(s.Z,{component:"div",variant:"subtitle1",fontWeight:600,sx:{color:"white",fontSize:"14px",mb:1},children:"Model"}),(0,i.jsx)(ef.o,{value:m,onChange:b,supportMediaTypes:V,modelOptions:G.ak}),(0,i.jsxs)(l.Z,{spacing:1,sx:{p:1,mb:2,borderRadius:1,border:"1px solid",borderColor:e=>e.palette.Colors.Gray["200"]},children:[(0,i.jsx)(s.Z,{component:"div",variant:"subtitle1",fontWeight:600,sx:{color:"white",fontSize:"16px",mb:1},children:"1. Select Your Character"}),(0,i.jsx)(er,{mode:t,visual:o,modelConfig:m?G.ak[m]:void 0,onSelectSource:H,onRemove:g,onDescriptionChange:e=>{o&&h({...o,description:e})}})]}),(0,i.jsxs)(l.Z,{spacing:1,sx:{p:1,mb:2,borderRadius:1,border:"1px solid",borderColor:e=>e.palette.Colors.Gray["200"]},children:[(0,i.jsx)(s.Z,{variant:"subtitle1",fontWeight:600,sx:{color:"white",fontSize:"16px",mb:1},children:"2. Add Motion Reference"}),(0,i.jsx)(B,{content:a||void 0,modelConfig:m?G.ak[m]:void 0,onSelectSource:N,onRemove:f})]}),"runway-act2"===m&&(0,i.jsx)(l.Z,{direction:"column",spacing:1,sx:{mt:2},children:(0,i.jsx)(em,{value:j,onChange:k})}),"wan2.2-v1"===m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eh.Q0,{label:"Motion Sync Style",value:P,setValue:z,options:ew,border:!1}),(0,i.jsx)(eh.H_,{label:"Resolution",resolution:D,setResolution:_,border:!1,resolutions:[720,1080]}),(0,i.jsx)(eh.I5,{prompt:Z,setPrompt:R,label:"Prompt (optional)",placeholder:"Describe how the video should be extended"})]})]}),(0,i.jsx)(ev.X,{loading:F.isLoading,disabled:!$,costCredits:K,onClick:A})]})}var eC=r(92744),ek=r(60503),eZ=r(31695),eR=r(35023),eS=r(38447),eP=r(64134),eE=!0;function ez(e){return(0,i.jsx)(o.a,{value:a.V.VIDEO_ACTION_SYNC_VIDEO,children:(0,i.jsxs)(eP.g,{ogConfig:eR.Gb,children:[(0,i.jsx)(ek._,{width:"370px",title:"Motion-Sync Video",serverProps:e,Sidebar:ej,sidebarProps:{type:"action-sync"}}),(0,i.jsx)(eC.Z,{serverProps:e,renderMainContent:eZ.L})]})})}ez.getLayout=(e,t)=>(0,i.jsx)(eS.$,{...t,children:e})}},function(e){e.O(0,[4354,4164,9686,9551,3262,4216,2088,7326,3003,5065,1278,9474,416,2004,1406,3343,3680,5966,669,6380,6478,2888,9774,179],function(){return e(e.s=59501)}),_N_E=e.O()}]);
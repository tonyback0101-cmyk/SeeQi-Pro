"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[722],{1663:function(e,t,i){i.d(t,{w:function(){return o}});var r=i(75271),n=i(71461);let o=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],[i,o]=(0,r.useState)(null),a=(0,r.useRef)(e);(0,r.useEffect)(()=>{a.current!==e&&o(null),a.current=e},[e]);let s=(0,r.useMemo)(()=>e?`stories/workflow/status_sse?workflowRunId=${encodeURIComponent(e)}`:"",[e]),l=t&&!!e&&"undefined"!==e,d=(0,r.useCallback)(e=>{try{if(!e.data||""===e.data.trim())return;let t=JSON.parse(e.data);if(!t.workflowRunId||!t.status)return;o(t)}catch(t){throw console.error("[SSE Single] Failed to parse SSE data:",t,"Raw data:",e.data),Error("Failed to parse status update")}},[]),c=(0,r.useCallback)(e=>{var t;if(null===(t=e.message)||void 0===t?void 0:t.includes("400"))throw Error("Invalid workflow ID")},[]),u=(0,n.D)({url:s,method:"GET",enabled:l,logPrefix:"[SSE Single]",onMessage:d,onError:c});return{data:i,isConnected:u.isConnected,error:u.error,connect:u.connect,disconnect:u.disconnect,isLoading:u.isLoading}}},3935:function(e,t,i){i.d(t,{i:function(){return o}});var r=i(75271),n=i(71461);let o=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2?arguments[2]:void 0,[o,a]=(0,r.useState)([]),s=(0,r.useRef)(new Set(e||[])),l=(0,r.useMemo)(()=>e&&0!==e.length?e.join(","):"",[e]),d=(0,r.useCallback)(e=>{try{if(!e.data||""===e.data.trim())return;let t=JSON.parse(e.data);if(!t.workflowRunId||!t.status){console.warn("[SSE Multi] Invalid data structure received:",t);return}if(!s.current.has(t.workflowRunId))return;try{i(t.workflowRunId,t)}catch(e){console.error(`[SSE Multi] Error in status change handler for ${t.workflowRunId}:`,e)}("completed"===t.status||t.status.startsWith("failed"))&&(s.current.delete(t.workflowRunId),a(e=>e.filter(e=>e!==t.workflowRunId)))}catch(t){throw console.error("[SSE Multi] Unexpected error in onmessage:",t,"Raw event:",e),Error("Failed to process status update")}},[i]),c=(0,r.useCallback)(e=>{var t;if(null===(t=e.message)||void 0===t?void 0:t.includes("400"))throw Error("Invalid workflow IDs")},[]),u=(0,r.useCallback)(async t=>{s.current=new Set(e),a(e)},[e]),p=(0,n.D)({url:"stories/workflow/status_sse",method:"POST",body:JSON.stringify({workflowRunIds:e}),enabled:t&&!!e&&e.length>0,logPrefix:"[SSE Multi]",dependencies:[l],onMessage:d,onError:c,onOpen:u});return(0,r.useEffect)(()=>{p.isConnected||(a([]),s.current.clear())},[p.isConnected]),{isConnected:p.isConnected,error:p.error,connect:p.connect,disconnect:p.disconnect,isLoading:p.isLoading,activeWorkflows:o}}},44616:function(e,t,i){i.d(t,{q8:function(){return s}});var r=i(52934);let n=e=>{var t,i,r,n;if((null==e?void 0:e.video_type)==="lyrics-video")return null==e?void 0:e.num_shots;let o=(null==e?void 0:e.music_duration)||10,a=5;(null==e?void 0:e.video_type)!=="singing-dancing"&&(a=(null==e?void 0:null===(n=e.advanced_settings)||void 0===n?void 0:null===(r=n.video_model_config)||void 0===r?void 0:r.model)==="MiniMax-Hailuo-02"?6:5),"singing-dancing"===e.video_type&&(null==e?void 0:null===(i=e.advanced_settings)||void 0===i?void 0:null===(t=i.video_model_config)||void 0===t?void 0:t.model)==="creatify-aurora"&&(a=15);let s=Math.floor(o/a),l=o-s*a;return 0===s?o>0?1:0:l>1?s+1:s},o=e=>{var t,i;let r=(null==e?void 0:e.expected_duration_seconds)||30,n=5,o=null==e?void 0:null===(i=e.advanced_settings)||void 0===i?void 0:null===(t=i.video_model_config)||void 0===t?void 0:t.model;"MiniMax-Hailuo-02"===o?n=6:"creatify-aurora"===o&&(n=15);let a=Math.floor(r/n),s=r-a*n;return 0===a?r>0?1:0:s>1?a+1:a},a={"story.character_vlog":{baseCost:25,costFactors:[{name:"generate_script_cost",unitCost:20,calculator:()=>1},{name:"image_generation",unitCost:e=>{var t,i,r,n,o;let a=null==e?void 0:null===(i=e.advanced_settings)||void 0===i?void 0:null===(t=i.image_model_config)||void 0===t?void 0:t.model;if("gpt"===a){let t=null==e?void 0:null===(o=e.advanced_settings)||void 0===o?void 0:null===(n=o.image_model_config)||void 0===n?void 0:null===(r=n.parameters)||void 0===r?void 0:r.quality;a=`${a}-${t}`}return({fluxdev:10,flux_kontext:15,character:10,"gpt-low":15,"gpt-medium":30,"gpt-high":100,seedream4:15,"nano-banana":15,"qwen-image":10})[a]||10},calculator:e=>o(e)},{name:"video_generation",unitCost:e=>{var t,i,r,n,o,a,s,l,d,c;let u=null==e?void 0:null===(i=e.advanced_settings)||void 0===i?void 0:null===(t=i.video_model_config)||void 0===t?void 0:t.model,p=null==e?void 0:null===(o=e.advanced_settings)||void 0===o?void 0:null===(n=o.video_model_config)||void 0===n?void 0:null===(r=n.parameters)||void 0===r?void 0:r.resolution,h=null==e?void 0:null===(l=e.advanced_settings)||void 0===l?void 0:null===(s=l.video_model_config)||void 0===s?void 0:null===(a=s.parameters)||void 0===a?void 0:a.videoMode,m=(null==p?void 0:null===(d=p.toLowerCase)||void 0===d?void 0:d.call(p))||"720p";return(null===(c=({"pixverse4.5":{"360p":75,"720p":100,"1080p":200},pixverse5:{"360p":75,"720p":100,"1080p":200},"kling2-5":{"1080p":100},"kling2.1":{"720p":100,"1080p":200},"seedance-v1":{"720p":100},"MiniMax-Hailuo-02":{"768p":60},"wan-i2v":{"720p":100},"wan2.2-i2v":{"720p":100},"wan-multi-talk":{"720p":100},hedra:{"720p":100},"creatify-aurora":{"720p":800},"vidu-q2":{"720p":"turbo"===h?100:150,"1080p":"turbo"===h?200:350}})[u])||void 0===c?void 0:c[m])||100},calculator:e=>o(e)}]},"story.music_video":{baseCost:25,costFactors:[{name:"generate_script_cost",unitCost:20,calculator:e=>1},{name:"audio_analysis",unitCost:10,calculator:e=>"singing-dancing"===e.video_type?1:"consistent-style"===e.video_type&&"auto"===e.video_consistent_style||"consistent-character"===e.video_type?2:(e.video_type,1)},{name:"image_generation",unitCost:e=>{var t,i,r,n,o;let a=null==e?void 0:null===(i=e.advanced_settings)||void 0===i?void 0:null===(t=i.image_model_config)||void 0===t?void 0:t.model;if("gpt"===a){let t=null==e?void 0:null===(o=e.advanced_settings)||void 0===o?void 0:null===(n=o.image_model_config)||void 0===n?void 0:null===(r=n.parameters)||void 0===r?void 0:r.quality;a=`${a}-${t}`}return({fluxdev:10,flux_kontext:15,character:10,"gpt-low":15,"gpt-medium":30,"gpt-high":100,seedream4:15,"nano-banana":15,"qwen-image":10})[a]||10},calculator:e=>n(e)},{name:"video_generation",unitCost:e=>{var t,i,r,n,o,a,s,l,d;if(null==e?void 0:e.skip_video_generation)return 0;let c=null==e?void 0:null===(i=e.advanced_settings)||void 0===i?void 0:null===(t=i.video_model_config)||void 0===t?void 0:t.model,u=null==e?void 0:null===(o=e.advanced_settings)||void 0===o?void 0:null===(n=o.video_model_config)||void 0===n?void 0:null===(r=n.parameters)||void 0===r?void 0:r.resolution,p=null==e?void 0:null===(l=e.advanced_settings)||void 0===l?void 0:null===(s=l.video_model_config)||void 0===s?void 0:null===(a=s.parameters)||void 0===a?void 0:a.videoMode;return(null===(d=({"pixverse4.5":{"360p":75,"720p":100,"1080p":200},pixverse5:{"360p":75,"720p":100,"1080p":200},"kling2-5":{"1080p":100},"kling2.1":{"720p":100,"1080p":200},"seedance-v1":{"720p":100},"MiniMax-Hailuo-02":{"768p":60},"wan-i2v":{"720p":100},"wan2.2-i2v":{"720p":100},"wan-multi-talk":{"720p":100},hedra:{"720p":100},"creatify-aurora":{"720p":800},"vidu-q2":{"720p":"turbo"===p?100:150,"1080p":"turbo"===p?200:350}})[c])||void 0===d?void 0:d[(null==u?void 0:u.toLowerCase())||"720p"])||100},calculator:e=>n(e)},{name:"video_generation_upscale",unitCost:100,calculator:e=>(null==e?void 0:e.upscale_to_resolution)==="1080p"||(null==e?void 0:e.upscale_to_resolution)==="2K"?n(e):0,condition:e=>(null==e?void 0:e.upscale_to_resolution)==="1080p"||(null==e?void 0:e.upscale_to_resolution)==="2K"}]},"story.script_to_video":{baseCost:r.v["story.script_to_video"].credit,costFactors:[]},"story.asmr_video":{baseCost:r.v["story.asmr_video"].credit,costFactors:[{name:"video_generation",unitCost:560,calculator:e=>(null==e?void 0:e.num_shots)??3}]}};function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("story.create_from_scratch"===e)return{totalCredits:0,totalCreditsExcludingVideoGeneration:0,totalCreditsVideoGeneration:0,breakdown:[]};if("story.script_to_video"===e)return{totalCredits:r.v["story.script_to_video"].credit,totalCreditsExcludingVideoGeneration:100,totalCreditsVideoGeneration:1e3,breakdown:[]};let n=a[e];if(!n)throw Error(`Unknown story type: ${e}`);let o=[],s=n.baseCost;for(let e of(o.push({factor:"base_cost",unitCost:n.baseCost,quantity:1,subtotal:n.baseCost}),n.costFactors)){var l;if(e.condition&&!e.condition(t))continue;let r=(null===(l=i.customCosts)||void 0===l?void 0:l[e.name])??e.unitCost,n=e.calculator(t),a="function"==typeof r?r(t)*n:r*n;s+=a,o.push({factor:e.name,unitCost:"function"==typeof r?r(t):r,quantity:n,subtotal:a})}if(n.modifiers){for(let e of n.modifiers)if(e.condition(t)){let t=s*(e.multiplier-1);s*=e.multiplier,o.push({factor:`modifier_${e.name}`,unitCost:t,quantity:1,subtotal:t})}}let d=Math.ceil(o.filter(e=>!e.factor.startsWith("video_generation")).reduce((e,t)=>e+t.subtotal,0));return{totalCredits:Math.ceil(s),totalCreditsExcludingVideoGeneration:d,totalCreditsVideoGeneration:s-d,breakdown:o}}},9421:function(e,t,i){i.d(t,{K:function(){return o}});var r=i(13200),n=i(81833);function o(){let{provider:e=n.yC,onVoiceListUpdated:t,enabled:i=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.a)({queryKey:["audio","voices",e],queryFn:async()=>{let t=new URLSearchParams;e&&t.append("provider",e);let i=await fetch(`/api/audio/voices?${t.toString()}`);if(!i.ok)throw Error((await i.json().catch(()=>({message:"Failed to fetch voices"}))).message||`HTTP ${i.status}: ${i.statusText}`);let r=await i.json();if(!r.success||!r.data)throw Error("Invalid response format from voices API");return r.data},enabled:i,onSuccess:e=>{t&&e&&t(e)},onError:t=>{console.error(`[useVoiceList] Error fetching voices from ${e}:`,t)},staleTime:3e5,cacheTime:6e5})}},85963:function(e,t,i){i.d(t,{z:function(){return d}});var r=i(52676),n=i(75271),o=i(22988);let a=new Map,s=Array.from({length:15},()=>60*Math.random()+20),l=Array.from({length:15},()=>60*Math.random()+20),d=n.memo(e=>{let{audioUrl:t,sx:i,samples:d=1e3,barColor:c="#6290FF"}=e,[u,p]=(0,n.useState)([]),[h,m]=(0,n.useState)([]),[x,g]=(0,n.useState)(0),[f,v]=(0,n.useState)(!1),b=(0,n.useRef)(null),y=(0,n.useRef)(null),w=(0,n.useCallback)(e=>{let t=e.getChannelData(0),i=Math.floor(t.length/d),r=[];for(let e=0;e<d;e++){let n=i*e,o=0;for(let e=0;e<i;e++)o+=Math.abs(t[n+e]);r.push(o/i)}let n=Math.max(...r);return r.map(e=>e/n)},[d]),C=(0,n.useCallback)(()=>{if(0===u.length||0===x){m([]);return}let e=Math.floor(x/4);if(u.length<=e)m(u);else{let t=[],i=u.length/e;for(let r=0;r<e;r++){let e=Math.floor(r*i);t.push(u[e])}m(t)}},[u,x]),j=(0,n.useCallback)(async()=>{if(!t)return;let e=a.get(t);if(e){p(e);return}v(!0);try{b.current||(b.current=new(window.AudioContext||window.webkitAudioContext));let e=await fetch(t),i=await e.arrayBuffer(),r=await b.current.decodeAudioData(i),n=w(r);a.set(t,n),p(n)}catch(e){console.error("Error loading audio or generating waveform:",e),p([])}finally{v(!1)}},[t,w]);(0,n.useEffect)(()=>{j()},[j]),(0,n.useEffect)(()=>{C()},[C]),(0,n.useEffect)(()=>{let e=null,t=null,i=0,r=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(y.current){let o=y.current.getBoundingClientRect();o.width>0?(g(o.width),i=o.width,e||(e=new ResizeObserver(e=>{null!==t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{for(let t of e){let e=t.contentRect.width;e>0&&Math.abs(e-i)>5&&(g(e),i=e)}t=null})})).observe(y.current)):n<10&&setTimeout(()=>r(n+1),10*(n+1))}else n<10&&setTimeout(()=>r(n+1),10*(n+1))};return r(),()=>{e&&e.disconnect(),null!==t&&cancelAnimationFrame(t)}},[]);let k={width:"100%",height:"16px",backgroundColor:"transparent",borderRadius:"2px",marginRight:"4px",position:"relative",display:"flex",alignItems:"center",justifyContent:"space-evenly",gap:"2px",overflow:"hidden",...i},F=(0,n.useMemo)(()=>(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",gap:"2px",height:"100%"},children:Array.from({length:20}).map((e,t)=>(0,r.jsx)(o.Z,{sx:{width:2,height:`${70*Math.random()+30}%`,backgroundColor:"rgba(184, 212, 255, 0.3)",borderRadius:"1px",animation:"pulse 1.5s ease-in-out infinite",animationDelay:`${.1*t}s`,"@keyframes pulse":{"0%, 100%":{opacity:.3},"50%":{opacity:.8}}}},t))}),[]);return(0,r.jsx)(o.Z,{ref:y,sx:k,className:"audio-waveform",children:t?f?F:h.length>0?h.map((e,t)=>(0,r.jsx)(o.Z,{sx:{flex:"0 0 2px",width:2,height:`${Math.max(100*e,5)}%`,backgroundColor:c,borderRadius:"1px"}},t)):(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",gap:"2px",height:"100%"},children:l.map((e,t)=>(0,r.jsx)(o.Z,{sx:{width:2,height:`${e}%`,backgroundColor:"rgba(184, 212, 255, 0.25)",borderRadius:"1px"}},t))}):(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",gap:"2px",height:"100%"},children:s.map((e,t)=>(0,r.jsx)(o.Z,{sx:{width:2,height:`${e}%`,backgroundColor:"rgba(184, 212, 255, 0.2)",borderRadius:"1px"}},t))})})},(e,t)=>e.audioUrl===t.audioUrl&&e.barColor===t.barColor&&e.samples===t.samples);d.displayName="AudioWaveform"},88764:function(e,t,i){i.d(t,{Bx:function(){return r.Bx},EL:function(){return r.EL},GH:function(){return n.GH},HM:function(){return r.HM},Jo:function(){return r.Jo},MH:function(){return n.MH},N1:function(){return o.N1},lk:function(){return n.lk},nn:function(){return o.nn},oH:function(){return r.oH},rB:function(){return n.rB},uO:function(){return n.uO},vi:function(){return o.vi}});var r=i(47462),n=i(9479),o=i(22112)},47462:function(e,t,i){i.d(t,{Bx:function(){return p},EL:function(){return g},HM:function(){return m},Jo:function(){return h},PL:function(){return u},oH:function(){return f}});var r=i(75271),n=i(13200),o=i(75616),a=i(21964),s=i(10986),l=i(66627),d=i(46973),c=i(33010);let u={all:["shots"],media:(e,t)=>["shots",e,t,"media"]},p=(e,t)=>{let{enqueueSnackbar:i}=(0,s.Ds)();return(0,n.a)({queryKey:u.media(e||"",t||""),queryFn:async()=>{if(!e||!t)return{images:[],videos:[]};let i=await fetch(`/api/stories/${e}/shots/${t}`);if(!i.ok)throw Error(`Failed to load shot media: ${i.statusText}`);return(await i.json()).media_resources||{images:[],videos:[]}},enabled:!!e&&!!t,onError:e=>{console.error("Error loading shot media:",e),i(`Error: ${e.message}`,{variant:"error"})}})},h=e=>{let t=(0,o.NL)(),{enqueueSnackbar:i}=(0,s.Ds)();return(0,a.D)({mutationFn:async t=>{let{shotId:i,promptData:r}=t;if(!e)throw Error("No story ID provided");let n=await fetch(`/api/stories/${e}/shots/${i}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw Error(`Failed to update shot prompts: ${n.statusText}`);return await n.json()},onSuccess:r=>{t.invalidateQueries({queryKey:l.Y.detail(e||"")}),i("Shot prompts updated successfully",{variant:"success"})},onError:e=>{console.error("Error updating shot prompts:",e),i(`Error: ${e.message}`,{variant:"error"})}})},m=e=>{let t=(0,o.NL)(),{enqueueSnackbar:i}=(0,s.Ds)();return(0,a.D)({mutationFn:async t=>{let{shotId:i,mediaType:r,mediaId:n,mediaUrl:o}=t;if(!e)throw Error("No story ID provided");let a=await fetch(`/api/stories/${e}/shots/${i}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active_media:{media_type:r,media_id:n,media_url:o}})});if(!a.ok)throw Error(`Failed to set active media: ${a.statusText}`);return await a.json()},onSuccess:(r,n)=>{t.invalidateQueries({queryKey:l.Y.detail(e||"")}),i(`Active ${n.mediaType} updated successfully`,{variant:"success"})},onError:(e,t)=>{console.error(`Error setting active ${t.mediaType}:`,e),i(`Error: ${e.message}`,{variant:"error"})}})},x=()=>{let[e,t]=(0,r.useState)({});return{pollWorkflowStatus:async e=>{for(let i=0;i<100;i++){await new Promise(e=>setTimeout(e,3e3));let i=await d.ZP.post("/stories/workflow/status",{workflowRunIds:e});if(200!==i.status)throw Error(i.data.error||`Polling failed with status ${i.status}`);let r=i.data;if("RUN_SUCCESS"===r.status)return r.output;if("RUN_FAILED"===r.status){var t;throw console.error("Workflow failed:",r.error,r),Error((null===(t=r.error)||void 0===t?void 0:t.message)||r.error||"Workflow execution failed")}if("RUN_CANCELED"===r.status)throw Error("Workflow was canceled")}throw Error(`Workflow ${e} timed out after 100 attempts.`)},pollingErrors:e,setPollingErrors:t}},g=e=>{let t=(0,o.NL)(),{enqueueSnackbar:i}=(0,s.Ds)(),{pollWorkflowStatus:n}=x(),[a,c]=(0,r.useState)({}),[p,h]=(0,r.useState)({});return{regenerateMedia:async function(r,o,a,s,p){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];if(!e)throw Error("No story ID provided");let x=1===o.length?o[0]:"both";h(e=>({...e,[r]:{workflowRunId:void 0,error:void 0,regeneratingType:x}})),c(e=>({...e,[r]:!0}));try{let c={media_types:o,image_prompt:a,video_prompt:s};p&&(c.advanced_settings=p),m&&(c.reference_image_urls=m);let x=await d.ZP.post(`/stories/workflow/regenerate_shot?storyId=${e}&shotId=${r}`,c);if(200!==x.status){let e=x.data.catch(()=>({error:`Failed to start regeneration: ${x.statusText}`}));throw Error(e.error||`Failed to start regeneration: ${x.statusText}`)}let{workflowRunId:g}=x.data;if(!g)throw Error("workflowRunId not found in regeneration response");try{h(e=>({...e,[r]:{...e[r],workflowRunId:g}}));let a=await n(g);if(!a||!a.success)throw Error((null==a?void 0:a.error)||"Workflow completed but indicated failure or missing output.");return t.invalidateQueries({queryKey:l.Y.detail(e)}),t.invalidateQueries({queryKey:u.media(e,r)}),i(`Shot ${o.join(" and ")} regenerated successfully via workflow`,{variant:"success"}),a}finally{h(e=>({...e,[r]:{...e[r],workflowRunId:void 0}}))}}catch(e){throw console.error("Error in regenerateShotMedia process:",e),i(`Error: ${e.message}`,{variant:"error"}),h(t=>({...t,[r]:{...t[r],error:e.message}})),e}finally{c(e=>({...e,[r]:!1}))}},regeneratingShots:a,pollingState:p}},f=()=>{let e=(0,o.NL)(),{enqueueSnackbar:t}=(0,s.Ds)(),{pollWorkflowStatus:i}=x(),[n,a]=(0,r.useState)(!1),[l,u]=(0,r.useState)(null);return{rebuildTimelineAndExport:async(r,n,o)=>{a(!0),u(null);try{let a=await d.ZP.post("/stories/workflow/rebuild_timeline_and_export",{story_id:r,force_music_reselection:n||!1,rebuild_timeline:o||!1});if(200!==a.status)throw Error(`Failed to start recovery: ${a.data.error}`);let s=a.data;if(s.workflowRunId){u(s.workflowRunId);let r=o?"Recovery (rebuild + export)":"Video export";t(`${r} started with workflow ${s.workflowRunId}`,{variant:"info"});let n=await i(s.workflowRunId);if(n&&n.success)return(0,c.tO)(e,n.story),t(o?"Timeline rebuilt and video exported successfully":"Video exported successfully",{variant:"success"}),n}else throw Error("No workflow ID received from recovery API")}catch(e){throw console.error("Error in recovery process:",e),t(o?`Recovery error: ${e.message}`:`Export error: ${e.message}`,{variant:"error"}),e}finally{a(!1),u(null)}},isRebuilding:n,workflowRunId:l}}},9479:function(e,t,i){i.d(t,{GH:function(){return g},MH:function(){return x},lk:function(){return p},rB:function(){return m},uO:function(){return h}});var r=i(75271),n=i(21617),o=i(13200),a=i(75616),s=i(21964),l=i(10986),d=i(66627),c=i(46973),u=i(33010);let p=()=>{let e=async e=>{let{pageParam:t=null}=e,i=new URLSearchParams;return t&&i.append("cursor",t),(await c.ZP.get(`/stories?${i.toString()}`)).data},{data:t,isFetching:i,fetchNextPage:r,hasNextPage:o,...a}=(0,n.N)(d.Y.lists(),e,{getNextPageParam:e=>(null==e?void 0:e.nextCursor)||null,keepPreviousData:!0,refetchOnWindowFocus:!0,refetchOnMount:!0});return{stories:(null==t?void 0:t.pages.flatMap(e=>e.stories))||[],hasNextPage:o,isFetching:i,fetchNextPage:r,...a}},h=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=async e=>{let{pageParam:i=null}=e,r=new URLSearchParams;return(null==i?void 0:i.cursor)&&r.append("cursor",i.cursor),(null==i?void 0:i.last_story_id)&&r.append("last_story_id",i.last_story_id),(null==t?void 0:t.user_id)&&r.append("user_id",t.user_id),(null==t?void 0:t.category_id)&&r.append("category_id",t.category_id),(await c.ZP.get(`/stories/published?${r.toString()}`)).data},{data:r,isFetching:o,isFetchingNextPage:a,fetchNextPage:s,hasNextPage:l,...u}=(0,n.N)(d.Y.published(t),i,{getNextPageParam:e=>({cursor:(null==e?void 0:e.nextCursor)||null,last_story_id:(null==e?void 0:e.lastStoryId)||null})}),p=(null==r?void 0:r.pages.flatMap(e=>e.stories))||[],h=(null==r?void 0:null===(e=r.pages)||void 0===e?void 0:e.flatMap(e=>e.recommId))||null;return{stories:p,recommId:null==h?void 0:h.at(-1),hasNextPage:l,isFetching:o,isFetchingNextPage:a,fetchNextPage:s,...u}},m=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2?arguments[2]:void 0,{enqueueSnackbar:n}=(0,l.Ds)(),[a,s]=(0,r.useState)(null);return{...(0,o.a)(d.Y.detail(e||""),async()=>{if(!e)return null;let t=await c.ZP.get(`/stories/${e}`);if(200!==t.status)throw Error(`Failed to get story: ${t.statusText}`);return t.data},{enabled:!!e&&t,refetchOnMount:!0,refetchInterval:e=>null!=i&&!!i.enablePollingForPreview&&null!=e&&!!e.is_preview&&!(null==e?void 0:e.workflow_run_id)&&2e3,onSuccess:e=>{e&&s(structuredClone(e))},onError:e=>{console.error("Error getting story:",e),n(`Error: ${e.message}`,{variant:"error"})}}),editedStory:a,setEditedStory:s}},x=e=>{let t=(0,a.NL)(),{enqueueSnackbar:i}=(0,l.Ds)();return(0,s.D)({mutationFn:async t=>{if(!e)throw Error("No story ID provided");let i=await c.ZP.patch(`/stories/${e}`,t);if(200!==i.status)throw Error(`Failed to update story: ${i.statusText}`);return i.data},onSuccess:e=>{(0,u.tO)(t,e),i("Story updated successfully",{variant:"success"})},onError:e=>{console.error("Error updating story:",e),i(`Error: ${e.message}`,{variant:"error"})}})},g=()=>{let e=(0,a.NL)(),{enqueueSnackbar:t}=(0,l.Ds)();return(0,s.D)({mutationFn:async e=>{let{templateStoryId:t,operation:i}=e,r=await c.ZP.post("/stories/operate_template_story",{template_story_id:t,operation:i});if(200!==r.status)throw Error(`Failed to create story from template: ${r.statusText}`);return r.data},onSuccess:()=>{e.invalidateQueries({queryKey:d.Y.lists()})},onError:e=>{console.error("Error creating story from template:",e),t(`Error: ${e.message}`,{variant:"error"})}})}},22112:function(e,t,i){i.d(t,{EY:function(){return d},N1:function(){return p},nn:function(){return u},vi:function(){return c}});var r=i(75271),n=i(21964),o=i(10986);i(66627);var a=i(46973),s=i(52934),l=i(16585);let d=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{enqueueSnackbar:t}=(0,o.Ds)(),[i,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null);return{...(0,n.D)({mutationFn:async i=>{d(!0),u(null);try{(0,l.B)("story_creation_requested",{story_type:"character_vlog",prompt:i.vlog_topic});let r=await a.ZP.post("/stories/workflow/generate_character_vlog",i);if(200!==r.status){let e=r.data;throw Error(`Failed to generate character vlog ${e.message}`)}let n=((null==i?void 0:i.additional_characters)||[]).length>0;(0,l.B)(i.is_preview?"story_previewed":"story_created",{story_type:"character_vlog",prompt:i.vlog_topic,is_multiple_characters:n,credits_num:i.is_preview?s.v["story.character_vlog.preview"].credit:s.v["story.character_vlog"].credit});let o=r.data;if(!o.workflowRunId)return t("Character vlog generated successfully",{variant:"success"}),o;if(!e)return o;u(o.workflowRunId),t(`Character vlog generation started with workflow ${o.workflowRunId}`,{variant:"info"})}catch(e){throw e}finally{d(!1),u(null)}}}),isGenerating:i,workflowRunId:c}},c=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{enqueueSnackbar:t}=(0,o.Ds)(),[i,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null);return{...(0,n.D)({mutationFn:async i=>{d(!0),u(null);try{(0,l.B)("story_creation_requested",{story_type:"script_to_video",prompt:i.script_content});let r=await a.ZP.post("/stories/workflow/generate_script_to_video",i);if((0,l.B)(i.is_preview?"story_previewed":"story_created",{story_type:"script_to_video",prompt:i.script_content,credits_num:i.is_preview?s.v["story.script_to_video.preview"].credit:s.v["story.script_to_video"].credit}),200!==r.status){let e=r.data;throw Error(`Failed to generate script to video: ${e.message||r.statusText}`)}let n=r.data;if(!n.workflowRunId)return t("Script to video generated successfully",{variant:"success"}),n;if(!e)return n;u(n.workflowRunId),t(`Script to video generation started with workflow ${n.workflowRunId}`,{variant:"info"})}catch(e){throw e}finally{d(!1),u(null)}}}),isGenerating:i,workflowRunId:c}},u=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{enqueueSnackbar:t}=(0,o.Ds)(),[i,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null);return{...(0,n.D)({mutationFn:async i=>{d(!0),u(null);try{(0,l.B)("story_creation_requested",{story_type:"music_video",prompt:i.music_url,video_type:"lyrics-video"});let r=await a.ZP.post("/stories/workflow/generate_lyrics_to_video",i);if((0,l.B)(i.is_preview?"story_previewed":"story_created",{story_type:"music_video",video_type:"lyrics-video",prompt:i.music_url,credits_num:i.is_preview?s.v["story.lyrics_video.preview"].credit:s.v["story.lyrics_video"].credit}),200!==r.status){let e=r.data;throw Error(`Failed to generate script to video: ${e.message||r.statusText}`)}let n=r.data;if(!n.workflowRunId)return t("Script to video generated successfully",{variant:"success"}),n;if(!e)return n;u(n.workflowRunId),t(`Script to video generation started with workflow ${n.workflowRunId}`,{variant:"info"})}catch(e){throw e}finally{d(!1),u(null)}}}),isGenerating:i,workflowRunId:c}},p=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{enqueueSnackbar:t}=(0,o.Ds)(),[i,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null);return{...(0,n.D)({mutationFn:async i=>{d(!0),u(null);try{(0,l.B)("story_creation_requested",{story_type:"asmr_video",prompt:i.script_content});let r=await a.ZP.post("/stories/workflow/generate_asmr_video",i);if((0,l.B)(i.is_preview?"story_previewed":"story_created",{story_type:"asmr_video",prompt:i.script_content,credits_num:i.is_preview?s.v["story.script_to_video.preview"].credit:s.v["story.script_to_video"].credit}),200!==r.status){let e=r.data;throw Error(`Failed to generate ASMR video: ${e.message||r.statusText}`)}let n=r.data;if(!n.workflowRunId)return t("ASMR video generated successfully",{variant:"success"}),n;if(!e)return n;u(n.workflowRunId),t(`ASMR video generation started with workflow ${n.workflowRunId}`,{variant:"info"})}catch(e){throw e}finally{d(!1),u(null)}}}),isGenerating:i,workflowRunId:c}}},83242:function(e,t,i){i.d(t,{N1:function(){return r.N1},nn:function(){return r.nn},vi:function(){return r.vi},uO:function(){return r.uO},oH:function(){return r.oH},EL:function(){return r.EL},HM:function(){return r.HM},Bx:function(){return r.Bx},rB:function(){return r.rB},Jo:function(){return r.Jo},MH:function(){return r.MH}});var r=i(88764);i(52676),i(75271),i(85872)},70024:function(e,t,i){i.d(t,{K:function(){return w}});var r=i(52676),n=i(75271),o=i(90145),a=i(66645),s=i(5082),l=i(97792),d=i(72660),c=i(22988),u=i(80110),p=i(6721),h=i(45138),m=i(77379),x=i(27574),g=i(68836),f=i.n(g),v=i(67197),b=i(84625),y=i(27806);function w(e){let{open:t,onClose:i,onCharacterCreated:g,initialFile:w}=e,[C,j]=(0,n.useState)(""),[k,F]=(0,n.useState)(null),[S,I]=(0,n.useState)(!1),[_,Z]=(0,n.useState)(null);(0,n.useEffect)(()=>{w&&t&&(T(w),j("My Character"))},[w,t]);let{getRootProps:A,getInputProps:E,isDragActive:M}=(0,b.uI)({accept:{"image/*":[".jpeg",".jpg",".png",".webp"]},multiple:!1,onDrop:async e=>{e.length>0&&await T(e[0])}}),T=async e=>{I(!0),Z(null);try{var t;let i=new FormData;i.append("file",e);let r=await f().post("/api/media/upload_image",i,{headers:{"Content-Type":"multipart/form-data"}});if(200===r.status&&(null===(t=r.data)||void 0===t?void 0:t.imageUrl))F(r.data.imageUrl);else throw Error("Failed to upload image")}catch(e){console.error("Image upload error:",e),Z("Failed to upload image. Please try again.")}finally{I(!1)}},R=async()=>{if(!k||!C.trim()){Z("Please provide both an image and character name.");return}null==g||g({id:(0,v.x0)(),name:C.trim(),image_url:k}),D()},D=()=>{j(""),F(null),Z(null),I(!1),i()},z=()=>{window.open(`${window.location.origin}/characters`,"_blank")};return(0,r.jsx)(l.Z,{open:t,onClose:D,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{bgcolor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"16px",maxWidth:"534px",width:{xs:"100%",sm:"534px"},height:{xs:"auto",sm:"auto"},m:{xs:2,sm:4}}},children:(0,r.jsxs)(d.Z,{sx:{p:0,height:"100%",display:"flex",flexDirection:"column",overflow:"auto"},children:[(0,r.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:"24px",py:"20px",borderBottom:"1px solid #2E2E2E"},children:[(0,r.jsx)(u.Z,{sx:{color:"#FFFFFF",fontWeight:600,fontSize:"20px",lineHeight:"20px",letterSpacing:"-0.05em"},children:"Quick Reference (Fastest)"}),(0,r.jsx)(p.Z,{onClick:D,sx:{color:"#444444",width:24,height:24,"@media (hover: hover)":{"&:hover":{color:"#666666"}}},children:(0,r.jsx)(o.Z,{sx:{fontSize:16}})})]}),(0,r.jsxs)(c.Z,{sx:{flex:1,display:"flex",flexDirection:"column",p:"32px",gap:"16px"},children:[(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(u.Z,{sx:{color:"#888888",fontSize:"14px",fontWeight:500,lineHeight:"22px",mb:"8px"},children:"Character Name"}),(0,r.jsx)(h.Z,{fullWidth:!0,placeholder:"Give your character a name",value:C,onChange:e=>j(e.target.value),sx:{"& .MuiOutlinedInput-root":{bgcolor:"#101010",border:"1px solid #3F3F3F",borderRadius:"8px",height:"50px",color:"#FFFFFF",fontSize:"14px",fontWeight:500,lineHeight:"22px",letterSpacing:"-0.14px","@media (hover: hover)":{"&:hover":{borderColor:"#555555"}},"&.Mui-focused":{borderColor:"#0084FF"},"& fieldset":{border:"none"}},"& .MuiOutlinedInput-input":{"&::placeholder":{color:"#444444",opacity:1}}}})]}),(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(u.Z,{sx:{color:"#888888",fontSize:"14px",fontWeight:500,lineHeight:"22px",mb:"8px"},children:"Reference Image"}),(0,r.jsxs)(c.Z,{...A(),sx:{width:"100%",height:"210px",border:"2px dashed #474747",borderRadius:"12px",bgcolor:"#101010",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",gap:"10px",p:"20px",position:"relative",transition:"all 0.2s ease-in-out","@media (hover: hover)":{"&:hover":{borderColor:"#555555",bgcolor:"#151515","& .upload-hover-overlay":{opacity:k?1:0}}}},children:[(0,r.jsx)("input",{...E()}),k?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{component:"img",src:k,alt:"Uploaded character",sx:{width:"100%",height:"100%",objectFit:"contain",borderRadius:"10px",position:"absolute",top:0,left:0}}),(0,r.jsx)(p.Z,{onClick:e=>{e.stopPropagation(),F(null),Z(null)},sx:{position:"absolute",top:8,right:8,width:32,height:32,bgcolor:"rgba(0, 0, 0, 0.6)",color:"#FFFFFF",zIndex:2,"@media (hover: hover)":{"&:hover":{bgcolor:"rgba(0, 0, 0, 0.8)"}}},children:(0,r.jsx)(a.Z,{sx:{fontSize:18}})}),(0,r.jsxs)(c.Z,{className:"upload-hover-overlay",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"10px",opacity:0,transition:"opacity 0.2s ease-in-out",gap:"10px"},children:[(0,r.jsx)(c.Z,{sx:{width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(s.Z,{sx:{color:"#FFFFFF",fontSize:"29px"}})}),(0,r.jsxs)(c.Z,{sx:{textAlign:"center",px:2},children:[(0,r.jsx)(u.Z,{sx:{color:"#FFFFFF",fontSize:"14px",fontWeight:600,lineHeight:"1.3em",letterSpacing:"-0.02em",mb:"8px"},children:"Click to upload or drag and drop"}),(0,r.jsx)(u.Z,{sx:{color:"#CCCCCC",fontSize:"12px",fontWeight:500,lineHeight:"1.3em",letterSpacing:"-0.02em",textAlign:"center"},children:"Replace with a new image"})]})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{sx:{width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(s.Z,{sx:{color:"#444444",fontSize:"29px"}})}),(0,r.jsxs)(c.Z,{sx:{textAlign:"center"},children:[(0,r.jsx)(u.Z,{sx:{color:"#FFFFFF",fontSize:"14px",fontWeight:600,lineHeight:"1.3em",letterSpacing:"-0.02em",mb:"14px"},children:M?"Drop the image here":"Click to upload or drag and drop"}),(0,r.jsx)(u.Z,{sx:{color:"#606060",fontSize:"12px",fontWeight:500,lineHeight:"1.3em",letterSpacing:"-0.02em",textAlign:"center"},children:"Use a high-quality image of a human-like character."})]})]}),S?(0,r.jsx)(c.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"12px"},children:(0,r.jsx)(u.Z,{sx:{color:"#FFFFFF"},children:"Uploading..."})}):null]})]}),(0,r.jsxs)(m.Z,{variant:"outlined",onClick:()=>z(),sx:{bgcolor:"#2E2E2E",border:"none",borderRadius:"6px",height:"41px",color:"#E0E0E0",fontSize:"14px",fontWeight:600,lineHeight:"1.3",textTransform:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px","@media (hover: hover)":{"&:hover":{bgcolor:"#3A3A3A",border:"none"}}},children:[(0,r.jsx)(y.ColorfulAiMagic,{sx:{width:20,height:20}}),"Train Character for Higher Consistency",(0,r.jsx)(c.Z,{component:"svg",sx:{width:18,height:18},viewBox:"0 0 18 18",fill:"none",children:(0,r.jsx)("path",{d:"M7.49985 3.74971H6.14985C5.30985 3.74971 4.88985 3.74971 4.56885 3.91321C4.28662 4.05701 4.05716 4.28648 3.91335 4.56871C3.74985 4.88971 3.74985 5.30971 3.74985 6.14971V11.8497C3.74985 12.6897 3.74985 13.1097 3.91335 13.4307C4.05716 13.7129 4.28662 13.9424 4.56885 14.0862C4.8891 14.2497 5.3091 14.2497 6.1476 14.2497H11.8521C12.6906 14.2497 13.1099 14.2497 13.4301 14.0862C13.7129 13.9422 13.9424 13.7127 14.0864 13.4307C14.2499 13.1097 14.2499 12.6905 14.2499 11.852V10.4997M14.9999 6.74971V2.99971M14.9999 2.99971H11.2499M14.9999 2.99971L9.74985 8.24971",stroke:"#888888",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),_?(0,r.jsx)(c.Z,{sx:{px:"32px",mb:2},children:(0,r.jsx)(x.Z,{severity:"error",sx:{bgcolor:"#2E1A1A",color:"#FF6B6B"},children:_})}):null,(0,r.jsxs)(c.Z,{sx:{borderTop:"1px solid #2E2E2E",p:"28px 32px",display:"flex",alignItems:"center",gap:"12px"},children:[(0,r.jsx)(m.Z,{variant:"outlined",onClick:D,sx:{bgcolor:"#1D1D1D",border:"1px solid #444444",borderRadius:"5px",px:"27px",py:"10px",fontSize:"16px",fontWeight:600,lineHeight:"16.35px",textTransform:"none",minWidth:"99px",height:"44px",color:"#B5B5B5","@media (hover: hover)":{"&:hover":{bgcolor:"#2A2A2A",border:"1px solid #555555"}}},children:"Cancel"}),(0,r.jsx)(m.Z,{variant:"contained",onClick:R,disabled:!k||!C.trim(),sx:e=>({bgcolor:e.palette.Colors.Blue["600"],borderRadius:"5px",px:"27px",py:"10px",fontSize:"16px",fontWeight:600,lineHeight:"16.35px",textTransform:"none",height:"44px",flex:1,color:e.palette.Colors.Gray["900"],display:"flex",alignItems:"center",justifyContent:"center",gap:"8px","@media (hover: hover)":{"&:hover":{bgcolor:e.palette.Colors.Blue["500"]}},"&:disabled":{bgcolor:e.palette.Colors.Gray["100"],color:e.palette.Colors.Gray["300"]}}),children:"Create Character"})]})]})})}},23679:function(e,t,i){i.d(t,{l:function(){return u}});var r=i(52676),n=i(75271),o=i(66266),a=i.n(o),s=i(22988),l=i(77379),d=i(80110),c=i(84643);function u(e){let{buttonText:t="Create Story",className:i}=e,[o,u]=(0,n.useState)(!1),p=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let h=()=>{u(!o)},m=e=>{u(!1),a().push(e)},x=[{id:"character-vlog",label:"Character vlog",icon:(0,r.jsx)(c.js,{width:13,height:15,fill:"#888888"}),path:"/story/create/vlog"},{id:"music-video",label:"Music video",icon:(0,r.jsx)(c.Eq,{width:12,height:14}),path:"/story/create/mv"},{id:"script-to-video",label:"Script to video",icon:(0,r.jsx)(c.SZ,{width:14,height:12}),path:"/story/create/script"},{id:"from-scratch",label:"From Scratch",icon:(0,r.jsx)(c.jw,{width:13,height:13}),path:"/story/editor"}];return(0,r.jsxs)(s.Z,{sx:{display:"flex",position:"relative"},ref:p,className:i,children:[(0,r.jsx)(l.Z,{variant:"contained",onClick:h,sx:{bgcolor:"#013FFE",color:"#FFFFFF",borderRadius:"4px 0px 0px 4px",py:"9px",px:"20px",textTransform:"none",fontWeight:700,fontSize:"16px",height:"44px","&:hover":{bgcolor:"#0035E0"}},children:t}),(0,r.jsx)(s.Z,{onClick:h,sx:{bgcolor:"#013FFE",borderLeft:"1px solid #1A1A1A",borderRadius:"0px 4px 4px 0px",width:"36px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer","&:hover":{bgcolor:"#0035E0"}},children:(0,r.jsx)(s.Z,{sx:{width:0,height:0,borderLeft:"4px solid transparent",borderRight:"4px solid transparent",borderTop:"4px solid #FFFFFF"}})}),o?(0,r.jsx)(s.Z,{sx:{position:"absolute",top:"52px",left:0,bgcolor:"#2E2E2E",borderRadius:"4px",padding:"8px",minWidth:"178px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3},children:x.map(e=>(0,r.jsxs)(s.Z,{onClick:()=>m(e.path),sx:{display:"flex",alignItems:"center",gap:"4px",padding:"8px 4px",borderRadius:"4px",cursor:"pointer","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)"}},children:[(0,r.jsx)(s.Z,{sx:{width:"20px",height:"20px",borderRadius:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.icon}),(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:"14px",lineHeight:"16.94px",color:"#CCCCCC"},children:e.label})]},e.id))}):null]})}},36772:function(e,t,i){i.d(t,{Y:function(){return h}});var r=i(52676),n=i(75271),o=i(45162),a=i.n(o),s=i(58684),l=i(56407),d=i(22988),c=i(80110),u=i(18420),p=i(16585);let h=e=>{let{layout:t="horizontal"}=e,i="vertical"===t,[o,h]=(0,n.useState)("list"),{createStoryAsync:m,isLoading:x}=(0,u.no)(),g=e=>{(0,p.B)("create_from_scratch_clicked",{to_view:"list"===e?"all-shots":"video-editor"}),h(e),f(e)},f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"list";try{let t=await m({title:"Untitled",category_id:"create_from_scratch"});(null==t?void 0:t.id)&&((0,p.B)("editor_opened",{story_id:t.id,opened_from:"story_create_card"}),window.open(`/story/editor?story_id=${t.id}&view=${e}`,"_blank"))}catch(e){console.error("Failed to create story:",e)}};return(0,r.jsxs)(l.Z,{direction:i?"column":"row",spacing:2,sx:{width:"100%",height:i?"auto":"120px",display:{xs:"none",md:"flex"}},children:[(0,r.jsxs)(d.Z,{component:s.Z,loading:!!(x&&"list"===o),disabled:x,sx:{position:"relative",flex:1,width:i?"100%":void 0,height:i?{xs:"96px",md:"110px"}:"100%",borderRadius:"12px",overflow:"hidden",cursor:"pointer",backgroundImage:"url(https://cdn.openart.ai/assets/internal/uploads/image_UQOH6BNs_1061x178_1757872858825.webp)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},onClick:()=>g("list"),children:[(0,r.jsx)(c.Z,{sx:{position:"absolute",top:"50%",left:"14px",transform:"translateY(-50%)",color:i?"var(--Gray-900)":"white",fontFamily:"Inter",fontSize:"20px",fontWeight:600,lineHeight:"normal",zIndex:2},children:"Build Storyboard →"}),(0,r.jsx)(a(),{src:"https://cdn.openart.ai/assets/internal/uploads/image_GGteXeW2_689x264_1755508255962.webp",alt:"Audio Waveform Background",fill:!0,style:{objectFit:"contain",objectPosition:"right bottom",transform:`scale(0.7${i?" translateX(30px)":""}`,transformOrigin:"right bottom"}})]}),(0,r.jsxs)(d.Z,{component:s.Z,loading:!!(x&&"video-editor"===o),disabled:x,sx:{position:"relative",flex:1,width:i?"100%":void 0,height:i?{xs:"96px",md:"110px"}:"100%",borderRadius:"12px",overflow:"hidden",cursor:"pointer",backgroundImage:"url(https://cdn.openart.ai/assets/internal/uploads/image_ByxM92xv_1061x178_1757872858664.webp)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},onClick:()=>g("video-editor"),children:[(0,r.jsx)(c.Z,{sx:{position:"absolute",top:"50%",left:"14px",transform:"translateY(-50%)",color:i?"var(--Gray-900)":"white",fontFamily:"Inter",fontSize:"20px",fontWeight:600,lineHeight:"normal",zIndex:2},children:"Open Editor →"}),(0,r.jsx)(a(),{src:"https://cdn.openart.ai/assets/internal/uploads/image_VHdK6D1Z_540x277_1755592684593.webp",alt:"Audio Waveform Background",fill:!i,width:i?131*1.4:void 0,height:i?73*1.4:void 0,style:{objectFit:"contain",objectPosition:"right bottom",transformOrigin:"right bottom",transform:"scale(0.7)",...i?{position:"absolute",right:"-65px",top:"55%",transform:"translateY(-50%)"}:{}}})]})]})}},46237:function(e,t,i){i.d(t,{$:function(){return p}});var r=i(52676),n=i(97792),o=i(6721),a=i(22988),s=i(80110),l=i(77379),d=i(46740),c=i(41899);let u=(0,d.F4)`
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
`;function p(e){let{open:t,onClose:i}=e;return(0,r.jsxs)(n.Z,{open:t,onClose:i,maxWidth:!1,PaperProps:{sx:{background:"#1A1A1A",borderRadius:"13px",border:"2px solid #2E2E2E",width:"312px",height:"416px",maxWidth:"none",maxHeight:"none",position:"relative",overflow:"hidden",p:0}},children:[(0,r.jsx)(o.Z,{onClick:i,sx:{position:"absolute",top:"9px",right:"9px",width:"20px",height:"20px",backgroundColor:"rgba(255, 255, 255, 0.17)",borderRadius:"16px",color:"#FFFFFF",minWidth:"auto",p:0,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.25)"},zIndex:1e3},children:(0,r.jsx)(c.Tw,{sx:{fontSize:"16px"}})}),(0,r.jsxs)(a.Z,{sx:{position:"relative",mb:"16px",height:"254px",borderRadius:"8px 8px 0 0",overflow:"hidden"},children:[(0,r.jsx)(a.Z,{sx:{width:"100%",height:"100%",backgroundImage:"url(https://cdn.openart.ai/assets/priview_editor_dialog.webp)",backgroundSize:"cover",backgroundPosition:"center",position:"relative"}}),(0,r.jsx)(a.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent)",backgroundSize:"200% 100%",animation:`${u} 3s ease-in-out infinite`,pointerEvents:"none"}})]}),(0,r.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:"9px",mb:"24px",px:"21px"},children:[(0,r.jsx)(s.Z,{sx:{fontWeight:700,fontSize:"20px",lineHeight:"1.1",color:"#FFFFFF",textAlign:"center"},children:"Edit Seamlessly on Web"}),(0,r.jsx)(s.Z,{sx:{fontWeight:500,fontSize:"14px",lineHeight:"1.429",color:"#888888",textAlign:"center"},children:"Enjoy a more powerful and precise video editing experience on the web."})]}),(0,r.jsx)(a.Z,{sx:{px:"31px",pb:"24px"},children:(0,r.jsx)(l.Z,{onClick:i,fullWidth:!0,sx:{background:"#013FFE",borderRadius:"7px",height:"44px",fontFamily:"Inter",fontWeight:700,fontSize:"14px",lineHeight:"1.571",letterSpacing:"-0.029em",color:"#FFFFFF",textTransform:"none","&:hover":{background:"#0133E6"}},children:"OK, I Got it !"})})]})}},42312:function(e,t,i){i.d(t,{d:function(){return x}});var r=i(52676),n=i(75271),o=i(78433),a=i(88823),s=i(19188),l=i(29984),d=i(80110),c=i(75616),u=i(39204),p=i(23638),h=i(1663),m=i(33010);let x=e=>{let{workflowRunId:t,storyId:i,onComplete:x,shouldAutoDownload:g=!0}=e,f=(0,c.NL)(),{data:v,isLoading:b,error:y}=(0,h.w)(t),[w,C]=(0,n.useState)(!1),[j,k]=(0,n.useState)(0),[F,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e;if(t)return(null==v?void 0:v.status.startsWith("processing"))&&!w?e=setInterval(()=>{k(e=>Math.min(e+(Math.random()*(e>80?1:e>60?2:5)+.5),90))},800+1200*Math.random()):(null==v?void 0:v.status)==="completed"?((0,m.tO)(f,v.story),k(100)):(y||(null==v?void 0:v.status.startsWith("failed")))&&k(0),()=>{e&&clearInterval(e)}},[null==v?void 0:v.status,w,y,t,v,f]),(0,n.useEffect)(()=>{k(0),S(!1)},[t]);let I=(null==v?void 0:v.status.startsWith("processing"))&&t,_=(null==v?void 0:v.status)==="completed"&&t,Z=(y||(null==v?void 0:v.status.startsWith("failed")))&&t;return(0,n.useEffect)(()=>{let e;return(async()=>{if(_&&100===j&&!F){if(S(!0),!w&&g)try{C(!0);let t=null==v?void 0:v.story;if(null==t?void 0:t.last_export_url){var e;let r=`story_${i}_${(null===(e=t.title)||void 0===e?void 0:e.replace(/[^a-z0-9]/gi,"_"))||"video"}.mp4`,n=t.last_export_url,o=document.createElement("a");o.href=n,o.download=r,o.rel="noopener noreferrer",o.style.display="none",document.body.append(o),o.click(),o.remove()}}catch(e){console.error("Failed to fetch updated story for download:",e)}finally{C(!1)}null==x||x()}})(),()=>{e&&clearTimeout(e)}},[_,j,i,x,w,v,g,F]),(0,n.useEffect)(()=>{if(Z&&!w&&!F){S(!0);let e=setTimeout(()=>{null==x||x()},1e3);return()=>clearTimeout(e)}},[Z,w,x,F]),(0,r.jsxs)(u.E.div,{initial:{opacity:0},animate:{opacity:t?1:0},exit:{opacity:0},transition:{duration:.3},style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(4px)",zIndex:10,pointerEvents:t?"auto":"none"},children:[(0,r.jsx)(p.M,{mode:"wait",children:w?(0,r.jsx)(u.E.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},transition:{type:"spring",stiffness:200,damping:15},style:{width:48,height:48,borderRadius:"50%",backgroundColor:"#0066FF",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16,position:"relative"},children:(0,r.jsx)(u.E.div,{animate:{y:[0,-2,0]},transition:{duration:1,repeat:1/0,ease:"easeInOut"},children:(0,r.jsx)(o.Z,{sx:{fontSize:24,color:"white"}})})},"downloading"):_?(0,r.jsx)(u.E.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},transition:{type:"spring",stiffness:200,damping:15},style:{width:48,height:48,borderRadius:"50%",backgroundColor:"#42BE65",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16},children:(0,r.jsx)(a.Z,{sx:{fontSize:24,color:"white"}})},"success"):Z?(0,r.jsx)(u.E.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},transition:{type:"spring",stiffness:200,damping:15},style:{width:48,height:48,borderRadius:"50%",backgroundColor:"#FA4D56",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16},children:(0,r.jsx)(s.Z,{sx:{fontSize:24,color:"white"}})},"failed"):(0,r.jsxs)(u.E.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},transition:{type:"spring",stiffness:200,damping:15},style:{position:"relative",width:80,height:80,marginBottom:16,display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,r.jsx)(l.Z,{variant:"determinate",value:100,size:80,thickness:4,sx:{color:"rgba(255, 255, 255, 0.1)",position:"absolute"}}),(0,r.jsx)(l.Z,{variant:"determinate",value:j,size:80,thickness:4,sx:{color:"#0066FF",position:"absolute",filter:"drop-shadow(0 0 8px rgba(0, 102, 255, 0.3))"}}),(0,r.jsx)(u.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},style:{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsxs)(d.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontSize:"16px",fontWeight:600,lineHeight:1},children:[Math.round(j),"%"]})}),I||w?(0,r.jsx)(u.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},style:{position:"absolute",width:88,height:88,borderRadius:"50%",background:"conic-gradient(from 0deg, transparent 0deg, rgba(0, 102, 255, 0.2) 60deg, transparent 120deg)",filter:"blur(8px)",zIndex:-1}}):null]},"progress")}),(0,r.jsx)(u.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,r.jsx)(d.Z,{sx:{color:w?"#0066FF":y||(null==v?void 0:v.status.startsWith("failed"))?"#FA4D56":(null==v?void 0:v.status)==="completed"?"#42BE65":"#FFFFFF",fontFamily:"Inter",fontSize:"12px",fontWeight:500,lineHeight:1.21,textAlign:"center",letterSpacing:"0.5px"},children:(()=>{if(w)return"Downloading...";if(y)return"Export failed";if(b||!v)return"Preparing export...";switch(v.status){case"processing:generating_timeline":case"processing:exporting_video":return"Exporting...";case"processing:generating_storyboard":return"Generating storyboard...";case"completed":return"Export complete";case"failed":return"Export failed";default:return"Processing..."}})()})}),y||(null==v?void 0:v.error)?(0,r.jsx)(u.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:(0,r.jsx)(d.Z,{sx:{mt:1,color:"#FA4D56",fontFamily:"Inter",fontSize:"10px",fontWeight:400,textAlign:"center",opacity:.8,maxWidth:"90%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"string"==typeof y?y:"string"==typeof(null==v?void 0:v.error)?v.error:"An error occurred"})}):null]})}},86061:function(e,t,i){i.d(t,{x:function(){return c}});var r=i(52676),n=i(75271),o=i(90145),a=i(97792),s=i(72660),l=i(6721),d=i(22988);let c=(0,n.memo)(e=>{let{open:t,src:i,alt:c="Image preview",onClose:u}=e,p=!!i,h=(0,n.useCallback)((e,t)=>{u()},[u]);return(0,r.jsx)(a.Z,{open:t&&p,onClose:h,maxWidth:!1,PaperProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.9)",margin:0,maxWidth:"90vw",maxHeight:"90vh",width:"auto",height:"auto",borderRadius:2,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.55)"}},children:(0,r.jsxs)(s.Z,{sx:{p:0,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",minWidth:"min(360px, 90vw)",minHeight:"min(240px, 90vh)"},children:[(0,r.jsx)(l.Z,{"aria-label":"Close image preview",onClick:e=>{e.stopPropagation(),u()},sx:{position:"absolute",top:16,right:16,color:"#FFFFFF",backgroundColor:"rgba(0, 0, 0, 0.6)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:(0,r.jsx)(o.Z,{fontSize:"small"})}),p?(0,r.jsx)(d.Z,{component:"img",src:i??void 0,alt:c,sx:{maxWidth:"90vw",maxHeight:"90vh",objectFit:"contain",display:"block"}}):null]})})})},32146:function(e,t,i){i.d(t,{W:function(){return x}});var r=i(52676),n=i(75271),o=i(22988),a=i(13724),s=i(56407),l=i(91415),d=i(80110),c=i(2733),u=i(60454),p=i(97779),h=i(27806);let m=e=>{let{children:t,sx:i,onClick:n}=e;return(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.14)",borderRadius:"6px",p:.5,backdropFilter:"blur(9.4px)",...i},onClick:e=>{e.stopPropagation(),e.preventDefault(),n()},children:t})};function x(e){let{id:t,title:i,thumbnail:x,videoUrl:g,duration:f="0:28",onClick:v,category_id:b,onVideoTimeUpdate:y,aspectRatio:w}=e,{isMobile:C}=(0,p.j)(),[j,k]=(0,c.Z)("story-community-auto-sound",{defaultValue:!1,listenStorageChange:!0}),[F,S]=(0,n.useState)(!1),[I,_]=(0,n.useState)(0),Z=(0,n.useRef)(null),A=(0,u.tu)(b),E=(0,n.useCallback)(()=>{if(Z.current){let e=Z.current.currentTime;Math.abs(e-I)>=.1&&(_(e),null==y||y(e))}},[y,I]);return(0,r.jsxs)(a.Z,{component:"a",href:`/story/community/${t}`,sx:{width:"100%",borderRadius:C?"6px":"12px",overflow:"hidden",bgcolor:"#1F1F1F",border:"none",boxShadow:"none",position:"relative",display:"flex",flexDirection:"column",gap:"8px",pb:1,cursor:v?"pointer":"default"},onClick:e=>{e.preventDefault(),null==v||v()},onMouseEnter:()=>{S(!0),Z.current&&Z.current.play()},onMouseLeave:()=>{S(!1),Z.current&&(Z.current.pause(),Z.current.currentTime=0,_(0))},children:[(0,r.jsxs)(s.Z,{sx:{position:"relative",width:"100%",...w?{aspectRatio:w}:{height:"100%"},backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:C?"6px":"12px",overflow:"hidden"},children:[!C&&F?(0,r.jsx)(o.Z,{component:"video",ref:Z,muted:!j,autoPlay:!0,loop:!0,preload:"metadata",poster:x,onTimeUpdate:E,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",zIndex:2,opacity:F?1:0,transition:"opacity 0.3s ease",pointerEvents:"none"},children:(0,r.jsx)("source",{src:g,type:"video/mp4"})}):null,x?(0,r.jsx)(l.Z,{component:"img",image:x,alt:i,loading:"lazy",sx:{objectFit:"cover",width:"100%",height:"100%",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.1)"}}):(0,r.jsx)(o.Z,{sx:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(255, 255, 255, 0.1)",borderRadius:"12px",zIndex:1},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#888888",fontFamily:"Inter",fontSize:"14px",fontWeight:400},children:"No preview"})})]}),(0,r.jsxs)(s.Z,{direction:"row",width:"100%",height:"50px",sx:{px:{xs:.5,md:1},pt:{xs:.2,md:1},pb:2,position:"absolute",top:C?"unset":"0px",bottom:C?"20px":"unset",left:"0px",background:F?"linear-gradient(0deg, rgba(0, 0, 0, 0.00) 0%, #000 161%)":"none",zIndex:3},alignItems:"center",justifyContent:"space-between",children:[(0,r.jsxs)(s.Z,{direction:"row",spacing:{xs:0,md:.5},alignItems:"start",sx:{opacity:{xs:1,md:F?1:0}},children:[(0,r.jsx)(m,{onClick:()=>{k(!j)},sx:{display:{xs:"none",md:"block"}},children:j?(0,r.jsx)(h.CustomSoundOn,{width:14,height:14}):(0,r.jsx)(h.CustomSoundOff,{width:14,height:14})}),(0,r.jsx)(m,{children:(0,r.jsxs)(s.Z,{direction:"row",spacing:.5,alignItems:"center",children:[(0,r.jsx)(A,{width:14,height:14,color:"rgba(255, 255, 255, 0.75)"}),(0,r.jsx)(d.Z,{fontSize:{xs:11,md:12},fontWeight:600,lineHeight:1.21,color:"rgba(255, 255, 255, 0.6)",textAlign:"center",letterSpacing:"-0.12px",children:(0,u.Oo)(b)})]})})]}),(0,r.jsx)(m,{children:(0,r.jsx)(d.Z,{fontSize:{xs:11,md:12},fontWeight:600,lineHeight:1.21,color:"rgba(255, 255, 255, 0.6)",textAlign:"center",children:f})})]}),(0,r.jsx)(s.Z,{direction:"column",spacing:.5,sx:{px:1},children:(0,r.jsx)(d.Z,{variant:"body2",fontSize:"14px",sx:{color:"#FFFFFF",fontWeight:700,lineHeight:"20px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})})]})}},87750:function(e,t,i){i.d(t,{V:function(){return j}});var r=i(52676),n=i(75271),o=i(66266),a=i(48177),s=i(22988),l=i(24181),d=i(14930),c=i(80110),u=i(77379),p=i(57672),h=i(72301),m=i(19242),x=i(51395),g=i(32146),f=i(722),v=i(45029),b=i(16585);let y=e=>{var t;let[i,r]=(0,n.useState)(null);return(0,n.useEffect)(()=>{var t;if(null===(t=e.metadata)||void 0===t?void 0:t.duration){r(e.metadata.duration);return}},[null===(t=e.metadata)||void 0===t?void 0:t.duration]),i};function w(e){let{story:t,index:i,onClick:n,onVideoTimeUpdate:o}=e,a=y(t),s=(()=>{var e,i,r;if((null==t?void 0:null===(e=t.metadata)||void 0===e?void 0:e.width)&&(null==t?void 0:null===(i=t.metadata)||void 0===i?void 0:i.height)&&0!==t.metadata.height)return t.metadata.width/t.metadata.height;let n=null==t?void 0:null===(r=t.category_inputs)||void 0===r?void 0:r.aspect_ratio;if(n&&/^\d+:\d+$/.test(n)){let[e,t]=n.split(":").map(Number);if(e>0&&t>0)return e/t}return(null==t?void 0:t.category_id)==="character_vlog"?9/16:16/9})(),l=a?`${Math.floor(a/60)}:${(a%60).toFixed(0).padStart(2,"0")}`:"0:00";return(0,r.jsx)(g.W,{id:t.id||`story-${i}`,title:t.title,author:"OpenArt",videoUrl:t.last_export_url,thumbnail:t.last_export_thumbnail_url,description:void 0,duration:l,onClick:n,category_id:null==t?void 0:t.category_id,onVideoTimeUpdate:o,aspectRatio:s})}function C(e){let{aspectRatio:t}=e;return(0,r.jsxs)(s.Z,{sx:{width:"100%",backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:"12px",overflow:"hidden",mb:2},children:[(0,r.jsx)(s.Z,{sx:{position:"relative",width:"100%",aspectRatio:t||16/9},children:(0,r.jsx)(l.Z,{variant:"rectangular",sx:{position:"absolute",inset:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"12px 12px 0 0"}})}),(0,r.jsxs)(s.Z,{sx:{p:2},children:[(0,r.jsx)(l.Z,{variant:"text",width:"80%",height:24,sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",mb:1}}),(0,r.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(l.Z,{variant:"text",width:"40%",height:20,sx:{backgroundColor:"rgba(255, 255, 255, 0.08)"}}),(0,r.jsx)(l.Z,{variant:"text",width:"20%",height:20,sx:{backgroundColor:"rgba(255, 255, 255, 0.08)"}})]})]})]})}function j(e){var t,i;let{initCommunityStory:l,stories:g,title:y,emptyText:j="No template stories available.",isLoading:k=!1,maxItems:F,sx:S,fetchNextPage:I,hasNextPage:_=!1,isFetchingNextPage:Z=!1,showVideoOutdatedHint:A=!1}=e,E=(0,p.Z)(),M=(0,o.useRouter)(),T=(0,d.Z)(E.breakpoints.up("xl")),R=(0,d.Z)(E.breakpoints.up("lg")),D=(0,d.Z)(E.breakpoints.up("md")),z=((0,d.Z)(E.breakpoints.up("sm")),(0,v.I)()),[P,W]=(0,n.useState)(0),{pathname:L}=M,[B,H]=(0,n.useState)(l||null),[$,O]=(0,n.useState)(!!l),{ref:U,inView:G}=(0,m.YD)({threshold:.1,triggerOnce:!1,rootMargin:"1200px"}),N=F?g.slice(0,F):g,V=T?5:R?4:D?3:2;(0,n.useEffect)(()=>{G&&I&&_&&!Z&&I()},[G,I,_,Z]),(0,n.useEffect)(()=>{if(!I)return;let e=(0,h.Z)(()=>{if(!_||Z)return;let e=window.scrollY+window.innerHeight;document.documentElement.scrollHeight-e<1600&&I()},200,{leading:!0,trailing:!0});return window.addEventListener("scroll",e,{passive:!0}),()=>{var t;window.removeEventListener("scroll",e),null===(t=e.cancel)||void 0===t||t.call(e)}},[I,_,Z]);let K=(0,n.useCallback)(e=>{H(e),O(!0),window.history.replaceState({},"",`/story/community/${e.id}`)},[z]),q=(0,n.useCallback)(()=>{O(!1),H(null),L.startsWith("/story/community")||L.startsWith("/story/share")?window.history.replaceState({},"","/story"):window.history.replaceState({},"",L)},[L]),Y=(0,n.useCallback)(()=>{if(!B)return;z.logDownload({itemId:B.id});let e=B.last_export_url;if(e){let t=document.createElement("a");t.download=`${B.title||"openart-story"}.mp4`,t.href=e,t.target="_self",t.click()}else console.error("No last export URL found")},[z,B]),X=(0,n.useCallback)(()=>{B&&(z.logMainCTAConverted({itemId:B.id}),(0,b.B)("story_preview_dialog_create_button_clicked",{story_type:B.category_id,story_id:B.id}))},[B,z]),J=(0,n.useCallback)(()=>{var e;B&&B.id!==(null===(e=N.at(-1))||void 0===e?void 0:e.id)&&K(N[N.indexOf(B)+1])},[B,N,K]),Q=(0,n.useCallback)(()=>{B&&B.id!==N[0].id&&K(N[N.indexOf(B)-1])},[B,N,K]),ee=(0,n.useCallback)(e=>{$||W(e)},[$]);return(0,r.jsxs)(s.Z,{sx:{mb:4,width:"100%",...S},children:[y?(0,r.jsx)(c.Z,{variant:"h6",component:"h2",sx:{fontWeight:700,fontSize:"24px",lineHeight:"29.05px",mb:"32px",color:"#E0E0E0",textAlign:"left"},children:y}):null,N.length>0||k&&0===N.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(x.Z,{columnsCount:V,gutter:T?"16px":R?"16px":D?"16px":"4px",children:[N.map((e,t)=>(0,r.jsx)(s.Z,{sx:{},children:(0,r.jsx)(w,{story:e,index:t,onClick:()=>K(e),onVideoTimeUpdate:ee})},e.id||`story-${t}`)),Z?Array.from({length:R?3*V:D?2*V:V},(e,t)=>(0,r.jsx)(C,{aspectRatio:t%3==0?9/16:16/9},`loading-skeleton-${t}`)):null,k&&0===N.length?Array.from({length:R?12:D?9:6},(e,t)=>(0,r.jsx)(C,{aspectRatio:t%3==0?9/16:16/9},`initial-skeleton-${t}`)):null]}),!F&&(_||Z)?(0,r.jsx)(s.Z,{ref:U,sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:4,mb:2,py:2}}):null]}):k?null:(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,bgcolor:"rgba(0, 0, 0, 0.2)",borderRadius:2,border:"1px dashed",borderColor:"grey.700"},children:[(0,r.jsx)(a.Z,{sx:{fontSize:48,color:"grey.600",mb:2}}),(0,r.jsx)(c.Z,{variant:"body1",sx:{color:"grey.500",mb:3,textAlign:"center"},children:j})]}),B?(0,r.jsx)(f.z,{story:B,showVideoOutdatedHint:A,story_id:B.id,needloadCompleteData:B.id!==(null==l?void 0:l.id),currentVideoTime:P,open:$,onClose:q,onDownload:Y,onNext:J,onPrev:Q,canDelete:!1,useDirectDownload:!0,canNavigateNext:B?B.id!==(null===(t=N.at(-1))||void 0===t?void 0:t.id):null,canNavigatePrev:B?B.id!==(null===(i=N[0])||void 0===i?void 0:i.id):null,bottomContent:"create_from_scratch"!==B.category_id?null:(0,r.jsx)(u.Z,{onClick:X,sx:{backgroundColor:E.palette.Colors.Blue["500"],color:E.palette.Colors.Gray["900"],fontSize:"16px",fontWeight:700,lineHeight:"23px",textTransform:"none",width:"100%",height:"44px",borderRadius:"8px",gap:"10px","&:hover":{backgroundColor:E.palette.Colors.Blue["400"]}},target:"_blank",href:(e=>{switch(e){case"character_vlog":return"/story/create/vlog";case"script_to_video":return"/story/create/script";case"music_video":return"/story/create/mv";default:return"/story/editor"}})(B.category_id),children:(e=>{switch(e){case"character_vlog":return"Create Character Vlog →";case"script_to_video":return"Create Script to Video →";case"music_video":return"Create Music Video →";case"create_from_scratch":return"Create from Scratch →";default:return"Create Story →"}})(B.category_id)})}):null]})}},8393:function(e,t,i){i.d(t,{p:function(){return c}});var r=i(52676);i(75271);var n=i(22988),o=i(80110),a=i(46740),s=i(16402);let l=(0,a.F4)`
  0%, 100% {
    opacity: 0.7;
  }
  50% {
    opacity: 1;
  }
`,d={color:"#ffffff",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:1.21};function c(e){let{text:t="",textStyle:i=d,logoSize:a=80,sx:c}=e;return(0,r.jsxs)(n.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",background:"linear-gradient(134.98deg, #444444 1.37%, #1A1A1A 103.51%)",...c},children:[(0,r.jsx)(s._,{size:a,title:""}),t?(0,r.jsx)(o.Z,{sx:{textAlign:"center",animation:`${l} 2s ease-in-out infinite`,letterSpacing:"0.5px",textShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",...i},children:t}):null]})}t.Z=c},58474:function(e,t,i){i.d(t,{O:function(){return u}});var r=i(52676);i(75271);var n=i(75036),o=i(35523),a=i(43807),s=i(22988),l=i(80110),d=i(43246);let c={};function u(e){let{label:t,value:i,options:u,onChange:p,sx:h=c,disabled:m=!1}=e,x=`model-selector-${t.replaceAll(" ","-").toLowerCase()}`,g=u.find(e=>e.name===i);return(0,r.jsx)(o.Z,{sx:{flex:1,...h},children:(0,r.jsx)(a.Z,{id:x,value:i,onChange:e=>{p(e.target.value)},displayEmpty:!0,disabled:m,sx:{backgroundColor:"#101010",borderRadius:"8px",height:"48px",color:"#FFFFFF",border:"1px solid transparent","&:hover":{border:"1px solid #333"},"&.Mui-focused":{border:"1px solid #2F66FF"},"&.Mui-disabled":{opacity:.6},"& .MuiOutlinedInput-notchedOutline":{border:"none"},"& .MuiSelect-select":{padding:"12px 16px",display:"flex",flexDirection:"row",alignItems:"center"},"& .MuiSelect-icon":{color:"#666666",fontSize:"16px"}},renderValue:e=>(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",width:"100%"},children:[(0,r.jsx)(l.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.5em",letterSpacing:"-0.04em",color:"#ccc"},children:t}),(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:null==g?void 0:g.icon}),(0,r.jsx)(l.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.5em",letterSpacing:"-0.04em",color:"#FFFFFF"},children:e})]})]}),MenuProps:{PaperProps:{sx:{border:"1px solid #2e2e2e",borderRadius:"8px",mt:.5,minWidth:"200px","& .MuiMenuItem-root":{margin:"0px",minHeight:"auto",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",borderRadius:"0px","&:not(:last-child)":{borderBottom:"1px solid #2E2E2E"}}}}},children:u.map(e=>(0,r.jsxs)(d.Z,{value:e.name,disabled:e.disabled,children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,r.jsx)(s.Z,{sx:{width:24,height:24,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",opacity:e.disabled?.5:1},children:e.icon}),(0,r.jsx)(l.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"16px",lineHeight:"1.5em",letterSpacing:"-0.04em",color:e.disabled?"#666666":"#FFFFFF"},children:e.name})]}),i===e.name&&(0,r.jsx)(s.Z,{sx:{width:22,height:22,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(n.Z,{sx:{color:"#FFFFFF",fontSize:16}})})]},e.name))})})}},93573:function(e,t,i){i.d(t,{m:function(){return p}});var r=i(52676),n=i(75271),o=i(97792),a=i(72660),s=i(80110),l=i(45138),d=i(22988),c=i(77379),u=i(29984);function p(e){let{open:t,onClose:i,onSuccess:p,onFileReady:h,placeholder:m="Enter Suno/TikTok music URL (suno.ai or suno.com or tiktok.com)...",title:x="Parse Music URL"}=e,[g,f]=(0,n.useState)(""),[v,b]=(0,n.useState)(!1),[y,w]=(0,n.useState)(!1),[C,j]=(0,n.useState)(""),k=e=>{if(!e.trim())return{isValid:!1,error:"Please enter a URL"};try{new URL(e)}catch{return{isValid:!1,error:"Please enter a valid URL"}}let t=e.toLowerCase();return["tiktok.com","suno.ai","suno.com"].some(e=>t.includes(e))?{isValid:!0,error:""}:{isValid:!1,error:"Please enter a URL from TikTok or Suno Music"}},F=async(e,t)=>{try{let i=await fetch(e);if(!i.ok)throw Error(`Failed to download file: ${i.statusText}`);let r=await i.blob(),n=r.type||"audio/mpeg";return new File([r],t,{type:n})}catch(e){throw console.error("Error downloading file:",e),Error("Failed to download music file for trimming")}},S=async()=>{let e=k(g);if(!e.isValid){j(e.error);return}b(!0),j("");try{let e=await fetch("/api/media/parse_music_url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:g})}),i=await e.json();if(i.success&&i.url){if(h){w(!0),b(!1);try{var t;let e=(null===(t=i.metadata)||void 0===t?void 0:t.title)?`${i.metadata.title}.mp3`:`music_${Date.now()}.mp3`,r=await F(i.url,e);h(r,e,i.metadata)}catch(e){console.error("Failed to download music for trimming:",e),j("Failed to download music file. Please try again."),w(!1);return}}p(i.url,i.metadata),I()}else{console.error("Failed to parse music URL:",i.message||i.error);let e="Failed to parse music URL. Please try again.";(i.message||i.error||"").startsWith("modal download media failed:")||(e=i.message||i.error||e),j(e),b(!1)}}catch(e){console.error("Failed to parse music URL:",e),j("Network error. Please check your connection and try again."),b(!1)}},I=()=>{f(""),j(""),b(!1),w(!1),i()};n.useEffect(()=>{t&&(f(""),j(""),b(!1),w(!1))},[t]);let _=v||y;return(0,r.jsx)(o.Z,{open:t,onClose:I,maxWidth:"xs",fullWidth:!0,sx:{"& .MuiDialog-paper":{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"11px",padding:"16px 20px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}},children:(0,r.jsxs)(a.Z,{sx:{padding:0},children:[(0,r.jsx)(s.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.21em",color:"#FFFFFF",textAlign:"left",mb:3},children:x}),(0,r.jsx)(l.Z,{fullWidth:!0,value:g,onChange:e=>{f(e.target.value),C&&j("")},placeholder:m,error:!!C,disabled:_,sx:{mb:C?1:2,"& .MuiOutlinedInput-root":{backgroundColor:"#2E2E2E",color:"#FFFFFF",borderRadius:"8px",height:52,border:C?"1px solid #FF4444":"none","& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"},"&.Mui-error":{border:"1px solid #FF4444"},"&.Mui-disabled":{backgroundColor:"#1E1E1E",color:"#666"}},"& .MuiInputBase-input":{padding:"16px",fontSize:14,fontFamily:"Inter"}}}),C?(0,r.jsx)(s.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:12,lineHeight:"1.33em",color:"#FF4444",mb:2},children:C}):null,(0,r.jsxs)(d.Z,{sx:{mb:2},children:[(0,r.jsx)(s.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:12,lineHeight:"1.33em",color:"#888",mb:.5},children:"Example link formats:"}),(0,r.jsxs)(s.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:12,lineHeight:"1.33em",color:"#888",mb:.25},children:[(0,r.jsx)(d.Z,{component:"span",sx:{color:"#7BA7EE"},children:"https://suno.com/song/"}),(0,r.jsx)(d.Z,{component:"span",sx:{color:"#888"},children:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"})]}),(0,r.jsxs)(s.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:12,lineHeight:"1.33em",color:"#888"},children:[(0,r.jsx)(d.Z,{component:"span",sx:{color:"#7BA7EE"},children:"https://suno.com/s/"}),(0,r.jsx)(d.Z,{component:"span",sx:{color:"#888"},children:"xxxxxxxxxxxxxxxx"})]}),(0,r.jsxs)(s.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:12,lineHeight:"1.33em",color:"#888"},children:[(0,r.jsx)(d.Z,{component:"span",sx:{color:"#7BA7EE"},children:"https://www.tiktok.com/"}),(0,r.jsx)(d.Z,{component:"span",sx:{color:"#888"},children:"@xxxxxxx/video/xxxxxxxxxxxx"})]}),(0,r.jsxs)(s.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:12,lineHeight:"1.33em",color:"#888"},children:[(0,r.jsx)(d.Z,{component:"span",sx:{color:"#7BA7EE"},children:"https://tiktok.com/t/"}),(0,r.jsx)(d.Z,{component:"span",sx:{color:"#888"},children:"xxxxxxxxx"})]})]}),(0,r.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[(0,r.jsx)(c.Z,{onClick:I,variant:"outlined",disabled:_,sx:{borderRadius:"5px",padding:"10px 27px",width:180,height:44,textTransform:"none",fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.02em"},children:"Cancel"}),(0,r.jsx)(c.Z,{onClick:S,variant:"primary",disabled:!g.trim()||_,sx:{borderRadius:"5px",padding:"17px 42px",width:180,height:44,textTransform:"none",fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.21em"},startIcon:_?(0,r.jsx)(u.Z,{size:16,sx:{color:"inherit"}}):null,children:v?"Grabbing Music...":y?"Preparing...":"Grab Music"})]})]})})}},38262:function(e,t,i){i.d(t,{B:function(){return C}});var r=i(52676),n=i(75271),o=i(45162),a=i.n(o),s=i(66266),l=i(99630),d=i(97792),c=i(22988),u=i(72660),p=i(6721),h=i(80110),m=i(14930),x=i(56407),g=i(56547),f=i(75962),v=i(98283),b=i(79435),y=i(24088);let w="https://cdn.openart.ai/assets/internal/uploads/image_5Jl-3pyV_1920x1115_1759048758627.webp";function C(e){let{open:t,onClose:i,closeCallback:o}=e,a=(0,s.useRouter)(),[m,x]=(0,n.useState)(null),[g,C]=(0,n.useState)(w),[F,S]=(0,n.useState)(null),I=(0,n.useMemo)(()=>v.w,[]),_=(0,n.useCallback)(async e=>{let t=`${y.y1}/${(0,b.q)(e)}`;await a.push(t),i()},[a,i]),Z=(0,n.useMemo)(()=>{let e=I.find(e=>e.key===m);return m?null==e?void 0:e.background:w},[m,I]);return(0,n.useEffect)(()=>{Z&&Z!==g&&S(Z)},[Z,g]),(0,r.jsxs)(d.Z,{open:t,onClose:async()=>{await (null==o?void 0:o()),i()},fullScreen:!0,fullWidth:!0,PaperProps:{sx:{borderRadius:0,overflow:"hidden",position:"relative",backgroundColor:"transparent",margin:"0 !important",height:["100vh","100dvh"],maxHeight:["100vh","100dvh"]}},sx:{"& .MuiDialog-container":{alignItems:"center",justifyContent:"center",opacity:"1 !important",height:["100vh","100dvh"],maxHeight:["100vh","100dvh"]}},children:[(0,r.jsxs)(c.Z,{sx:{position:"absolute",inset:0,zIndex:0,pointerEvents:"none"},children:[(0,r.jsx)(c.Z,{sx:{position:"absolute",inset:0,backgroundImage:`url(${g})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),F?(0,r.jsx)(c.Z,{component:f.m.div,initial:{opacity:0},animate:{opacity:1},transition:{duration:.35,ease:"easeOut"},onAnimationComplete:()=>{F&&(C(F),S(null))},sx:{position:"absolute",inset:0,backgroundImage:`url(${F})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}):null]}),(0,r.jsxs)(u.Z,{sx:{pt:{xs:3,md:8},position:"relative",zIndex:1,display:"flex",flexDirection:"column",height:["100vh","100dvh"],maxHeight:["100vh","100dvh"],overflowY:"auto",overflowX:"hidden"},children:[(0,r.jsx)(p.Z,{"aria-label":"Close",onClick:()=>{null==o||o(),i()},sx:{position:"absolute",right:{xs:20,md:110},top:{xs:20,md:50},color:"var(--Gray-800)",cursor:"pointer",zIndex:1e3,bgcolor:"var(--Gray-100)","&:hover":{bgcolor:"var(--Gray-200)"}},children:(0,r.jsx)(l.Z,{})}),(0,r.jsxs)(c.Z,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",transform:{xs:"none",md:"translateY(-10%)"}},children:[(0,r.jsx)(h.Z,{component:"h2",sx:{textAlign:"center",color:"var(--Gray-900)",fontWeight:800,fontSize:{xs:22,md:36},letterSpacing:"-0.02em",mb:"56px",fontFamily:"Poppins",maxWidth:600,mx:"auto"},children:"Which type of music video would you like to create?"}),(0,r.jsx)(c.Z,{sx:{px:{xs:2,md:6},display:{xs:"grid"},gridTemplateColumns:{xs:"repeat(2, minmax(0, 1fr))",md:"repeat(4, minmax(0, 1fr))"},alignItems:"center",justifyItems:"center",gap:{xs:3,md:6},flexWrap:{md:"wrap"},maxWidth:1240,mx:"auto"},component:f.m.div,variants:k,initial:!1,animate:"show",children:I.map(e=>(0,r.jsx)(j,{option:e,onClick:()=>_(e.key),setIsHovered:t=>{x(t?e.key:null)}},e.key))})]})]})]})}function j(e){let{option:t,onClick:i,setIsHovered:o}=e,s={xs:120,md:160},l={xs:180,md:220},d={xs:12,md:24},[u,p]=(0,n.useState)(!1),v=(0,m.Z)("(hover: hover) and (pointer: fine)");return(0,r.jsxs)(x.Z,{alignItems:"center",spacing:2,component:f.m.div,variants:F,sx:{cursor:"pointer",scale:.9,"@media (hover: hover) and (pointer: fine)":{"&:hover":{scale:1.2}},"& .MuiDialog-container":{alignItems:"center",justifyContent:"center",opacity:"1 !important"},transition:"scale 0.2s ease-in-out"},onMouseEnter:()=>{v&&(o(!0),p(!0))},onMouseLeave:()=>{v&&(o(!1),p(!1))},children:[(0,r.jsxs)(g.Z,{component:f.m.a,href:`${y.y1}/${(0,b.q)(t.key)}`,onClick:e=>{e.preventDefault(),i()},focusRipple:!0,sx:{borderRadius:"50%",p:0,position:"relative",width:l,height:l,cursor:"pointer",willChange:"transform","&:focus-visible":{outline:"2px solid",outlineColor:e=>e.palette.Colors.Blue["600"],outlineOffset:2}},children:[(0,r.jsx)(c.Z,{component:f.m.img,src:"https://cdn.openart.ai/assets/internal/uploads/image_7zymQp7-_1168x1168_1759048232936.webp",alt:"Vinyl disc",animate:u?{rotate:360}:{rotate:0},transition:u?{duration:5,ease:"linear",repeat:1/0}:{duration:.3,ease:"easeOut"},sx:{position:"absolute",inset:0,width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",pointerEvents:"none",willChange:"auto"}}),(0,r.jsx)(c.Z,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:s,height:s,borderRadius:"50%",overflow:"hidden",boxShadow:e=>`0 0 0 2px ${e.palette.Colors.Gray["400"]} inset`},children:t.hoverPlayVideo&&u&&v?(0,r.jsx)(c.Z,{component:"video",src:t.hoverPlayVideo,autoPlay:!0,loop:!0,playsInline:!0,sx:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):(0,r.jsx)(a(),{src:t.image,alt:t.title,fill:!0,sizes:"(max-width: 600px) 50vw, (max-width: 900px) 25vw, 15vw",style:{objectFit:"cover"}})}),!u&&(0,r.jsx)(c.Z,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:d,height:d,borderRadius:"50%",bgcolor:"black",boxShadow:"0 0 0 2px black inset"}})]}),(0,r.jsxs)(x.Z,{spacing:.5,alignItems:"center",sx:{textAlign:"center"},children:[(0,r.jsx)(h.Z,{sx:{color:e=>e.palette.Colors.Gray["900"],fontWeight:800},children:t.title}),(0,r.jsx)(h.Z,{sx:{color:e=>e.palette.Colors.Gray["700"],fontSize:13},children:t.desc})]})]})}let k={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.03,delayChildren:.02}}},F={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.12,ease:"easeOut"}},rest:{y:0},hover:{y:-2,transition:{duration:.08,ease:"easeOut"}},tap:{y:-1,transition:{duration:.06,ease:"easeOut"}}}},722:function(e,t,i){i.d(t,{z:function(){return ee}});var r=i(52676),n=i(75271),o=i(90145),a=i(97792),s=i(6721),l=i(56407),d=i(22988),c=i(42312),u=i(49200),p=i(7672),h=i(77379),m=i(23638),x=i(39204);let g=e=>{let{canNavigatePrev:t=!1,canNavigateNext:i=!1,onPrev:n,onNext:o,isAnimationReady:a=!0,isMobile:d=!1}=e;if(d)return t||i?(0,r.jsxs)(l.Z,{direction:"row",spacing:2,mt:2,justifyContent:"center",children:[t?(0,r.jsx)(h.Z,{onClick:n,variant:"outlined",startIcon:(0,r.jsx)(u.Z,{}),sx:{borderColor:"#2E2E2E",color:"#FFFFFF",fontSize:"14px",textTransform:"none",flex:1,"&:hover":{borderColor:"#444444",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Previous"}):null,i?(0,r.jsx)(h.Z,{onClick:o,variant:"outlined",endIcon:(0,r.jsx)(p.Z,{}),sx:{borderColor:"#2E2E2E",color:"#FFFFFF",fontSize:"14px",textTransform:"none",flex:1,"&:hover":{borderColor:"#444444",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Next"}):null]}):null;let c={width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"rgba(0, 0, 0, 0.3)",color:"#FFFFFF",backdropFilter:"blur(8px)",border:"1px solid rgba(255, 255, 255, 0.1)",transition:"all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"rgba(255, 255, 255, 0.2)"}},g={initial:a?{opacity:0,scale:.9}:{opacity:1,scale:1},animate:{opacity:1,scale:1,transition:{duration:.2,ease:[.25,.46,.45,.94],delay:.05}},exit:a?{opacity:0,scale:.9,transition:{duration:.15,ease:[.55,.085,.68,.53]}}:{opacity:1,scale:1}},f=a?{scale:1.05,transition:{duration:.2,ease:[.25,.46,.45,.94]}}:{},v=a?{scale:.95,transition:{duration:.1,ease:[.25,.46,.45,.94]}}:{};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.M,{children:t?(0,r.jsx)(x.E.div,{...g,style:{position:"absolute",top:"50%",left:"16px",transform:"translateY(-50%)",zIndex:1e3,willChange:"transform, opacity"},children:(0,r.jsx)(s.Z,{onClick:n,component:x.E.button,whileHover:f,whileTap:v,sx:c,children:(0,r.jsx)(u.Z,{sx:{fontSize:"24px"}})})}):null}),(0,r.jsx)(m.M,{children:i?(0,r.jsx)(x.E.div,{...g,style:{position:"absolute",top:"50%",right:"16px",transform:"translateY(-50%)",zIndex:1e3,willChange:"transform, opacity"},children:(0,r.jsx)(s.Z,{onClick:o,component:x.E.button,whileHover:f,whileTap:v,sx:c,children:(0,r.jsx)(p.Z,{sx:{fontSize:"24px"}})})}):null})]})};var f=i(56547),v=i(86262),b=i(27806);function y(e){let{onShare:t,onDownload:i,isRebuilding:o,sx:a,canShare:s,canDownload:c,onDelete:u,isDeleting:p,canDelete:m,isMobile:x=!1,story:g,useDirectDownload:y=!1}=e,[w,C]=(0,n.useState)(!1),[j,k]=(0,n.useState)(null),F=(e,t,i,n)=>x?(0,r.jsx)(h.Z,{onClick:t,disabled:i,variant:"outlined",startIcon:e,sx:{borderColor:"#2E2E2E",color:"#FFFFFF",fontSize:"14px",textTransform:"none",flex:1,"&:hover":{borderColor:"#444444",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:n}):(0,r.jsx)(f.Z,{onClick:t,disabled:i,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:"4px",height:"32px",padding:"0 8px",background:"rgba(16, 16, 16, 0.52)",color:"#666666",fontSize:"12px",fontWeight:500,lineHeight:"20px",textTransform:"none",minWidth:"auto",borderRadius:"6.5px","&:hover":{background:"rgba(16, 16, 16, 0.52)"}},children:e}),S=(e,t)=>e?(0,r.jsx)(d.Z,{sx:{width:"16px",height:"16px",border:"2px solid #444444",borderTop:"2px solid #CCCCCC",borderRadius:"50%",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}):t;return(0,r.jsxs)(l.Z,{direction:x?"row":"column",spacing:x?2:1,sx:a,children:[s?F((0,r.jsx)(b.PhShareFat,{sx:{fontSize:"16px",color:"#CCCCCC"}}),t,!1,"Share"):null,c?F(S(o,(0,r.jsx)(b.PhDownloadSimple,{sx:{fontSize:"16px",color:"#CCCCCC"}})),e=>{y?i():(k(e.currentTarget),C(!0))},o,"Download"):null,m?F(S(p,(0,r.jsx)(b.PhTrash,{sx:{fontSize:"16px",color:"#CCCCCC"}})),u,p,"Delete"):null,g&&!y?(0,r.jsx)(v.Z,{open:w,anchorEl:j,onClose:()=>{C(!1),k(null)},story:g,openDirectlyToExportOptions:!0}):null]})}var w=i(38970);let C=e=>{let{onEdit:t,isEditingStory:i,onEditStory:n}=e;return t?(0,r.jsx)(h.Z,{onClick:n,disabled:i,sx:{backgroundColor:"#013FFE",color:"#FFFFFF",fontSize:{xs:"14px",md:"16px"},fontWeight:700,lineHeight:"23px",textTransform:"none",width:"100%",height:"44px",borderRadius:"8px",gap:"10px","&:hover":{backgroundColor:"#0135E6"},"&:disabled":{backgroundColor:"#666666",color:"#CCCCCC"}},startIcon:i?(0,r.jsx)(d.Z,{sx:{width:"18px",height:"18px",border:"2px solid #CCCCCC",borderTop:"2px solid #FFFFFF",borderRadius:"50%",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}):(0,r.jsx)(w.Z,{sx:{fontSize:"18px"}}),children:i?"Processing...":"Edit the story"}):null};var j=i(23187);function k(e){let{onDelete:t,isDeleting:i,canDelete:n}=e;return n?(0,r.jsx)(l.Z,{direction:"column",spacing:1.5,children:(0,r.jsx)(f.Z,{onClick:t,disabled:i,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:"8px",height:"36px",padding:"16px 24px",background:"rgba(220, 53, 69, 0.12)",color:"#dc3545",fontSize:"14px",fontWeight:500,lineHeight:"20px",textTransform:"none",minWidth:"auto",borderRadius:"8px",width:"100%","&:hover":{background:"rgba(220, 53, 69, 0.2)"},"&:disabled":{background:"rgba(220, 53, 69, 0.08)",color:"rgba(220, 53, 69, 0.5)"}},children:i?(0,r.jsx)(d.Z,{sx:{width:"16px",height:"16px",border:"2px solid #444444",borderTop:"2px solid #CCCCCC",borderRadius:"50%",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.PhTrash,{sx:{fontSize:"16px"}}),"Delete"]})})}):null}var F=i(66266),S=i.n(F),I=i(76651),_=i(48858),Z=i(80110),A=i(8928);let E={character_vlog:{label:"Character Vlog",sx:{backgroundColor:"rgba(1, 63, 254, 0.40);"}},script_to_video:{label:"Explainer Video",sx:{backgroundColor:"rgba(251, 35, 194, 0.40)"}},music_video:{label:"Music Video",sx:{backgroundColor:"rgba(27, 239, 97, 0.20)"}},create_from_scratch:{label:"Create from Scratch",sx:{}},asmr_video:{label:"ASMR Video",sx:{backgroundColor:"rgba(27, 239, 97, 0.20)"}}},M={"consistent-character":{label:"Consistent Character",sx:{}},"consistent-style":{label:"Style Mode",sx:{}},"singing-dancing":{label:"Sing Mode",sx:{}},"story-focused":{label:"Story Mode",sx:{}},"lyrics-video":{label:"Lyrics Video",sx:{}}},T=(0,A.ZP)(I.Z)({backgroundColor:"#1A1A1A",color:"#E0E0E0",fontSize:"14px",fontWeight:600,height:"32px",borderRadius:"4px","& .MuiChip-label":{px:"8px"}}),R=e=>{let{story:t,showProfile:i=!0,isMobile:o=!1}=e,a=(0,F.useRouter)(),s=(0,n.useMemo)(()=>{let e=E[t.category_id];if(!e)return[];let i=[];if(e&&i.push((0,r.jsx)(T,{label:`# ${e.label}`,sx:e.sx},`${t.category_id}`)),"music_video"===t.category_id){let e=M[t.category_inputs.video_type];e&&i.push((0,r.jsx)(T,{label:`# ${e.label}`,sx:e.sx},e.label))}return i},[t.category_id,t.category_inputs]);return(0,r.jsxs)(l.Z,{spacing:2,children:[(0,r.jsx)(l.Z,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"wrap",children:s}),(()=>{let e=null==t?void 0:t.profile;if(!i||!e)return null;let n=e.display_name||e.username;return(0,r.jsxs)(l.Z,{direction:"row",spacing:1.25,alignItems:"center",sx:{cursor:"pointer"},onClick:t=>{t.stopPropagation(),t.preventDefault(),e.username&&!e.is_team&&a.push(`/@${e.username}`)},children:[(0,r.jsx)(_.Z,{src:e.avatar_url,sx:{width:36,height:36,border:"2px solid rgb(213, 131, 131)"}}),(0,r.jsx)(Z.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontSize:"16px",fontWeight:600,lineHeight:"22px"},children:n})]})})(),(0,r.jsxs)(l.Z,{children:[(0,r.jsxs)(l.Z,{direction:"row",spacing:1,alignItems:"center",children:[t.is_template?(0,r.jsx)(T,{label:"Example",sx:{backgroundColor:"#013FFE",color:"#FFFFFF",fontSize:"12px",fontWeight:600,height:"24px",borderRadius:"4px",flexShrink:0,"& .MuiChip-label":{px:"6px"},...o&&{background:"linear-gradient(135deg, rgba(255, 246, 246, 0.15) 0%, rgba(255, 255, 255, 0.2) 100%)",border:"1px solid rgba(255, 255, 255, 0.08)",backdropFilter:"blur(10.9px)",color:"rgba(255, 255, 255, 0.62)",fontFamily:"Inter",fontSize:"14px",fontWeight:600,height:"24px",borderRadius:"6px","& .MuiChip-label":{px:"8px",py:"4px"}}}}):null,(0,r.jsx)(Z.Z,{sx:{color:"#FFFFFF",fontSize:o?"14px":"16px",fontWeight:700,letterSpacing:"-0.16px",flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title})]}),(0,r.jsx)(Z.Z,{sx:{color:"#888888",fontSize:"12px",fontWeight:500},children:function(e){try{let t=e.created_at;if(e.is_published&&!e.is_featured&&e.published_at&&(t=e.published_at),!t)return"";let i=function(e){if(!e)return null;if("number"==typeof e)return new Date(e);if("object"==typeof e&&void 0!==e._seconds){let t=e._seconds||0;return new Date(1e3*t+(e._nanoseconds||0)/1e6)}return"string"==typeof e?new Date(e):e instanceof Date?e:null}(t);if(!i||!(i instanceof Date&&!Number.isNaN(i.getTime())))return"";return i.toLocaleString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(e){return console.warn("Error formatting story date:",e),""}}(t)})]})]})};var D=i(19005);function z(e){let t,{onShare:i,onDownload:o,isRebuilding:a,canShare:s,canDownload:c,story:u,useDirectDownload:p=!1,showVideoOutdatedHint:h=!0}=e,[m,x]=(0,n.useState)(!1),[g,y]=(0,n.useState)(null),{data:w}=(0,D.CD)(),C=(0,n.useMemo)(()=>(null==w?void 0:w.id)===(null==u?void 0:u.created_by_user_id),[w,u]),j=(0,n.useMemo)(()=>h&&(null==u?void 0:u.is_published)&&(null==u?void 0:u.is_export_outdated)&&C,[C,h,null==u?void 0:u.is_export_outdated,null==u?void 0:u.is_published]),k=(e,t,i,n)=>(0,r.jsx)(f.Z,{onClick:t,disabled:i,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:"8px",height:"36px",padding:"16px 24px",background:"rgba(255, 255, 255, 0.12)",color:"white",fontSize:"12px",fontWeight:500,lineHeight:"20px",textTransform:"none",minWidth:"auto",borderRadius:"8px",width:"100%","&:hover":{background:"rgba(255, 255, 255, 0.12)"},...n},children:e}),F=[s,c].filter(Boolean).length;return 0===F?null:(0,r.jsxs)(l.Z,{direction:"column",flexWrap:"wrap",spacing:1.5,children:[(0,r.jsx)(Z.Z,{sx:{color:"#FFFFFF",fontSize:{xs:"14px",md:"16px"},fontWeight:700,lineHeight:"23px"},children:"Share & Download"}),(0,r.jsx)(P,{visible:j}),(0,r.jsx)(l.Z,{direction:"column",spacing:1,children:(0,r.jsxs)(d.Z,{sx:{display:"grid",gridTemplateColumns:`repeat(${F}, 1fr)`,gap:"8px",width:"100%"},children:[s?k((0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.PhShareFat,{sx:{fontSize:"16px"}})," Share"]}),i,!1):null,c?k((t=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.PhDownloadSimple,{sx:{fontSize:"16px"}})," Download"]}),a?(0,r.jsx)(d.Z,{sx:{width:"16px",height:"16px",border:"2px solid #444444",borderTop:"2px solid #CCCCCC",borderRadius:"50%",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}):t),e=>{p?o():(y(e.currentTarget),x(!0))},a):null]})}),u&&!p?(0,r.jsx)(v.Z,{open:m,anchorEl:g,onClose:()=>{x(!1),y(null)},story:u,openDirectlyToExportOptions:!0}):null]})}let P=(0,n.memo)(e=>{let{visible:t}=e;return t?(0,r.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:"4px",px:1.5,py:1,borderRadius:"6px",backgroundColor:"rgba(47, 102, 255, 0.28)",border:"1px solid #1856d0"},children:[(0,r.jsx)(d.Z,{sx:{width:16,height:16,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M8 1C4.13401 1 1 4.13401 1 8C1 11.866 4.13401 15 8 15C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1ZM8 4.5C8.41421 4.5 8.75 4.83579 8.75 5.25C8.75 5.66421 8.41421 6 8 6C7.58579 6 7.25 5.66421 7.25 5.25C7.25 4.83579 7.58579 4.5 8 4.5ZM8.75 11.25C8.75 11.6642 8.41421 12 8 12C7.58579 12 7.25 11.6642 7.25 11.25V8.25C7.25 7.83579 7.58579 7.5 8 7.5C8.41421 7.5 8.75 7.83579 8.75 8.25V11.25Z",fill:"#9CBAFF"})})}),(0,r.jsx)(Z.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"normal",color:"#9CBAFF"},children:"Published version is out of sync. Click Download to export the latest."})]}):null});P.displayName="VideoOutdatedHint";var W=i(57497);let L=e=>{let{story:t,showProfile:i=!0,canShare:n=!0,canDownload:o=!0,canDelete:a=!0,isRebuilding:s,isDeleting:c,useDirectDownload:u=!1,bottomContent:p,isAnimationReady:h,isMobile:f,showVideoOutdatedHint:v=!0,canNavigateNext:b=!1,canNavigatePrev:y=!1,onNext:w,onPrev:C,onShare:F,onDownload:S,onDelete:I,onEdit:_}=e,Z=(0,W.q)(t.category_id);return(0,r.jsx)(l.Z,{px:2,py:f?2:3,height:f?"60%":"100%",direction:"column",width:"100%",maxWidth:f?"100%":"30%",spacing:f?2:3,sx:{borderTop:f?"1px solid #2E2E2E":"none",flex:f?1:void 0,pb:f?4:void 0},children:(0,r.jsx)(m.M,{mode:"wait",children:(0,r.jsxs)(x.E.div,{initial:h?{opacity:0,y:8}:{opacity:1,y:0},animate:{opacity:1,y:0,transition:{duration:.25,ease:[.25,.46,.45,.94],delay:.1}},exit:h?{opacity:0,y:-8,transition:{duration:.15,ease:[.55,.085,.68,.53]}}:{opacity:1,y:0},style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:f?"16px":"24px",willChange:"transform, opacity"},children:[(0,r.jsx)(R,{story:t,showProfile:i,isMobile:f}),(0,r.jsx)(j.Z,{}),(0,r.jsx)(z,{onShare:F,onDownload:S,isRebuilding:s,canShare:n,canDownload:o,onEdit:_,story:t,useDirectDownload:u,showVideoOutdatedHint:v}),(0,r.jsx)(l.Z,{direction:"column",spacing:1.5,pr:f?0:1.5,sx:{overflowY:f?"visible":"auto",flex:f?void 0:1},children:Z?(0,r.jsx)(Z,{story:t}):null}),f?(0,r.jsxs)(l.Z,{sx:{mt:2},spacing:1,children:[p,(0,r.jsx)(k,{onDelete:I,isDeleting:c,canDelete:a}),(0,r.jsx)(g,{canNavigatePrev:y,canNavigateNext:b,onPrev:C,onNext:w,isAnimationReady:h,isMobile:f})]}):(0,r.jsx)(d.Z,{sx:{mt:"auto !important"},children:p})]},`${t.id}-details`)})})};var B=i(63108),H=i(79435),$=i(80749);let O=e=>{let{story:t}=e,{data:i}=(0,D.CD)(),n=(null==i?void 0:i.id)===(null==t?void 0:t.created_by_user_id);return(0,r.jsx)(h.Z,{variant:n?"outlined":"primary",onClick:()=>{if(t){if("music_video"===t.category_id){let e=t.category_inputs||{};$.E.getState().setPrefill("music_video",e);let i=e.video_type||"singing-dancing";S().push(`/music-video/${(0,H.q)(i)}`);return}if("character_vlog"===t.category_id){$.E.getState().setPrefill("character_vlog",t.category_inputs),S().push("/story/create/vlog");return}if("script_to_video"===t.category_id){$.E.getState().setPrefill("script_to_video",t.category_inputs),S().push("/story/create/script");return}if("asmr_video"===t.category_id){$.E.getState().setPrefill("asmr_video",t.category_inputs),S().push("/story/create/asmr");return}}},sx:{fontSize:{xs:"14px",md:"16px"},fontWeight:700,lineHeight:"23px",textTransform:"none",width:"100%",height:"44px",borderRadius:"8px",gap:"10px"},startIcon:n?(0,r.jsx)(B.Z,{sx:{fontSize:"18px"}}):(0,r.jsx)(b.PhSparkle,{size:18}),children:n?"Reuse Setting":(0,r.jsxs)(r.Fragment,{children:["Remix this Story ",(0,r.jsx)(b.PhArrowRight,{size:18})]})})};var U=i(12120),G=i(1299);let N=e=>{var t,i,o,a;let{story:s,useStoryPreviewPlayer:l=!1,isAnimationReady:d,currentVideoTime:c=0}=e,u=(0,n.useRef)(null);(0,n.useEffect)(()=>{u.current&&c>0&&(u.current.currentTime=c)},[c,s.id]);let p=(0,n.useMemo)(()=>{var e,t;return Array.isArray(null===(e=s.video_editor_timeline)||void 0===e?void 0:e.tracks)&&s.video_editor_timeline.tracks.length>0&&Array.isArray(null===(t=s.video_editor_timeline)||void 0===t?void 0:t.mediaAssets)&&s.video_editor_timeline.mediaAssets.length>0},[null===(t=s.video_editor_timeline)||void 0===t?void 0:t.tracks,null===(i=s.video_editor_timeline)||void 0===i?void 0:i.mediaAssets]);return(0,r.jsx)(m.M,{mode:"wait",children:(0,r.jsx)(x.E.div,{initial:d?{opacity:0,x:15}:{opacity:1,x:0},animate:{opacity:1,x:0,transition:{duration:.2,ease:[.25,.46,.45,.94]}},exit:d?{opacity:0,x:-15,transition:{duration:.15,ease:[.55,.085,.68,.53]}}:{opacity:1,x:0},style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",willChange:"transform, opacity"},children:l&&p?(0,r.jsx)(G.cP,{storyData:s,controls:!0,autoPlay:Array.isArray(null===(o=s.video_editor_timeline)||void 0===o?void 0:o.tracks)&&s.video_editor_timeline.tracks.length>0&&Array.isArray(null===(a=s.video_editor_timeline)||void 0===a?void 0:a.mediaAssets)&&s.video_editor_timeline.mediaAssets.length>0,style:{width:"100%",height:"100%",objectFit:"contain",display:"block"}}):(0,r.jsx)(U.X,{story:s,origin:"preview_video_dialog",children:e=>(0,r.jsx)("video",{ref:u,controls:!0,preload:"auto",loop:!0,autoPlay:!0,playsInline:!0,poster:s.last_export_thumbnail_url,"aria-label":s.title||"Story video",onPlay:e.onPlay,onPause:e.onPause,onEnded:e.onEnded,onTimeUpdate:e.onTimeUpdate,onSeeking:e.onSeeking,onError:e.onError,onLoadStart:e.onLoadStart,onLoadedMetadata:()=>{u.current&&c>0&&(u.current.currentTime=c)},style:{width:"100%",height:"100%",objectFit:"contain",display:"block"},src:s.last_export_url,children:"Your browser does not support the video tag."})})},s.id)})};var V=i(24181);let K=()=>(0,r.jsxs)(l.Z,{direction:"column",sx:{minHeight:"100%",overflowY:"auto"},children:[(0,r.jsx)(d.Z,{sx:{width:"100%",height:"40vh",minHeight:"250px",position:"relative",backgroundColor:"#1A1A1A",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(V.Z,{variant:"rectangular",width:"100%",height:"100%",sx:{backgroundColor:"#2A2A2A"}})}),(0,r.jsxs)(l.Z,{px:2,py:2,direction:"column",spacing:2,sx:{borderTop:"1px solid #2E2E2E",flex:1,pb:4},children:[(0,r.jsxs)(l.Z,{spacing:1.5,children:[(0,r.jsx)(l.Z,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"wrap",children:(0,r.jsx)(V.Z,{variant:"rectangular",width:120,height:32,sx:{backgroundColor:"#2A2A2A",borderRadius:"4px"}})}),(0,r.jsx)(j.Z,{}),(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(V.Z,{variant:"text",width:"80%",height:20,sx:{backgroundColor:"#2A2A2A"}}),(0,r.jsx)(V.Z,{variant:"text",width:"60%",height:16,sx:{backgroundColor:"#2A2A2A"}})]})]}),(0,r.jsx)(j.Z,{}),(0,r.jsxs)(l.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,r.jsx)(V.Z,{variant:"rectangular",width:40,height:40,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px"}}),(0,r.jsx)(V.Z,{variant:"rectangular",width:40,height:40,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px"}})]}),(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(V.Z,{variant:"text",width:"100%",height:20,sx:{backgroundColor:"#2A2A2A"}}),(0,r.jsx)(V.Z,{variant:"text",width:"100%",height:20,sx:{backgroundColor:"#2A2A2A"}})]}),(0,r.jsx)(V.Z,{variant:"rectangular",width:"100%",height:44,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px",mt:2}})]})]}),q=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{sx:{width:"70%",height:"100%",position:"relative",backgroundColor:"#1A1A1A",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(V.Z,{variant:"rectangular",width:"100%",height:"100%",sx:{backgroundColor:"#2A2A2A"}})}),(0,r.jsxs)(l.Z,{px:2,py:3,height:"100%",direction:"column",width:"100%",maxWidth:"30%",spacing:3,children:[(0,r.jsxs)(l.Z,{spacing:2,children:[(0,r.jsx)(l.Z,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"wrap",children:(0,r.jsx)(V.Z,{variant:"rectangular",width:120,height:32,sx:{backgroundColor:"#2A2A2A",borderRadius:"4px"}})}),(0,r.jsxs)(l.Z,{direction:"row",spacing:1.25,alignItems:"center",children:[(0,r.jsx)(V.Z,{variant:"circular",width:36,height:36,sx:{backgroundColor:"#2A2A2A"}}),(0,r.jsx)(V.Z,{variant:"text",width:120,height:22,sx:{backgroundColor:"#2A2A2A"}})]}),(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(V.Z,{variant:"text",width:"90%",height:20,sx:{backgroundColor:"#2A2A2A"}}),(0,r.jsx)(V.Z,{variant:"text",width:"70%",height:16,sx:{backgroundColor:"#2A2A2A"}})]})]}),(0,r.jsx)(j.Z,{}),(0,r.jsxs)(l.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,r.jsx)(V.Z,{variant:"rectangular",width:40,height:40,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px"}}),(0,r.jsx)(V.Z,{variant:"rectangular",width:40,height:40,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px"}})]}),(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,pr:1.5,sx:{overflowY:"auto"},children:[(0,r.jsx)(V.Z,{variant:"text",width:"100%",height:20,sx:{backgroundColor:"#2A2A2A"}}),(0,r.jsx)(V.Z,{variant:"text",width:"100%",height:20,sx:{backgroundColor:"#2A2A2A"}}),(0,r.jsx)(V.Z,{variant:"text",width:"80%",height:20,sx:{backgroundColor:"#2A2A2A"}})]}),(0,r.jsx)(d.Z,{sx:{mt:"auto !important"},children:(0,r.jsx)(V.Z,{variant:"rectangular",width:"100%",height:44,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px"}})})]})]});var Y=i(9479),X=i(93710),J=i(16585),Q=i(97779);let ee=e=>{let{open:t,onClose:i,workflowRunId:u,isRebuilding:p,isDeleting:h,shouldAutoDownload:m,story:x,story_id:f,showProfile:b=!0,bottomContent:w,canShare:j=!0,canDownload:k=!0,canDelete:S=!0,onDownload:I,onExportComplete:_,onDelete:Z,onEdit:A,useStoryPreviewPlayer:E=!1,useDirectDownload:M=!1,needloadCompleteData:T=!1,canNavigateNext:R=!1,canNavigatePrev:D=!1,onNext:z,onPrev:P,currentVideoTime:W,showVideoOutdatedHint:B=!0}=e,{isMobile:H}=(0,Q.j)(),{currentStory:$,isLoadingStory:U,shareAnchorEl:G,isSharePopoverOpen:V,isAnimationReady:ee,isEditingStory:et,handleShareClick:ei,handleShareClose:er,handleEditStory:en,handleDeleteStory:eo}=function(e){let{story:t,story_id:i,needloadCompleteData:r,onEdit:o,onDelete:a}=e,s=(0,F.useRouter)(),[l,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!1),[p,h]=(0,n.useState)(!1),{data:m,isLoading:x}=(0,X.TO)(i,r||!t),{mutateAsync:g}=(0,Y.GH)(),f=r?m:t;(0,n.useEffect)(()=>{u(!0)},[]);let v=async()=>{if(f)try{if(h(!0),f.is_template){(0,J.B)("editor_opened",{story_id:f.id,opened_from:"preview_video_dialog"});let e=await g({templateStoryId:f.id,operation:"edit"});s.push(`/story/editor?story_id=${e.id}`)}else null==o||o()}catch(e){console.error("Error editing story:",e)}finally{h(!1)}},b=async()=>{f&&((null==f?void 0:f.is_template)?await g({templateStoryId:f.id,operation:"delete"}):await (null==a?void 0:a()))};return{currentStory:f,isLoadingStory:x,shareAnchorEl:l,isSharePopoverOpen:!!l,isAnimationReady:c,isEditingStory:p,handleShareClick:e=>{d(e.currentTarget)},handleShareClose:()=>{d(null)},handleEditStory:v,handleDeleteStory:b}}({story:x,story_id:f,onEdit:A,onDelete:Z,needloadCompleteData:T}),ea=U&&!$,es=(null==$?void 0:$.category_id)==="create_from_scratch"?null:(0,r.jsx)(O,{story:$}),el=(0,r.jsx)(C,{onEdit:A,isEditingStory:et,onEditStory:en});return(0,r.jsxs)(a.Z,{open:t,onClose:i,maxWidth:!1,fullWidth:!0,sx:{"& .MuiDialog-container":{alignItems:"center",justifyContent:"center",opacity:"1 !important"}},PaperProps:{sx:{backgroundColor:"#101010",border:"1px solid #2E2E2E",borderRadius:H?"0px":"12px",width:H?"100vw":"1103px",maxWidth:H?"100vw":"90vw",height:H?"100%":"829px",...!H&&{maxHeight:"90vh"},margin:0,padding:0,position:"relative",overflow:"hidden",display:"flex",flexDirection:H?"column":"row",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"}},children:[(0,r.jsx)(s.Z,{onClick:i,sx:{position:"absolute",top:"16px",right:"16px",width:"30px",height:"30px",borderRadius:"50%",color:"var(--Gray-600)",backgroundColor:H?"rgba(0, 0, 0, 0.6)":"transparent",backdropFilter:H?"blur(8px)":"none",border:H?"1px solid var(--Gray-300)":"none",zIndex:1e3,"@media (hover: hover)":{"&:hover":{backgroundColor:H?"rgba(0, 0, 0, 0.8)":"rgba(0, 0, 0, 0.1)",color:"var(--Gray-700)"}}},children:(0,r.jsx)(o.Z,{sx:{fontSize:"18px"}})}),ea?H?K():q():$?H?(0,r.jsxs)(l.Z,{direction:"column",sx:{minHeight:"100%",overflowY:"auto"},children:[(0,r.jsxs)(d.Z,{sx:{width:"100%",height:"40vh",minHeight:"250px",position:"relative",backgroundColor:"#1A1A1A",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:[(0,r.jsx)(N,{story:$,useStoryPreviewPlayer:E,isAnimationReady:ee,currentVideoTime:W}),u&&(null==$?void 0:$.id)?(0,r.jsx)(c.d,{workflowRunId:u,storyId:$.id,onComplete:_,shouldAutoDownload:m}):null]}),(0,r.jsx)(L,{story:$,showProfile:b,canShare:j,canDownload:k,canDelete:S,isRebuilding:p,isDeleting:h,useDirectDownload:M,bottomContent:w||el,isAnimationReady:ee,isMobile:H,showVideoOutdatedHint:B,canNavigateNext:R,canNavigatePrev:D,onNext:z,onPrev:P,onShare:ei,onDownload:I,onDelete:eo,onEdit:A})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.Z,{sx:{width:"70%",height:"100%",position:"relative",backgroundColor:"#1A1A1A",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,r.jsx)(N,{story:$,useStoryPreviewPlayer:E,isAnimationReady:ee,currentVideoTime:W}),(0,r.jsx)(y,{onShare:ei,onDownload:I,isRebuilding:p,canShare:(null==$||!$.is_template)&&j,canDownload:(null==$||!$.is_template)&&k,onDelete:eo,isDeleting:h,canDelete:S,story:$,useDirectDownload:M,sx:{position:"absolute",top:"16px",right:"16px"}}),u&&(null==$?void 0:$.id)?(0,r.jsx)(c.d,{workflowRunId:u,storyId:$.id,onComplete:_,shouldAutoDownload:m}):null,(0,r.jsx)(g,{canNavigatePrev:D,canNavigateNext:R,onPrev:P,onNext:z,isAnimationReady:ee,isMobile:!1})]}),(0,r.jsx)(L,{story:$,showProfile:b,canShare:j,canDownload:k,canDelete:S,isRebuilding:p,isDeleting:h,useDirectDownload:M,bottomContent:(0,r.jsxs)(l.Z,{direction:"column",spacing:1,children:[es,w||el]}),isAnimationReady:ee,isMobile:H,showVideoOutdatedHint:B,canNavigateNext:R,canNavigatePrev:D,onNext:z,onPrev:P,onShare:ei,onDownload:I,onDelete:eo,onEdit:A})]}):null,$?(0,r.jsx)(v.Z,{open:V,anchorEl:G,onClose:er,story:$}):null]})}},67431:function(e,t,i){i.d(t,{E:function(){return c}});var r=i(52676),n=i(75271),o=i(22988),a=i(60454),s=i(54669);let l=e=>`<<CHARACTER_${e}>>`,d=(e,t)=>{let i=e&&"string"==typeof e.model_id&&e.model_id.length>0?e.model_id:void 0,r=[];i&&r.push(l(i));let n=(0,a.R4)(t);return r.includes(n)||r.push(n),{modelId:i,markers:r}},c=(0,n.memo)(function(e){let{isHovered:t,value:c,onChange:u,placeholder:p="Enter your prompt...",disabled:h=!1,onFocus:m,onBlur:x,sx:g}=e,f=(0,n.useRef)(null),v=(0,n.useRef)(null),b=(0,n.useRef)(!1),y=(0,n.useRef)(new Set),w=(0,n.useRef)(!1),C=(0,n.useRef)(null),j=(0,n.useRef)(null),k=(0,n.useRef)(null),F=(0,n.useCallback)((e,t)=>{let i=setTimeout(()=>{y.current.delete(i),e()},t);return y.current.add(i),i},[]);(0,n.useEffect)(()=>{let e=y.current;return()=>{e.forEach(clearTimeout),e.clear(),null!==C.current&&(cancelAnimationFrame(C.current),C.current=null),j.current&&(clearTimeout(j.current),j.current=null)}},[]);let S=(0,s.Jc)(),I=(0,s.vw)(),{recurringProps:_}=(0,s.xX)(),Z=(0,n.useMemo)(()=>{let e=[];return S&&e.push({key:S.name||"Character",value:S.model_id||S.name||"Character",group:"character"}),(null==I?void 0:I.length)>0&&I.forEach((t,i)=>{if(t){let r=t.name||`Character${i+1}`,{modelId:n}=d(t,i),o=null==t?void 0:t.id;e.push({key:r,value:n||o||r,group:"character"})}}),(null==_?void 0:_.length)>0&&_.forEach(t=>{if(t&&t.key){let i=t.key.replaceAll(/^<<|>>$/g,"");e.push({key:i,value:i,group:"recurringProp"})}}),e},[S,I,_]),A=(0,n.useCallback)(e=>{let t=e;if(t=t.replaceAll("\n","<br>"),S){let e=S.model_id||S.name||"unknown",i=S.name||"Character",r=`<span class="mention-text" data-character-id="${e}" contenteditable="false" data-character-name="${i}">@${i}</span>`;t=t.replaceAll("<<THE_MARKER>>",r)}return I&&I.length>0&&I.forEach((e,i)=>{if(e){let{modelId:r,markers:n}=d(e,i),o=null==e?void 0:e.id,a=r||o||e.name||`character-${i+1}`,s=e.name||`Character${i+1}`,l=`<span class="mention-text" data-character-id="${a}" contenteditable="false" data-character-name="${s}">@${s}</span>`;n.forEach(e=>{t=t.replaceAll(e,l)})}}),_&&_.length>0&&_.forEach(e=>{if(e&&e.key){let i=e.key.replaceAll(/^<<|>>$/g,""),r=`<<${i}>>`,n=`<span class="mention-text" data-character-id="${i}" contenteditable="false" data-character-name="${i}">@${i}</span>`;t=t.replaceAll(r,n)}}),t},[S,I,_]),E=(0,n.useCallback)(e=>{let t=e,i=document.createElement("div");if(i.innerHTML=e,i.querySelectorAll(".mention-text").forEach(e=>{let i=e.dataset.characterId,r=e.textContent||"";S&&i===(S.model_id||S.name)&&(t=t.replace(r,"<<THE_MARKER>>")),I&&I.length>0&&I.forEach((e,n)=>{if(e){let{modelId:o}=d(e,n),s=new Set;o&&s.add(o);let c=null==e?void 0:e.id;if(c&&s.add(c),e.name&&s.add(e.name),i&&s.has(i)){let e=o?l(o):(0,a.R4)(n);t=t.replace(r,e)}}}),_&&_.length>0&&_.forEach(e=>{let n=e.key.replaceAll(/^<<|>>$/g,"");if(i===n){let e=`<<${n}>>`;t=t.replace(r,e)}})}),S){let e=S.name||"Character";RegExp(`@${e.replaceAll(/[.*+?^${}()|[\]\\]/g,String.raw`\$&`)}`,"g").test(t)&&(t=t.replaceAll(`@${e}`,"<<THE_MARKER>>"))}return I&&I.length>0&&I.forEach((e,i)=>{if(e){let r=e.name||`Character${i+1}`;if(RegExp(`@${r.replaceAll(/[.*+?^${}()|[\]\\]/g,String.raw`\$&`)}`,"g").test(t)){let{modelId:n}=d(e,i),o=n?l(n):(0,a.R4)(i);t=t.replaceAll(`@${r}`,o)}}}),_&&_.length>0&&_.forEach(e=>{if(e.key){let i=e.key.replaceAll(/^<<|>>$/g,"");if(RegExp(`@${i.replaceAll(/[.*+?^${}()|[\]\\]/g,String.raw`\$&`)}`,"g").test(t)){let e=`<<${i}>>`;t=t.replaceAll(`@${i}`,e)}}}),t},[S,I,_]),M=(0,n.useCallback)((e,t)=>{if(null==t?void 0:t.flush){j.current&&(clearTimeout(j.current),j.current=null),k.current=null,u(e);return}k.current=e,j.current||(j.current=setTimeout(()=>{j.current=null;let e=k.current;null!==e&&(k.current=null,u(e))},200))},[u]),T=(0,n.useCallback)(()=>{if(!f.current)return;let e=f.current.innerHTML,t=f.current.textContent||"",i=E(t);!(()=>{if(!e.includes("mention-text"))return!0;let i=!1;if(S){let e=S.name||"Character";t.includes(`@${e}`)&&(i=!0)}return I&&I.length>0&&I.forEach((e,r)=>{if(e){let n=e.name||`Character${r+1}`;t.includes(`@${n}`)&&(i=!0)}}),_&&_.length>0&&_.forEach(e=>{if(e.key){let r=e.key.replaceAll(/^<<|>>$/g,"");t.includes(`@${r}`)&&(i=!0)}}),i})()&&e.includes("mention-text")&&(f.current.innerHTML=t),M(i)},[E,S,I,_,M]),R=(0,n.useCallback)(()=>{null===C.current&&(C.current=requestAnimationFrame(()=>{C.current=null,T()}))},[T]),D=(0,n.useCallback)(()=>{b.current=!0},[]),z=(0,n.useCallback)(()=>{b.current=!1},[]),P=(0,n.useCallback)(()=>{F(()=>{f.current&&(f.current.querySelectorAll(".mention-text").forEach(e=>{e.setAttribute("contenteditable","false")}),M(E(f.current.textContent||"")))},0)},[F,E,M]),W=(0,n.useCallback)(()=>{!f.current||h||v.current||i.e(7233).then(i.t.bind(i,27233,23)).then(e=>{let t=e.default;document.querySelectorAll(".prompt-tribute-container").forEach(e=>e.remove());let i=new Set;if(v.current=new t({trigger:"@",values:(e,t)=>{i=new Set,t(Z.filter(t=>t.key.toLowerCase().includes(e.toLowerCase())))},menuContainer:document.body,positionMenu:!0,selectTemplate:e=>e?`<span class="mention-text" data-character-id="${e.original.value}" contenteditable="false" data-character-name="${e.original.key}">@${e.original.key}</span>&nbsp;`:"",containerClass:"tribute-container prompt-tribute-container",menuItemTemplate:e=>{let t=e.original.group,r=!i.has(t);i.add(t);let n="character"===t?"Character":"Recurring Prop",o=r?`<div class="mention-group-header">${n}</div>`:"";return`${o}<div class="mention-item" data-group="${t}">@${e.original.key}</div>`},noMatchTemplate:()=>'<div class="mention-item no-match">No matches found</div>',allowSpaces:!0,requireLeadingSpace:!1,replaceTextSuffix:"",menuShowMinLength:0,autocompleteMode:!1,selectClass:"highlight"}),f.current){v.current.attach(f.current);let e=f.current;e.addEventListener("tribute-active-true",D),e.addEventListener("tribute-active-false",z),e.addEventListener("tribute-replaced",P)}}).catch(e=>{console.error("Failed to load tributejs:",e)})},[Z,h,D,z,P]),L=(0,n.useCallback)(()=>{if(v.current&&f.current){v.current.detach(f.current);let e=f.current;e.removeEventListener("tribute-active-true",D),e.removeEventListener("tribute-active-false",z),e.removeEventListener("tribute-replaced",P),v.current=null}document.querySelectorAll(".prompt-tribute-container").forEach(e=>e.remove())},[D,z,P]);return(0,n.useEffect)(()=>{if(!f.current||h)return;let e=e=>{var t;e.preventDefault();let i=((null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text/plain"))??"").replaceAll(/\n\s*\n/g,"\n").trim();document.execCommand("insertText",!1,i)},t=e=>{var t,i,r,n;if(!b.current){if("Backspace"===e.key||"Delete"===e.key){let n=window.getSelection();if(!n||0===n.rangeCount)return;let o=n.getRangeAt(0);if(n.toString()===(null===(t=f.current)||void 0===t?void 0:t.textContent)){e.preventDefault(),f.current&&(f.current.innerHTML="",M(""));return}let a=null===(i=o.startContainer.parentElement)||void 0===i?void 0:i.closest(".mention-text");if(a){e.preventDefault(),a.remove(),f.current&&(!f.current.textContent||""===f.current.textContent.trim())?(f.current.innerHTML="",M("")):R();return}if("Backspace"===e.key&&o.collapsed&&f.current){let t=o.startContainer,i=o.startOffset;if(t.nodeType===Node.TEXT_NODE&&0===i){let i=t.previousSibling;if(i&&(null===(r=i.classList)||void 0===r?void 0:r.contains("mention-text"))){e.preventDefault(),i.remove(),F(()=>{f.current&&(""===(f.current.textContent||"").trim()?(f.current.innerHTML="",M("")):R())},0);return}}}}else if("Enter"===e.key){let t=window.getSelection();if(!t||0===t.rangeCount)return;let i=null===(n=t.getRangeAt(0).startContainer.parentElement)||void 0===n?void 0:n.closest(".mention-text");if(i){e.preventDefault();let r=document.createRange();r.setStartAfter(i),r.collapse(!0),t.removeAllRanges(),t.addRange(r)}}}},i=e=>{let t=e.target.closest(".mention-text");if(t){e.preventDefault();let i=window.getSelection(),r=document.createRange();r.setStartAfter(t),r.collapse(!0),null==i||i.removeAllRanges(),null==i||i.addRange(r)}},r=()=>{var e;let t=window.getSelection();if(!t||0===t.rangeCount)return;let i=null===(e=t.getRangeAt(0).startContainer.parentElement)||void 0===e?void 0:e.closest(".mention-text");if(i){let e=document.createRange();e.setStartAfter(i),e.collapse(!0),t.removeAllRanges(),t.addRange(e)}},n=f.current;return n.addEventListener("paste",e),n.addEventListener("keydown",t),n.addEventListener("click",i),document.addEventListener("selectionchange",r),()=>{n.removeEventListener("paste",e),n.removeEventListener("keydown",t),n.removeEventListener("click",i),document.removeEventListener("selectionchange",r)}},[h,F,R,M]),(0,n.useEffect)(()=>{f.current&&E(f.current.textContent||"")!==c&&(c.includes("<<THE_MARKER>>")||I&&I.some((e,t)=>{if(!e)return!1;let{markers:i}=d(e,t);return i.some(e=>c.includes(e))})||_&&_.some(e=>{if(e.key){let t=e.key.replaceAll(/^<<|>>$/g,"");return c.includes(`<<${t}>>`)}return!1})?(f.current.innerHTML=A(c),f.current.querySelectorAll(".mention-text").forEach(e=>{e.setAttribute("contenteditable","false")})):f.current.textContent=c)},[c,E,A,I,_]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("style",{children:`
        .tribute-container {
          padding: 0px 0px !important;
        }
      
          
        .tribute-container li {
          padding: 0px 0px !important;
        }

        .prompt-tribute-container {
          position: absolute !important;
          background-color: #101010 !important;
          border: 1px solid #1a1a1a !important;
          border-radius: 6px !important;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
          z-index: 10000 !important;
          max-height: 300px !important;
          overflow-y: auto !important;
        }
        
        .prompt-tribute-container .mention-group-header {
          padding: 4px 8px 6px 8px !important;
          color: #444444 !important;
          background: #101010 !important;
          font-size: 12px !important;
          font-family: 'Inter', sans-serif !important;
          font-weight: 500 !important;
          line-height: normal !important;
          cursor: default !important;
          pointer-events: none !important;
          margin-top: 6px !important;
        }
        
        .prompt-tribute-container .mention-group-header:first-child {
          margin-top: 0 !important;
        }
        
        .prompt-tribute-container .tribute-item,
        .prompt-tribute-container .mention-item {
          padding: 2px 14px !important;
          color: #aaaaaa !important;
          font-size: 14px !important;
          font-family: 'Inter', sans-serif !important;
          font-weight: 400 !important;
          line-height: normal !important;
          cursor: pointer !important;
          border: none !important;
          background: none !important;
          height: 36px !important;
          display: flex !important;
          align-items: center !important;
          border-radius: 4px !important;
          white-space: nowrap !important;
        }
        
        .prompt-tribute-container .tribute-item:hover,
        .prompt-tribute-container .mention-item:not(.no-match):hover,
        .prompt-tribute-container .tribute-item.highlight,
        .prompt-tribute-container .mention-item.highlight {
          color: #e0e0e0 !important;
          background-color: #1a1a1a !important;
        }
        
        .prompt-tribute-container .no-match {
          color: #666666 !important;
          cursor: default !important;
        }
        
        .mention-text {
          color: #6290FF !important;
          font-weight: 500 !important;
          margin: 0 1px !important;
          display: inline-block !important;
          user-select: none !important;
        }
      `}),(0,r.jsx)(o.Z,{sx:{width:"100%",height:"100%",backgroundColor:"transparent",position:"relative",...void 0===g?{}:g},children:(0,r.jsx)(o.Z,{ref:f,contentEditable:!h,onInput:R,onFocus:()=>{w.current=!0,W(),null==m||m()},onBlur:()=>{w.current=!1,L(),f.current&&M(E(f.current.textContent||""),{flush:!0}),null==x||x()},sx:{width:"100%",height:"100%",color:t?"#FFFFFF":"rgba(255, 255, 255, 0.3)",transition:"color 0.2s ease",bgcolor:"transparent",caretColor:"white",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:1.67,letterSpacing:"-0.01em",border:"none",outline:"none",whiteSpace:"pre-wrap",wordBreak:"break-word",overflowY:"auto",cursor:h?"not-allowed":"text",opacity:h?.5:1,"&:empty::before":{content:`"${p}"`,color:"#666666",pointerEvents:"none"}}})})]})},(e,t)=>e.isHovered===t.isHovered&&e.value===t.value&&e.placeholder===t.placeholder&&e.disabled===t.disabled&&e.onFocus===t.onFocus&&e.onBlur===t.onBlur&&e.sx===t.sx)},92662:function(e,t,i){i.d(t,{Kk:function(){return T},J4:function(){return R},zq:function(){return z},JQ:function(){return P},Rb:function(){return L},IB:function(){return W}});var r=i(52676),n=i(75271),o=i(6721),a=i(77379),s=i(22988),l=i(3059),d=i(56407),c=i(80110),u=i(8928),p=i(81159),h=i(90043),m=i(72509),x=i(54022),g=i(97792),f=i(11955),v=i(29984),b=i(72301),y=i(97779),w=i(18889);let C=(e,t)=>{try{var i,r,n,o,a,s,l;if(!(null===(r=e.moov)||void 0===r?void 0:null===(i=r.traks)||void 0===i?void 0:i.length))return console.warn("No tracks found in MP4 file"),null;let d=e.moov.traks.find(e=>{var i;return(null===(i=e.tkhd)||void 0===i?void 0:i.track_id)===t});if(!(null==d?void 0:null===(l=d.mdia)||void 0===l?void 0:null===(s=l.minf)||void 0===s?void 0:null===(a=s.stbl)||void 0===a?void 0:null===(o=a.stsd)||void 0===o?void 0:null===(n=o.entries)||void 0===n?void 0:n[0]))return console.warn("No valid video track found for codec description extraction"),null;let c=d.mdia.minf.stbl.stsd.entries[0],u=c.avcC??c.hvcC??c.vpcC??c.av01C;if(null!=u&&u.write&&"function"==typeof u.write)try{let e=new w.DataStream(void 0,0,w.DataStream.BIG_ENDIAN);return u.write(e),new Uint8Array(e.buffer.slice(8))}catch(e){console.warn("Failed to write codec box:",e)}}catch(e){console.warn("Failed to extract codec description:",e)}return null};class j{async open(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isClosed=!1;let{onProgress:t}=e,i=await fetch(this.url);if(!i.ok)throw Error(`HTTP ${i.status} ${i.statusText}`);let r=i.headers.get("content-length"),n=r?Number.parseInt(r,10):0;if(i.body&&n>0&&"getReader"in i.body){let e=i.body.getReader(),r=[],o=0,a=!1;for(;!a;){let{done:i,value:s}=await e.read();if(i){a=!0;break}r.push(s),o+=s.byteLength,null==t||t(Math.min(100,Math.round(o/n*100)))}let s=new Uint8Array(o),l=0;for(let e of r)s.set(e,l),l+=e.byteLength;this.srcBuffer=s.buffer}else this.srcBuffer=await i.arrayBuffer(),null==t||t(100);if(this.backings=[this.srcBuffer],this.srcBuffer.fileStart=0,this.setupMp4boxCollectMetaZeroCopy(),this.mp4box.appendBuffer(this.srcBuffer),this.mp4box.flush(),!this.videoTrack)throw Error("No video track found");this.decoder=new VideoDecoder({output:this.handleDecoderOutput,error:e=>{console.error("VideoDecoder error:",e),this.isClosed=!0;let t=this.pendingSeek;if(t){this.pendingSeek=null;try{t.reject(e)}catch{}}}});let o={codec:this.videoTrack.codec,codedWidth:this.videoTrack.track_width,codedHeight:this.videoTrack.track_height,hardwareAcceleration:"prefer-hardware",description:C(this.mp4box,this.videoTrack.id)};try{let e=window.VideoDecoder;if(e&&"function"==typeof e.isConfigSupported){let t=await e.isConfigSupported(o);if(!(null==t?void 0:t.supported))throw Error("Unsupported decoder configuration")}}catch{}try{this.decoder.configure(o)}catch(e){this.isClosed=!0;try{this.decoder.close()}catch{}throw this.decoder=null,e}}get duration(){return this.durationSec}get trackCodec(){var e;return(null===(e=this.videoTrack)||void 0===e?void 0:e.codec)??null}async seek(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.isClosed)throw Error("Decoder closed");if(!this.decoder||!this.videoTrack)throw Error("Call open() first");try{let e=this.decoder.state;if("closed"===e)throw Error("Decoder closed")}catch{}let t=Math.max(0,Math.floor(e*this.timescale)),i=this.findRapIndexLE(t),r=0;if(i>=0?r=this.rapSamples[i].sampleIndex:this.rapSamples.length>0&&(r=this.rapSamples[0].sampleIndex),this.samples[r]&&!this.samples[r].is_sync){let e=this.findNextKeyframeSampleIndex(r);-1!==e&&(r=e)}let n=r;for(let e=r;e<this.samples.length&&(n=e,!(this.samples[e].cts>=t));e++);return n=Math.min(n+2,this.samples.length-1),new Promise((e,i)=>{let o=this.decoder;if(this.isClosed){i(Error("Decoder closed"));return}let a=++this.curSeekId;this.pendingSeek={id:a,targetCts:t,resolve:e,reject:i};try{for(let e=r;e<=n;e++){if(this.isClosed)throw Error("Decoder closed");let t=this.samples[e],i=this.backings[t.bufId],n=new Uint8Array(i,t.offset,t.size),a=new EncodedVideoChunk({type:e===r?"key":t.is_sync?"key":"delta",timestamp:t.cts,duration:t.duration||0,data:n});o.decode(a)}o.flush().catch(()=>{})}catch(e){this.pendingSeek&&this.pendingSeek.id===a&&(this.pendingSeek=null),i(e)}})}close(){try{var e;null===(e=this.decoder)||void 0===e||e.close()}catch{}this.isClosed=!0,this.pendingSeek=null,this.cache.clear(),this.mp4box=null,this.decoder=null}setupMp4boxCollectMetaZeroCopy(){this.mp4box.onReady=e=>{if(this.videoTrack=e.videoTracks.find(e=>"video"===e.type),!this.videoTrack)throw Error("No video track");this.timescale=this.videoTrack.timescale||1,this.durationSec=(this.videoTrack.duration||0)/this.timescale,this.mp4box.setExtractionOptions(this.videoTrack.id,"video"),this.mp4box.start()},this.mp4box.onSamples=(e,t,i)=>{for(let e of i){let t=e.data,i=t.buffer,r=0;i!==this.srcBuffer&&(r=this.findOrPushBacking(i));let n={cts:e.cts,duration:e.duration||0,is_sync:!!e.is_sync,offset:t.byteOffset,size:t.byteLength,bufId:r};this.samples.push(n),n.is_sync&&this.rapSamples.push({cts:n.cts,sampleIndex:this.samples.length-1})}},this.mp4box.onError=e=>{console.error("MP4Box error",e)}}findOrPushBacking(e){for(let t=0;t<this.backings.length;t++)if(this.backings[t]===e)return t;return this.backings.push(e),this.backings.length-1}findRapIndexLE(e){let t=0,i=this.rapSamples.length-1,r=-1;for(;t<=i;){let n=t+i>>1;this.rapSamples[n].cts<=e?(r=n,t=n+1):i=n-1}return r}findNextKeyframeSampleIndex(e){for(let t=e;t<this.samples.length;t++)if(this.samples[t].is_sync)return t;return -1}constructor(e){if(this.backings=[],this.videoTrack=null,this.timescale=1,this.durationSec=0,this.decoder=null,this.isClosed=!1,this.samples=[],this.rapSamples=[],this.curSeekId=0,this.cache=new Map,this.cacheSize=12,this.pendingSeek=null,this.handleDecoderOutput=async e=>{try{let t=this.pendingSeek;if(!t)return;if(e.timestamp>=t.targetCts)try{let i=await createImageBitmap(e),r={time:e.timestamp/this.timescale,imageBitmap:i,width:e.codedWidth,height:e.codedHeight},n=t.resolve;this.pendingSeek=null,n(r)}catch(i){let e=t.reject;this.pendingSeek=null,e(i)}}finally{try{e.close()}catch{}}},!("VideoDecoder"in window))throw Error("WebCodecs not supported in this browser");this.mp4box=w.createFile(),this.url=e}}let k="This feature is currently unavailable.";var F=function(e){let{open:t,videoUrl:i,onClose:l,onConfirm:u}=e,[p,h]=(0,n.useState)(!1),[m,w]=(0,n.useState)(null),[C,F]=(0,n.useState)(0),[S,I]=(0,n.useState)(0),[_,Z]=(0,n.useState)([]),[A,E]=(0,n.useState)(!1),[M,T]=(0,n.useState)(!1),[R,D]=(0,n.useState)(!1),[z,P]=(0,n.useState)(!1),{isDesktop:W}=(0,y.j)(),L=(0,n.useRef)(null),B=(0,n.useRef)(null),H=(0,n.useRef)(null),$=(0,n.useRef)(null),O=(0,n.useRef)(null),U=(0,n.useRef)(null),G=(0,n.useRef)(!1),N=(0,n.useRef)(null),V=(0,n.useMemo)(()=>"VideoDecoder"in window,[]),K=(0,n.useCallback)(e=>{let t=H.current;if(!t)return;let i=t.getContext("2d");if(i){t.width=e.width,t.height=e.height,i.drawImage(e,0,0);try{P(e.height>e.width)}catch{}}},[]),q=(0,n.useCallback)(async e=>{try{if("OffscreenCanvas"in window){let t=new window.OffscreenCanvas(e.width,e.height),i=t.getContext("2d");if(!i)throw Error("Failed to get OffscreenCanvas context");return i.drawImage(e,0,0),await t.convertToBlob({type:"image/jpeg",quality:.92})}}catch{}let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");if(!i)throw Error("Failed to get canvas context");return i.drawImage(e,0,0),await new Promise((e,i)=>{t.toBlob(t=>t?e(t):i(Error("toBlob failed")),"image/jpeg",.92)})},[]),Y=(0,n.useCallback)(async e=>{let t=L.current;if(t)try{let i=await t.seek(e,{keyframeOnly:!1,cacheSize:24,timeoutMs:5e3,predecodeNext:6});$.current=i.imageBitmap,K(i.imageBitmap)}catch(e){console.error("[FramePickerDialog] seek error",e)}},[K]);(0,n.useEffect)(()=>(O.current=(0,b.Z)(e=>{Y(e).catch(()=>{})},80,{leading:!0,trailing:!0}),()=>{try{var e,t;null===(t=O.current)||void 0===t||null===(e=t.cancel)||void 0===e||e.call(t)}catch{}O.current=null}),[Y]);let X=(0,n.useCallback)(e=>{var t;let i=U.current;if(!i||C<=0)return;let r=i.getBoundingClientRect(),n=Math.min(Math.max(e-r.left,0),r.width),o=Math.min(Math.max((r.width>0?n/r.width:0)*C,0),C);I(o),null===(t=O.current)||void 0===t||t.call(O,o)},[C]),J=(0,n.useCallback)(e=>{G.current=!0;try{var t,i;null===(t=(i=e.currentTarget).setPointerCapture)||void 0===t||t.call(i,e.pointerId)}catch{}X(e.clientX)},[X]),Q=(0,n.useCallback)(e=>{G.current&&X(e.clientX)},[X]),ee=(0,n.useCallback)(e=>{G.current=!1;try{var t,i;null===(t=(i=e.currentTarget).releasePointerCapture)||void 0===t||t.call(i,e.pointerId)}catch{}},[]),et=(0,n.useCallback)(async e=>{try{let t=64/e.width,i=Math.max(1,Math.round(e.height*t));if("OffscreenCanvas"in window){let t=new window.OffscreenCanvas(64,i).getContext("2d");if(!t)return!1;t.drawImage(e,0,0,64,i);let r=t.getImageData(0,0,64,i),n=0;for(let e=0;e<r.data.length;e+=4){let t=r.data[e],i=r.data[e+1],o=r.data[e+2];n+=.2126*t+.7152*i+.0722*o}return n/(64*i)<12}let r=document.createElement("canvas");r.width=64,r.height=i;let n=r.getContext("2d");if(!n)return!1;n.drawImage(e,0,0,64,i);let o=n.getImageData(0,0,64,i),a=0;for(let e=0;e<o.data.length;e+=4){let t=o.data[e],i=o.data[e+1],r=o.data[e+2];a+=.2126*t+.7152*i+.0722*r}return a/(64*i)<12}catch{return!1}},[]),ei=(0,n.useCallback)(async()=>{D(!0);try{let e=$.current;if(!e)return;let t=await q(e);u({imageBitmap:e,blob:t,timeSec:S})}catch(e){console.error("[FramePickerDialog] confirm error",e),w(k)}finally{D(!1),l()}},[S,q,u,l]),er=(0,n.useCallback)(async()=>{if(!V){w(k);return}if(L.current&&N.current===i){try{I(0);let e=await L.current.seek(0,{keyframeOnly:!0});$.current=e.imageBitmap,K(e.imageBitmap)}catch{}return}h(!0),w(null);try{let e=new j(i);L.current=e,await e.open();let t=new j(i);await t.open(),B.current=t,T(!0),N.current=i,F(L.current.duration),I(0);try{let e=await L.current.seek(0,{keyframeOnly:!0});$.current=e.imageBitmap,K(e.imageBitmap)}catch{w(k)}}catch(e){console.error("[FramePickerDialog] init error",e),w(k)}finally{h(!1)}},[i,V,K]);(0,n.useEffect)(()=>{t&&er().catch(()=>{})},[t,er]),(0,n.useEffect)(()=>()=>{var e,t;try{null===(e=L.current)||void 0===e||e.close()}catch{}L.current=null;try{null===(t=B.current)||void 0===t||t.close()}catch{}B.current=null,T(!1);try{Z(e=>{for(let t of e)URL.revokeObjectURL(t.url);return[]})}catch{}$.current=null,N.current=null},[i]),(0,n.useEffect)(()=>()=>{var e,t;try{null===(e=L.current)||void 0===e||e.close()}catch{}L.current=null;try{null===(t=B.current)||void 0===t||t.close()}catch{}B.current=null,T(!1);try{Z(e=>{for(let t of e)URL.revokeObjectURL(t.url);return[]})}catch{}$.current=null,N.current=null},[]),(0,n.useEffect)(()=>{if(!t||C<=0||!B.current||!M)return;let e=!1,i=[];return(async()=>{E(!0);try{let t=[];for(let e=0;e<12;e++){let i=e/12*C,r=(e+1)/12*C,n=(i+r)/2,o=Math.min(Math.max(n,0),Math.max(C-.01,0));t.push(o)}let r=[],n=Promise.resolve(),o=Math.max(C/240,.1),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return B.current.seek(e,{keyframeOnly:!0}).then(async i=>{let r=await et(i.imageBitmap),n=await q(i.imageBitmap),s=URL.createObjectURL(n);if(r&&t<3){URL.revokeObjectURL(s);let i=Math.min(e+o,Math.max(C-.01,0));return a(i,t+1)}return{url:s,time:e}})};t.forEach(t=>{n=n.then(async()=>{if(e)return;let{url:n,time:o}=await a(t);i.push(n),r.push({time:o,url:n}),e||Z([...r])}).catch(()=>{})}),await n}finally{e||E(!1)}})(),()=>{for(let t of(e=!0,i))URL.revokeObjectURL(t)}},[t,C,M,q,et]);let en=Math.floor(S/60),eo=Math.floor(S%60).toString().padStart(2,"0");return(0,r.jsxs)(g.Z,{open:t,onClose:l,maxWidth:!1,fullWidth:!0,sx:{"& .MuiDialog-container":{alignItems:"center",justifyContent:"center",p:0}},PaperProps:{sx:{backgroundColor:e=>e.palette.Colors.Gray["50"],border:{xs:"none",sm:"1px solid"},borderColor:e=>e.palette.Colors.Gray["200"],borderRadius:{xs:0,sm:"12px"},m:{xs:0,sm:4},width:{xs:"100%",sm:"960px"},maxWidth:{xs:"100%",sm:"95vw"},height:{xs:"auto",sm:"640px"},maxHeight:{xs:"none",sm:"95vh"},display:"flex",flexDirection:"column",overflow:{xs:"visible",sm:"hidden"}}},children:[(0,r.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pr:1},children:[(0,r.jsx)(c.Z,{sx:{color:e=>e.palette.Colors.Gray["800"],fontSize:14,fontWeight:600},children:"Pick Cover Frame"}),(0,r.jsx)(o.Z,{onClick:l,size:"small",sx:{color:e=>e.palette.Colors.Gray["500"]},children:(0,r.jsx)(x.default,{fontSize:"small"})})]}),(0,r.jsxs)(d.Z,{sx:{flex:{xs:"0 0 auto",sm:1},px:{xs:1.5,sm:3},pb:2,minHeight:0},spacing:2,children:[(0,r.jsxs)(s.Z,{sx:{flex:{xs:"0 0 auto",sm:1},borderRadius:"8px",backgroundColor:e=>e.palette.Colors.Gray["50"],overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",minHeight:0},children:[(0,r.jsx)("canvas",{ref:H,style:{width:W&&z?"auto":"100%",height:W&&z?"100%":"auto",display:"block"},"aria-label":"frame-preview",role:"img"}),p?(0,r.jsx)(s.Z,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(v.Z,{size:28,thickness:4,sx:{color:e=>e.palette.Colors.Gray["800"]}})}):null,m?(0,r.jsx)(s.Z,{sx:{position:"absolute",bottom:8,left:8,right:8},children:(0,r.jsx)(c.Z,{sx:{color:e=>e.palette.status.Error,fontSize:12},children:m})}):null]}),(0,r.jsxs)(d.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsxs)(c.Z,{sx:{color:e=>e.palette.Colors.Gray["600"],fontSize:12,width:{xs:56,sm:64}},children:[en,":",eo]}),(0,r.jsxs)(s.Z,{ref:U,onPointerDown:J,onPointerMove:Q,onPointerUp:ee,sx:{position:"relative",flex:1,height:{xs:48,sm:56},borderRadius:"6px",overflow:"hidden",borderColor:e=>e.palette.Colors.Gray["300"],backgroundColor:e=>e.palette.Colors.Gray["100"],cursor:"pointer",userSelect:"none",touchAction:"none"},children:[(0,r.jsx)(d.Z,{direction:"row",sx:{width:"100%",height:"100%"},children:_.length>0?_.map(e=>(0,r.jsx)(s.Z,{sx:{flex:1,position:"relative"},children:(0,r.jsx)("img",{src:e.url,alt:"thumbnail",style:{width:"100%",height:"100%",objectFit:"cover",display:"block",pointerEvents:"none"}})},e.url)):(0,r.jsx)(s.Z,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(c.Z,{sx:{color:e=>e.palette.Colors.Gray["600"],fontSize:12},children:A?"Generating preview…":"No preview"})})}),(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,bottom:0,left:`${C>0?Math.min(S,C)/C*100:0}%`,width:"2px",backgroundColor:e=>e.palette.Colors.Blue["500"],transform:"translateX(-1px)",pointerEvents:"none"}})]}),(0,r.jsxs)(c.Z,{sx:{color:e=>e.palette.Colors.Gray["600"],fontSize:12,width:{xs:56,sm:64},textAlign:"right"},children:[Math.floor(C/60),":",Math.floor(C%60).toString().padStart(2,"0")]})]}),(0,r.jsxs)(d.Z,{direction:"row",justifyContent:"flex-end",spacing:1,children:[(0,r.jsx)(a.Z,{variant:"outlined",onClick:l,sx:{borderColor:e=>e.palette.Colors.Gray["300"],color:e=>e.palette.Colors.Gray["800"]},children:"Cancel"}),(0,r.jsx)(a.Z,{variant:"contained",className:"oa-button-primary",onClick:ei,disabled:R||!$.current||!!m,startIcon:R?(0,r.jsx)(v.Z,{size:16,color:"inherit"}):null,children:R?"Processing…":"Use this frame"})]})]})]})},S=i(48635),I=i(49049),_=i(27806),Z=i(93710),A=i(328);let E=(0,u.ZP)(o.Z)({display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",padding:"8px",borderRadius:"8px",backgroundColor:"transparent",border:"none",cursor:"pointer",transition:"background-color 0.2s ease","&:hover":{backgroundColor:"#2E2E2E"},"&:disabled":{opacity:.6,cursor:"not-allowed"},"& .icon-container":{width:"46px",height:"46px",borderRadius:"50%",backgroundColor:"#2E2E2E",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"4px"}}),M=(0,u.ZP)(a.Z)({color:"#E0E0E0",padding:"4px 8px",display:"flex",alignItems:"center",gap:"4px",fontFamily:"Inter",fontSize:"14px",fontWeight:600,lineHeight:"22px",textTransform:"none","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}),T=(0,u.ZP)(a.Z)({backgroundColor:"#1856D0",color:"#FFFFFF",padding:"7px 12px",borderRadius:"8px",fontFamily:"Inter",fontSize:"14px",fontWeight:600,textTransform:"none","&:hover":{backgroundColor:"#1447B3"},"&.secondary":{backgroundColor:"#030B1D",color:"#FFFFFF",border:"1px solid rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"#0A1A30"}},"&.highlighted":{backgroundColor:"#1856D0",color:"#FFFFFF",border:"none","&:hover":{backgroundColor:"#1447B3"}}}),R=e=>{let{onClick:t,disabled:i=!1,className:n,sx:o,children:a,progress:l=0,isProcessing:d=!1}=e;return(0,r.jsxs)(T,{onClick:t,disabled:i,className:n,sx:{...o,position:"relative",overflow:"hidden"},children:[!0===d&&(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,left:0,height:"100%",width:`${l}%`,borderRadius:"8px",backgroundColor:"#3e74dd",transition:"width 0.3s ease",zIndex:0}}),(0,r.jsx)(s.Z,{sx:{position:"relative",zIndex:1,display:"flex",alignItems:"center",gap:1},children:a})]})},D=(0,u.ZP)(l.Z)(e=>{let{theme:t}=e;return{width:33,height:18,padding:0,display:"flex","&:active":{"& .MuiSwitch-thumb":{width:15},"& .MuiSwitch-switchBase.Mui-checked":{transform:"translateX(9px)"}},"& .MuiSwitch-switchBase":{padding:1.5,"&.Mui-checked":{transform:"translateX(15px)",color:"#fff","& + .MuiSwitch-track":{opacity:1,backgroundColor:"#0929F7"}}},"& .MuiSwitch-thumb":{boxShadow:"none",width:15,height:15,borderRadius:"50%",backgroundColor:"#A0A0A0",transition:t.transitions.create(["width"],{duration:200})},"& .MuiSwitch-track":{borderRadius:75,opacity:1,backgroundColor:"#4A4A4A",boxSizing:"border-box"}}}),z=e=>{let{onBack:t,title:i}=e,{isMobile:n}=(0,y.j)();return(0,r.jsx)(d.Z,{direction:"row",alignItems:"center",children:t?(0,r.jsxs)(M,{onClick:t,size:"small",sx:{position:"relative",top:n?-8:0,left:n?-10:0},children:[(0,r.jsx)(A.Z,{icon:"ph:arrow-left",width:16,height:16}),"Back"]}):(0,r.jsx)(c.Z,{sx:{color:"#E0E0E0",fontFamily:"Inter",fontSize:"14px",fontWeight:600,lineHeight:"22px",position:"relative",top:n?-4:0,left:n?16:0},children:i})})},P=e=>{let{icon:t,label:i,onClick:n,textColor:o="#AAAAAA",isLoading:a=!1,disabled:l=!1}=e;return(0,r.jsxs)(E,{onClick:n,disabled:a||l,children:[(0,r.jsx)(s.Z,{className:"icon-container",children:t}),(0,r.jsx)(c.Z,{sx:{color:o,fontFamily:"Inter",fontSize:"12px",fontWeight:500,lineHeight:"19px",textAlign:"center"},children:i})]})},W=e=>{let{checked:t,onChange:i,style:n}=e,{isMobile:o}=(0,y.j)();return(0,r.jsxs)(d.Z,{sx:{flexDirection:"row",justifyContent:o?"flex-end":"space-between",alignItems:"center",gap:1,alignSelf:o?"flex-end":"stretch"},children:[(0,r.jsxs)(d.Z,{direction:"row",alignItems:"center",gap:.5,children:[(0,r.jsx)(A.Z,{icon:"ph:sparkle",width:20,height:20,color:"#16D866"}),(0,r.jsx)(c.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontSize:"14px",fontWeight:600,lineHeight:"12px",...n},children:"Remove Watermark"})]}),(0,r.jsx)(D,{checked:t,onChange:e=>i(e.target.checked)})]})},L=e=>{let{story:t}=e,{story:i,updateStoryThumbnail:o}=(0,S.MT)(),{originalThumbnail:a}=(0,S.ef)(),l=(0,n.useRef)(null),[u,x]=(0,n.useState)(null),[g,f]=(0,n.useState)(!1),[v,b]=(0,n.useState)(!1),[y,w]=(0,n.useState)(""),{uploadFile:C}=(0,I.k)({cdnFolder:"stories/thumbnails"}),[j,k]=(0,Z.MH)(),A=t||i,E=(null==A?void 0:A.is_published)===!0,M=(0,n.useCallback)(async e=>{w("");try{let t=e[0];if(!t||!(null==A?void 0:A.id))return;let i=URL.createObjectURL(t);x({...t,preview:i}),f(!0);let r=await C(t);E&&await j({storyId:A.id,last_export_thumbnail_url:r.url,is_thumbnail_modified:!0}),o(r.url)}catch(t){let e="Failed to update thumbnail. Please try again.";t instanceof Error&&(e=t.message),x(null),w(e),console.error("Failed to update thumbnail:",t)}finally{f(!1)}},[null==A?void 0:A.id,C,j,E,o]),{UploadContextMenu:T}=(0,m.w)({onChange:async e=>{if(e&&e.length>0&&(null==A?void 0:A.id))try{w(""),f(!0),x({preview:e[0]}),E&&await j({storyId:A.id,last_export_thumbnail_url:e[0],is_thumbnail_modified:!0}),o(e[0])}catch(e){w("Failed to update thumbnail from history"),x(null),console.error("Failed to update thumbnail from history:",e)}finally{f(!1)}},onClickUpload:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.triggerInputClick()},maxSelectionCount:1}),R=(0,n.useCallback)(e=>{if(null==A?void 0:A.last_export_url){b(!0);return}w("Please export the video first to pick a frame as thumbnail")},[null==A?void 0:A.last_export_url]),D=(0,n.useCallback)(async e=>{let{blob:t}=e;if(null==A?void 0:A.id)try{w(""),f(!0);let e=new File([t],"cover.jpg",{type:"image/jpeg"}),i=URL.createObjectURL(e);x({preview:i});let r=await C(e);(null==A?void 0:A.is_published)&&await j({storyId:A.id,last_export_thumbnail_url:r.url,is_thumbnail_modified:!0}),o(r.url),b(!1)}catch(e){console.error("Failed to set thumbnail from frame:",e),w("Failed to set thumbnail from frame")}finally{f(!1)}},[null==A?void 0:A.id,null==A?void 0:A.is_published,j,o,C]),z=(0,n.useCallback)(async()=>{if(null==A?void 0:A.id)try{f(!0);let e=a||"";E&&await j({storyId:A.id,last_export_thumbnail_url:e,is_thumbnail_modified:!0}),o(e),x(null)}catch(e){console.error("Failed to delete thumbnail:",e),w("Failed to delete thumbnail")}finally{f(!1)}},[null==A?void 0:A.id,j,E,o,a]);return((0,n.useEffect)(()=>{let e=null==A?void 0:A.last_export_thumbnail_url;e?x({preview:e}):x(null)},[null==A?void 0:A.last_export_thumbnail_url]),A)?(0,r.jsxs)(s.Z,{sx:{width:"100%",height:"169px",borderRadius:"12px",border:"1px solid #444444",position:"relative"},children:[(0,r.jsx)(h.Z,{ref:l,sx:{width:"100%",height:"100%",border:"none",backgroundColor:"transparent",borderRadius:"12px",margin:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},dropZoneSx:{borderRadius:"12px",width:"100%",height:"100%",padding:0},file:u,isUploading:g||k,maxSize:10485760,onDrop:M,onAreaClick:e=>R(e),alwaysShowOverlay:(null==A?void 0:A.last_export_thumbnail_url)===a,title:(0,r.jsx)(d.Z,{alignItems:"center",spacing:1,children:(0,r.jsx)(c.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontSize:"14px",fontWeight:600,lineHeight:"17px"},children:"Choose a Thumbnail (Optional)"})}),accept:{"image/png":[],"image/jpeg":[],"image/webp":[],"image/gif":[]},caption:y?(0,r.jsx)(c.Z,{variant:"caption",sx:{padding:"0 8px",display:"inline-block",position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",pointerEvents:"none",width:"100%",textAlign:"center"},color:"error.main",children:y}):(null==A?void 0:A.last_export_url)?null:(0,r.jsx)(c.Z,{variant:"caption",sx:{padding:"0 8px",display:"inline-block",position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",pointerEvents:"none",width:"100%",textAlign:"center",color:e=>e.palette.status.Warning},children:"Export required: Please export your story to enable frame picking"})}),(0,r.jsx)(F,{open:v,videoUrl:(null==A?void 0:A.last_export_url)||"",onClose:()=>b(!1),onConfirm:D}),T,!u||g||k||(null==A?void 0:A.last_export_thumbnail_url)===a?null:(0,r.jsx)(p.Z,{title:"Restore original thumbnail",icon:_.FaTrash,iconSize:16,sx:{position:"absolute",top:8,right:8,cursor:"pointer",backgroundColor:"rgba(0, 0, 0, 0.6)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},onClick:z})]}):null}},22875:function(e,t,i){i.d(t,{z:function(){return L}});var r=i(75271),n=i(75616),o=i(68836),a=i.n(o),s=i(8765),l=i(10986);let d=e=>{switch(e){case"generate_link":case"share_link_native":case"share_file_native":return["generate_link"];case"publish":return["publish"];default:return}},c=e=>({"processing:generating_timeline":30,"processing:user_exporting_video":75})[e]||50,u=()=>`
  <html>
    <head>
      <title>OpenArt - Preparing Story</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
        body { 
          font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
          background: #1D1D1D;
          color: #FFFFFF;
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          text-align: center;
          overflow: hidden;
        }
        .loading-container {
          background: #292929;
          padding: 32px;
          border-radius: 12px;
          border: 1px solid #444444;
          box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.4);
          max-width: 400px;
          width: 90%;
          position: relative;
        }
        .logo-container {
          margin-bottom: 24px;
        }
        .logo {
          width: 48px;
          height: 48px;
          background: linear-gradient(135deg, #0929F7 0%, #3366FF 100%);
          border-radius: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto;
          font-weight: 700;
          font-size: 20px;
          color: white;
        }
        .spinner {
          width: 32px;
          height: 32px;
          border: 3px solid #444444;
          border-top: 3px solid #0929F7;
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto 20px;
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        h2 { 
          margin: 0 0 8px 0;
          font-size: 20px;
          font-weight: 600;
          color: #FFFFFF;
          line-height: 1.3;
        }
        p { 
          margin: 0;
          font-size: 14px;
          color: rgba(255, 255, 255, 0.7);
          font-weight: 400;
          line-height: 1.5;
        }
        .progress-bar {
          width: 100%;
          height: 3px;
          background: #444444;
          border-radius: 2px;
          margin-top: 20px;
          overflow: hidden;
        }
        .progress-fill {
          height: 100%;
          background: linear-gradient(90deg, #0929F7 0%, #3366FF 100%);
          border-radius: 2px;
          animation: progress 2s ease-in-out infinite;
        }
        @keyframes progress {
          0% { width: 0%; }
          50% { width: 70%; }
          100% { width: 100%; }
        }
        .dots {
          display: inline-block;
          animation: dots 1.5s infinite;
        }
        @keyframes dots {
          0%, 20% { opacity: 0; }
          50% { opacity: 1; }
          100% { opacity: 0; }
        }
      </style>
    </head>
    <body>
      <div class="loading-container">
        <div class="spinner"></div>
        <h2>Preparing your story<span class="dots">...</span></h2>
        <p>Please wait while we prepare your story</p>
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      </div>
    </body>
  </html>
  `,p=(e,t)=>"generate_link"===e&&!!t,h=()=>{let e=window.open("about:blank","_blank");return e&&e.document.write(u()),e};var m=i(52676),x=i(77379),g=i(97792),f=i(11955),v=i(56407),b=i(80110),y=i(72660),w=i(89228),C=i(25278),j=i(59147),k=i(35570),F=i(33600);let S=e=>{let{open:t,onClose:i}=e;return(0,m.jsxs)(g.Z,{open:t,onClose:i,sx:{"& .MuiDialog-paper":{maxWidth:700,borderRadius:2}},children:[(0,m.jsx)(f.Z,{children:(0,m.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:2,children:[F.F.warning,(0,m.jsx)(b.Z,{variant:"h6",children:"The following types of content cannot be used."})]})}),(0,m.jsx)(y.Z,{dividers:!0,sx:{px:3,py:2},children:(0,m.jsx)(v.Z,{spacing:3,children:(0,m.jsxs)(w.Z,{sx:{listStyleType:"disc",pl:4,"& .MuiListItem-root":{display:"list-item",py:.5,pl:1},"& .MuiListItemText-primary":{fontSize:"0.95rem"}},children:[(0,m.jsx)(C.ZP,{children:(0,m.jsx)(j.Z,{primary:"Nudity and Sexual Content"})}),(0,m.jsx)(C.ZP,{children:(0,m.jsx)(j.Z,{primary:"Child Exploitation and Abuse"})}),(0,m.jsx)(C.ZP,{children:(0,m.jsx)(j.Z,{primary:"Violence and Gore"})}),(0,m.jsx)(C.ZP,{children:(0,m.jsx)(j.Z,{primary:"Illegal Activities"})}),(0,m.jsx)(C.ZP,{children:(0,m.jsx)(j.Z,{primary:"Hate Speech and Harassment"})})]})})}),(0,m.jsx)(k.Z,{sx:{px:3,py:2},children:[(0,m.jsx)(x.Z,{className:"oa-button-primary",variant:"contained",sx:{width:"120px"},onClick:()=>{i({},"backdropClick")},children:"Close"},"cancel")].reverse()})]})};var I=i(48635),_=i(40950),Z=i(18420),A=i(1663),E=i(93710),M=i(33010);let T=async(e,t,i)=>{t(!0);try{await (0,_.an)(e.last_export_url,e.title||"openart-story"),i()}catch(e){console.error("Download failed:",e),(0,l.yv)("Failed to download video",{variant:"error"})}finally{setTimeout(()=>t(!1),500)}},R=(e,t,i)=>{let r=(0,_.wy)(e.title),n=(0,_.KY)(null==e?void 0:e.id),o=(0,_.e3)(t,r,n);o&&window.open(o,"_blank"),i()},D=async(e,t,i)=>{(0,l.yv)(i?"Story published":"Story unpublished",{variant:"success"}),(0,M.tO)(e,{...t,is_published:i}),await (0,_.v6)(e,t.id)},z=async function(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>{};try{await t({is_published:!0,last_export_thumbnail_url:e.last_export_thumbnail_url,is_thumbnail_modified:n,contests:(null==e?void 0:e.contests)||[]}),await D(i,e,!0)}catch(e){o(e)}},P=async(e,t)=>{let i=(0,_.wy)(e.title),r=(0,_.KY)(null==e?void 0:e.id),n={title:e.title||"My OpenArt Story",text:i,url:r};await (0,_.It)(n)||(0,l.yv)("Unable to share due to system restrictions, please try other sharing options",{variant:"warning"}),t()},W=async(e,t)=>{if(!e.last_export_url){(0,l.yv)("No video available to share",{variant:"warning"});return}let i=(0,_.wy)(e.title),r=await (0,_.O4)(e.last_export_url,e.title||"openart-story");if(r){let t={title:e.title||"My OpenArt Story",text:i,files:[r]};await (0,_.It)(t)||(0,l.yv)("Unable to share due to system restrictions, please try other sharing options",{variant:"warning"})}t()},L=e=>{var t;let{shareState:i,currentAction:o,selectedPlatform:u,setSelectedPlatform:m,setExportOptionsView:x,goBack:g}=(0,I.ef)(),{showModal:f}=(0,s.dd)(),{story:v,shouldShowExportOptions:b,originalThumbnail:y,removeWatermark:w}=(0,I.MT)(),[C]=(0,E.oH)(),[j,k]=(0,r.useState)(null),[F,M]=(0,r.useState)(null),[L,B]=(0,r.useState)(null),[H,$]=(0,r.useState)(!1),[O,U]=(0,r.useState)(0),[G,N]=(0,r.useState)(null),[V,K]=(0,r.useState)(!1),q=(0,n.NL)(),{data:Y}=(0,A.w)(j),{updateStoryAsync:X,isLoading:J}=(0,Z.MH)((null==v?void 0:v.id)||""),Q=(0,r.useCallback)(()=>{var e;return(null==v?void 0:null===(e=v.metadata)||void 0===e?void 0:e.duration)?.5*v.metadata.duration+2:30},[null==v?void 0:null===(t=v.metadata)||void 0===t?void 0:t.duration]),ee=(0,r.useCallback)(()=>{let e=Q(),t=Date.now(),i=setInterval(()=>{let i;let r=(Date.now()-t)/1e3,n=Math.min(r/e*100,95);i=n>=95?Math.min(95+Math.min((r-.95*e)/(.5*e)*4,4),99):n,U(e=>Math.max(e,i))},200);return()=>clearInterval(i)},[Q]);(0,r.useEffect)(()=>{if(H&&F)return ee()},[H,F,ee]);let et=(0,r.useCallback)(()=>{k(null),M(null),$(!1),U(0)},[]),ei=(0,r.useCallback)(async(e,t)=>{try{if($(!0),U(e=>Math.max(e,2)),M(e),p(e,t)){let e=h();e&&N(e)}let i={story_id:null==v?void 0:v.id,remove_watermark:w},r=d(e);r&&(i.extra_steps=r);let n=await C(i);k(n)}catch(t){console.error(`Failed to start ${e}:`,t),et(),(0,l.yv)(`Failed to ${e}. Please try again.`,{variant:"error"})}},[null==v?void 0:v.id,C,et,w]),er=(0,r.useCallback)(e=>{if(a().isAxiosError(e)){var t;let i=null===(t=e.response)||void 0===t?void 0:t.data;if((null==i?void 0:i.error)==="COMMUNITY_CONTENT_MODERATION"){f(S);return}}console.error("Publish/Unpublish failed:",e),(0,l.yv)("Failed to publish/unpublish story",{variant:"error"})},[f]);(0,r.useEffect)(()=>{if(!j||!Y||!F||!v||Y.workflowRunId!==j)return;let t=null;if("completed"===Y.status)U(100),t=setTimeout(async()=>{let t=Y.story;if(t)switch(F){case"download":await T(t,K,e);break;case"generate_link":if(u&&G&&!G.closed){let e=(0,_.wy)(t.title),i=(0,_.KY)(t.id),r=(0,_.e3)(u,e,i);r&&(G.location.href=r)}else if(!u){let e=(0,_.KY)(null==v?void 0:v.id);await (0,_.vQ)(e)?(0,l.yv)("Link copied to clipboard",{variant:"success"}):(0,l.yv)("Failed to copy link",{variant:"error"})}e();break;case"publish":try{await X(L),await D(q,t,!0)}catch(e){er(e)}break;case"share_link_native":await P(t,e);break;case"share_file_native":await W(t,e)}await (0,_.v6)(q,null==v?void 0:v.id),et()},1e3);else if(Y.status.startsWith("failed"))console.error(`${F} failed:`,Y),G&&!G.closed&&G.close(),et(),(0,l.yv)(`Failed to ${F}. Please try again.`,{variant:"error"});else if(Y.status.startsWith("processing")){$(!0);let e=c(Y.status);U(t=>Math.max(t,e))}return()=>{t&&clearTimeout(t)}},[j,Y,null==v?void 0:v.id,q,F,u,G,et,K,e]);let en=(0,r.useCallback)(async()=>{if(!v)return;let e=(0,_.KY)(null==v?void 0:v.id);await (0,_.vQ)(e)?(0,l.yv)("Link copied to clipboard",{variant:"success"}):(0,l.yv)("Failed to copy link. Please try selecting and copying manually.",{variant:"error"})},[v]),eo=(0,r.useCallback)(async()=>{v&&(b?x("download"):await T(v,K,e))},[v,b,x,e]),ea=(0,r.useCallback)(async()=>{v&&(b?x("generate_link"):u?R(v,u,e):en())},[v,b,x,u,e,en]),es=(0,r.useCallback)(async t=>{if(M(t),v){if("main"===i){x("publish");return}try{if("unpublish"===t)await X({is_published:!1}),await D(q,v,!1);else if("publish"===t){if(b&&v.is_export_outdated){let e={contests:(null==v?void 0:v.contests)||[]};y!==(null==v?void 0:v.last_export_thumbnail_url)&&(e.last_export_thumbnail_url=null==v?void 0:v.last_export_thumbnail_url,e.is_thumbnail_modified=!0),B(e),await ei("publish")}else await z(v,X,q,e,y!==(null==v?void 0:v.last_export_thumbnail_url),er)}}catch(e){er(e)}}},[v,i,x,X,q,b,e,y,ei]),el=(0,r.useCallback)(t=>{if(v){if(m(t),v.is_public&&!b){R(v,t,e);return}b?x("generate_link"):R(v,t,e)}},[v,b,m,x,e]),ed=(0,r.useCallback)(async()=>{v&&(b?x("share_link_native"):await P(v,e))},[v,b,x,e]),ec=(0,r.useCallback)(async()=>{v&&(b?x("share_file_native"):await W(v,e))},[v,b,x,e]);return{handleCopyLink:en,handleDownload:eo,handleGenerateLink:ea,handlePublishOrUnpublish:es,handleSocialShare:el,handleNativeLinkShare:ed,handleNativeVideoShare:ec,handleBack:(0,r.useCallback)(()=>{g()},[g]),handleReExport:(0,r.useCallback)(async()=>{v&&await ei(o,u||void 0)},[v,ei,o,u]),handleUseLastExport:(0,r.useCallback)(async()=>{if(v)switch(o){case"download":await T(v,K,e);break;case"generate_link":u&&R(v,u,e);break;case"publish":await z(v,X,q,e);break;case"share_link_native":await P(v,e);break;case"share_file_native":await W(v,e)}},[v,o,u,X,q,e]),actionType:F,isProcessing:H,progress:O,isNativeShareSupported:_.v_,isPublishLoading:J,isDownloadLoading:V}}},86262:function(e,t,i){i.d(t,{Z:function(){return $}});var r=i(52676),n=i(75271),o=i(66266),a=i(60588),s=i(97792),l=i(72660),d=i(6721),c=i(22988),u=i(8928),p=i(57672),h=i(14930),m=i(22875),x=i(56407),g=i(19509),f=i(80110),v=i(23187),b=i(45138),y=i(93216),w=i(32897),C=i(53152),j=i(45984),k=i(48635),F=i(19005);let S=(0,u.ZP)(C.Z)(e=>{let{theme:t}=e;return{width:12,height:12,padding:0,borderRadius:3,"& .MuiSvgIcon-root":{fontSize:12,borderRadius:3},"&.Mui-checked":{color:"#1BEF61",borderRadius:3,"& .MuiSvgIcon-root":{boxShadow:"0 0.5px 0 0 rgba(26, 26, 26, 0.08), 0 1px 3px 0 rgba(26, 26, 26, 0.08)"}}}}),I=()=>{var e;let t="contest:202510-story-mv",{story:i,updateStoryContestBanner:n}=(0,k.MT)(),o=(null==i?void 0:null===(e=i.contests)||void 0===e?void 0:e.includes(t))||!1,{data:a}=(0,F.CD)();return(0,r.jsx)(x.Z,{direction:"row",justifyContent:"center",alignItems:"center",role:"button",onClick:()=>n(t,!o),sx:{backgroundImage:"url('https://cdn.openart.ai/assets/internal/uploads/image_nX_7qylK_740x144_1760450492514.webp')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"81px",width:"100%",borderRadius:"8px",padding:"16px",cursor:"pointer"},children:(0,r.jsxs)(x.Z,{direction:"column",alignItems:"center",justifyContent:"center",spacing:1,sx:{whiteSpace:"nowrap",textAlign:"left"},children:[(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",justifyContent:"left",spacing:1,sx:{width:"100%"},children:[(0,r.jsx)(S,{checked:o,onChange:e=>n(t,e.target.checked),onClick:e=>e.stopPropagation()}),(0,r.jsx)(f.Z,{sx:{color:"#FFF",fontFamily:"Inter",fontSize:"14px",fontStyle:"normal",fontWeight:600,lineHeight:"130%"},children:"Join the OMVA Awards — Win $50K in Prizes!"})]}),(0,r.jsxs)(f.Z,{fontSize:"12px",fontWeight:600,color:"var(--Gray-900)",sx:{color:"#FFF",fontFamily:"Inter",fontSize:"12px",fontStyle:"normal",fontWeight:500,lineHeight:"130%"},children:["Complete your entry by filling out the\xa0",(0,r.jsx)(j.Z,{href:`https://forms.openart.ai/omva?${new URLSearchParams({user_id:null==a?void 0:a.id,email:null==a?void 0:a.email,name:null==a?void 0:a.displayName}).toString()}`,target:"_blank",rel:"noopener noreferrer",color:"#1BEF61",sx:{"&:hover":{textDecoration:"underline"}},onClick:e=>e.stopPropagation(),children:"Submission Form ↗"})]})]})})};var _=i(92662),Z=i(40950),A=i(55070),E=i(45029),M=i(27806),T=i(328),R=i(16585);let D=e=>({twitter:"Twitter/X",linkedin:"LinkedIn",reddit:"Reddit"})[e]||e.charAt(0).toUpperCase()+e.slice(1),z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;switch(e){case"twitter":return(0,r.jsx)(M.LogosTwitter,{width:t,height:t});case"linkedin":return(0,r.jsx)(T.Z,{icon:"mdi:linkedin",width:t,height:t,color:"#0077B5"});case"reddit":return(0,r.jsx)(M.LogosRedditIcon,{width:t,height:t});default:return(0,r.jsx)(T.Z,{icon:"ph:share-network",width:t,height:t})}},P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;switch(e){case"download":return(0,r.jsx)(T.Z,{icon:"ph:download-simple",width:t,height:t});case"publish":return(0,r.jsx)(M.CustomPublishOpenArt,{size:t,color:"#FFFFFF"});case"unpublish":return(0,r.jsx)(T.Z,{icon:"ph:eye-slash",width:t,height:t,color:"#FFFFFF"});default:return(0,r.jsx)(T.Z,{icon:"ph:share-network",width:t,height:t})}},W=e=>{let{onDownload:t,onLink:i,onPublishOrUnpublish:n,onSocialShare:o,onNativeLinkShare:a,onNativeVideoShare:s,isOwner:l=!1,isNativeShareSupported:d}=e,{story:u}=(0,k.MT)(),p=(0,E.I)();if(!u)return null;let h=u.is_published||!1,m=e=>{R.B("story_shared_clicked",{story_id:u.id,story_type:u.category_id,share_method:`social_${e}`}),p.logShare({itemId:u.id}),o(e)};return(0,r.jsxs)(c.Z,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,r.jsx)(_.zq,{title:"Share"}),(0,r.jsxs)(x.Z,{spacing:2,sx:{mt:3,width:"100%"},children:[(0,r.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(g.ZP,{item:!0,xs:4,children:(0,r.jsx)(_.JQ,{icon:(0,r.jsx)(M.PhDownloadSimple,{size:22,color:"#FFFFFF"}),label:"Download",onClick:()=>{R.B("story_shared_clicked",{story_id:u.id,story_type:u.category_id,share_method:"download"}),p.logDownload({itemId:u.id}),t()}})}),(0,r.jsx)(g.ZP,{item:!0,xs:4,children:(0,r.jsx)(_.JQ,{icon:(0,r.jsx)(M.PhLinkLight,{size:22,color:"#FFFFFF"}),label:"Copy Link",onClick:()=>{R.B("story_shared_clicked",{story_id:u.id,story_type:u.category_id,share_method:"copy_link"}),p.logShare({itemId:u.id}),i()}})}),l?(0,r.jsx)(g.ZP,{item:!0,xs:4,children:(0,r.jsx)(_.JQ,{icon:P(h?"unpublish":"publish",22),label:h?"Unpublish":"Publish",onClick:()=>{R.B("story_shared_clicked",{story_id:u.id,story_type:u.category_id,share_method:h?"unpublish":"publish"}),p.logShare({itemId:u.id}),n()},textColor:h?"#FA4D56":void 0})}):null]}),(0,r.jsx)(g.ZP,{container:!0,spacing:2,children:["twitter","linkedin","reddit"].map(e=>(0,r.jsx)(g.ZP,{item:!0,xs:4,children:(0,r.jsx)(_.JQ,{icon:z(e,22),label:D(e),onClick:()=>m(e)})},e))})]})]})},L=e=>{let{actionType:t,onBack:i,onReExport:n,onUseLastExport:o,onPublishOrUnpublish:a,onCopyLink:s,isPublishLoading:l=!1,isDownloadLoading:d=!1,isProcessing:u=!1,isOwner:p=!1,progress:h=0}=e,{currentAction:m,selectedPlatform:g}=(0,k.ef)(),{story:C,shouldHighlightBottomButton:j,removeWatermark:S,updateRemoveWatermark:E}=(0,k.MT)(),[R,z,W]=(0,A.e)((null==C?void 0:C.id)||""),{data:L}=(0,F.$_)();if(!C)return null;let B=null!==C.last_export_url&&void 0!==C.last_export_url&&""!==C.last_export_url&&!C.is_export_outdated,H=C.is_published||!1;return(0,r.jsx)(c.Z,{children:(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(_.zq,{onBack:i}),"publish"===m&&("music_video"===C.category_id||"create_from_scratch"===C.category_id)?(0,r.jsx)(I,{}):null,"download"===m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(x.Z,{direction:"column",alignItems:"center",spacing:2,children:[(0,r.jsxs)(x.Z,{direction:{sm:"column",md:"row"},alignItems:{sm:"flex-start",md:"center"},justifyContent:{sm:"flex-start",md:"space-between"},width:"100%",sx:{gap:1},children:[(0,r.jsx)(f.Z,{sx:{color:"#FFF",fontFamily:"Inter",fontSize:"16px",fontStyle:"normal",fontWeight:600,lineHeight:"18px"},children:"Download Final Video"}),(0,r.jsx)(_.IB,{checked:S,onChange:E,style:{fontSize:"12px",fontWeight:500}})]}),(0,r.jsx)(_.J4,{onClick:B?o:n,className:"highlighted",sx:{width:"100%"},disabled:u,progress:h,isProcessing:u,children:u?(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(T.Z,{icon:"eos-icons:loading",width:16,height:16}),(0,r.jsx)("span",{children:"Exporting..."})]}):(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[P("download"),(0,r.jsx)("span",{children:"Download MP4"})]})})]}),(0,r.jsx)(v.Z,{}),L&&(null==C?void 0:C.user_id)!==(null==L?void 0:L.id)?null:(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsxs)(w.X2,{children:[(0,r.jsx)(f.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontSize:"16px",fontWeight:600,lineHeight:"17px"},children:"Download All Assets"}),(0,r.jsx)(y.ZP,{title:"Includes all videos, images, and other resources."})]}),(0,r.jsx)(_.J4,{onClick:z,className:"secondary",sx:{width:"100%"},disabled:R,progress:W,isProcessing:R,children:R?(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(c.Z,{sx:{width:"16px",height:"16px",border:"2px solid #444444",borderTop:"2px solid #CCCCCC",borderRadius:"50%",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}),(0,r.jsx)("span",{children:"Exporting..."})]}):(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(T.Z,{icon:"ph:download-simple",width:16,height:16}),(0,r.jsx)("span",{children:"Download Zip File"})]})})]})]}):null,"generate_link"!==m||g?null:(0,r.jsxs)(x.Z,{direction:"column",spacing:2,children:[(0,r.jsx)(_.IB,{checked:S,onChange:E}),(0,r.jsx)(b.Z,{size:"small",value:(0,Z.KY)(C.id),sx:{flex:1,"& .MuiOutlinedInput-root":{backgroundColor:"transparent","& fieldset":{borderColor:"#444444"},"& input":{color:"#CCCCCC",fontFamily:"Inter",fontSize:"12px",fontWeight:500,padding:"8px"}}},InputProps:{readOnly:!0}}),(0,r.jsx)(_.J4,{onClick:B?s||o:n,className:"highlighted",sx:{width:"100%"},disabled:u,progress:h,isProcessing:u,children:u?(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(T.Z,{icon:"eos-icons:loading",width:16,height:16}),(0,r.jsx)("span",{children:"Exporting..."})]}):(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(T.Z,{icon:"ph:copy",width:16,height:16}),(0,r.jsx)("span",{children:"Copy link"})]})})]}),"generate_link"===m&&g?(0,r.jsxs)(x.Z,{direction:"column",spacing:2,children:[(0,r.jsx)(_.IB,{checked:S,onChange:E}),(0,r.jsx)(_.J4,{onClick:B?o:n,className:"highlighted",sx:{width:"100%"},disabled:u,progress:h,isProcessing:u,children:u?(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(T.Z,{icon:"eos-icons:loading",width:16,height:16}),(0,r.jsx)("span",{children:"Exporting..."})]}):(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(M.PhShareFat,{sx:{fontSize:"16px"}}),(0,r.jsxs)("span",{children:["Share to ",D(g)]})]})})]}):null,"publish"===m?(0,r.jsxs)(x.Z,{direction:"column",spacing:2,children:[(0,r.jsx)(_.Rb,{}),(0,r.jsx)(_.IB,{checked:S,onChange:E}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,justifyContent:"center",children:[{action:"publish",disabled:H||l},{action:"unpublish",disabled:!H||l}].map(e=>{let{action:i,disabled:n}=e,o="unpublish"===i;return(0,r.jsx)(_.Kk,{disabled:n,onClick:()=>a(i),sx:{flex:1,backgroundColor:n?"#333333":o?"#FA4D56":"#1856D0",color:"#FFFFFF",border:"none","&:hover":{backgroundColor:o?"#E53E3E":"#1447B3"}},children:l&&t===i?(0,r.jsx)(T.Z,{icon:"eos-icons:loading",width:16,height:16}):(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[P(i),(0,r.jsx)("span",{children:D(i)})]})},i)})}),u?(0,r.jsx)(_.J4,{onClick:()=>{},className:"highlighted",sx:{width:"100%"},disabled:u,progress:h,isProcessing:u,children:(0,r.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(T.Z,{icon:"eos-icons:loading",width:16,height:16}),(0,r.jsx)("span",{children:"Exporting..."})]})}):null]}):null]})})},B=(0,u.ZP)(a.ZP)(e=>{let{theme:t}=e;return{"& .MuiPopover-paper":{backgroundColor:"#1A1A1A",border:"1px solid #444444",borderRadius:"12px",padding:"20px",width:"min(420px, calc(100vw - 32px))",maxWidth:"calc(100vw - 32px)",maxHeight:"calc(100vh - 32px)",overflowY:"auto",boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.4)"},[t.breakpoints.down("sm")]:{"& .MuiPopover-paper":{padding:"16px"}}}}),H=(0,u.ZP)(s.Z)(e=>{let{theme:t}=e;return{"& .MuiDialog-container":{alignItems:"center",justifyContent:"center",padding:"16px"},"& .MuiPaper-root":{backgroundColor:"#1A1A1A",borderRadius:"12px",border:"1px solid #444444",boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.4)",width:"min(600px, calc(100vw - 32px))",maxWidth:"calc(100vw - 32px)",maxHeight:"calc(100vh - 96px)",margin:0},[t.breakpoints.down("sm")]:{"& .MuiDialog-container":{padding:"12px"},"& .MuiPaper-root":{width:"min(600px, calc(100vw - 24px))",maxWidth:"calc(100vw - 24px)",maxHeight:"calc(100vh - 80px)"}}}});var $=e=>{let{open:t,anchorEl:i,onClose:a,story:s,openDirectlyToExportOptions:u=!1}=e,x=(0,p.Z)(),g=(0,h.Z)(x.breakpoints.down("sm"),{defaultMatches:!1,noSsr:!0}),f=(0,o.useRouter)(),{data:v,isLoggedIn:b}=(0,F.$_)(),y=(null==s?void 0:s.user_id)===(null==v?void 0:v.id),{shareState:w,resetState:C,setExportOptionsView:j}=(0,k.ef)(),{initializeProps:S}=(0,k.MT)(),I=(0,m.z)(a),_=()=>{let{asPath:e}=f||{},t=`/signin?callbackUrl=${encodeURIComponent(e)}`;f.push(t)},Z=e=>function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];if(!b){_();return}return e(...i)};(0,n.useEffect)(()=>{t&&(S(s,y),u&&j("download"))},[t,s,y,S,u,j]),(0,n.useEffect)(()=>{t||C()},[t,C]);let A=(0,r.jsx)(r.Fragment,{children:"export_options"===w?(0,r.jsx)(L,{actionType:I.actionType,onBack:u?void 0:I.handleBack,onReExport:I.handleReExport,onUseLastExport:I.handleUseLastExport,onPublishOrUnpublish:I.handlePublishOrUnpublish,onCopyLink:I.handleCopyLink,isPublishLoading:I.isPublishLoading,isDownloadLoading:I.isDownloadLoading,isProcessing:I.isProcessing,isOwner:y,progress:I.progress}):(0,r.jsx)(W,{onDownload:Z(I.handleDownload),onLink:Z(I.handleGenerateLink),onPublishOrUnpublish:Z(I.handlePublishOrUnpublish),onSocialShare:Z(I.handleSocialShare),onNativeLinkShare:Z(I.handleNativeLinkShare),onNativeVideoShare:Z(I.handleNativeVideoShare),isOwner:y,isNativeShareSupported:I.isNativeShareSupported})});return g?(0,r.jsx)(H,{open:t,onClose:a,children:(0,r.jsxs)(l.Z,{sx:{padding:"12px 20px 24px",position:"relative",overflowY:"auto"},children:[(0,r.jsx)(d.Z,{"aria-label":"Close share options",onClick:a,sx:{position:"absolute",top:16,right:16,color:"#E0E0E0"},children:(0,r.jsx)(T.Z,{icon:"ph:x",width:18,height:18})}),(0,r.jsx)(c.Z,{sx:{mt:2},children:A})]})}):(0,r.jsx)(B,{open:t,anchorEl:i,onClose:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:A})}},48635:function(e,t,i){i.d(t,{MT:function(){return y},ef:function(){return b}});var r=i(75271),n=i(81192),o=i(19082),a=i(12522);let s=(0,n.cn)("main"),l=(0,n.cn)(null),d=(0,n.cn)(null),c=(0,n.cn)(!1),u=(0,n.cn)(null),p=(0,n.cn)(!0),h=(0,n.cn)(!1),m=(0,n.cn)(null),x=(0,n.cn)(null),g=(0,n.cn)(e=>({useLastExport:!1,removeWatermark:e(c)})),f=(0,n.cn)(e=>!!e(p)),v=(0,n.cn)(e=>{let t=e(u),i=e(c);return((null==t?void 0:t.is_export_outdated)||i)??!1});function b(){let[e,t]=(0,o.KO)(s),[i,n]=(0,o.KO)(l),[a,c]=(0,o.KO)(d),[u,p]=(0,o.KO)(h),[g,f]=(0,o.KO)(m),[,v]=(0,o.KO)(x),b=(0,r.useCallback)(()=>{t("main"),n(null),c(null),p(!1),f(null),v(null)},[t,n,c,p,f,v]),y=(0,r.useCallback)(e=>{t("export_options"),n(e)},[t,n]),w=(0,r.useCallback)(()=>{"export_options"===e&&(t("main"),n(null),c(null),p(!1))},[e,t,n,c,p]);return{shareState:e,currentAction:i,selectedPlatform:a,isUnpublishMode:u,originalThumbnail:g,setSelectedPlatform:c,setIsUnpublishMode:p,setOriginalThumbnail:f,resetState:b,setExportOptionsView:y,goBack:w}}function y(){let e=(0,o.b9)(u),t=(0,o.b9)(p),[i,n]=(0,o.KO)(m),[s,l]=(0,o.KO)(x),d=(0,o.Dv)(u),c=(0,o.Dv)(f),h=(0,o.Dv)(v),b=(0,o.Dv)(g),y=(0,r.useCallback)((i,r)=>{e(i),t(r),n((null==i?void 0:i.last_export_thumbnail_url)||null);let o=a.cc().prop("video_editor_timeline").prop("globalConfig").prop("watermark").prop("enabled");l(!a.U2(o)(i))},[e,t,n,l]),w=(0,r.useCallback)(t=>{e(e=>e?{...e,last_export_thumbnail_url:t}:null)},[e]),C=(0,r.useCallback)((t,i)=>{e(e=>{if(!e)return null;let r=new Set((e.contests||[]).filter(Boolean));return i?r.add(t):r.delete(t),{...e,contests:Array.from(r)}})},[e]),j=(0,r.useCallback)(t=>{e(e=>{if(!e)return null;let i=a.cc().prop("video_editor_timeline").prop("globalConfig").prop("watermark").prop("enabled"),r=a.cc().prop("is_export_outdated"),n=a.t8(i)(!t)(e);return s?n:null!=s&&t!==s?a.t8(r)(!0)(n):a.t8(r)(!1)(n)})},[e,s]),k=(0,r.useMemo)(()=>{let e=a.cc().prop("video_editor_timeline").prop("globalConfig").prop("watermark").prop("enabled");return!!d&&!a.U2(e)(d)},[d]);return{story:d,shouldShowExportOptions:c,originalThumbnail:i,shouldHighlightBottomButton:h,exportOptions:b,initializeProps:y,updateStoryThumbnail:w,updateStoryContestBanner:C,removeWatermark:k,updateRemoveWatermark:j}}},40950:function(e,t,i){i.d(t,{It:function(){return a},KY:function(){return r},O4:function(){return s},an:function(){return h},e3:function(){return n},v6:function(){return d},vQ:function(){return o},v_:function(){return l},wy:function(){return c}});let r=e=>`https://openart.ai/story/share/${e}`,n=(e,t,i)=>({twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(t)}&url=${encodeURIComponent(i)}`,reddit:`https://reddit.com/submit?url=${encodeURIComponent(i)}&title=${encodeURIComponent(t)}`,linkedin:`https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(`${t} ${i}`)}`})[e]||"",o=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.error("Failed to copy link:",e),!1}},a=async e=>{if(!navigator.share)return!1;try{return await navigator.share(e),!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return console.error("Error sharing:",e),!0;return!1}},s=async(e,t)=>{try{let i=await fetch(e);if(!i.ok)throw Error(`Failed to download video: ${i.statusText}`);let r=await i.blob();return new File([r],`${t}.mp4`,{type:"video/mp4"})}catch(e){return console.error("Error downloading video:",e),null}},l=()=>void 0!==navigator.share,d=async(e,t)=>{await Promise.all([e.invalidateQueries({queryKey:["stories","published",{}]}),e.invalidateQueries({queryKey:["stories","detail",t]}),e.invalidateQueries({queryKey:["profile","published","stories"]})])},c=e=>`Check out this story on @openart_ai: ${e||"My Story"}`,u=(e,t)=>{let i=document.createElement("a");i.download=`${t}.mp4`,i.href=e,i.target="_self",i.click()},p=async(e,t)=>{let i=await fetch(e,{method:"GET"});if(!i.ok)throw Error(`Failed to fetch video blob: ${i.status} ${i.statusText}`);let r=await i.blob(),n=URL.createObjectURL(r);try{let e=document.createElement("a");e.href=n,e.download=`${t}.mp4`,e.click()}finally{URL.revokeObjectURL(n)}},h=async(e,t)=>{if(e){try{let i=await fetch(e,{method:"HEAD"}),r=i.headers.get("content-disposition")||i.headers.get("Content-Disposition")||"";if("string"==typeof r&&r.toLowerCase().includes("attachment")){u(e,t);return}}catch{}try{await p(e,t)}catch{u(e,t)}}}},60905:function(e,t,i){i.d(t,{E:function(){return T}});var r=i(52676),n=i(75271),o=i(45162),a=i.n(o),s=i(66266),l=i(58684),d=i(22988),c=i(80110),u=i(56407),p=i(76651),h=i(91415),m=i(13724),x=i(75616),g=i(39204),f=i(42312),v=i(8393),b=i(86262),y=i(69491),w=i(81479),C=i(88764),j=i(27806),k=i(93710),F=i(328),S=i(16585),I=i(33010);let _=e=>{let{storyStatus:t}=e;return(0,r.jsxs)(d.Z,{sx:{height:"100%",width:"100%",px:"40px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(253deg, #202020 -15.03%, #393939 59.06%, #202020 117.83%), #2E2E2E"},children:[(0,r.jsx)(a(),{src:"https://cdn.openart.ai/story/home/my/storyErrorStatus.png",alt:"Story card error",width:69,height:60}),(0,r.jsx)(c.Z,{sx:{mt:1,color:"#888",textAlign:"center",fontFamily:"Inter",fontSize:"12px",fontWeight:500,lineHeight:"normal"},children:(0,w.MZ)(t).description})]})},Z=()=>(0,r.jsx)(d.Z,{sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(253deg, #202020 -15.03%, #393939 59.06%, #202020 117.83%), #2E2E2E"},children:(0,r.jsx)(F.Z,{icon:"fa6-solid:compass-drafting",width:32,height:32,color:"#666666"})}),A=e=>{let{title:t,formattedDate:i,typeImage:n}=e;return(0,r.jsxs)(u.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{p:0,px:{xs:1,sm:1.5},pt:1,gap:1},children:[(0,r.jsx)(d.Z,{sx:{flex:"0 0 auto"},children:(0,r.jsx)(a(),{src:n,alt:"Story card error",width:20,height:20})}),(0,r.jsxs)(d.Z,{sx:{flex:"1 1 auto",overflow:"hidden"},children:[(0,r.jsx)(c.Z,{variant:"subtitle1",component:"h3",sx:{color:"#FFF",fontSize:{xs:"12px",sm:"14px"},fontStyle:"normal",fontWeight:600,lineHeight:"22px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t,children:t}),(0,r.jsx)(c.Z,{variant:"caption",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:{xs:"10px",sm:"12px"}},children:i})]})]})},E=e=>{let{story:t,onDelete:i,isDeleting:n,setWorkflowRunId:o,setIsRegenerating:a}=e,h=(0,s.useRouter)(),[m,x]=(0,k.oH)(),g=["failed:generating_timeline","failed:exporting_video","failed:user_exporting_video"].includes(t.status),f=["failed:exporting_video","failed:generating_images","failed:generating_timeline","failed:user_exporting_video","failed:generating_videos"].includes(t.status),v=async()=>{a(!0),o(await m({story_id:t.id,force_music_reselection:!1,rebuild_timeline:!0}))};return(0,r.jsxs)(u.Z,{direction:"row",justifyContent:g?"space-between":"center",alignItems:"center",sx:{p:0,px:1.5,pt:2.2,gap:1},children:[g?(0,r.jsxs)(d.Z,{sx:{position:"relative"},children:[(0,r.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"10px 12px",width:116,height:36,backgroundColor:"#013FFE",border:"1px solid rgba(255, 255, 255, 0.16)",borderRadius:"8px",backdropFilter:"blur(23.5px)",cursor:"pointer","@media (hover: hover)":{"&:hover":{backgroundColor:"#0235e6"}}},loading:x,onClick:v,children:!x&&(0,r.jsx)(c.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"14px",lineHeight:"1.21em",color:"#FFFFFF",textAlign:"center"},children:"Recover"})}),(0,r.jsx)(p.Z,{label:"FREE",size:"small",sx:{position:"absolute",top:-6,right:-6,height:16,minWidth:28,background:"linear-gradient(135deg, #00C851 0%, #007E33 100%)",color:"#FFFFFF",fontSize:"10px",fontWeight:700,fontFamily:"Inter",borderRadius:"8px",zIndex:10,"& .MuiChip-label":{px:"6px",py:"2px"}}})]}):null,f?(0,r.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"10px 12px",width:116,height:36,backgroundColor:"#1A1A1A",border:"1px solid rgba(255, 255, 255, 0.16)",borderRadius:"8px",backdropFilter:"blur(23.5px)",cursor:"pointer","@media (hover: hover)":{"&:hover":{backgroundColor:"#2A2A2A"}}},onClick:()=>{(0,S.B)("editor_opened",{story_id:null==t?void 0:t.id,opened_from:"story_card"}),h.push(`/story/editor?story_id=${null==t?void 0:t.id}`)},children:(0,r.jsx)(c.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"14px",lineHeight:"1.21em",color:"#FFFFFF",textAlign:"center"},children:"Open Editor"})}):null,!(f||g)&&(0,r.jsx)(l.Z,{loading:n,sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"10px 12px",width:116,height:36,backgroundColor:"#1A1A1A",border:"1px solid rgba(255, 255, 255, 0.16)"},onClick:()=>{null==i||i(t.id)},children:(0,r.jsx)(c.Z,{children:"Delete"})})]})},M=e=>{let{icon:t,onClick:i,isLoading:n}=e;return(0,r.jsx)(l.Z,{loading:n,disableRipple:!0,disableElevation:!0,sx:{width:24,height:24,p:0,minWidth:"unset",backgroundColor:"#262626",borderRadius:"3.75px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",border:"none",outline:"none",boxShadow:"none","@media (hover: hover)":{"&:hover":{backgroundColor:"#404040",boxShadow:"none"}},"&:focus":{boxShadow:"none"},"&:active":{boxShadow:"none"},"&.Mui-disabled":{backgroundColor:"#262626",color:"inherit"},"& .MuiLoadingButton-loadingIndicator":{color:"#FFFFFF",position:"absolute"},"&.MuiLoadingButton-loading":{color:"transparent"}},onClick:e=>{e.stopPropagation(),e.preventDefault(),i(e)},children:t})};function T(e){var t;let{story:i,id:o,title:a,createdAt:l,isOpenPreview:k,onOpenPreview:F,onDelete:T,isDeleting:R,onExport:D,isRebuilding:z,workflowRunId:P,onExportComplete:W}=e,L=null==i?void 0:null===(t=i.status)||void 0===t?void 0:t.startsWith("processing:"),[B,H]=(0,n.useState)(!1),[$,O]=(0,n.useState)(!1),[U,G]=(0,n.useState)(!1),[N,V]=(0,n.useState)(!1),[K,q]=(0,n.useState)(null),[Y,X]=(0,n.useState)(!1),[J,Q]=(0,n.useState)(null),ee=(0,x.NL)(),{mutateAsync:et}=(0,C.GH)(),ei=(0,s.useRouter)(),[er,en]=(0,n.useState)(null),eo=P||er,ea="object"==typeof l?`Created on ${new Date(1e3*l._seconds+l._nanoseconds/1e6).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}`:`Created on ${l}`,es=null==i?void 0:i.last_export_thumbnail_url,el=(0,n.useMemo)(()=>(0,w.v4)(null==i?void 0:i.status)?(0,r.jsx)(_,{storyStatus:null==i?void 0:i.status}):(null==i?void 0:i.status.startsWith("draft"))&&!es?(0,r.jsx)(Z,{}):L?(0,r.jsx)(v.Z,{text:(0,y.Xe)(null==i?void 0:i.status)}):es?(0,r.jsx)(g.E.div,{whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:30},style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:(0,r.jsx)(h.Z,{component:"img",image:es,alt:a,sx:{maxHeight:"100%",maxWidth:"100%",width:"100%",height:"100%",objectFit:"cover"}})}):(0,r.jsx)(d.Z,{sx:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.900"},children:(0,r.jsx)(c.Z,{variant:"body2",color:"text.secondary",children:"No preview"})}),[L,null==i?void 0:i.status,es,a]),ed=(0,n.useMemo)(()=>(0,y.j7)(null==i?void 0:i.category_id),[null==i?void 0:i.category_id]),ec=(0,n.useMemo)(()=>(0,w.v4)(null==i?void 0:i.status)?(0,r.jsx)(E,{story:i,setWorkflowRunId:en,setIsRegenerating:H,isDeleting:R,onDelete:async()=>{await (null==T?void 0:T(o))}}):(0,r.jsx)(A,{title:a,formattedDate:(null==i?void 0:i.is_template)?"By OpenArt":ea,typeImage:ed}),[T,ea,o,R,i,a,ed]),eu=(0,n.useMemo)(()=>(0,w.Jc)(null==i?void 0:i.status)?(0,r.jsxs)(u.Z,{className:"action-buttons",direction:"column",justifyContent:"center",alignItems:"center",spacing:1,sx:{position:"absolute",top:8,right:8,zIndex:2,opacity:0,visibility:"visible",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out"},children:[(0,r.jsx)(M,{icon:(0,r.jsx)(j.PhPen,{}),isLoading:$,onClick:async e=>{e.stopPropagation(),e.preventDefault();try{if(O(!0),(0,S.B)("editor_opened",{story_id:null==i?void 0:i.id,opened_from:"story_card"}),null==i?void 0:i.is_template){let e=await et({templateStoryId:i.id,operation:"edit"});window.open(`/story/editor?story_id=${e.id}`,"_blank")}else window.open(`/story/editor?story_id=${o}`,"_blank")}finally{O(!1)}}}),(null==i?void 0:i.is_template)?null:(0,r.jsx)(M,{icon:(0,r.jsx)(j.PhShareFat,{}),onClick:e=>{q(e.currentTarget),V(!0)}}),(null==i?void 0:i.is_template)?null:(0,r.jsx)(M,{isLoading:z,icon:(0,r.jsx)(j.PhDownloadSimple,{}),onClick:async e=>{Q(e.currentTarget),X(!0)}}),(0,r.jsx)(M,{icon:(0,r.jsx)(j.PhTrash,{}),isLoading:R||U,onClick:async()=>{try{(null==i?void 0:i.is_template)?(G(!0),await et({templateStoryId:i.id,operation:"delete"})):await (null==T?void 0:T(o))}finally{G(!1)}}})]}):(0,r.jsx)(u.Z,{className:"action-buttons",direction:"column",justifyContent:"center",alignItems:"center",spacing:1,sx:{position:"absolute",top:8,right:8,zIndex:2,opacity:0,visibility:"visible",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out"},children:(0,r.jsx)(M,{icon:(0,r.jsx)(j.PhTrash,{}),isLoading:R||U,onClick:async()=>{try{(null==i?void 0:i.is_template)?(G(!0),await et({templateStoryId:i.id,operation:"delete"})):await (null==T?void 0:T(o))}finally{G(!1)}}})}),[null==i?void 0:i.status,null==i?void 0:i.is_template,i.id,$,z,T,R,U,o,et]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(m.Z,{sx:{pb:1.5,width:"100%",overflow:"hidden",position:"relative",backgroundColor:"#1A1A1A",borderRadius:"8px",border:"1px solid #2E2E2E",background:"#1A1A1A","@media (hover: hover)":{"&:hover .action-buttons":{opacity:1,visibility:"visible"}},cursor:"pointer"},onClick:()=>{let e=(0,w.gu)(i);(0,w.Jc)(null==i?void 0:i.status)?null==F||F():e?ei.push(`/story/editor?story_id=${o}&view=list`):(null==i?void 0:i.status)==="draft"?((0,S.B)("editor_opened",{story_id:null==i?void 0:i.id,opened_from:"story_card"}),ei.push(`/story/editor?story_id=${o}`)):(null==i?void 0:i.status)==="failed"||(null==i?void 0:i.status.startsWith("failed:"))||ei.push(`/story/my/${o}`)},children:[(0,r.jsxs)(d.Z,{sx:{position:"relative",height:146,width:"100%",overflow:"hidden"},children:[el,eu,(null==i?void 0:i.is_template)?(0,r.jsx)(p.Z,{label:"Example",size:"small",sx:{position:"absolute",top:8,right:8,zIndex:3,background:"rgba(0, 0, 0, 0.58)",border:"1px solid rgba(255, 255, 255, 0.08)",backdropFilter:"blur(10.9px)",color:"rgba(255, 255, 255, 0.62)",fontFamily:"Inter",fontSize:"14px",fontWeight:600,height:"24px",borderRadius:"6px","& .MuiChip-label":{px:"8px",py:"4px"}}}):null,eo?(0,r.jsx)(f.d,{workflowRunId:eo,storyId:o,onComplete:W||(()=>{en(null),B&&((0,I.tO)(ee,i),H(!1))}),shouldAutoDownload:!k&&!B}):null]}),ec]}),(0,r.jsx)(b.Z,{open:N,anchorEl:K,onClose:()=>{V(!1),q(null)},story:i}),(0,r.jsx)(b.Z,{open:Y,anchorEl:J,onClose:()=>{X(!1),Q(null)},story:i,openDirectlyToExportOptions:!0})]})}},90610:function(e,t,i){i.d(t,{n:function(){return S}});var r=i(52676),n=i(75271),o=i(22988),a=i(24181),s=i(80110),l=i(19509),d=i(75616),c=i(53874),u=i(8765),p=i(19242),h=i(24368),m=i(23679),x=i(46237),g=i(86775),f=i(722),v=i(60905),b=i(81479),y=i(66627),w=i(97779),C=i(3935),j=i(93710),k=i(16585);function F(){return(0,r.jsxs)(o.Z,{sx:{width:"100%",backgroundColor:"#1A1A1A",borderRadius:"8px",border:"1px solid #2E2E2E",overflow:"hidden",pb:1.5},children:[(0,r.jsx)(a.Z,{variant:"rectangular",width:"100%",height:146,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px 8px 0 0"}}),(0,r.jsxs)(o.Z,{sx:{p:0,px:{xs:1,sm:1.5},pt:1,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(a.Z,{variant:"rectangular",width:20,height:20,sx:{backgroundColor:"#2A2A2A",borderRadius:"4px",flexShrink:0}}),(0,r.jsxs)(o.Z,{sx:{flex:"1 1 auto",overflow:"hidden"},children:[(0,r.jsx)(a.Z,{variant:"text",width:"70%",height:22,sx:{backgroundColor:"#2A2A2A",mb:.5}}),(0,r.jsx)(a.Z,{variant:"text",width:"50%",height:16,sx:{backgroundColor:"#2A2A2A"}})]})]})]})}function S(e){let{stories:t,fetchNextPage:i,hasNextPage:a=!1,isFetchingNextPage:S=!1,title:I,maxItems:_,isLoading:Z=!1,showVideoOutdatedHint:A=!0}=e,E=(0,d.NL)(),{isMobile:M}=(0,w.j)(),{showModal:T}=(0,u.dd)(),[R]=(0,j.oH)(),[D]=(0,j.lj)(),z=(0,h.aT)(),[P,W]=(0,n.useState)(!1),[L,B]=(0,n.useState)(null),[H,$]=(0,n.useState)(()=>new Map),[O,U]=(0,n.useState)(()=>new Map),[G,N]=(0,n.useState)(()=>new Map),[V,K]=(0,n.useState)(!1),{ref:q,inView:Y}=(0,p.YD)({threshold:.1,triggerOnce:!1}),X=(0,n.useMemo)(()=>_?t.slice(0,_):t,[t,_]),J=(0,n.useMemo)(()=>X.filter(e=>e.status.startsWith("processing")).map(e=>e.workflow_run_id),[X]),Q=(0,n.useCallback)((e,t)=>{E.setQueryData(y.Y.lists(),(0,c.Uy)(i=>{if(null==i?void 0:i.pages){for(let r of i.pages)for(let i of r.stories)if(i.workflow_run_id===e){let e=t.story;(0,b.v4)(t.status)?i.status="failed":e&&e.status!==i.status&&Object.assign(i,e);return}}}))},[E]);(0,n.useEffect)(()=>{Y&&i&&a&&!S&&i()},[Y,i,a,S]),(0,C.i)(J,!0,Q);let ee=L?X.find(e=>e.id===L.id):null,et=(0,n.useCallback)(e=>{var t,i,r,n;K((null===(i=e.video_editor_timeline)||void 0===i?void 0:null===(t=i.tracks)||void 0===t?void 0:t.length)>0&&(null===(n=e.video_editor_timeline)||void 0===n?void 0:null===(r=n.mediaAssets)||void 0===r?void 0:r.length)>0)},[]),ei=(0,n.useCallback)(e=>{et(e),B(e),W(!0)},[et]),er=(0,n.useCallback)(()=>{W(!1),B(null)},[]),en=(0,n.useCallback)(()=>{if(L&&L.id!==X.at(-1).id){let e=X[X.indexOf(L)+1];et(e),B(e)}},[L,X,et]),eo=(0,n.useCallback)(()=>{if(L&&L.id!==X[0].id){let e=X[X.indexOf(L)-1];et(e),B(e)}},[L,X,et]),ea=(0,n.useCallback)(async()=>{if(ee){U(e=>new Map(e).set(ee.id,!0));try{let e=await R({story_id:ee.id,force_music_reselection:!1});$(t=>new Map(t).set(ee.id,e))}finally{U(e=>{let t=new Map(e);return t.delete(ee.id),t})}}},[ee,R]),es=(0,n.useCallback)(async e=>{z.confirm({title:"Delete Story",content:"Are you sure you want to delete this Story? This action cannot be undone.",iconType:"warning",onConfirm:async()=>{N(t=>new Map(t).set(e,!0));try{if(await D(e),(null==L?void 0:L.id)===e&&P){let t=X.findIndex(t=>t.id===e),i=X[t+1]||X[t-1];i?B(i):(W(!1),B(null))}}finally{N(t=>{let i=new Map(t);return i.delete(e),i})}},onCancel:()=>{N(t=>{let i=new Map(t);return i.delete(e),i})}})},[z,D,null==L?void 0:L.id,P,X]),el=(0,n.useCallback)(e=>{$(t=>{let i=new Map(t);return i.delete(e),i}),U(t=>{let i=new Map(t);return i.delete(e),i})},[]),ed=(0,n.useCallback)(async e=>{U(t=>new Map(t).set(e,!0));try{let t=await R({story_id:e,force_music_reselection:!1});$(i=>new Map(i).set(e,t))}finally{U(t=>{let i=new Map(t);return i.delete(e),i})}},[R]),ec=(0,n.useCallback)(async()=>{if(ee){if(M){T(x.$);return}(0,k.B)("editor_opened",{story_id:ee.id,opened_from:"story_card_list"}),W(!1),window.open(`/story/editor?story_id=${ee.id}`,"_blank")}},[ee,M,T]);return(0,r.jsxs)(o.Z,{sx:{mb:4,width:"100%"},children:[I?(0,r.jsx)(s.Z,{variant:"h6",component:"h2",sx:{fontWeight:700,mb:2,color:"#E0E0E0"},children:I}):null,Z?(0,r.jsx)(l.ZP,{container:!0,spacing:2,children:Array.from({length:8},(e,t)=>(0,r.jsx)(l.ZP,{item:!0,xs:6,sm:4,md:4,lg:3,children:(0,r.jsx)(F,{})},`skeleton-${t}`))}):X.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.ZP,{container:!0,spacing:2,children:X.map(e=>(0,r.jsx)(l.ZP,{item:!0,xs:6,sm:4,md:4,lg:3,children:(0,r.jsx)(v.E,{story:e,id:e.id,title:e.title,thumbnail:e.last_export_thumbnail_url,createdAt:e.created_at,isOpenPreview:(null==L?void 0:L.id)===e.id,onOpenPreview:()=>ei(e),onExport:()=>ed(e.id),workflowRunId:H.get(e.id),onExportComplete:()=>el(e.id),isRebuilding:O.get(e.id)||!1,onDelete:()=>es(e.id),isDeleting:G.get(e.id)||!1})},e.id))}),!_&&(a||S)?(0,r.jsx)(o.Z,{ref:q,children:S?(0,r.jsx)(l.ZP,{container:!0,spacing:2,sx:{mt:2},children:Array.from({length:4},(e,t)=>(0,r.jsx)(l.ZP,{item:!0,xs:6,sm:4,md:4,lg:3,children:(0,r.jsx)(F,{})},`loading-skeleton-${t}`))}):null}):null,ee?(0,r.jsx)(f.z,{story:ee,open:P,onClose:er,workflowRunId:H.get(ee.id)||null,isRebuilding:O.get(ee.id)||!1,onDownload:ea,onExportComplete:()=>el(ee.id),shouldAutoDownload:P,canNavigateNext:L?L.id!==X.at(-1).id:null,canNavigatePrev:L?L.id!==X[0].id:null,onNext:en,onPrev:eo,onEdit:ec,onDelete:()=>es(ee.id),isDeleting:G.get(ee.id)||!1,showProfile:!1,canDelete:!0,useStoryPreviewPlayer:V,showVideoOutdatedHint:A}):null]}):(0,r.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8},children:[(0,r.jsx)(o.Z,{sx:{mb:2.5,display:"flex",justifyContent:"center"},children:(0,r.jsx)(g.b,{})}),(0,r.jsx)(s.Z,{variant:"body1",sx:{color:"#E0E0E0",mb:2.5,textAlign:"center",fontWeight:600,fontSize:"14px",lineHeight:"20px",maxWidth:"418px"},children:"Start your storytelling journey — create your first story!"}),(0,r.jsx)(m.l,{})]})]})}},33621:function(e,t,i){i.d(t,{i:function(){return k}});var r=i(52676),n=i(75271),o=i(22988),a=i(80110),s=i(29984),l=i(77379),d=i(64150),c=i(58069),u=i(6721),p=i(56407),h=i(7999),m=i(35600),x=i(97779),g=i(27806),f=i(52934),v=i(328),b=i(30117);let y={vlog:{creditType:"story.character_vlog",previewCreditType:"story.character_vlog.preview",defaultButtonText:"Create Full Video",defaultLoadingText:"Generating Story..."},script:{creditType:"story.script_to_video",previewCreditType:"story.script_to_video.preview",defaultButtonText:"Create Full Video",defaultLoadingText:"Generating Story..."},music_video:{creditType:"story.music_video",previewCreditType:"story.music_video.preview",defaultButtonText:"Create Full Video",defaultLoadingText:"Generating Story..."},asmr_video:{creditType:"story.asmr_video",previewCreditType:"story.asmr_video.preview",defaultButtonText:"Create Full Video",defaultLoadingText:"Generating ASMR..."}};function w(e){let{isGenerating:t,disabled:i,storyType:d,buttonText:c,loadingText:u,showCreditInfo:p,isPreview:h=!1,onClick:m,promoQuotaUI:g,typeConfig:f,sx:v,useMobileCardStyle:y=!1}=e,{isMobile:w}=(0,x.j)(),C=(0,n.useRef)(null),[j,k]=(0,n.useState)(1),F=(0,n.useMemo)(()=>{let e="script"===d?4:3;return h?"~1min":w?`~${e}min`:`~${e}min render, fully editable`},[d,h,w]);(0,n.useEffect)(()=>{if(!w||!C.current){k(1);return}let e=()=>{let e=C.current;e&&requestAnimationFrame(()=>{let t=e.offsetWidth,i=e.scrollWidth;i>t?k(Math.max(t/i*.95,.7)):k(1)})};e();let t=new ResizeObserver(e);return t.observe(C.current),()=>t.disconnect()},[w]);let S=(0,n.useMemo)(()=>p?(0,r.jsxs)(o.Z,{sx:{backgroundColor:w?"transparent":"#2E2E2E",borderRadius:1,py:{sm:0,md:.5},px:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:"script"===d?{xs:.25,sm:1}:1},children:[(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",gap:1,whiteSpace:"nowrap"},children:g}),(0,r.jsx)(a.Z,{sx:{fontFamily:"Inter",fontWeight:400,whiteSpace:"nowrap",fontSize:12,lineHeight:1,color:"#BFBFBF"},children:F})]}):null,[p,w,d,g,F]);return y?(0,r.jsxs)(o.Z,{onClick:i||t?void 0:m,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:1,p:.75,pl:2,height:70,borderRadius:"12px",backgroundColor:h?"rgba(255, 255, 255, 0.1)":"#3A3A3A",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(11.75px)",cursor:i||t?"not-allowed":"pointer",opacity:i||t?.6:1,transition:"all 0.2s ease","&:active":{transform:i||t?"none":"scale(0.98)"},...v},children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:.75,flex:1,minWidth:0},children:[(0,r.jsx)(a.Z,{sx:{fontFamily:"Inter",fontWeight:700,fontSize:16,lineHeight:"20px",color:"var(--Gray-900)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:h?"Preview Storyboard":"Get Full Video"}),(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:.75},children:[(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",gap:.5},children:g}),(0,r.jsx)(o.Z,{sx:{width:"1px",flexGrow:0,flexShrink:0,flexBasis:"1px",height:12,backgroundColor:"rgba(255, 255, 255, 0.15)"}}),(0,r.jsx)(a.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:13,lineHeight:"16px",color:"rgba(255, 255, 255, 0.5)",whiteSpace:"nowrap"},children:F})]})]}),(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:100,flex:"0 1 160px",height:58,borderRadius:"8px",backgroundColor:h?"rgba(255, 255, 255, 0.1)":"var(--Blue-500)",border:h?"1px solid rgba(255, 255, 255, 0.16)":"1px solid rgba(98, 144, 255, 0.6)"},children:t?(0,r.jsx)(s.Z,{size:20,sx:{color:"var(--Gray-900)"}}):(0,r.jsx)(a.Z,{sx:{fontFamily:"Inter",fontWeight:700,fontSize:18,lineHeight:"22px",color:"var(--Gray-900)"},children:"Create →"})})]}):(0,r.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:1,flex:1,...v},children:[(0,r.jsxs)(l.Z,{ref:C,variant:"primary",type:"submit",disabled:i||t,onClick:m,sx:{position:"relative",borderRadius:1,py:"script"===d?void 0:{sm:1,md:2.25},px:"script"===d?void 0:{sm:1,md:6},fontFamily:"Inter",fontWeight:700,fontSize:{sm:14,md:16},lineHeight:"script"===d?void 0:{sm:1,md:1.21},textTransform:"none",border:"none",whiteSpace:"nowrap",overflow:"hidden","&.MuiButton-root":{boxShadow:"none"},..."script"===d&&{height:44},...h&&{borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.16)",background:"rgba(255, 255, 255, 0.15)",boxShadow:"0 -4px 28.4px 0 rgba(0, 0, 0, 0.56)",backdropFilter:"blur(11.75px)","&:hover":{backgroundColor:"#2D3748"}}},startIcon:!w&&t?(0,r.jsx)(s.Z,{size:20,sx:{color:"#666666"}}):null,children:[w&&t?(0,r.jsx)(o.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",borderRadius:"inherit",zIndex:1},children:(0,r.jsx)(s.Z,{size:24,sx:{color:"#FFFFFF"}})}):null,(0,r.jsxs)(o.Z,{component:"span",sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5,...w&&j<1&&{transform:`scale(${j})`,transformOrigin:"center center"}},children:[(0,r.jsx)("span",{style:{position:"relative",top:w?4:0},children:t?u:`${c} →`}),(0,r.jsx)("span",{style:{display:w?"block":"none",transform:"scale(0.8)"},children:S})]}),h?(0,r.jsx)(b.S,{tagContent:"new",sx:{position:"absolute",right:4,transform:"unset",top:w?4:void 0}}):null]}),w?null:S]})}let C={};function j(e){let{isGenerating:t,disabled:i,activeButton:n,storyType:o,finalButtonText:a,finalLoadingText:s,showCreditInfo:l,typeConfig:d,promoQuotaUI:c,previewPromoQuotaUI:u,onFullClick:p,onPreviewClick:h,layout:m="bottom"}=e,{isMobile:g}=(0,x.j)(),f="dialog"===m;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w,{isGenerating:!!(t&&"preview"===n),disabled:i||t&&"full"===n,storyType:o,buttonText:"Preview Storyboard",loadingText:"Creating Preview...",showCreditInfo:l,isPreview:!0,onClick:h,promoQuotaUI:u,typeConfig:d,useMobileCardStyle:f,sx:"bottom"===m?{flexGrow:1,order:g?2:1,flexShrink:0}:void 0}),(0,r.jsx)(w,{isGenerating:!!(t&&"full"===n),disabled:i||t&&"preview"===n,storyType:o,buttonText:a,loadingText:s,showCreditInfo:l,isPreview:!1,onClick:p,promoQuotaUI:c,typeConfig:d,useMobileCardStyle:f,sx:"bottom"===m?{flexGrow:1,flexShrink:0,order:g?1:2}:void 0})]})}function k(e){var t,i;let{isGenerating:s=!1,disabled:b=!1,errors:w=C,storyType:k,buttonText:F,loadingText:S,containerSx:I,showCreditInfo:_=!0,numShots:Z=3,onCreateStory:A,onCreatePreview:E,promoQuotaUI:M,previewPromoQuotaUI:T}=e,{isMobile:R}=(0,x.j)(),[D,z]=(0,n.useState)(null),P=(0,n.useRef)(null),[W,L]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s||z(null)},[s]);let B=()=>{L(!1)};(0,n.useEffect)(()=>{if(W&&R){let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[W,R]);let H=y[k],$=f.v[H.creditType],O=f.v[H.previewCreditType],U="asmr_video"===k?600*Z:$.credit,G="asmr_video"===k?40*Z:O.credit,N=F||H.defaultButtonText,V=S||H.defaultLoadingText,[K]=(0,m.f)("story",{},{oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.PhCurrencyEth,{size:12,sx:{color:h.MK}}),(0,r.jsxs)(a.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:h.MK},children:[U," ",R?"":"credits"]})]}),newUI:(e,t,i)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.PhCurrencyEth,{size:12,sx:{color:h.MK}}),(0,r.jsxs)(a.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:{sm:"1em",md:"1.8em"},letterSpacing:"-0.02em",color:h.MK,textDecoration:"line-through"},children:[U," ",R?"":"credits"]}),(0,r.jsxs)(a.Z,{sx:{fontFamily:"Inter",fontWeight:"bold",fontSize:"12px",lineHeight:{sm:"0.8em",md:"1em"},color:"#BFBFBF"},children:[(0,r.jsx)("span",{style:{color:h.MK},children:t})," FREE Story Left"]})]}),upgradeDailyNewUI:null}),[q]=(0,m.f)("story",{},{disabled:!0,oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.PhCurrencyEth,{size:12,sx:{color:h.MK}}),(0,r.jsxs)(a.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:h.MK},children:[G," ",R?"":"credits"]})]}),newUI:(e,t,i)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.PhCurrencyEth,{size:12,sx:{color:h.MK}}),(0,r.jsxs)(a.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:h.MK},children:[G," ",R?"":"credits"]})]}),upgradeDailyNewUI:null});return(0,r.jsxs)(r.Fragment,{children:[R?(0,r.jsx)(d.Z,{in:!s,children:(0,r.jsxs)(l.Z,{variant:"primary",onClick:()=>{L(!0)},disabled:b,sx:{position:"fixed",bottom:80,left:"10px",right:"10px",width:"calc(100% - 20px)",zIndex:1e3,borderRadius:"12px",py:"14px",px:2,fontFamily:"Inter",fontWeight:700,fontSize:18,lineHeight:"24px",textTransform:"none",backgroundColor:"var(--Blue-500)",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px","&.MuiButton-root":{minWidth:"auto"},"&:hover":{backgroundColor:"var(--Blue-400)",boxShadow:"0px 0px 12px 0px rgba(0, 0, 0, 0.64), inset 0px 0px 10px 0px rgba(255, 255, 255, 0.5)"},"&:disabled":{backgroundColor:"var(--Gray-300)",boxShadow:"0px 0px 10px 0px rgba(0, 0, 0, 0.56)"}},children:[(0,r.jsx)(v.Z,{icon:"material-symbols:rocket-launch-rounded",width:24,height:24}),"Create now"]})}):null,R?(0,r.jsxs)(c.ZP,{anchor:"bottom",open:W,onClose:B,ModalProps:{slotProps:{backdrop:{sx:{background:"none",backgroundColor:"rgba(0, 0, 0, 0.8)",touchAction:"none"}}}},PaperProps:{sx:{borderTopLeftRadius:"16px",borderTopRightRadius:"16px",backgroundColor:"#242424"}},children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",p:2.5,pb:1.5},children:[(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(a.Z,{sx:{color:"var(--Gray-900)",fontSize:"20px",fontWeight:700,lineHeight:"24px",mb:1},children:"How would you like to create?"}),(0,r.jsx)(a.Z,{sx:{color:"var(--Gray-600)",fontSize:"13px",fontWeight:400,lineHeight:"16px"},children:"Credits depend on model selection and music length."})]}),(0,r.jsx)(u.Z,{onClick:B,sx:{width:24,height:24,color:"var(--Gray-900)",flexShrink:0},children:(0,r.jsx)(o.Z,{component:"span",sx:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:300},children:"✕"})})]}),(0,r.jsxs)(o.Z,{sx:{p:2,pt:1.5,pb:3,width:"100%"},children:[Object.keys(w).length>0&&(0,r.jsx)(a.Z,{variant:"caption",color:"error",sx:{mb:2,display:"block",backgroundColor:"#2A1A1A",color:"#FF6B6B",padding:"8px 12px",borderRadius:1,border:"1px solid #FF6B6B30"},children:(null===(t=Object.values(w)[0])||void 0===t?void 0:t.message)||"Please fix the errors above"}),(0,r.jsx)(p.Z,{spacing:1.5,children:(0,r.jsx)(j,{isGenerating:s,disabled:b,activeButton:D,storyType:k,finalButtonText:N,finalLoadingText:V,showCreditInfo:_,typeConfig:H,promoQuotaUI:M||K,previewPromoQuotaUI:T||q,onFullClick:()=>{z("full"),null==A||A()},onPreviewClick:()=>{z("preview"),null==E||E()},layout:"dialog"})})]})]}):null,(0,r.jsxs)(o.Z,{ref:P,sx:{position:R?"static":"sticky",bottom:R?void 0:0,left:0,right:0,display:"flex",flexDirection:"column",gap:1,pb:"script"===k?1:2,pt:2,px:"script"===k?0:2,mb:0,backgroundColor:"script"===k?"transparent":"#1A1A1A",borderTop:"1px solid #2E2E2E",..."script"!==k&&{boxShadow:"0 -4px 12px rgba(0, 0, 0, 0.3)"},zIndex:10,alignSelf:"stretch",...R&&{visibility:"hidden",pointerEvents:"none",height:"60px",maxHeight:"60px",overflow:"hidden"},...I},children:[Object.keys(w).length>0&&(0,r.jsx)(a.Z,{variant:"caption",color:"error",sx:{mb:1,display:"block",backgroundColor:"#2A1A1A",color:"#FF6B6B",padding:"8px 12px",borderRadius:1,border:"1px solid #FF6B6B30"},children:(null===(i=Object.values(w)[0])||void 0===i?void 0:i.message)||"Please fix the errors above"}),(0,r.jsx)(o.Z,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1.25},children:(0,r.jsx)(j,{isGenerating:s,disabled:b,activeButton:D,storyType:k,finalButtonText:N,finalLoadingText:V,showCreditInfo:_,typeConfig:H,promoQuotaUI:M||K,previewPromoQuotaUI:T||q,onFullClick:()=>{z("full"),null==A||A()},onPreviewClick:()=>{z("preview"),null==E||E()},layout:"bottom"})})]})]})}},7006:function(e,t,i){i.d(t,{Z:function(){return S}});var r=i(52676),n=i(75271),o=i(66266),a=i(77379),s=i(29984),l=i(22988),d=i(80110),c=i(39204),u=i(23638),p=i(8765),h=i(90145),m=i(14930),x=i(97792),g=i(72660),f=i(6721),v=i(56407),b=i(57672),y=function(e){let{open:t,onClose:i,onSelectMode:n}=e,o=(0,b.Z)(),s=(0,m.Z)(o.breakpoints.down("sm"));return(0,r.jsx)(x.Z,{open:t,onClose:i,maxWidth:!1,PaperProps:{sx:{backgroundColor:"#1A1A1A",border:"2px solid #2E2E2E",borderRadius:"16px",maxWidth:s?"90vw":"823px",width:"100%",maxHeight:s?"90vh":"561px",height:s?"auto":"561px",p:0,m:s?1:2}},sx:{"& .MuiBackdrop-root":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:(0,r.jsxs)(g.Z,{sx:{p:0,position:"relative"},children:[(0,r.jsx)(f.Z,{onClick:i,sx:{position:"absolute",top:16,right:16,width:30,height:30,backgroundColor:"#101010",color:"#CCCCCC",borderRadius:"24px",zIndex:1,"&:hover":{backgroundColor:"#202020"}},children:(0,r.jsx)(h.Z,{sx:{fontSize:10}})}),(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:s?"32px":"46px",py:s?4:"173px",width:"100%",height:"100%"},children:[(0,r.jsx)(d.Z,{variant:"h5",sx:{fontFamily:"Inter, sans-serif",fontWeight:500,fontSize:s?"20px":"24px",lineHeight:"19.16px",color:"#FFFFFF",textAlign:"center"},children:"Choose how you want to create"}),(0,r.jsxs)(v.Z,{direction:s?"column":"row",spacing:s?"24px":"46px",sx:{alignItems:"center",width:"100%",justifyContent:"center"},children:[(0,r.jsxs)(a.Z,{onClick:()=>n("list"),sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",width:s?"140px":"160px",height:"auto",backgroundColor:"transparent",border:"none",borderRadius:0,cursor:"pointer",textTransform:"none",p:2,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.04)",borderRadius:"8px"}},children:[(0,r.jsx)(l.Z,{sx:{width:s?"80px":"96px",height:s?"80px":"96px",backgroundColor:"#2E2E2E",borderRadius:"9.1px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:(0,r.jsx)(l.Z,{component:"img",src:"https://cdn.openart.ai/story/home/my/listViewIcon.png",alt:"List View",sx:{width:"100%",height:"100%",objectFit:"contain"}})}),(0,r.jsxs)(l.Z,{sx:{textAlign:"center"},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter, sans-serif",fontWeight:700,fontSize:s?"13px":"14.21px",lineHeight:"19.16px",color:"#FFFFFF",mb:"4px"},children:"Write & Generate"}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter, sans-serif",fontWeight:500,fontSize:s?"12px":"14px",lineHeight:"19.16px",color:"#AAAAAA"},children:"Storyboard"})]})]}),(0,r.jsxs)(a.Z,{onClick:()=>n("video-editor"),sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",width:s?"140px":"160px",height:"auto",backgroundColor:"transparent",border:"none",borderRadius:0,cursor:"pointer",textTransform:"none",p:2,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.04)",borderRadius:"8px"}},children:[(0,r.jsx)(l.Z,{sx:{width:s?"80px":"96px",height:s?"80px":"96px",backgroundColor:"#2E2E2E",borderRadius:"9.1px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:(0,r.jsx)(l.Z,{component:"img",src:"https://cdn.openart.ai/story/home/my/videoEditorIcon.png",alt:"Video Editor",sx:{width:"100%",height:"100%",objectFit:"contain"}})}),(0,r.jsxs)(l.Z,{sx:{textAlign:"center"},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter, sans-serif",fontWeight:700,fontSize:s?"13px":"14.21px",lineHeight:"19.16px",color:"#FFFFFF",mb:"4px"},children:"Upload & Edit"}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter, sans-serif",fontWeight:500,fontSize:s?"12px":"14px",lineHeight:"19.16px",color:"#AAAAAA"},children:"Timeline"})]})]})]})]})]})})},w=i(38262),C=i(18420),j=i(48867),k=i(97779),F=i(16585),S=function(e){let{title:t,titleNode:i,description:h,urlToJump:m,buttonText:x,isFromScratchCard:g,cardBg:f,cardMainImg:v,compactModeCardMainImg:b,hoverBagVideo:S,hoverTitle:I,hoverBagVideoPoster:_,isCompactMode:Z=!1}=e,{showModal:A}=(0,p.dd)(),E=(0,n.useRef)(null),M=(0,n.useRef)(null),[T,R]=(0,n.useState)(!1),D=(0,j.k)(),{isMobile:z,isTouchDevice:P}=(0,k.j)(),[W,L]=(0,n.useState)("idle"),[B,H]=(0,n.useState)(!1),[$,O]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!S||z||P)return;let e=()=>{"complete"===document.readyState&&H(!0)};if("complete"!==document.readyState)return window.addEventListener("load",e),()=>window.removeEventListener("load",e);e()},[S,z,P]);let U=(0,n.useCallback)(()=>{L("loading")},[]),G=(0,n.useCallback)(()=>{L("ready")},[]),N=(0,n.useCallback)(()=>{L("error"),console.error("Video failed to load:",S)},[S]);(0,n.useEffect)(()=>{let e=M.current;if(e&&B)return e.addEventListener("loadstart",U),e.addEventListener("canplaythrough",G),e.addEventListener("error",N),()=>{e.removeEventListener("loadstart",U),e.removeEventListener("canplaythrough",G),e.removeEventListener("error",N)}},[B,U,G,N]);let V=(0,n.useCallback)(async()=>{let e=M.current;if(e&&"ready"===W)try{e.currentTime>=e.duration-.5&&(e.currentTime=0),await e.play()}catch(e){console.error("Video play failed:",e)}},[W]),K=(0,n.useCallback)(()=>{let e=M.current;e&&e.pause()},[]);(0,n.useEffect)(()=>{z||P||(T?V():K())},[T,z,P,V,K]);let q=g||t.toLowerCase().includes("scratch")||(null==x?void 0:x.toLowerCase().includes("editor")),{createStoryAsync:Y,isLoading:X}=(0,C.no)(),J=(0,o.useRouter)(),Q=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"list";if(q)try{let t=await Y({title:"Untitled",category_id:"create_from_scratch"});(null==t?void 0:t.id)&&((0,F.B)("editor_opened",{story_id:t.id,opened_from:"story_create_card"}),window.open(`/story/editor?story_id=${t.id}&view=${e}`,"_blank"))}catch(e){console.error("Failed to create story:",e)}},ee=()=>{O(!0)},et=e=>{e.preventDefault(),e.stopPropagation(),q?D?ee():J.push("/signin?callbackUrl=/story/editor"):m.includes("music-video")?(window.history.replaceState({},"","/music-video"),A(w.B,{onClose:()=>{},closeCallback:()=>{let e=J.pathname;return window.history.replaceState({},"",e),Promise.resolve()}})):window.open(m,"_blank")},ei=(0,r.jsx)(a.Z,{disabled:X,onClick:et,variant:"contained",sx:{bgcolor:"#013FFE",color:"#FFFFFF",borderRadius:"6px",py:"10px",px:"12px",width:"100%",height:"40px",textTransform:"none",fontFamily:"Inter, sans-serif",fontWeight:q?600:700,fontSize:"16px",lineHeight:"19.36px",display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",flexShrink:0,"&:hover":{bgcolor:"#0035E0"}},startIcon:X?(0,r.jsx)(s.Z,{size:20}):void 0,children:x||"Create"});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(c.E.a,{title:t,ref:E,href:m,variants:{initial:{scale:1},hover:{scale:z||P?1:1.02,transition:{type:"spring",stiffness:600,damping:25,duration:.1}}},initial:"initial",whileHover:z||P||Z?void 0:"hover",onHoverStart:z||P||Z?void 0:()=>{z||P||(R(!0),q||J.prefetch(m))},onHoverEnd:z||P||Z?void 0:()=>{z||P||R(!1)},onClick:et,style:{position:"relative",width:"100%",minHeight:Z?"200px":"280px",height:Z?"200px":"100%",borderRadius:"12px",border:"1px solid #2E2E2E",overflow:"hidden",cursor:"pointer"},children:[(0,r.jsxs)(c.E.div,{variants:{initial:{opacity:1,y:0},hover:{opacity:!S||z||P?1:0,y:!S||z||P?0:-5,transition:{duration:.12,ease:"easeOut"}}},initial:"initial",animate:!T||z||P?"initial":"hover",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",zIndex:1,overflow:"hidden"},children:[f,(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",transformStyle:"preserve-3d"},children:Z&&b?b:v}),!T&&!Z&&(0,r.jsx)(a.Z,{variant:"contained",color:"inherit",onClick:et,sx:{position:"absolute",bottom:"15px",width:"70%",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"#343434",boxShadow:"0px 4px 4px 0px rgba(0, 0, 0, 0.25)",borderRadius:"6px",color:"#FFFFFF",fontWeight:700,"&:hover":{bgcolor:"#343434"}},children:q?"Open Editor":"Create"})]}),(0,r.jsx)(c.E.div,{variants:{initial:{opacity:1,y:0},hover:{opacity:1,y:0,transition:{duration:.12,ease:"easeOut"}}},initial:"initial",animate:!T||z||P?"initial":"hover",style:{position:"absolute",top:Z?"unset":0,bottom:Z?"18px":"auto",left:0,width:"100%",zIndex:3,padding:Z?0:q?"20px":"16px",paddingBottom:0},children:(0,r.jsx)(d.Z,{variant:"subtitle1",component:"h3",sx:{fontWeight:Z?700:q?600:700,fontSize:Z?"15px":"20px",lineHeight:Z?"24px":"19.36px",color:Z?"var(--Gray-900)":"#E0E0E0",mb:Z?0:"4px",textAlign:Z?"center":"left",whiteSpace:Z?"nowrap":"normal"},children:Z?t:i||t})}),h&&!Z?(0,r.jsx)(c.E.div,{variants:{initial:{opacity:1,y:0},hover:{opacity:!S||z||P?1:0,y:!S||z||P?0:-5,transition:{duration:.12,ease:"easeOut"}}},initial:"initial",animate:!T||z||P?"initial":"hover",style:{position:"absolute",top:q?"60px":"56px",left:0,width:"100%",zIndex:3,padding:q?"0 20px":"0 16px"},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{fontWeight:500,fontSize:"12px",lineHeight:"18px",color:"rgba(255, 255, 255, 0.3)"},children:h})}):null,S&&!z&&!P&&B?(0,r.jsx)(c.E.div,{variants:{initial:{opacity:0,scale:1.03},hover:{opacity:1,scale:1,transition:{duration:.15,ease:"easeOut"}}},initial:"initial",animate:T?"hover":"initial",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"12px",overflow:"hidden",zIndex:1},children:(0,r.jsx)("video",{ref:M,muted:!0,loop:!0,poster:_,playsInline:!0,preload:"metadata",style:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.2s ease-in-out"},children:(0,r.jsx)("source",{src:S,type:"video/mp4"})})}):null,(0,r.jsx)(u.M,{children:!T||z||P||Z?null:(0,r.jsxs)(c.E.div,{variants:{initial:{opacity:0,y:15,scale:.96},hover:{opacity:1,y:0,scale:1,transition:{duration:.15,ease:"easeOut",delay:.05}}},initial:"initial",animate:"hover",exit:"initial",style:{position:"absolute",bottom:0,left:0,right:0,zIndex:2,padding:q?"20px":"16px",display:"flex",flexDirection:"column",gap:I?"12px":"0"},children:[I?(0,r.jsx)("div",{style:{marginBottom:"8px"},children:I}):null,ei]})})]}),(0,r.jsx)(y,{open:$,onClose:()=>{O(!1)},onSelectMode:e=>{O(!1),(0,F.B)("create_from_scratch_clicked",{to_view:"list"===e?"all-shots":"video-editor"}),Q(e)}})]})}},97708:function(e,t,i){i.d(t,{B:function(){return d}});var r=i(52676),n=i(22988),o=i(80110),a=i(19509),s=i(36772),l=i(7006);function d(e){let{cards:t,title:i,showEditorAccessCards:d=!1,useCompactLayout:c=!1}=e,u=(()=>{let e=t.length;return 0===e?12:12/(e+(d?1:0))})();return(0,r.jsxs)(n.Z,{sx:{width:"100%"},children:[i?(0,r.jsx)(o.Z,{variant:"h6",component:"h2",sx:{fontFamily:"Inter, sans-serif",fontWeight:700,fontSize:"16px",lineHeight:"19.36px",mb:2,color:"#E0E0E0"},children:i}):null,(0,r.jsxs)(a.ZP,{container:!0,spacing:c?1:2,sx:{"& .MuiGrid-item":{display:"flex"}},children:[t.map((e,t)=>(0,r.jsx)(a.ZP,{item:!0,xs:c?6:12,sm:6,md:c?6:u,lg:c?6:u,xl:c?6:u,sx:{display:"flex","& > *":{width:"100%",height:"100%",minHeight:c?"unset":"246px"}},children:e.component||(0,r.jsx)(l.Z,{title:e.title,titleNode:e.titleNode,description:e.description,cardBg:e.cardBg,cardMainImg:e.cardMainImg,compactModeCardMainImg:e.compactModeCardMainImg,urlToJump:e.urlToJump,buttonText:e.buttonText,hoverBagVideo:e.hoverBagVideo,hoverBagVideoPoster:e.hoverBagVideoPoster,hoverTitle:e.hoverTitle,isCompactMode:c})},e.title)),d?(0,r.jsx)(a.ZP,{item:!0,xs:12,sm:12,md:u,lg:u,xl:u,sx:{display:"flex","& > *":{width:"100%",height:"100%",minHeight:"246px"}},children:(0,r.jsx)(s.Y,{layout:"vertical"})}):null]})]})}},56541:function(e,t,i){i.d(t,{m:function(){return r2}});var r=i(52676),n=i(75271),o=i(66266),a=i(22972),s=i(22988),l=i(77379),d=i(80110),c=i(92204),u=i(56407),p=i(66425),h=i(97779);function m(e){let{sx:t,icon:i,title:n,rightSide:o,titleHelp:a}=e,{isMobile:l}=(0,h.j)();return(0,r.jsxs)(u.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch",gap:l?1:2,sx:{overflowX:"auto",overflowY:"hidden",whiteSpace:"nowrap",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},...t},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,color:"#CCCCCC"},children:[i,n?(0,r.jsx)(d.Z,{className:"row-selection-title",sx:{fontWeight:500,fontSize:"16px",lineHeight:"1.5em",color:"#CCCCCC",whiteSpace:"nowrap"},children:n}):null,a?(0,r.jsx)(s.Z,{sx:{display:"inline-flex",ml:.5},children:a}):null]}),(0,r.jsx)(s.Z,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:o})]})}function x(e){let{showIcon:t=!0,iconSize:i=20,sx:n,value:o,onChange:a,aspectRatioOptions:l=["16:9","9:16"]}=e,{isMobile:c}=(0,h.j)(),u=(e,t,i)=>{let n=o===e;return(0,r.jsx)(s.Z,{onClick:()=>a(e),sx:{display:"flex",flexGrow:c?1:0,flexBasis:c?0:"auto",alignItems:"center",justifyContent:"center",gap:c?"8px":"1.03px",padding:c?"10px 2.059px":"2.06px",width:c?"auto":"99.84px",minWidth:c?"1px":"auto",height:c?"auto":"28.82px",backgroundColor:c&&n?"#333333":"var(--Gray-50)",border:c?"none":o===e?"2px solid var(--Blue-600)":"none",borderRadius:c?1:"5.15px",cursor:"pointer",boxSizing:"border-box",transition:"all 0.2s ease",WebkitTapHighlightColor:"transparent","@media (hover: hover)":{"&:hover":{backgroundColor:"#111111"}},"&:active":{opacity:.8}},children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{sx:{width:t,height:i,backgroundColor:n?"var(--Gray-900)":"var(--Gray-200)",borderRadius:"2px",flexShrink:0,transition:"all 0.2s ease"}}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"14px",lineHeight:"20px",letterSpacing:"-0.02em",color:"var(--Gray-900)",flexShrink:0,whiteSpace:"nowrap",transition:"all 0.2s ease",userSelect:"none"},children:e})]}):(0,r.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"3.83px",padding:"0px 7.66px",width:"95.73px",height:"22.97px",backgroundColor:"transparent",borderRadius:"3.83px",boxSizing:"border-box"},children:[(0,r.jsx)(s.Z,{sx:{width:t,height:i,backgroundColor:"var(--Gray-200)",borderRadius:"9:16"===e?"1.46px":"1.81px"}}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.67em",letterSpacing:"-0.02em",color:o===e?"var(--Gray-900)":"#C6C6C6"},children:e})]})},e)};return(0,r.jsx)(m,{icon:t?(0,r.jsx)(p.Z,{sx:{color:"#CCCCCC",fontSize:i}}):null,title:"Aspect Ratio",rightSide:(0,r.jsx)(s.Z,{sx:{display:"flex",gap:c?"8px":1,width:c?"100%":"auto",...c&&{backgroundColor:"#0a0a0a",padding:"8px",borderRadius:"12px",boxShadow:"0px 4px 16px 0px rgba(0, 0, 0, 0.25)"}},children:l.map(e=>{let[t,i]=e.split(":").map(Number);return 1===t&&1===i?u(e,"12px","12px"):16===t&&9===i?u(e,"20px","12px"):9===t&&16===i?u(e,"12px","20px"):u(e,`${t}px`,`${i}px`)})}),isMobile:c,sx:{...n,flexDirection:c?"column":"row",justifyContent:c?"flex-start":"space-between",alignItems:c?"stretch":"center"}})}var g=i(47284),f=i(79720),v=i(72755),b=i(10193),y=i(49568),w=i(85707),C=i(45586),j=i(98919),k=i(43517),F=i(35327),S=i(89151),I=i(68409),_=i(46890),Z=i(97792),A=i(72660),E=i(6721),M=i(29984),T=i(90946),R=i(77913),D=i(91139),z=i(35600),P=i(49049),W=i(28989);function L(e){let{onChange:t,onUploadStart:o,onUploadError:a,open:c=!1,onClose:p,enableTrimming:h=!1,minDuration:m=10,maxDuration:x=60,preselectedFile:g=null,maxFileSize:f=26214400}=e,[v,b]=(0,n.useState)(null),[y,w]=(0,n.useState)(!1),[C,j]=(0,n.useState)("upload"),[k,F]=(0,n.useState)(null),[T,L]=(0,n.useState)(!1),[H,$]=(0,n.useState)(0),[O,U]=(0,n.useState)(0),[G,N]=(0,n.useState)(0),[V,K]=(0,n.useState)(0),[q,Y]=(0,n.useState)([]),[X,J]=(0,n.useState)([]),[Q,ee]=(0,n.useState)(0),[et,ei]=(0,n.useState)(""),er=(0,n.useRef)(null),en=(0,n.useRef)(null),eo=(0,n.useRef)(null),ea=(0,n.useRef)(),es=(0,n.useRef)(null),el=(0,n.useRef)(!0),{uploadFile:ed,isUploading:ec}=(0,P.k)({cdnFolder:"storybuilder/soundtracks"}),{hasStoryQuota:eu,campaignIsActive:ep}=(0,z.ku)(),{shouldShowBanner:eh,isSubscriptionActive:em}=(0,D.R)(),ex=ep&&eh&&eu,eg=ex&&!em?R.N6:x,ef=(0,n.useCallback)(e=>{if(!e.type.startsWith("audio/"))return{isValid:!1,errorMessage:"Please select a valid audio file"};let t=e.name.toLowerCase();if(![".mp3",".wav",".m4a",".aac",".ogg",".flac",".wma"].some(e=>t.endsWith(e)))return{isValid:!1,errorMessage:"Please select a valid audio file (.mp3, .wav, .m4a, .aac, .ogg, .flac, .wma)"};if(e.size>f){let e=Math.round(f/1024/1024);return{isValid:!1,errorMessage:`Audio file size must be ${e}MB or less`}}return{isValid:!0}},[f]),ev=(0,n.useCallback)(e=>{let t=e.getChannelData(0),i=Math.floor(t.length/1e3),r=[];for(let e=0;e<1e3;e++){let n=i*e,o=0;for(let e=0;e<i;e++)o+=Math.abs(t[n+e]);r.push(o/i)}let n=Math.max(...r);return r.map(e=>e/n)},[]),eb=(0,n.useCallback)(()=>{if(0===q.length||0===Q){J([]);return}let e=Math.floor((Q-0)/4);if(q.length<=e)J(q);else{let t=[],i=q.length/e;for(let r=0;r<e;r++){let e=Math.floor(r*i);t.push(q[e])}J(t)}},[q,Q]),ey=(0,n.useCallback)(()=>{if(es.current){let e=es.current.getBoundingClientRect().width;e>0&&ee(e)}},[]),ew=(0,n.useCallback)(e=>Math.round(1e3*e)/1e3,[]),eC=(0,n.useCallback)((e,t)=>{let i=ew(e),r=ew(t),n=Math.max(0,Math.min(i,O)),o=Math.max(0,Math.min(r,O)),a=o-n;a>eg&&(a=(o=ew(Math.min(O,n+eg)))-n),a>=m&&a<=eg&&(N(n),K(o),et&&ei(""))},[O,eg,m,et,ew]),ej=(0,n.useCallback)(e=>{let t=V-G,i=G+e,r=i+t;r=(i=Math.max(0,Math.min(O-t,i)))+t,eC(i,r)},[G,V,O,eC]),ek=(0,n.useCallback)(e=>{K(Math.max(G+m,Math.min(Math.min(O,G+eg),V+e)))},[V,G,m,eg,O]),eF=(0,n.useCallback)((e,t)=>i=>{var r;i.preventDefault();let n=null===(r=i.currentTarget.parentElement)||void 0===r?void 0:r.getBoundingClientRect();if(!n)return;let o=i=>{i.preventDefault();let{newTrimStart:r,newTrimEnd:o}=t(("touches"in i?i.touches[0].clientX:i.clientX)-n.left-10,n.width-20);if("start"===e&&void 0!==r){let e=V-10;N(Math.max(Math.max(0,V-eg),Math.min(e,r)))}else"end"===e&&void 0!==o?K(Math.max(G+10,Math.min(Math.min(O,G+eg),o))):"area"===e&&void 0!==r&&void 0!==o&&eC(r,o)},a=()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",a),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",a)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",a),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",a)},[G,V,O,eC,eg]),eS=(0,n.useMemo)(()=>eF("start",(e,t)=>({newTrimStart:ew(Math.max(0,Math.min(1,e/t))*O)})),[eF,O,ew]),eI=(0,n.useMemo)(()=>eF("end",(e,t)=>({newTrimEnd:ew(Math.max(0,Math.min(1,e/t))*O)})),[eF,O,ew]),e_=(0,n.useCallback)(e=>{var t;e.preventDefault();let i=null===(t=e.currentTarget.parentElement)||void 0===t?void 0:t.getBoundingClientRect();if(!i)return;let r="touches"in e?e.touches[0].clientX:e.clientX,n=V-G,o=e=>{e.preventDefault();let t=ew(G+(("touches"in e?e.touches[0].clientX:e.clientX)-r)/(i.width-20)*O),o=ew(t+n);o=ew((t=Math.max(0,Math.min(O-n,t)))+n),eC(t,o)},a=()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",a),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",a)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",a),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",a)},[G,V,O,eC,ew]),eZ=(0,n.useCallback)(e=>{var t;e.preventDefault();let i=null===(t=es.current)||void 0===t?void 0:t.getBoundingClientRect();if(!i)return;en.current&&en.current.pause(),L(!1),ea.current&&cancelAnimationFrame(ea.current);let r=e=>{e.preventDefault();let t=ew(Math.max(0,Math.min(1,(("touches"in e?e.touches[0].clientX:e.clientX)-i.left-10)/(i.width-20)))*O);$(t),en.current&&(en.current.currentTime=t)},n=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",n),document.removeEventListener("touchmove",r),document.removeEventListener("touchend",n)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",n),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("touchend",n)},[O,ew]),eA=(0,n.useCallback)(async e=>{try{eo.current||(eo.current=new(window.AudioContext||window.webkitAudioContext));let t=await e.arrayBuffer(),i=await eo.current.decodeAudioData(t);return{duration:i.duration,sampleRate:i.sampleRate,numberOfChannels:i.numberOfChannels,fileSize:e.size,mimeType:e.type,bitrate:Math.round(8*e.size/i.duration/1e3)}}catch(t){return console.error("Error extracting audio metadata:",t),{duration:0,sampleRate:0,numberOfChannels:0,fileSize:e.size,mimeType:e.type}}},[]),eE=(0,n.useCallback)(async e=>{try{eo.current||(eo.current=new(window.AudioContext||window.webkitAudioContext));let t=await e.arrayBuffer(),i=await eo.current.decodeAudioData(t),r=URL.createObjectURL(e),n={duration:i.duration,sampleRate:i.sampleRate,numberOfChannels:i.numberOfChannels,fileSize:e.size,mimeType:e.type,bitrate:Math.round(8*e.size/i.duration/1e3)},o=ev(i);Y(o),U(i.duration);let a=ex?R.N6:30;if(i.duration<=eg){if(ex&&i.duration>R.N6){let e=R.N6,t=(i.duration-e)/2,r=ew(Math.max(0,t)),n=ew(r+e);N(r),K(n)}else N(0),K(ew(i.duration))}else{let e=Math.min(a,eg),t=(i.duration-e)/2,r=ew(Math.max(0,t)),n=ew(r+e);N(r),K(n)}return{file:e,audioBuffer:i,audioUrl:r,metadata:n}}catch(e){throw console.error("Error processing audio file:",e),e}},[ev,ex,eg,ew]),eM=(0,n.useCallback)(()=>{en.current&&T&&($(en.current.currentTime),ea.current=requestAnimationFrame(eM))},[T]),eT=(0,n.useCallback)(()=>{if(en.current){if(T)en.current.pause(),L(!1),ea.current&&cancelAnimationFrame(ea.current);else{let e=Math.max(0,Math.min(O||1/0,H));!Number.isNaN(e)&&Number.isFinite(e)&&(en.current.currentTime=e),el.current=e>=G&&e<=V,en.current.play(),L(!0),eM()}}},[T,H,O,eM]),eR=(0,n.useCallback)(()=>{L(!1),ea.current&&cancelAnimationFrame(ea.current)},[]),eD=(0,n.useCallback)(()=>{en.current&&($(en.current.currentTime),el.current&&en.current.currentTime>=V&&(en.current.pause(),L(!1),ea.current&&cancelAnimationFrame(ea.current)))},[V]),ez=(0,n.useCallback)(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),eP=(0,n.useCallback)(async()=>{if(!k||!eo.current)throw Error("Audio data not available");let{audioBuffer:e,file:t}=k,i=e.sampleRate,r=Math.floor(G*i),n=Math.floor(V*i)-r,o=eo.current.createBuffer(e.numberOfChannels,n,i);for(let t=0;t<e.numberOfChannels;t++){let i=e.getChannelData(t),a=o.getChannelData(t);for(let e=0;e<n;e++)a[e]=i[r+e]}let a=o.length,s=new ArrayBuffer(2*a),l=new DataView(s),d=o.getChannelData(0);for(let e=0;e<a;e++){let t=Math.max(-1,Math.min(1,d[e]));l.setInt16(2*e,32767*t,!0)}let c=new Blob([eL(s,i)],{type:"audio/wav"}),u=t.name.replace(/\.[^/.]+$/,"");return new File([c],`${u}_trimmed.wav`,{type:"audio/wav"})},[k,G,V]),eW=(0,n.useCallback)(async()=>{if(!k)throw Error("Audio data not available");let{file:e}=k;try{var t,r;let{FFmpeg:n}=await Promise.resolve().then(i.bind(i,52846)),{fetchFile:o}=await Promise.resolve().then(i.bind(i,75635)),a=new n;a.on("log",e=>{let{message:t}=e}),await a.load();let s=(null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase())||"mp3",l=e.type||"audio/mpeg",d=s,c=l,u=`input_${Date.now()}.${s}`,p=`output_${Date.now()}.${s}`,h=await o(e);await a.writeFile(u,h);let m=Math.max(.01,Number((V-G).toFixed(3)));await a.exec(["-i",u,"-ss",m?G.toFixed(3):G.toString(),"-t",m.toFixed(3),"-map","0:a:0","-c","copy",p]);let x=await a.readFile(p);if(!x||0===x.byteLength){console.warn("FFmpeg produced empty output after trimming. Retrying with re-encode.");try{await a.deleteFile(p)}catch{}let e=null==k?void 0:null===(r=k.metadata)||void 0===r?void 0:r.bitrate,t=((e,t)=>{let i=Math.min(320,Math.max(96,t||192)),r=`${i}k`;switch(e){case"mp3":return{args:["-c:a","libmp3lame","-b:a",r]};case"m4a":case"aac":return{args:["-c:a","aac","-b:a",r,"-movflags","+faststart"]};case"ogg":case"oga":return{args:["-c:a","libvorbis","-q:a",String(i<=128?3:i<=160?4:i<=196?5:i<=224?6:7)]};case"wav":return{args:["-c:a","pcm_s16le"]};case"flac":return{args:["-c:a","flac"]};default:return{args:["-c:a","libmp3lame","-b:a","192k"],newExt:"mp3",newMime:"audio/mpeg"}}})(s,e);if(t.newExt&&(d=t.newExt),t.newMime&&(c=t.newMime),await a.exec(["-i",u,"-ss",m?G.toFixed(3):G.toString(),"-t",m.toFixed(3),"-vn","-map","0:a:0",...t.args,p]),!(x=await a.readFile(p))||0===x.byteLength){console.warn("Re-encode also produced empty output. Falling back to WAV.");try{await a.deleteFile(u)}catch{}try{await a.deleteFile(p)}catch{}return await eP()}}await a.deleteFile(u),await a.deleteFile(p);let g=new Blob([x],{type:c}),f=e.name.replace(/\.[^/.]+$/,"");return new File([g],`${f}_trimmed.${d}`,{type:c})}catch(e){return console.error("Failed to trim audio with FFmpeg, falling back to WAV conversion:",e),await eP()}},[k,G,V,eP]),eL=(e,t)=>{let i=e.byteLength,r=new ArrayBuffer(44+i),n=new DataView(r),o=(e,t)=>{for(let i=0;i<t.length;i++)n.setUint8(e+i,t.codePointAt(i)||0)};o(0,"RIFF"),n.setUint32(4,36+i,!0),o(8,"WAVE"),o(12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,t,!0),n.setUint32(28,2*t,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),o(36,"data"),n.setUint32(40,i,!0);let a=new Uint8Array(e);return new Uint8Array(r,44).set(a),r},eB=(0,n.useCallback)(async e=>{let t=ef(e);if(!t.isValid){console.warn(t.errorMessage),(0,W.cB)(t.errorMessage),null==a||a({message:t.errorMessage});return}b(e),h&&(F(await eE(e)),j("trimming"))},[h,eE,ef,a]),eH=async e=>{let t=e.target.files;if(t&&t.length>0){let i=t[0],r=ef(i);r.isValid?eB(i):(console.warn(r.errorMessage),(0,W.cB)(r.errorMessage),null==a||a({message:r.errorMessage}),e.target.value="")}},e$=()=>{b(null),w(!1),j("upload"),F(null),ei(""),en.current&&(en.current.pause(),L(!1)),document.removeEventListener("keydown",eV),"trimming"!==C&&(null==p||p())},[eO,eU]=(0,n.useState)(!1),eG=async()=>{if(v){let e;if(ei(""),"trimming"===C&&k){let e=V-G;if(e<m){ei(`Trimmed audio must be at least ${m} seconds long. Current duration: ${ez(e)}`);return}if(ew(e)>eg){ei(`Trimmed audio must be no longer than ${eg} seconds. Current duration: ${ez(e)}`);return}}let t=v;if(eU(!0),"trimming"===C&&k){let i=ew(V-G);0===ew(G)&&i===ew(O)?e=k.metadata:(t=await eW(),e={...k.metadata,duration:i,fileSize:t.size,mimeType:t.type,bitrate:Math.round(8*t.size/i/1e3)})}else if(k)e=k.metadata;else try{e=await eA(v)}catch(t){console.error("Error extracting metadata for direct upload:",t),e={duration:0,sampleRate:0,numberOfChannels:0,fileSize:v.size,mimeType:v.type}}await eN(t,e)}},eN=async(e,i)=>{null==o||o();try{let r=await ed(e);eU(!1);let n=i||{duration:0,sampleRate:0,numberOfChannels:0,fileSize:e.size,mimeType:e.type};t(r.url,e.name,n),e$()}catch(e){eU(!1),console.error("Upload failed:",e),null==a||a(e)}};(0,n.useEffect)(()=>()=>{ea.current&&cancelAnimationFrame(ea.current),(null==k?void 0:k.audioUrl)&&URL.revokeObjectURL(k.audioUrl)},[k]),(0,n.useEffect)(()=>{eb()},[eb]),(0,n.useEffect)(()=>{let e=()=>{ey()};return"trimming"===C&&ey(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[ey,C]),(0,n.useEffect)(()=>{if("trimming"===C){let e=null,t=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(es.current){let r=es.current.getBoundingClientRect();r.width>0?(ee(r.width),e||(e=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.width;e>0&&ee(e)}})).observe(es.current)):i<10&&setTimeout(()=>t(i+1),10*(i+1))}else i<10&&setTimeout(()=>t(i+1),10*(i+1))};return t(),()=>{e&&e.disconnect()}}},[C]);let eV=(0,n.useCallback)(e=>{if("trimming"===C&&k)switch(e.code){case"Space":e.preventDefault(),eT();break;case"ArrowLeft":e.preventDefault(),ej(-(e.shiftKey?5:e.ctrlKey||e.metaKey?.1:1));break;case"ArrowRight":e.preventDefault(),ej(e.shiftKey?5:e.ctrlKey||e.metaKey?.1:1);break;case"ArrowUp":e.preventDefault(),ek(e.shiftKey?5:e.ctrlKey||e.metaKey?.1:1);break;case"ArrowDown":e.preventDefault(),ek(-(e.shiftKey?5:e.ctrlKey||e.metaKey?.1:1))}},[C,k,eT,G,V,O,eg,m]);(0,n.useEffect)(()=>{if(c&&"trimming"===C)return document.addEventListener("keydown",eV),()=>{document.removeEventListener("keydown",eV)}},[c,C,eV]),(0,n.useEffect)(()=>{en.current&&"trimming"===C&&(en.current.pause(),L(!1),ea.current&&cancelAnimationFrame(ea.current))},[G,C]),(0,n.useEffect)(()=>{c&&g?eB(g):c&&!g&&j("upload")},[c,g,eB]);let eK=V-G,eq="trimming"===C?535:444;return(0,r.jsxs)(r.Fragment,{children:[ec?(0,r.jsx)(s.Z,{sx:{position:"absolute",bottom:0,left:0,right:0},children:(0,r.jsx)(_.Z,{sx:{height:2,borderRadius:"0 0 6px 6px","& .MuiLinearProgress-bar":{backgroundColor:"#2F66FF"}}})}):null,(0,r.jsx)(Z.Z,{open:c,onClose:(e,t)=>{eO&&"backdropClick"===t||e$()},maxWidth:"md",fullWidth:!0,sx:{"& .MuiDialog-paper":{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"trimming"===C?"8px":"11px",padding:"16px 20px",width:eq,maxWidth:"90vw",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}},children:(0,r.jsxs)(A.Z,{sx:{padding:0},children:[(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.21em",color:"#FFFFFF",textAlign:"left",mb:2},children:["upload"===C?"Upload Your Song":"Select a Song Segment"," ",(0,r.jsx)("span",{style:{fontSize:"0.75em",fontWeight:400,color:"rgb(153, 153, 153)"},children:"upload"===C?"(Up to 25 MB)":"(Up to 5 minutes)"})]}),"upload"===C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Z,{sx:{mb:2},children:[(0,r.jsx)(s.Z,{onClick:()=>{var e;null===(e=er.current)||void 0===e||e.click()},onDragOver:e=>{var t;if(e.preventDefault(),!((null===(t=e.dataTransfer.items)||void 0===t?void 0:t.length)&&Array.from(e.dataTransfer.items).some(e=>e.type.startsWith("audio/")))){e.dataTransfer.dropEffect="none";return}w(!0)},onDragEnter:e=>{e.preventDefault()},onDragLeave:()=>{w(!1)},onDrop:e=>{e.preventDefault(),w(!1);let t=e.dataTransfer.files;if(0===t.length)return;let i=t[0],r=ef(i);r.isValid?eB(i):(console.warn(r.errorMessage),(0,W.cB)(r.errorMessage),null==a||a({message:r.errorMessage}))},sx:{backgroundColor:"#101010",border:y?"1px dashed #2F66FF":"1px dashed #2E2E2E",borderRadius:"8px",height:101,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",mb:1,transition:"border-color 0.2s ease","&:hover":{borderColor:"#444444"}},children:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"1.57em",color:v?"#2F66FF":"#E0E0E0",textAlign:"center",whiteSpace:"pre-wrap",px:2},children:v?`Selected: ${v.name}`:y?"Drop your audio file here":(0,r.jsxs)(r.Fragment,{children:["Drag and drop audio file here,",(0,r.jsx)("br",{}),"or ",(0,r.jsx)("span",{style:{textDecoration:"underline"},children:"select a file"})]})})}),ex?(0,r.jsx)(B,{style:{mb:1.5}}):null,(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:11,lineHeight:"1.67em",color:"#888888"},children:"Music videos support up to 5 minutes — you can trim after upload. Your song remains private unless you choose to publish it later."})]}),(0,r.jsx)("input",{ref:er,type:"file",accept:".mp3,.wav,.m4a,.aac,.ogg,.flac,.wma",style:{display:"none"},onChange:eH})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Z,{sx:{backgroundColor:"#101010",borderRadius:"7px",padding:"16px",mb:2,position:"relative",overscrollBehavior:"contain"},children:[(0,r.jsx)(u.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{width:"100%"},children:(0,r.jsxs)(s.Z,{sx:{flex:1,height:63,m:2,position:"relative",overflow:"visible",touchAction:"none"},children:[(0,r.jsx)(s.Z,{ref:es,sx:{display:"flex",alignItems:"center",justifyContent:"center",py:"10px",gap:"2px",height:"100%",backgroundColor:"#1856D0",borderRadius:"8px"},children:X.map((e,t)=>{let i=t/X.length>=G/O&&t/X.length<=V/O,n=t/X.length*O,o=i&&H>=n;return(0,r.jsx)(s.Z,{sx:{flex:"0 0 2px",width:2,height:`${Math.max(100*e,5)}%`,backgroundColor:i?o?"#FFFFFF":"#B8D4FF":"rgba(255, 255, 255, 0.3)",borderRadius:"1px"}},t)})}),(0,r.jsxs)(s.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none"},children:[(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,left:0,bottom:0,width:`${G/O*100}%`,backgroundColor:"rgba(0, 0, 0, 0.6)"}}),(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,right:0,bottom:0,width:`${(O-V)/O*100}%`,backgroundColor:"rgba(0, 0, 0, 0.6)"}})]}),(0,r.jsx)(s.Z,{onMouseDown:eS,onTouchStart:eS,sx:{position:"absolute",top:0,bottom:0,left:`${G/O*100}%`,width:3,backgroundColor:"#FFFFFF",cursor:"ew-resize",zIndex:10,touchAction:"none","&::before":{content:'""',position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:12,height:12,backgroundColor:"#FFFFFF",borderRadius:"50%",border:"2px solid #1856D0"},"&:hover::before":{backgroundColor:"#F0F0F0"}}}),(0,r.jsx)(s.Z,{onMouseDown:eI,onTouchStart:eI,sx:{position:"absolute",top:0,bottom:0,right:`${(O-V)/O*100}%`,width:3,backgroundColor:"#FFFFFF",cursor:"ew-resize",zIndex:10,touchAction:"none","&::before":{content:'""',position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:12,height:12,backgroundColor:"#FFFFFF",borderRadius:"50%",border:"2px solid #1856D0"},"&:hover::before":{backgroundColor:"#F0F0F0"}}}),(0,r.jsx)(s.Z,{onMouseDown:e_,onTouchStart:e_,sx:{position:"absolute",top:0,bottom:0,left:`calc(${G/O*100}% + 6px)`,width:`calc(${(V-G)/O*100}% - 12px)`,cursor:"move",zIndex:8,backgroundColor:"transparent",touchAction:"none","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"},"&:active":{backgroundColor:"rgba(255, 255, 255, 0.2)"},"&:hover::after":{opacity:1}}}),"trimming"===C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,bottom:0,left:`${(H||G)/O*100}%`,width:2,backgroundColor:"#FF4444",zIndex:100,pointerEvents:"none"}}),(0,r.jsx)(s.Z,{onMouseDown:eZ,onTouchStart:eZ,sx:{position:"absolute",top:-6,left:`calc(${(H||G)/O*100}% - 8px)`,width:16,height:16,borderRadius:"50%",backgroundColor:"#FFFFFF",border:"2px solid #1856D0",zIndex:120,cursor:"ew-resize",boxShadow:"0 0 0 2px rgba(0,0,0,0.2)",touchAction:"none"}})]}):null]})}),(0,r.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mx:2},children:[(0,r.jsxs)(d.Z,{sx:{flex:"1 1 200px",color:"#FFFFFF",fontSize:12},children:[ez(G)," - ",ez(V)]}),(0,r.jsx)(E.Z,{onClick:eT,sx:{color:"#FFFFFF",backgroundColor:"rgba(255, 255, 255, 0.1)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:T?(0,r.jsx)(S.Z,{}):(0,r.jsx)(I.Z,{})}),(0,r.jsxs)(d.Z,{sx:{flex:"1 1 200px",color:"#FFFFFF",fontSize:12,textAlign:"right"},children:["Duration: ",ez(eK),eK===m?"(min)":eK===eg?"(max)":""]})]}),ex?(0,r.jsx)(B,{style:{mt:2,mx:2}}):null,(0,r.jsx)(s.Z,{sx:{mt:2,mx:2},children:(0,r.jsx)(d.Z,{sx:{color:"#888888",fontSize:11},children:"Tips: Press Space to play or pause. Use arrow keys to move or resize the trim box."})})]}),et?(0,r.jsx)(d.Z,{sx:{color:"#FF6B6B",fontSize:12,textAlign:"center",mb:2,backgroundColor:"rgba(255, 107, 107, 0.1)",padding:"8px 12px",borderRadius:"4px",border:"1px solid rgba(255, 107, 107, 0.3)"},children:et}):null,k?(0,r.jsx)("audio",{ref:en,src:k.audioUrl,onEnded:eR,onTimeUpdate:eD,style:{display:"none"}}):null]}),(0,r.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[(0,r.jsx)(l.Z,{onClick:e$,variant:"outlined",disabled:eO,sx:{borderRadius:"5px",padding:"10px 27px",width:131,height:44,textTransform:"none",fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.02em"},children:"upload"===C?"Cancel":"Back"}),(0,r.jsx)(l.Z,{color:"primary",onClick:eG,variant:"primary",disabled:!v||eO||"trimming"===C&&!k,startIcon:eO?(0,r.jsx)(M.Z,{size:20,sx:{color:"#666666"}}):null,sx:{borderRadius:"5px",padding:"17px 42px",width:160,height:44,textTransform:"none",fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.21em"},children:"upload"===C?"Upload":"Confirm"})]})]})})]})}function B(e){let{isSubscriptionActive:t}=(0,D.R)();return(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:.5,borderRadius:"6px",border:"1px solid var(--Blue-400, #1856D0)",background:"rgba(47, 102, 255, 0.28)",paddingY:1,paddingX:1,...e.style},children:t?(0,r.jsxs)(d.Z,{sx:{flex:1,fontFamily:"Inter",fontWeight:500,fontSize:12,lineHeight:"1.5em",color:"var(--Blue-800, #9CBAFF)"},children:["\uD83C\uDF81 Your"," ",(0,r.jsx)(s.Z,{component:"a",sx:{textDecoration:"underline"},href:"https://openart.ai/programs/music-video-awards",target:"_blank",rel:"noreferrer",children:"OMVA"})," ","gift: one-time free creation of up to 1 minute of video."]}):(0,r.jsxs)(d.Z,{sx:{flex:1,fontFamily:"Inter",fontWeight:500,fontSize:12,lineHeight:"1.5em",color:"var(--Blue-800, #9CBAFF)"},children:["\uD83C\uDF81 You can create up to 1 minute for free —"," ",(0,r.jsx)(T.Z,{underline:!0,linkColor:"currentcolor",children:"upgrade"})," ","to extend to 5 minutes! You can create up to 1 minute for free"]})})}function H(e){let[t,i]=(0,n.useState)(!1),[o,a]=(0,n.useState)(null),s=(0,n.useCallback)(()=>{i(!0)},[]),l=(0,n.useCallback)(()=>{i(!1),a(null)},[]),d=(0,n.useCallback)(()=>{l()},[l]),c=(0,n.useCallback)((t,i,r)=>{e.onChange(t,i,r),l()},[e.onChange,l]),u=(0,n.useCallback)(e=>{a(e),i(!0)},[]),p=(0,n.useCallback)(e=>{a(e),i(!0)},[]),h=(0,r.jsx)(L,{open:t,onClose:d,onChange:c,onUploadStart:e.onUploadStart,onUploadError:e.onUploadError,preselectedFile:o,...e.uploadProps??{}});return{visible:t,open:s,close:l,context:h,selectFile:u,openWithFile:p}}var $=i(23156),O=i(60465),U=i(91022),G=i(48577),N=i(43246);function V(e){let{has_lyrics:t=!0,selectedSongId:i,onChange:o,open:a=!1,onClose:c}=e,u=t?R.WK:R.l2,[p,h]=(0,n.useState)(null),[m,x]=(0,n.useState)(!1),g=(0,n.useRef)(null),f=e=>{let t=u.find(t=>t.id===e);t&&(g.current&&(g.current.pause(),g.current=null),x(!1),h(null),o(e,t.url),null==c||c())},v=()=>{g.current&&(g.current.pause(),g.current=null),x(!1),h(null),null==c||c()},b=e=>{let t=u.find(t=>t.id===e);if(!t)return;g.current&&(g.current.pause(),g.current=null);let i=new Audio(t.url);i.volume=.3,g.current=i,h(e),x(!0),i.play().catch(e=>{x(!1)}),i.addEventListener("ended",()=>{x(!1),h(null)}),i.addEventListener("error",()=>{x(!1),h(null)})},y=()=>{g.current&&(g.current.pause(),g.current=null),x(!1),h(null)};return(0,n.useEffect)(()=>{a||(g.current&&(g.current.pause(),g.current=null),x(!1),h(null))},[a]),(0,n.useEffect)(()=>()=>{g.current&&(g.current.pause(),g.current=null)},[]),(0,r.jsx)(Z.Z,{open:a,onClose:v,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"11px",padding:"16px 20px",width:400,maxWidth:"90vw",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}},children:(0,r.jsxs)(A.Z,{sx:{padding:0},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.21em",color:"#FFFFFF",textAlign:"left",mb:3},children:"Choose from trending songs"}),(0,r.jsx)(s.Z,{sx:{mb:3,maxHeight:300,overflowY:"auto"},children:(0,r.jsx)(G.Z,{sx:{padding:0},children:u.map((e,t)=>(0,r.jsxs)(N.Z,{onClick:()=>f(e.id),onMouseEnter:()=>b(e.id),onMouseLeave:y,sx:{padding:"8px 12px",backgroundColor:i===e.id?"#292929":"transparent",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:1,mb:t<u.length-1?"8px":0,"&:hover":{backgroundColor:i===e.id?"#292929":"#2a2a2a"}},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:0,flex:1},children:[(0,r.jsx)(s.Z,{sx:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center"},children:i===e.id&&(0,r.jsx)($.Z,{sx:{color:"#2F66FF",fontSize:18}})}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"1.43em",letterSpacing:"-0.02em",color:"#F0F0F0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name})]}),(0,r.jsx)(s.Z,{sx:{width:20,height:20,borderRadius:"50%",backgroundColor:p===e.id&&m?"rgba(47, 102, 255, 0.8)":"rgba(255, 255, 255, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,transition:"background-color 0.2s ease"},children:p===e.id&&m?(0,r.jsx)(O.Z,{sx:{color:"#FFFFFF",fontSize:12}}):(0,r.jsx)(U.Z,{sx:{color:"#FFFFFF",fontSize:12}})})]},e.id))})}),(0,r.jsx)(s.Z,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:(0,r.jsx)(l.Z,{onClick:v,variant:"outlined",sx:{borderRadius:"5px",padding:"10px 27px",width:"100%",height:44,textTransform:"none",fontFamily:"Inter",fontWeight:600,fontSize:16,lineHeight:"1.02em"},children:"Cancel"})})]})})}var K=i(42580),q=i(16585);function Y(e){var t;let i,o;let{showIcon:a=!0,iconSize:l=20,sx:c,value:u,onChange:p,expanded:h=!1,has_lyrics:m=!1,onExpandChange:x,defaultMusicType:S="auto"}=e,[I,_]=(0,n.useState)(S),[Z,A]=(0,n.useState)(""),[E,M]=(0,n.useState)(""),[T,D]=(0,n.useState)(""),[z,P]=(0,n.useState)(null),[W,L]=(0,n.useState)(""),[B,$]=(0,n.useState)(!1),[O,U]=(0,n.useState)(""),[G,N]=(0,n.useState)(!1),[Y,X]=(0,n.useState)(null);(0,n.useEffect)(()=>{u&&(L(u.split("/").pop()||""),M(u))},[]);let{open:J,context:Q,openWithFile:ee}=H({uploadProps:{enableTrimming:!0},onChange:(e,t,i)=>{G?(A(e),_("link"),N(!1)):(M(e),L(t),_("upload"),X(null)),U(""),p(e),(0,q.B)("story_music_uploaded",{method:"file"})},onUploadStart:()=>{},onUploadError:e=>{console.error("Music upload failed:",e),N(!1)}}),{open:et,context:ei}=(0,K.K)({onSuccess:(e,t)=>{A(e),_("link"),U(""),X(t),p(e),(0,q.B)("story_music_uploaded",{method:"url",platform:null==t?void 0:t.platform,domain:null==t?void 0:t.domain})},placeholder:"Enter Suno/TikTok music URL...",title:"Use Suno/TikTok music",enableTrimming:!0,onFileReady:(e,t,i)=>{N(!0),X(i),ee(e)}}),{open:er,context:en}=function(e){let[t,i]=(0,n.useState)(!1),o=(0,n.useCallback)(()=>{i(!0)},[]),a=(0,n.useCallback)(()=>{i(!1)},[]),s=(0,n.useCallback)(()=>{a()},[a]),l=(0,n.useCallback)((t,i)=>{e.onChange(t,i),a()},[e.onChange,a]),d=(0,r.jsx)(V,{has_lyrics:e.has_lyrics,selectedSongId:e.selectedSongId,onChange:l,open:t,onClose:s});return{visible:t,open:o,close:a,context:d}}({selectedSongId:z,has_lyrics:m,onChange:(e,t)=>{P(e),D(t),_("trending"),U(""),p(t),(0,q.B)("story_music_uploaded",{method:"trending"})}});return(0,n.useEffect)(()=>{},[u]),(0,r.jsxs)(s.Z,{sx:{mb:4,position:"relative",...c},children:[B?(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(47, 102, 255, 0.1)",border:"2px dashed #2F66FF",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,pointerEvents:"none"},children:(0,r.jsxs)(s.Z,{sx:{backgroundColor:"rgba(47, 102, 255, 0.9)",borderRadius:"8px",padding:"12px 24px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(g.Z,{sx:{color:"#FFFFFF",fontSize:20}}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:14,color:"#FFFFFF"},children:"Drop audio file to upload"})]})}):null,(0,r.jsxs)(y.Z,{expanded:h,onChange:x,sx:{backgroundColor:"transparent",boxShadow:"none",border:"none","&:before":{display:"none"},"&.Mui-expanded":{margin:0}},children:[(0,r.jsxs)(w.Z,{expandIcon:(0,r.jsx)(f.Z,{sx:{color:"#666",fontSize:16,backgroundColor:"#101010",borderRadius:"50%",width:24,height:24,padding:"4px"}}),sx:{padding:0,minHeight:"auto","&.Mui-expanded":{minHeight:"auto"},"& .MuiAccordionSummary-content":{margin:0,display:"flex",justifyContent:"space-between",alignItems:"center","&.Mui-expanded":{margin:0}},"& .MuiAccordionSummary-expandIconWrapper":{transition:"transform 0.3s","&.Mui-expanded":{transform:"rotate(180deg)"}}},children:[(i=(0,r.jsx)(v.Z,{sx:{color:"#CCCCCC",fontSize:l}}),o="Background Music",(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[a?i:null,(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:{xs:"14px",md:"16px"},lineHeight:"1.5em",color:"#CCCCCC"},children:o})]})),(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,pr:1},children:(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:{xs:"14px",md:"16px"},lineHeight:"1.43em",color:"#AAAAAA",maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(()=>{switch(I){case"auto":default:return"Auto select";case"link":return(null==Y?void 0:Y.title)||"Suno music";case"upload":return W||"Uploaded music";case"trending":var e;return z&&(null===(e=R.WK.find(e=>e.id===z))||void 0===e?void 0:e.name)||"Trending song";case"none":return"No background music"}})()})})]}),(0,r.jsx)(C.Z,{sx:{padding:"16px 0 0 0"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:1},onDragOver:e=>{var t;if(e.preventDefault(),!((null===(t=e.dataTransfer.items)||void 0===t?void 0:t.length)&&Array.from(e.dataTransfer.items).some(e=>e.type.startsWith("audio/")))){e.dataTransfer.dropEffect="none";return}$(!0)},onDragEnter:e=>{e.preventDefault()},onDragLeave:()=>{$(!1)},onDrop:e=>{e.preventDefault(),$(!1);let t=e.dataTransfer.files;0!==t.length&&t[0].type.startsWith("audio/")&&(_("upload"),J())},children:[(0,r.jsxs)(j.Z,{value:I,onChange:e=>{let t=e.target.value;_(t);let i="";switch(t){case"auto":X(null),p("auto");break;case"link":Z?p(Z):(et(),i="Please paste a Suno music link");break;case"upload":X(null),E?p(E):(J(),i="Please upload an audio file");break;case"trending":X(null),z?p(T):(er(),i="Please select a song from trending songs");break;case"none":X(null),p("")}U(i),i&&p("")},sx:{gap:1},children:[(0,r.jsx)(s.Z,{sx:{backgroundColor:"#101010",borderRadius:"6px",padding:"10px 12px",display:"flex",alignItems:"center",gap:1},children:(0,r.jsx)(k.Z,{value:"auto",control:(0,r.jsx)(F.Z,{sx:{color:"#636366",padding:0,width:16,height:16,"&.Mui-checked":{color:"#2F66FF"},"& .MuiSvgIcon-root":{fontSize:16}}}),label:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"1.67em",color:"#AAAAAA",ml:.5},children:"Auto-select trending song"}),sx:{margin:0,gap:.5}})}),(0,r.jsxs)(s.Z,{sx:{backgroundColor:"#101010",borderRadius:"6px",padding:"10px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:1,position:"relative"},children:[(0,r.jsx)(k.Z,{value:"link",control:(0,r.jsx)(F.Z,{sx:{color:"#636366",padding:0,width:16,height:16,"&.Mui-checked":{color:"#2F66FF"},"& .MuiSvgIcon-root":{fontSize:16}}}),label:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"1.67em",color:"#AAAAAA",ml:.5},children:"Use Suno/TikTok music"}),sx:{margin:0,gap:.5}}),(0,r.jsxs)(s.Z,{onClick:et,sx:{display:"flex",alignItems:"center",gap:.5,cursor:"pointer"},children:[(0,r.jsx)(s.Z,{sx:{width:16,height:16,borderRadius:0,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(b.Z,{sx:{color:"#666666",fontSize:16}})}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:12,lineHeight:"1.3em",letterSpacing:"-0.02em",color:Z?"#2F66FF":"#FFFFFF",maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Z?(null==Y?void 0:Y.title)?`${Y.title}`:"Suno music added":"Paste link"})]})]}),(0,r.jsxs)(s.Z,{sx:{backgroundColor:B?"#1E3A8A":"#101010",borderRadius:"6px",padding:"10px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:1,border:B?"1px solid #2F66FF":"1px solid transparent",transition:"all 0.2s ease",position:"relative"},children:[(0,r.jsx)(k.Z,{value:"upload",control:(0,r.jsx)(F.Z,{sx:{color:"#636366",padding:0,width:16,height:16,"&.Mui-checked":{color:"#2F66FF"},"& .MuiSvgIcon-root":{fontSize:16}}}),label:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"1.67em",color:"#AAAAAA",ml:.5},children:"Upload a song"}),sx:{margin:0,gap:.5}}),(0,r.jsxs)(s.Z,{onClick:J,sx:{display:"flex",alignItems:"center",gap:.5,cursor:"pointer"},children:[(0,r.jsx)(s.Z,{sx:{width:16,height:16,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(g.Z,{sx:{color:"#666666",fontSize:16}})}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:12,lineHeight:"1.3em",letterSpacing:"-0.02em",color:E?"#2F66FF":"#FFFFFF",maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:W||(B?"Drop to upload":"Upload")})]}),Q]}),(0,r.jsxs)(s.Z,{sx:{backgroundColor:"#101010",borderRadius:"6px",padding:"10px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:1,position:"relative"},children:[(0,r.jsx)(k.Z,{value:"trending",control:(0,r.jsx)(F.Z,{sx:{color:"#636366",padding:0,width:16,height:16,"&.Mui-checked":{color:"#2F66FF"},"& .MuiSvgIcon-root":{fontSize:16}}}),label:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"1.67em",color:"#AAAAAA",ml:.5},children:"Choose from trending songs"}),sx:{margin:0,gap:.5}}),(0,r.jsxs)(s.Z,{onClick:er,sx:{display:"flex",alignItems:"center",gap:.5,cursor:"pointer"},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:12,lineHeight:"1.3em",letterSpacing:"-0.02em",color:T?"#2F66FF":"#FFFFFF"},children:z?null===(t=R.WK.find(e=>e.id===z))||void 0===t?void 0:t.name:"Pick a song"}),(0,r.jsx)(s.Z,{sx:{width:16,height:16,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)("svg",{width:"10",height:"5",viewBox:"0 0 10 5",fill:"none",children:(0,r.jsx)("path",{d:"M1 1L5 4L9 1",stroke:"#666666",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),(0,r.jsx)(s.Z,{sx:{backgroundColor:"#101010",borderRadius:"6px",padding:"10px 12px",display:"flex",alignItems:"center",gap:1},children:(0,r.jsx)(k.Z,{value:"none",control:(0,r.jsx)(F.Z,{sx:{color:"#636366",padding:0,width:16,height:16,"&.Mui-checked":{color:"#2F66FF"},"& .MuiSvgIcon-root":{fontSize:16}}}),label:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"1.67em",color:"#AAAAAA",ml:.5},children:"No background music"}),sx:{margin:0,gap:.5}})})]}),O?(0,r.jsx)(s.Z,{sx:{mt:1,p:1,backgroundColor:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)",borderRadius:"4px"},children:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:400,fontSize:12,lineHeight:"1.5em",color:"#F44336"},children:O})}):null]})})]}),ei,en]})}i(93573);var X=i(750),J=i(35523),Q=i(43807);let ee=e=>{let{value:t=3,onChange:i,min:n=3,max:o=8}=e,a=Array.from({length:o-n+1},(e,t)=>n+t);return(0,r.jsx)(J.Z,{size:"small",sx:{width:100,"& .MuiOutlinedInput-root":{backgroundColor:"#101010",borderRadius:"8px",height:"40px","& fieldset":{borderColor:"#2E2E2E"},"@media (hover: hover)":{"&:hover fieldset":{borderColor:"#3E3E3E"}},"&.Mui-focused fieldset":{borderColor:"#2F66FF",borderWidth:"1px"}},"& .MuiSelect-select":{color:"#FFFFFF",fontSize:"13px",fontFamily:"Inter",py:1,display:"flex",alignItems:"center"},"& .MuiSvgIcon-root":{color:"#AAAAAA"}},children:(0,r.jsx)(Q.Z,{value:t,onChange:e=>i(Number(e.target.value)),IconComponent:X.Z,MenuProps:{PaperProps:{sx:{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"8px",mt:.5,"& .MuiMenuItem-root":{fontSize:"13px",fontFamily:"Inter",color:"#FFFFFF",py:1,"@media (hover: hover)":{"&:hover":{backgroundColor:"#2E2E2E"}},"&.Mui-selected":{backgroundColor:"#2F66FF",color:"#FFFFFF","@media (hover: hover)":{"&:hover":{backgroundColor:"#2556DD"}}}}}}},children:a.map(e=>(0,r.jsxs)(N.Z,{value:e,children:[e," ",1===e?"shot":"shots"]},e))})})};var et=i(33621),ei=i(90145),er=i(58684),en=i(11955),eo=i(45138),ea=i(8928),es=i(27806);let el=(0,ea.ZP)(Z.Z)(e=>{let{theme:t}=e;return{"& .MuiDialog-paper":{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"11px",width:"444px",maxWidth:"444px"}}}),ed=(0,ea.ZP)(en.Z)(e=>{let{theme:t}=e;return{color:"#FFFFFF",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"1.21em",padding:"16px 20px 24px 20px",position:"relative"}}),ec=(0,ea.ZP)(A.Z)(e=>{let{theme:t}=e;return{padding:"0 20px 16px 20px",display:"flex",flexDirection:"column",gap:"24px"}}),eu=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{position:"relative",height:"132px"}}),ep=(0,ea.ZP)(eo.Z)(e=>{let{theme:t}=e;return{"& .MuiOutlinedInput-root":{backgroundColor:"#101010",borderRadius:"8px",height:"132px",border:"none","& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"},"& textarea":{color:"#FFFFFF",fontFamily:"Inter",fontWeight:500,fontSize:"12px",resize:"none","&::placeholder":{color:"#444444",opacity:1}}}}}),eh=(0,ea.ZP)(d.Z)(e=>{let{theme:t}=e;return{position:"absolute",bottom:"11px",right:"12px",color:"#444444",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.83em"}}),em=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column"}}),ex=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"}}),eg=(0,ea.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#1D1D1D",border:"1px solid #444444",borderRadius:"5px",color:"#B5B5B5",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"1.02em",padding:"10px 27px",width:"131px",height:"44px",textTransform:"none","&:hover":{backgroundColor:"#2A2A2A",border:"1px solid #555555"}}}),ef=(0,ea.ZP)(er.Z)(e=>{let{theme:t}=e;return{borderRadius:"5px",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"1.21em",padding:"17px 42px",height:"44px",textTransform:"none",gap:"4px"}});function ev(e){let{open:t,onClose:i,onGenerate:o,isGenerating:a}=e,[s,l]=(0,n.useState)(""),c=async()=>{s.trim()&&o&&await o(s.trim()),null==i||i(void 0,"backdropClick")},u=()=>{l(""),null==i||i(void 0,"backdropClick")};return(0,r.jsxs)(el,{open:t,onClose:u,maxWidth:!1,children:[(0,r.jsxs)(ed,{children:[(0,r.jsx)(d.Z,{fontSize:16,fontWeight:600,color:"#FFFFFF",children:"Idea to video"}),(0,r.jsx)(E.Z,{onClick:u,sx:{position:"absolute",right:8,top:8,color:"#888888"},children:(0,r.jsx)(ei.Z,{})})]}),(0,r.jsxs)(ec,{children:[(0,r.jsx)(em,{children:(0,r.jsxs)(eu,{children:[(0,r.jsx)(ep,{fullWidth:!0,multiline:!0,rows:4,placeholder:"What topic would you like to explain today? Add any extra inputs you'd like here.",value:s,onChange:e=>{let t=e.target.value;t.length<=100&&l(t)},variant:"outlined"}),(0,r.jsxs)(eh,{children:[s.length,"/",100]})]})}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(eg,{onClick:u,children:"Cancel"}),(0,r.jsxs)(ef,{className:"oa-button-primary",onClick:c,variant:"contained",disabled:!s.trim(),loading:a,children:[(0,r.jsx)(es.CustomRewrite,{}),(0,r.jsx)(d.Z,{children:"Generate script"})]})]})]})]})}var eb=i(16301),ey=i(76651);let ew=[{name:"Cutting",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_BPXPtFTy_310x200_1757842306271.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_DM7q4QJS_1757872444441.mp4",value:"Cutting"},{name:"Slime Play",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_3cGE3aSv_310x200_1757842306157.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_LmLJuSka_1757872444550.mp4",value:"Slime"},{name:"Keyboard Sounds",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_YPpn8CPH_310x200_1757842306690.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_YCzn7h79_1757872444338.mp4",value:"Keyboard"},{name:"Smear & Spread",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_k_L-wk_h_310x200_1757842306303.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_Ip8DcluO_1757872446059.mp4",value:"Smear"},{name:"Petri Dish",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_tgYF6q4E_310x200_1757842306307.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_fOTeE8am_1757872445031.mp4",value:"Petridish"},{name:"Magic Pens",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_DS4dzuRG_310x200_1757947936673.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_MZJaKf4m_1757930410705.mp4",value:"Magicpens"},{name:"Bedroom",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_A4CIEQ4D_310x200_1757914443323.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_0RZd7zu0_1757865667604.mp4",value:"Bedroom"},{name:"Upstairs",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_Xr4s725-_310x200_1757914442654.webp",videoUrl:"https://cdn.openart.ai/production/2025-09/uploads/nhwt04FKtj8LRDpjtoLZ/file_T4OU31qs_1757865667298.mp4",value:"Upstairs"}],eC=(e,t,i)=>(0,n.useMemo)(()=>{let t=e>0&&e<=640?2:4;if(0===e)return{cardWidth:183,cardHeight:136,containerHeight:316,columnsCount:4,gap:12,padding:16};let i=e-32-(t-1)*12,r=2===t?Math.floor(i/t):183,n=Math.round(.7431693989071039*r);return{cardWidth:r,cardHeight:n,containerHeight:2*n+12+32,columnsCount:t,gap:12,padding:16}},[e,t,i]),ej=()=>{let e=(0,n.useRef)(null),[t,i]=(0,n.useState)(0),r=(0,n.useCallback)(()=>{e.current&&i(e.current.offsetWidth)},[]);return(0,n.useEffect)(()=>{r();let t=new ResizeObserver(r);return e.current&&t.observe(e.current),()=>{t.disconnect()}},[r]),{containerWidth:t,containerRef:e}},ek=()=>(0,n.useMemo)(()=>({fallbackHeight:200}),[]),eF=e=>{let t=(0,n.useRef)(null),[i,r]=(0,n.useState)(!1),o=(0,n.useCallback)(()=>{if(t.current){let{scrollTop:e,scrollHeight:i,clientHeight:n}=t.current;r(e+n<i)}},[]),a=(0,n.useCallback)(()=>{if(t.current){let{scrollTop:e,clientHeight:i}=t.current;t.current.scrollTo({top:e+i,behavior:"smooth"})}},[]);return(0,n.useEffect)(()=>{let e=t.current;if(e)return e.addEventListener("scroll",o),o(),()=>{e.removeEventListener("scroll",o)}},[o]),{canScrollDown:i,scrollableRef:t,handleScrollDown:a}};var eS=i(23638),eI=i(39204),e_=i(92743);let eZ=e=>{let{canScrollDown:t,onScrollDown:i}=e;return(0,r.jsx)(eS.M,{children:t&&(0,r.jsx)(eI.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},children:(0,r.jsx)(s.Z,{sx:{position:"absolute",bottom:8,right:8,zIndex:3},children:(0,r.jsx)(E.Z,{onClick:i,size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"text.primary","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:(0,r.jsx)(e_.Z,{fontSize:"small"})})})})})};var eA=i(13724),eE=i(80148),eM=i(2733);let eT=e=>{let{styleOption:t,isSelected:i,onSelect:o,cardWidth:a,cardHeight:l}=e,c=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),{isMobile:m}=(0,h.j)(),[x,g]=(0,eM.Z)("story-asmr-style-auto-sound",{defaultValue:!1,listenStorageChange:!0}),f=()=>{o(t)};return(0,r.jsx)(eI.E.div,{whileTap:{scale:.95},transition:{duration:.1},children:(0,r.jsxs)(eA.Z,{onClick:f,onMouseEnter:()=>{!m&&(p(!0),c.current&&t.videoUrl&&c.current.play().catch(()=>{}))},onMouseLeave:()=>{!m&&(p(!1),c.current&&t.videoUrl&&(c.current.pause(),c.current.currentTime=0))},onTouchStart:()=>{m&&c.current&&t.videoUrl?(p(!0),c.current.play().catch(()=>{}),setTimeout(()=>{p(!1),c.current&&(c.current.pause(),c.current.currentTime=0)},1e3)):m&&f()},sx:{width:a,height:l,cursor:"pointer",position:"relative",overflow:"hidden",backgroundColor:"background.paper",border:"1px solid",borderColor:i?e=>{var t,i;return(null===(i=e.palette.Colors)||void 0===i?void 0:null===(t=i.Blue)||void 0===t?void 0:t["600"])||"primary.main"}:"divider",boxShadow:i?e=>{var t,i;return`0 0 0 1px ${(null===(i=e.palette.Colors)||void 0===i?void 0:null===(t=i.Blue)||void 0===t?void 0:t["600"])||"#2f66ff"}`}:"none",transition:"all 0.2s ease-in-out",borderRadius:"12px","@media (hover: hover)":{"&:hover":{borderColor:e=>{var t,i;return(null===(i=e.palette.Colors)||void 0===i?void 0:null===(t=i.Blue)||void 0===t?void 0:t["600"])||"primary.main"}}}},children:[t.imageUrl?(0,r.jsx)("img",{src:t.imageUrl,alt:t.name,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"12px",zIndex:1}}):null,t.videoUrl?(0,r.jsx)("video",{ref:c,src:t.videoUrl,muted:!x,loop:!0,playsInline:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"12px",opacity:u?1:0,transition:"opacity 0.3s ease",zIndex:2}}):null,(0,r.jsx)(s.Z,{sx:{position:"absolute",inset:0,background:"linear-gradient(180deg, rgba(0,0,0,0.35) 55%, rgba(0,0,0,0.65) 100%)",zIndex:3}}),!m&&u?(0,r.jsx)(s.Z,{onClick:e=>{e.stopPropagation(),e.preventDefault(),g(!x)},sx:{position:"absolute",top:8,left:8,zIndex:4,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.14)",borderRadius:"6px",p:.5,backdropFilter:"blur(9.4px)",cursor:"pointer"},children:x?(0,r.jsx)(es.CustomSoundOn,{width:14,height:14}):(0,r.jsx)(es.CustomSoundOff,{width:14,height:14})}):null,(0,r.jsx)(eE.Z,{sx:{p:1,position:"absolute",left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"flex-start",zIndex:4},children:(0,r.jsx)(d.Z,{variant:"subtitle2",sx:{color:"common.white",fontWeight:600,textShadow:"0 1px 2px rgba(0,0,0,0.6)"},children:t.name})})]})})},eR=e=>{let{styles:t,selectedStyle:i,onStyleSelect:n,cardWidth:o,cardHeight:a,columnsCount:l,gap:d}=e;return(0,r.jsx)(s.Z,{sx:{display:"grid",gridTemplateColumns:`repeat(${l}, ${o}px)`,gap:d/8,width:"100%",justifyContent:"center",justifyItems:"center",pb:1},children:t.map(e=>(0,r.jsx)(eT,{styleOption:e,isSelected:(null==i?void 0:i.name)===e.name,onSelect:n,cardWidth:o,cardHeight:a},e.name))})},eD="{material}",ez=[{id:"fruit",label:"\uD83C\uDF49 Fruit",icon:"\uD83C\uDF49",content:"Fruit"},{id:"baked",label:"\uD83E\uDD6F Baked Goods",icon:"\uD83E\uDD6F",content:"Baked Goods"},{id:"toys",label:"\uD83E\uDDF8 Toys",icon:"\uD83E\uDDF8",content:"Toys"},{id:"electronics",label:"⌨️ Electronics",icon:"⌨️",content:"Electronics"},{id:"glass",label:"\uD83E\uDD43 Glass",icon:"\uD83E\uDD43",content:"Glass"},{id:"clay",label:"\uD83E\uDDF1 Clay",icon:"\uD83E\uDDF1",content:"Clay"},{id:"crystal",label:"\uD83D\uDC8E Crystal",icon:"\uD83D\uDC8E",content:"Crystal"}],eP=e=>{let{value:t="calm_peaceful",scriptContent:i="",onChange:o,contextSlot:a,onContentConfirm:l}=e,[c,p]=(0,n.useState)(!i),[m,x]=(0,n.useState)(ew.find(e=>e.value===t)||null),[g,f]=(0,n.useState)(!1),[v,b]=(0,n.useState)(""),[y,w]=(0,n.useState)(null),[C,j]=(0,n.useState)(""),[k,F]=(0,n.useState)(""),[S,I]=(0,n.useState)(""),_=(0,n.useRef)(null),Z={Smear:{template:"Spreading {material} On Bread",placeholder:"Material Object"},Slime:{template:"Hands kneading slime like {material}",placeholder:" Object"},Keyboard:{template:"Hands typing on a keyboard like {material}",placeholder:"Material Object"},Magicpens:{template:"A pen drawing {material}",placeholder:"Material Object"},Cutting:{template:"A knife cutting {material}",placeholder:"Material Object"},Bedroom:{template:"Lying on {material}",placeholder:"Material Object"},Petridish:{template:"Growing {material} from a petri dish",placeholder:"Material Object"},Upstairs:{template:"Stepping on {material}",placeholder:"Material Object"}};(0,n.useEffect)(()=>{x(ew.find(e=>e.value===t)||null)},[t]),(0,n.useEffect)(()=>{if(!c){if(p(!0),i){f(!0);let e=Z[(null==m?void 0:m.value)||"smear"];if(e){let t=e.template.split(eD),r=t[0]||"",n=t[1]||"",o=RegExp(`${r}(.*)${n}`).exec(i),a=o&&o[1]?o[1]:e.placeholder;F(r),I(n),j(a);let s=i||`${r}${a}${n}`;b(s),null==l||l(s)}}return}w(null);let e=Z[(null==m?void 0:m.value)||"smear"];if(e){let t=e.template.split(eD),i=t[0]||"",r=t[1]||"";F(i),I(r),j(e.placeholder);let n=`${i}${e.placeholder}${r}`;b(n),null==l||l(n)}else F(""),I(""),j("")},[null==m?void 0:m.value]);let A=(0,n.useMemo)(()=>(null==m?void 0:m.isSpecial)===!0,[m]),{isMobile:E}=(0,h.j)(),M=ek(),{containerWidth:T,containerRef:R}=ej(),{canScrollDown:D,scrollableRef:z,handleScrollDown:P}=eF(T),{cardWidth:W,cardHeight:L,containerHeight:B,columnsCount:H,gap:$,padding:O}=eC(T,A,ew.length),{fallbackHeight:U}=M,G=e=>{if(w(e.id),Z[(null==m?void 0:m.value)||"smear"]){let t=e.content;j(t);let i=`${k}${t}${S}`;b(i),null==l||l(i)}},N=e=>{let t=`${k}${e}${S}`;b(t),null==l||l(t)};return(0,r.jsxs)(s.Z,{sx:{position:"relative"},children:[(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,width:"100%"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(es.PhPaletteBold,{size:16,sx:{color:"#AAAAAA"}}),(0,r.jsx)(d.Z,{sx:{fontSize:"16px",fontWeight:500,color:"#AAAAAA",fontFamily:"'Inter', sans-serif",lineHeight:"24px"},children:"ASMR Style"})]})}),(0,r.jsxs)(eb.Z,{ref:R,elevation:0,sx:{bgcolor:"#0A0A0A",borderRadius:"8px",position:"relative",maxWidth:"100%",width:"100%",p:1.5,overflow:"hidden",border:"1px solid #1A1A1A"},children:[(0,r.jsx)(s.Z,{ref:z,sx:{},children:(0,r.jsx)(eR,{styles:ew,selectedStyle:m,onStyleSelect:e=>{x(e),f(!0),null==o||o(e.value||"calm_peaceful")},cardWidth:W,cardHeight:L,columnsCount:H,gap:$})}),(0,r.jsx)(eZ,{canScrollDown:D,onScrollDown:P}),g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{sx:{mt:2,mb:1,fontSize:"16px",fontWeight:600,color:"#666666",fontFamily:"'Inter', Semi Bold",lineHeight:"20px",textTransform:"title case",letterSpacing:"0.5px"},children:"Describe the scene"}),(0,r.jsxs)(s.Z,{sx:{mt:1,p:2,backgroundColor:"#141414",borderRadius:"8px",border:"1px solid #222222",position:"relative"},children:[(0,r.jsx)(u.Z,{spacing:1,sx:{mb:2},children:(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},onMouseDown:e=>{var t;e.preventDefault(),null===(t=_.current)||void 0===t||t.focus(),setTimeout(()=>{let e=_.current;e&&e.setSelectionRange(0,e.value.length)},0)},children:(()=>{let e=Z[(null==m?void 0:m.value)||"smear"];if(!e)return(0,r.jsx)(d.Z,{sx:{color:"#FFFFFF",fontSize:"14px",fontWeight:400},children:v});let t=e.placeholder,i=Math.max(4,((null==C?void 0:C.length)??0)||t.length);return(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"8px"},children:[k?(0,r.jsx)(d.Z,{component:"span",sx:{color:"#888888",fontFamily:"'Inter', sans-serif",fontSize:"15px",lineHeight:"22px",fontWeight:400},children:k}):null,(0,r.jsx)(s.Z,{sx:{display:"inline-flex",alignItems:"center",backgroundColor:"#1F1F1F",padding:"4px 10px",height:"30px",borderRadius:"6px",border:"1px solid #333333",transition:"all 0.2s ease","&:hover":{borderColor:"#444444",backgroundColor:"#252525"}},children:(0,r.jsx)("input",{ref:_,value:C,placeholder:t,size:i,onChange:e=>{let t=e.target.value;j(t),N(t)},style:{color:"#FFFFFF",fontFamily:"'JetBrains Mono', monospace",fontSize:"14px",lineHeight:"20px",fontWeight:500,backgroundColor:"transparent",padding:0,border:"none",outline:"none",caretColor:"#9CBAFF",textTransform:"capitalize"}})}),S?(0,r.jsx)(d.Z,{component:"span",sx:{color:"#888888",fontFamily:"'Inter', sans-serif",fontSize:"15px",lineHeight:"22px",fontWeight:400},children:S}):null]})})()})}),(0,r.jsx)(s.Z,{sx:{height:"1px",backgroundColor:"#2A2A2A",mx:-2,mb:2}}),(0,r.jsx)(u.Z,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:ez.map(e=>(0,r.jsx)(ey.Z,{label:e.label,onClick:()=>G(e),sx:{backgroundColor:y===e.id?"#333333":"#262626",color:y===e.id?"#FFFFFF":"#CCCCCC",border:y===e.id?"1px solid #444444":"1px solid transparent",borderRadius:"20px",height:"28px",fontSize:"13px",fontWeight:500,fontFamily:"'Inter', sans-serif",px:1.5,transition:"all 0.2s ease",cursor:"pointer","&:hover":{backgroundColor:"#333333",color:"#FFFFFF",borderColor:"#444444"},"& .MuiChip-label":{px:.5,lineHeight:"20px"}}},e.id))})]})]}):null]})]})};var eW=i(19702),eL=i(51686),eB=i(84291),eH=i(60454),e$=i(57672);function eO(e){let{open:t,onClose:i,onConfirm:o}=e,a=(0,e$.Z)(),c=(0,n.useCallback)(()=>{o(),i()},[o,i]);return(0,r.jsx)(Z.Z,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:a.palette.Colors.Gray["100"],borderRadius:"13px",border:`2px solid ${a.palette.Colors.Gray["200"]}`,maxWidth:"400px",margin:2}},children:(0,r.jsxs)(A.Z,{sx:{p:0,position:"relative",overflow:"hidden"},children:[(0,r.jsx)(E.Z,{onClick:i,sx:{position:"absolute",top:9,right:9,zIndex:3,color:a.palette.Colors.Gray["900"],width:20,height:20,padding:.5,borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.17)","& svg":{width:20,height:20}},children:(0,r.jsx)(es.PhX,{})}),(0,r.jsx)(s.Z,{sx:{position:"relative",width:"100%",height:254,borderRadius:"7.775px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:-2,right:-2,bottom:0,backgroundImage:"url(https://cdn.openart.ai/story/home/mobile_preview_hint_bg.png)",backgroundSize:"cover",backgroundPosition:"center",zIndex:0},"&::after":{content:'""',position:"absolute",top:"80%",left:0,right:0,bottom:0,background:`linear-gradient(to bottom, transparent 0%, ${a.palette.Colors.Gray["100"]} 100%)`,pointerEvents:"none",zIndex:1}},children:(0,r.jsx)(s.Z,{component:"img",src:"https://cdn.openart.ai/story/home/mobile_preview_hint.png",alt:"Mobile preview hint",sx:{maxHeight:"80%",objectFit:"contain",position:"relative",top:10,zIndex:2}})}),(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",pt:0,pb:3,px:3},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1,mb:3,textAlign:"center"},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:"bold",fontSize:18,lineHeight:"22px",color:a.palette.Colors.Gray["900"]},children:"Preview Storyboard on Web"}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:14,lineHeight:"20px",color:a.palette.Colors.Gray["500"],maxWidth:"271px"},children:"Preview images in detail for precise video edits."})]}),(0,r.jsx)(l.Z,{onClick:c,sx:{backgroundColor:a.palette.Colors.Blue["500"],borderRadius:"7px",height:44,width:250,fontFamily:"Inter",fontWeight:"bold",fontSize:14,lineHeight:0,textTransform:"none",color:a.palette.Colors.Gray["900"],"&:hover":{backgroundColor:a.palette.Colors.Blue["600"]}},children:"OK, I Got it !"})]})]})})}function eU(){let e=(0,o.useRouter)(),{isMobile:t}=(0,h.j)(),[i,a]=(0,n.useState)(!1),s=(0,n.useCallback)(()=>{t&&a(!0)},[t]),l=(0,n.useCallback)(()=>{e.push("/story")},[e]),d=(0,n.useCallback)(()=>{a(!1)},[]);return{isMobile:t,showMobilePreviewDialog:s,MobilePreviewDialogComponent:(0,n.useCallback)(()=>(0,r.jsx)(eO,{open:i,onClose:d,onConfirm:l}),[i,d,l]),isDialogOpen:i,closeDialog:d}}var eG=i(80749),eN="/_next/static/media/warning-icon.9dd82fac.svg";let eV=()=>(0,r.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"ai-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,r.jsx)("stop",{offset:"0%",stopColor:"#072A6E"}),(0,r.jsx)("stop",{offset:"50%",stopColor:"#339597"}),(0,r.jsx)("stop",{offset:"100%",stopColor:"#5E6EFF"})]})}),(0,r.jsx)("path",{d:"M5.33382 13.9996C5.33382 13.9996 5.33382 13.9999 6.00049 13.9999V14.6666H5.33382V13.9996Z",fill:"url(#ai-gradient)"}),(0,r.jsx)("path",{d:"M12.8499 10.1576L9.56864 13.4386C8.91059 14.0966 7.97668 14.3876 7.29237 14.5245C6.93747 14.5956 6.6197 14.6308 6.39028 14.6485C6.27511 14.6574 6.18101 14.6619 6.11418 14.6642C6.08074 14.6653 6.05404 14.6659 6.03486 14.6663L6.01178 14.6666L6.00463 14.6666L6.00218 14.6666L6.00124 14.6666C6.00124 14.6666 6.00049 14.6666 6.00049 13.9999L5.33382 13.9996L5.33383 13.9983L5.33383 13.9958L5.33388 13.9887L5.33416 13.9656C5.33448 13.9464 5.33508 13.9197 5.33624 13.8862C5.33854 13.8194 5.34306 13.7252 5.35192 13.61C5.36957 13.3805 5.40481 13.0627 5.4758 12.7077C5.61265 12.0233 5.9035 11.0892 6.56136 10.4314L9.84257 7.15039L12.8499 10.1576Z",fill:"url(#ai-gradient)"}),(0,r.jsx)("path",{d:"M13.7928 9.21478L15.3315 7.67612L15.3338 7.40322C15.3361 7.12312 15.2393 6.77388 15.1136 6.4716C14.9825 6.15624 14.7787 5.79232 14.4934 5.50697C14.208 5.22163 13.8441 5.0179 13.5287 4.88676C13.2264 4.76107 12.8772 4.66431 12.5971 4.66665L12.3242 4.66893L10.7854 6.20761L13.7928 9.21478Z",fill:"url(#ai-gradient)"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.98697 3.98642L4.68426 1.89453H5.31672L6.01401 3.98642L8.1059 4.68371V5.31617L6.01401 6.01346L5.31672 8.10535H4.68426L3.98697 6.01346L1.89508 5.31617V4.68371L3.98697 3.98642Z",fill:"url(#ai-gradient)"})]}),eK=(0,ea.ZP)(Z.Z)(e=>{let{theme:t}=e;return{"& .MuiDialog-paper":{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"11px",padding:"20px",width:"444px",maxWidth:"444px",margin:0}}}),eq=(0,ea.ZP)(u.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column",gap:"16px",width:"100%"}}),eY=(0,ea.ZP)(u.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"row",gap:"8px"}}),eX=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center"}}),eJ=(0,ea.ZP)(d.Z)(e=>{let{theme:t}=e;return{fontWeight:600,fontSize:"24px",lineHeight:"28px",color:"#FFFFFF"}}),eQ=(0,ea.ZP)(d.Z)(e=>{let{theme:t}=e;return{fontWeight:500,fontSize:"16px",lineHeight:"28px",color:"#E0E0E0",textAlign:"left",width:"100%"}}),e0=(0,ea.ZP)(u.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"row",gap:"12px",width:"100%"}}),e1=(0,ea.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#1D1D1D",border:"1px solid #444444",borderRadius:"5px",padding:"10px 27px",height:"44px",color:"#FFFFFF",fontWeight:600,fontSize:"16px",lineHeight:"16.35px",textTransform:"none",textAlign:"center",flex:1,"&:hover":{backgroundColor:"#2A2A2A",border:"1px solid #555555"}}}),e2=(0,ea.ZP)(er.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#2E2E2E",borderRadius:"5px",padding:"17px 8px",height:"44px",color:"#FFFFFF",fontWeight:600,fontSize:"16px",gap:"8px","&:hover":{backgroundColor:"#3E3E3E"},"& .MuiLoadingButton-loadingIndicator":{color:"#FFFFFF",position:"absolute"},"&.MuiLoadingButton-loading":{color:"transparent"}}});function e5(e){let{open:t,onClose:i,onProceedAnyway:n,onRewriteWithAI:o,isRewriting:a}=e;return(0,r.jsx)(eK,{open:t,onClose:i,children:(0,r.jsx)(A.Z,{sx:{padding:0},children:(0,r.jsxs)(eq,{children:[(0,r.jsxs)(eY,{children:[(0,r.jsx)(eX,{children:(0,r.jsx)("img",{src:eN,alt:"Warning",width:23,height:23})}),(0,r.jsx)(eJ,{children:"Warning"})]}),(0,r.jsx)(eQ,{children:"Looks like your voiceover script is very short — the generated video will be just about 5 seconds. Need help expanding it with AI?"}),(0,r.jsxs)(e0,{children:[(0,r.jsx)(e1,{onClick:n,children:"Proceed Anyway"}),(0,r.jsxs)(e2,{variant:"contained",onClick:o,loading:a,children:[(0,r.jsx)(eV,{}),(0,r.jsx)(d.Z,{fontSize:16,fontWeight:600,color:"#FFFFFF",children:"Rewrite with AI"})]})]})]})})})}var e6=i(83242),e4=i(46973);let e3=async e=>(await e4.ZP.post("/stories/rewrite_script",e)).data,e8=(0,e4.py)(e3);var e9=i(81241),e7=i(1663);function te(e,t){try{let i=JSON.stringify(t);return localStorage.setItem(e,i),!0}catch(t){return console.warn(`Failed to save to localStorage with key "${e}":`,t),!1}}let tt="asmr_creation_form_data_v2",ti=eB.Ry({script_content:eB.Z_().min(1,"Please enter a script").refine(e=>e.replaceAll(" ","").replaceAll(/\n\s*\n/g,"\n").trim().length<=900,"Script is too long"),voiceover_voice:eB.Km(e9.Kz).default("auto"),background_music:eB.Z_().nullable().optional(),aspect_ratio:eB.Km(["16:9","9:16"]).default("16:9"),num_shots:eB.Rx().min(3).max(8).default(3),asmr_type:eB.Z_().default("calm_peaceful"),auto_rewrite:eB.O7().default(!1),auto_captions:eB.O7().default(!0),imageModelConfig:eB.PG(),videoModelConfig:eB.PG()}),tr={script_content:"",background_music:"",aspect_ratio:"16:9",num_shots:3,asmr_type:void 0,auto_rewrite:!0,auto_captions:!0,imageModelConfig:{model:"imagen4",parameters:{}},videoModelConfig:{model:"veo3_fast",parameters:{}}};var tn=i(79446);function to(e){let{onSubmit:t}=e,[i,a]=(0,n.useState)(!1),{form:l,isGenerating:p,canGenerate:h,isRewriting:m,scriptContent:g,scriptOverLimit:f,scriptLength:v,maxScriptLength:b,voiceStyle:y,backgroundMusic:w,imageModelConfig:C,videoModelConfig:j,imageModelOptions:k,videoModelOptions:F,aspectRatio:S,numShots:I,visualStyle:_,autoCaptions:Z,expandedPanels:A,togglePanel:E,onFormSubmit:M,onPreviewSubmit:T,handleModelSelect:R,handleScriptContentChange:D,handleAspectRatioSelect:z,handleNumShotsChange:P,handleVisualStyleSelect:W,handleVoiceoverVoiceChange:L,handleBackgroundMusicChange:B,handleRewriteScript:H,undoScriptContent:$,handleAutoCaptionsChange:O,canUndo:U,autoRewrite:G,handleAutoRewriteChange:N,Node:V,MobilePreviewDialogComponent:K}=function(){var e,t,i,a;let{onSubmit:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,o.useRouter)(),{mutate:d,isLoading:u}=(0,e6.N1)(!1),{isMobile:p,showMobilePreviewDialog:h,MobilePreviewDialogComponent:m}=eU(),[x,g]=e8(),[f,v]=(0,n.useState)(!1),[b,y]=(0,n.useState)(!1),[w,C]=(0,n.useState)(null),[j,k]=(0,n.useState)(!1),[F,S]=(0,n.useState)([]),[I,_]=(0,n.useState)(-1),[Z,A]=(0,n.useState)({advancedSettings:!1,backgroundMusic:!1}),[E,M]=(0,n.useState)(!1),T=eG.E.getState().consumePrefill("asmr_video"),R=(0,eL.cI)({mode:"onChange",defaultValues:{...tr,...T&&{script_content:void 0===T.script_content?tr.script_content:T.script_content,background_music:null==T.background_music?tr.background_music:(0,eH.fz)(T),aspect_ratio:T.aspect_ratio??tr.aspect_ratio,num_shots:T.num_shots??tr.num_shots,asmr_type:T.asmr_type??tr.asmr_type,auto_rewrite:T.auto_rewrite??tr.auto_rewrite,auto_captions:T.auto_captions??tr.auto_captions,imageModelConfig:(null===(e=(0,eH.O8)(null===(t=T.advanced_settings)||void 0===t?void 0:t.image_model_config,eH.Fj))||void 0===e?void 0:e.value)||tr.imageModelConfig,videoModelConfig:(null===(i=(0,eH.O8)(null===(a=T.advanced_settings)||void 0===a?void 0:a.video_model_config,eH.E5))||void 0===i?void 0:i.value)||tr.videoModelConfig}},resolver:(0,eW.F)(ti)}),{handleSubmit:D,setValue:z,reset:P,setError:W}=R,L=R.watch("script_content"),B=R.watch("voiceover_voice"),H=R.watch("background_music"),$=R.watch("aspect_ratio"),O=R.watch("num_shots"),U=R.watch("asmr_type"),G=R.watch("auto_rewrite"),N=R.watch("auto_captions"),V=R.watch("imageModelConfig"),K=R.watch("videoModelConfig"),{data:q}=(0,e7.w)(w,!!w);(0,n.useEffect)(()=>{var e;(null==q?void 0:null===(e=q.story)||void 0===e?void 0:e.id)&&b&&(y(!1),C(null),l.push(`/story/editor?story_id=${q.story.id}&view=list`))},[q,b,l]),(0,n.useEffect)(()=>{k(!0)},[]),(0,n.useEffect)(()=>{if(!j)return;let e=function(e,t){try{let i=localStorage.getItem(e);if(null===i)return t;return JSON.parse(i)}catch(i){return console.warn(`Failed to read from localStorage with key "${e}":`,i),t}}(tt,{});Object.keys(e).length>0&&Object.entries(e).forEach(e=>{let[t,i]=e;null!=i&&""!==i&&z(t,i)})},[j,z]),(0,n.useEffect)(()=>{if(!j)return;let e=R.watch(e=>{let t=Object.entries(e).reduce((e,t)=>{let[i,r]=t;return null!=r&&""!==r&&(e[i]=r),e},{});Object.keys(t).length>0&&te(tt,t)});return()=>e.unsubscribe()},[R,j]);let Y=(0,n.useMemo)(()=>{let e=eH.Fj.filter(e=>!(0,eH.Rx)(e.value));return(0,eH.FA)(e,V).map(e=>({name:e.name,icon:e.icon,value:e.value,disabled:(0,eH.Rx)(e.value)}))},[V]),X=(0,n.useMemo)(()=>eH.E5.map(e=>({name:e.name,icon:e.icon,value:e.value})),[]),J=(0,n.useCallback)(e=>{A(t=>({...t,[e]:!t[e]}))},[]),Q=(0,n.useMemo)(()=>L.replaceAll(" ","").replaceAll(/\n\s*\n/g,"\n").trim().length,[L]),ee=(0,n.useMemo)(()=>{var e;let t=R.getValues(),i=ti.safeParse(t).success,r=!!t.asmr_type,n=(null===(e=t.script_content)||void 0===e?void 0:e.trim())||"",o=n.length>0&&!n.includes("Material Object")&&!n.includes(" Object");return i&&r&&o},[R.watch()]),et=D(async e=>{if(Q<100&&!e.auto_rewrite){v(!0);return}await er(e,!1)}),ei=D(async e=>{if(Q<100&&!e.auto_rewrite){v(!0);return}y(!0),await er(e,!0)}),er=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{M(!0),c.IP.getState().updateFormData({oneSentenceStory:e.script_content,aspectRatio:e.aspect_ratio});let i={script_content:e.script_content,background_music:e.background_music,aspect_ratio:e.aspect_ratio,num_shots:e.num_shots,asmr_type:e.asmr_type,advanced_settings:{image_model_config:e.imageModelConfig,video_model_config:e.videoModelConfig},...t&&{is_preview:!0}};d(i,{onSuccess:e=>{j&&te(tt,{}),e.workflowRunId?t?p?h():C(e.workflowRunId):l.push(`/story/create/workflow/${e.workflowRunId}?category_id=asmr_video`):null==s||s()},onError:e=>{t&&y(!1),W("root",{message:e instanceof Error?e.message:"Failed to generate character vlog"})}})}catch(e){console.error("Form submission error:",e)}finally{M(!1)}},en=(0,n.useCallback)((e,t)=>{if("imageModel"===e){let e=eH.Fj.find(e=>e.name===t);e&&z("imageModelConfig",e.value)}else if("videoModel"===e){let e=eH.E5.find(e=>e.name===t);e&&z("videoModelConfig",e.value)}},[z]),eo=(0,n.useCallback)(async e=>{try{let t=R.getValues("script_content"),{enhancedScript:i}=await x({story:e});z("script_content",i),S(e=>{let r=[...e];return t.trim()&&(0===r.length||r.at(-1)!==t)&&r.push(t),i&&i!==r.at(-1)&&r.push(i),r}),_(e=>F.length+(t.trim()&&F.at(-1)!==t?1:0))}catch(e){console.error("Error rewriting script:",e)}},[x,z,R,F]),ea=(0,n.useCallback)(()=>{if(I>0){let e=I-1;z("script_content",F[e]),_(e)}},[I,F,z]),es=(0,n.useCallback)(e=>{z("script_content",e)},[z]),el=(0,n.useCallback)(e=>{z("background_music",e)},[z]),ed=(0,n.useCallback)(e=>{z("aspect_ratio",e)},[z]),ec=(0,n.useCallback)(e=>{z("num_shots",e)},[z]),eu=(0,n.useCallback)(e=>{z("asmr_type",e)},[z]),ep=(0,n.useCallback)(e=>{z("voiceover_voice",e)},[z]),eh=(0,n.useCallback)(e=>{z("auto_rewrite",e)},[z]),em=(0,n.useCallback)(e=>{z("auto_captions",e)},[z]),ex=(0,n.useCallback)(()=>{P(tr),A({advancedSettings:!1,backgroundMusic:!1}),j&&te(tt,{})},[P,j]),eg=(0,r.jsx)(e5,{open:f,isRewriting:g,onProceedAnyway:()=>{v(!1),R.handleSubmit(e=>er(e,!1))()},onRewriteWithAI:async()=>{await eo(R.getValues("script_content")),v(!1)},onClose:()=>v(!1)});return{form:R,isGenerating:u||b,isRewriting:g,scriptContent:L,scriptOverLimit:Q>900,scriptLength:Q,maxScriptLength:900,voiceStyle:B,backgroundMusic:H,aspectRatio:$,numShots:O,autoCaptions:N,visualStyle:U,autoRewrite:G,imageModelConfig:V,videoModelConfig:K,imageModelOptions:Y,videoModelOptions:X,isSubmitting:E,onFormSubmit:et,onPreviewSubmit:ei,resetForm:ex,expandedPanels:Z,togglePanel:J,handleModelSelect:en,handleBackgroundMusicChange:el,handleAspectRatioSelect:ed,handleNumShotsChange:ec,handleVisualStyleSelect:eu,handleVoiceoverVoiceChange:ep,handleScriptContentChange:es,handleRewriteScript:eo,handleAutoRewriteChange:eh,handleAutoCaptionsChange:em,undoScriptContent:ea,canUndo:I>0,canGenerate:ee,Node:eg,MobilePreviewDialogComponent:m}}({onSubmit:t}),q=(0,tn.B)(),X=Object.entries(l.formState.errors).reduce((e,t)=>{let[i,r]=t;return(null==r?void 0:r.message)&&(e[i]={message:r.message}),e},{}),J=async e=>{await H(e),a(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Z,{component:"form",onSubmit:e=>{e.preventDefault(),q({onAuthenticated:()=>M(e)})},sx:{width:"100%",maxWidth:800,mx:"auto"},children:[(0,r.jsx)("input",{type:"hidden",...l.register("script_content")}),(0,r.jsxs)(u.Z,{spacing:4,children:[(0,r.jsx)(s.Z,{children:(0,r.jsx)(eP,{value:_,scriptContent:g,onChange:W,onContentConfirm:D})}),(0,r.jsxs)(s.Z,{children:[(0,r.jsx)(d.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Video Format"}),(0,r.jsx)(x,{value:S,aspectRatioOptions:["9:16","16:9"],onChange:z})]}),(0,r.jsx)(s.Z,{children:(0,r.jsxs)(u.Z,{spacing:2,children:[(0,r.jsx)(s.Z,{children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,r.jsx)(d.Z,{variant:"h6",sx:{fontWeight:600},children:"Number of Shots"}),(0,r.jsx)(ee,{value:I,onChange:P,min:3,max:8})]})}),(0,r.jsxs)(s.Z,{children:[(0,r.jsx)(d.Z,{variant:"h6",sx:{mb:1.5,fontWeight:600},children:"Background Ambience"}),(0,r.jsx)(Y,{defaultMusicType:"none",value:w,onChange:B,expanded:A.backgroundMusic,onExpandChange:(e,t)=>{t!==A.backgroundMusic&&E("backgroundMusic")}})]})]})}),(0,r.jsx)(s.Z,{sx:{textAlign:"center"},children:(0,r.jsx)(et.i,{storyType:"asmr_video",isGenerating:p,disabled:!h,errors:X,showCreditInfo:!0,numShots:I,onCreateStory:()=>{q({onAuthenticated:()=>M()})},onCreatePreview:()=>{q({onAuthenticated:()=>T()})}})})]})]}),(0,r.jsx)(ev,{open:i,onClose:()=>{a(!1)},onGenerate:J,isGenerating:m}),(0,r.jsx)(K,{})]})}var ta=i(8349),ts=i(95425),tl=i(58474);let td={"360p":{displayName:"360p",actualResolutions:["360p"],order:1,modelOrder:["Pixverse5 - 360p"]},"720p":{displayName:"720p",actualResolutions:["720p","768p","768P"],order:2,modelOrder:["Kling2.1 - Standard","MiniMax Hailuo 02 Standard","Pixverse5 - 720p","Seedance 1.0 Lite","Wan2.1","Wan2.2","ViduQ2-Turbo-720p","ViduQ2-Pro-720p"]},"1080p":{displayName:"1080p",actualResolutions:["1080p"],order:3,modelOrder:["Kling 2.5","Kling2.1 - Pro","Pixverse5 - 1080p","ViduQ2-Turbo-1080p","ViduQ2-Pro-1080p"]}};function tc(e){var t;let{iconSize:i=20,showIcon:n=!0,sx:o,imageModelConfig:a,videoModelConfig:l,imageModelOptions:c,videoModelOptions:u,onModelSelect:p,expanded:h,onChange:m}=e;return(0,r.jsx)(s.Z,{sx:{position:"relative",...o},children:(0,r.jsxs)(y.Z,{expanded:h,onChange:m,sx:{backgroundColor:"transparent",boxShadow:"none",border:"none","&:before":{display:"none"},"&.Mui-expanded":{margin:0}},children:[(0,r.jsx)(w.Z,{expandIcon:(0,r.jsx)(f.Z,{sx:{color:"#666",fontSize:16,backgroundColor:"#101010",borderRadius:"50%",width:24,height:24,padding:"4px"}}),sx:{padding:0,minHeight:"auto","&.Mui-expanded":{minHeight:"auto"},"& .MuiAccordionSummary-content":{margin:0,"&.Mui-expanded":{margin:0}},"& .MuiAccordionSummary-expandIconWrapper":{transition:"transform 0.3s","&.Mui-expanded":{transform:"rotate(180deg)"}}},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[n?(0,r.jsx)(ts.Z,{sx:{color:"#CCCCCC",fontSize:i}}):null,(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:{xs:"14px",md:"16px"},lineHeight:"1.5em",color:"#CCCCCC"},children:"Advanced Settings"})]})}),(0,r.jsx)(C.Z,{sx:{padding:"20px 16px 16px 16px"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,r.jsxs)(s.Z,{sx:{pl:1},children:[" ",(0,r.jsx)(d.Z,{sx:{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC",mb:1.5},children:"Image Model"}),(0,r.jsx)(tl.O,{label:"Select image model",value:(null===(t=eH.Fj.find(e=>e.value.model===a.model&&JSON.stringify(e.value.parameters)===JSON.stringify(a.parameters)))||void 0===t?void 0:t.name)||eH.Fj[0].name,options:c,onChange:e=>p("imageModel",e),sx:{width:"100%"}})]}),(0,r.jsxs)(s.Z,{sx:{pl:1},children:[" ",(0,r.jsx)(d.Z,{sx:{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC",mb:1.5},children:"Video Model"}),(0,r.jsx)(tu,{videoModelConfig:l,videoModelOptions:u,onModelSelect:p})]})]})})]})})}function tu(e){var t,i;let{videoModelConfig:o,videoModelOptions:a,onModelSelect:l,showResolutionSelect:c=!0}=e,u=e=>e&&"string"==typeof e.resolution,p=(0,n.useMemo)(()=>a.some(e=>u(e.value.parameters)),[a]),h=Object.entries(td).sort((e,t)=>{let[,i]=e,[,r]=t;return i.order-r.order}).map(e=>{let[t,i]=e;return{name:i.displayName,value:t}}),m=e=>{for(let[t,i]of Object.entries(td))if(i.actualResolutions.includes(e))return t;return e},x=u(o.parameters)?o.parameters.resolution:"",g=x?m(x):(null===(t=h[0])||void 0===t?void 0:t.value)||"",[f,v]=(0,n.useState)(g);(0,n.useEffect)(()=>{v(g)},[g]);let b=(0,n.useCallback)(e=>{if(!p)return a;let t=a.filter(t=>!u(t.value.parameters)||m(t.value.parameters.resolution)===e),i=td[e];return(null==i?void 0:i.modelOrder)?t.sort((e,t)=>{let r=i.modelOrder,n=r.indexOf(e.name),o=r.indexOf(t.name);return -1!==n&&-1!==o?n-o:-1!==n?-1:-1!==o?1:0}):t},[a,p]),y=(0,n.useMemo)(()=>b(f),[b,f]),w=p&&0===y.length,C=e=>{v(e);let t=b(e);t.length>0&&l("videoModel",t[0].name)};return(0,r.jsxs)(s.Z,{sx:{display:"flex",gap:1.5,flexDirection:{xs:"column",sm:"row"}},children:[c&&p&&h.length>0?(0,r.jsx)(J.Z,{sx:{flex:1},children:(0,r.jsx)(Q.Z,{value:f,onChange:e=>{C(e.target.value)},displayEmpty:!0,sx:{backgroundColor:"#101010",borderRadius:"8px",height:"48px",color:"#FFFFFF",border:"1px solid transparent","&:hover":{border:"1px solid #333"},"&.Mui-focused":{border:"1px solid #2F66FF"},"& .MuiOutlinedInput-notchedOutline":{border:"none"},"& .MuiSelect-select":{padding:"12px 16px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},"& .MuiSelect-icon":{color:"#666666",fontSize:"16px"}},renderValue:e=>(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.5em",letterSpacing:"-0.04em",color:"#ccc"},children:"Select resolution"}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.5em",letterSpacing:"-0.04em",color:"#FFFFFF"},children:e})]}),MenuProps:{PaperProps:{sx:{border:"1px solid #2e2e2e",borderRadius:"8px",mt:.5,minWidth:"200px","& .MuiMenuItem-root":{margin:"0px",minHeight:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 16px",borderRadius:"0px","&:not(:last-child)":{borderBottom:"1px solid #2E2E2E"}}}}},children:h.map(e=>(0,r.jsx)(N.Z,{value:e.value,children:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"16px",lineHeight:"1.5em",letterSpacing:"-0.04em",color:"#FFFFFF"},children:e.name})},e.value))})}):null,(0,r.jsx)(tl.O,{label:"Select video model",value:w?"":(null===(i=eH.E5.concat(eH.yD).find(e=>e.value.model===o.model&&JSON.stringify(e.value.parameters)===JSON.stringify(o.parameters)))||void 0===i?void 0:i.name)||(null===eH.Zc||void 0===eH.Zc?void 0:eH.Zc.name)||"",options:y,onChange:e=>l("videoModel",e),sx:{flex:1},disabled:w})]})}var tp=i(7999),th=i(44616),tm=i(42849),tx=i(54672),tg=i(48858),tf=i(82639),tv=i(5338),tb=i(21964),ty=i(68836),tw=i.n(ty),tC=i(67197),tj=i(2345),tk=i(52973),tF=i(47469),tS=i(56138);let tI={systemPromptKey:tS.x0,customSystemPrompt:tS.dH,scriptSchemaDescriptions:tS.BK,aspectRatio:"16:9",scriptModel:"o4-mini",characterStyle:"",characterSpecies:"",oneSentenceStory:"",numShots:[5,10],selectedCharacter:null,selectedCharacterSampleImage:null,script:{title:"",recurringProps:[],shots:[]},imageGenerationMethod:"fluxlora",videoGenerationMethod:"pixverse_4_720p",includeCharacterStyle:!0,videoUrl:void 0,soundtrackUrl:null,selectedShotId:void 0,playbackSpeed:2,isScriptLoading:!1,scriptError:void 0,isImageLoading:!1,imageError:void 0,isExporting:!1,exportError:void 0,setSelectedCharacter:()=>{},setSelectedCharacterSampleImage:()=>{}};(0,tj.U)()((0,tk.mW)((0,tF.n)((e,t)=>({...tI,setScriptSchemaDescription:(t,i)=>e(e=>{e.scriptSchemaDescriptions[t]=i}),setSystemPromptKey:t=>e(e=>{switch(e.systemPromptKey=t,t){case tS.x0:e.customSystemPrompt=tS.dH,e.scriptSchemaDescriptions=tS.BK,e.numShots=[5,10];break;case tS.W1:e.customSystemPrompt=tS.sQ,e.scriptSchemaDescriptions=tS.Q9,e.numShots=5;break;case tS.r_:e.customSystemPrompt=tS.ci,e.scriptSchemaDescriptions=tS.E$,e.numShots=5;break;case tS.S8:e.customSystemPrompt=tS.zh,e.scriptSchemaDescriptions=tS.ym,e.numShots=5}}),setCustomSystemPrompt:t=>e(e=>{e.customSystemPrompt=t}),setAspectRatio:t=>e(e=>{e.aspectRatio=t}),setScriptModel:t=>e(e=>{e.scriptModel=t}),setCharacterStyle:t=>e(e=>{e.characterStyle=t}),setCharacterSpecies:t=>e(e=>{e.characterSpecies=t}),setOneSentenceStory:t=>e(e=>{e.oneSentenceStory=t}),setNumShots:t=>e(e=>{e.numShots=t}),setSelectedCharacter:t=>e(e=>{e.selectedCharacter=t}),setSelectedCharacterSampleImage:t=>e(e=>{e.selectedCharacterSampleImage=t}),setScript:t=>e(e=>{e.isScriptLoading=!1,e.scriptError=void 0;let i=(t.shots||[]).map(e=>({...e,id:e.id||(0,tC.x0)(),imageUrl:e.imageUrl||void 0,imageStatus:e.imageStatus||"idle",videoUrl:e.videoUrl||void 0,videoStatus:e.videoStatus||"idle"}));e.script={...e.script,id:t.id||e.script.id,recurringProps:t.recurringProps||[],shots:i}}),setShots:t=>e(e=>{e.script.shots=t}),updateShotPrompt:(t,i,r)=>e(e=>{let n=e.script.shots.find(e=>e.id===t);n&&(n[i]=r)}),updateShotImageStatus:(t,i,r)=>e(e=>{let n=e.script.shots.find(e=>e.id===t);n&&(n.imageStatus=i,void 0!==r&&(n.imageUrl=r))}),setImageGenerationMethod:t=>e(e=>{e.imageGenerationMethod=t}),setVideoGenerationMethod:t=>e(e=>{e.videoGenerationMethod=t}),setIncludeCharacterStyle:t=>e(e=>{e.includeCharacterStyle=t}),setAllImagesLoading:t=>e(e=>{e.isImageLoading=t,e.imageError=void 0,t&&e.script.shots.forEach(e=>{e.imageStatus="generating"})}),setAllImagesResult:(t,i)=>e(e=>{e.isImageLoading=!1,e.imageError=i,t.forEach(t=>{let i=e.script.shots.find(e=>e.id===t.shotId);i&&(i.imageUrl=t.imageUrl??i.imageUrl,i.imageStatus=t.error?"error":t.imageUrl?"success":"idle",i.videoStatus="idle",i.videoUrl=void 0)})}),updateShotVideoStatus:(t,i,r)=>e(e=>{let n=e.script.shots.find(e=>e.id===t);n&&(n.videoStatus=i,void 0!==r&&(n.videoUrl=r),("error"===i||"idle"===i||"generating"===i&&void 0===r)&&(n.videoUrl=void 0))}),setVideoUrl:t=>e(e=>{e.videoUrl=t}),setSoundtrackUrl:t=>e(e=>{e.soundtrackUrl=t}),setSelectedShotId:t=>e(e=>{e.selectedShotId=t}),setPlaybackSpeed:t=>e(e=>{e.playbackSpeed=t}),setScriptLoading:(t,i)=>e(e=>{e.isScriptLoading=t,e.scriptError=i}),setExporting:(t,i)=>e(e=>{e.isExporting=t,e.exportError=i}),resetStore:()=>e(tI),resetState:()=>e(tI)})),{name:"storyBuilderStore"}));let t_=e=>(e||[]).map(e=>({id:e.id,model_name:e.model_name,image_url:e.image_url,fal_cdn_file_path:e.fal_cdn_file_path,object_prompt:e.object_prompt,character_features_description:e.character_features_description,sample_images:e.sample_images})),tZ=async e=>{if(!e)return null;try{let{data:t}=await tw().get(`/api/train/model?id=${e}`);if(t.data)return t_([t.data])[0];return null}catch(e){return console.error("Error fetching character by ID:",e),null}};var tA=i(70024),tE=function(e){let{starNumber:t,onAdd:i,disabled:n=!1,width:o=240,height:a=36,sx:l}=e;return(0,r.jsx)(s.Z,{sx:{position:"relative",width:{xs:"100%",sm:o},height:{xs:"100%",sm:a},borderRadius:1,overflow:"hidden",cursor:n?"not-allowed":"pointer",opacity:n?.6:1,...l},onClick:n?void 0:i,children:(0,r.jsxs)(s.Z,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",height:"100%",px:1.125},children:[(0,r.jsxs)(d.Z,{variant:"body2",sx:{color:"var(--Gray-900)",fontWeight:600,fontSize:12,lineHeight:"18px",whiteSpace:"nowrap"},children:["Pick Character ",t]}),(0,r.jsx)(E.Z,{size:"small",sx:{width:18,height:18,backgroundColor:"var(--Gray-200)",borderRadius:.56,border:"1.125px solid #adadb3","@media (hover: hover)":{"&:hover":{backgroundColor:"var(--Gray-300)"}},"&:disabled":{backgroundColor:"var(--Gray-200)",opacity:.6}},disabled:n,onClick:e=>{e.stopPropagation(),null==i||i()},children:(0,r.jsx)(tm.Z,{sx:{fontSize:12,color:"var(--Gray-900)",strokeWidth:1.03125}})})]})})},tM=i(49099),tT=i(2895),tR=i(48867),tD=i(52423),tz=i(19005),tP=i(69664);let tW=n.memo(e=>{let{character:t,isSelected:i,isAlreadySelected:n,size:o=80,onCharacterSelect:a,characterRef:c}=e,u=n&&!i;return(0,r.jsxs)(s.Z,{ref:c,onClick:()=>!u&&a(t),sx:{cursor:u?"not-allowed":"pointer",flexShrink:0,position:"relative",width:o,height:o,transition:"transform 0.2s ease-in-out",opacity:u?.5:1,"@media (hover: hover)":{"&:hover":{transform:u?"none":"scale(1.05)",".character-avatar-overlay":{opacity:u?.5:1}}}},children:[(0,r.jsx)(tg.Z,{src:t.image_url,alt:t.model_name,sx:{width:o,height:o,border:i?"2px solid #0929F7":n?"2px solid #666666":"1px solid #444444",borderRadius:"50%",transition:"border-color 0.2s ease-in-out"}}),(0,r.jsxs)(s.Z,{sx:{position:"absolute",top:0,left:0,pt:1,pb:1.5,width:"100%",height:"100%",overflow:"hidden",borderRadius:"50%",background:"linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.4) 100%)",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",opacity:i?1:0,transition:"all 0.3s ease-in-out",pointerEvents:"none"},className:"character-avatar-overlay",children:[(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:14,fontWeight:i?600:500,color:"#FFFFFF",textAlign:"center",transition:"all 0.2s ease-in-out",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",maxHeight:"42px"},children:t.model_name}),i?(0,r.jsx)($.Z,{sx:{fontSize:32,color:"#FFFFFF",strokeWidth:4,transition:"all 0.2s ease-in-out"}}):n?(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:10,fontWeight:600,color:"#666666",textAlign:"center",bgcolor:"rgba(0, 0, 0, 0.7)",borderRadius:"4px",px:1,py:.5},children:"Selected"}):(0,r.jsx)(l.Z,{variant:"contained",size:"small",sx:{minWidth:44,height:18,fontSize:11,fontWeight:500,bgcolor:"#101010",color:"#FFFFFF",borderRadius:"4px",boxShadow:"3px 3px 3.4px 0px rgba(0, 0, 0, 0.44)",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"#202020"}},children:"Apply"})]})]})},(e,t)=>e.character.id===t.character.id&&e.isSelected===t.isSelected&&e.isAlreadySelected===t.isAlreadySelected&&e.size===t.size);tW.displayName="CharacterAvatar";let tL=n.memo(e=>{let{character:t,isSelected:i,isAlreadySelected:n,size:o=80,onCharacterSelect:a,characterRef:c}=e,u=n&&!i;return(0,r.jsxs)(s.Z,{ref:c,onClick:()=>!u&&a(t),sx:{cursor:u?"not-allowed":"pointer",flexShrink:0,position:"relative",width:o,height:o,transition:"transform 0.2s ease-in-out",opacity:u?.5:1,"@media (hover: hover)":{"&:hover":{transform:u?"none":"scale(1.05)",".character-avatar-overlay":{opacity:u?.5:1}}}},children:[(0,r.jsx)(tg.Z,{src:t.image_url,alt:t.model_name,sx:{width:o,height:o,border:i?"2px solid #0929F7":n?"2px solid #666666":"1px solid #444444",borderRadius:"50%",transition:"border-color 0.2s ease-in-out"}}),(0,r.jsxs)(s.Z,{sx:{position:"absolute",top:0,left:0,pt:1,pb:1.5,width:"100%",height:"100%",overflow:"hidden",borderRadius:"50%",background:"linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.4) 100%)",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",opacity:i?1:0,transition:"all 0.3s ease-in-out",pointerEvents:"none"},className:"character-avatar-overlay",children:[(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:14,fontWeight:i?600:500,color:"#FFFFFF",textAlign:"center",transition:"all 0.2s ease-in-out",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",maxHeight:"42px"},children:t.model_name}),i?(0,r.jsx)($.Z,{sx:{fontSize:32,color:"#FFFFFF",strokeWidth:4,transition:"all 0.2s ease-in-out"}}):n?(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:10,fontWeight:600,color:"#666666",textAlign:"center",bgcolor:"rgba(0, 0, 0, 0.7)",borderRadius:"4px",px:1,py:.5},children:"Selected"}):(0,r.jsx)(l.Z,{variant:"contained",size:"small",sx:{minWidth:44,height:18,fontSize:11,fontWeight:500,bgcolor:"#101010",color:"#FFFFFF",borderRadius:"4px",boxShadow:"3px 3px 3.4px 0px rgba(0, 0, 0, 0.44)",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"#202020"}},children:"Apply"})]})]})},(e,t)=>e.character.id===t.character.id&&e.isSelected===t.isSelected&&e.isAlreadySelected===t.isAlreadySelected&&e.size===t.size);tL.displayName="MyCharacterAvatar";let tB=e=>{let{onClick:t,size:i=64}=e;return(0,r.jsx)(s.Z,{onClick:t,sx:{flexShrink:0,cursor:"pointer",width:i,height:i,position:"relative",transition:"transform 0.2s ease-in-out"},children:(0,r.jsxs)(tg.Z,{sx:{width:i,height:i,bgcolor:"var(--Gray-200)",border:"1px dashed var(--Gray-300)",borderRadius:"50%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease-in-out","@media (hover: hover)":{"&:hover":{bgcolor:"#3E3E3E",borderColor:"var(--Gray-400)"}}},children:[(0,r.jsx)(tm.Z,{sx:{color:"var(--Gray-800)",fontSize:.25*i}}),i>=80&&(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:11,fontWeight:500,color:"var(--Gray-600)",textAlign:"center",lineHeight:1.21,mt:.5},children:"Custom"})]})})},tH=e=>{let{size:t=80,count:i=1}=e;return(0,r.jsx)(r.Fragment,{children:Array.from({length:i}).map((e,i)=>(0,r.jsx)(s.Z,{sx:{flexShrink:0,width:t,height:t,position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(tg.Z,{sx:{width:t,height:t,bgcolor:"#2E2E2E",border:"1px solid #444444",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(M.Z,{size:24,sx:{color:"#666666"}})})},`skeleton-${i}`))})},t$=e=>{let{allowOutfitChanges:t,onToggle:i,sx:n}=e,{isMobile:o}=(0,h.j)();return(0,r.jsxs)(eb.Z,{sx:{bgcolor:"#101010",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",mt:1.5,...n},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(es.ColorfulAiMagic,{}),(0,r.jsx)(d.Z,{sx:{fontSize:14,fontWeight:500,color:"#AAAAAA"},children:o?"Allow Outfit Changes?":"Allow Character Outfit Changes?"}),(0,r.jsx)(tf.Z,{title:"Yes = AI may switch outfits between shots for variety. No = keep one consistent look throughout.",children:(0,r.jsx)(tx.Z,{sx:{fontSize:14,color:"#444444",cursor:"help"}})})]}),(0,r.jsxs)(s.Z,{sx:{bgcolor:"#2E2E2E",border:"1px solid #2E2E2E",borderRadius:"4px",p:"3px",display:"flex",alignItems:"center",gap:"2px",height:24},children:[(0,r.jsx)(s.Z,{onClick:()=>i(!0),sx:{width:38,height:18,borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",bgcolor:t?"#013FFE":"transparent",boxShadow:t?"1px 1px 2.1px 0px rgba(0, 21, 255, 0.38)":"none",transition:"all 0.2s ease-in-out"},children:(0,r.jsx)(d.Z,{sx:{fontSize:11,fontWeight:600,color:t?"#FFFFFF":"#666666",textAlign:"center"},children:"YES"})}),(0,r.jsx)(s.Z,{onClick:()=>i(!1),sx:{width:38,height:18,borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",bgcolor:t?"transparent":"#013FFE",boxShadow:t?"none":"1px 1px 2.1px 0px rgba(0, 21, 255, 0.38)",transition:"all 0.2s ease-in-out"},children:(0,r.jsx)(d.Z,{sx:{fontSize:11,fontWeight:600,color:t?"#666666":"#FFFFFF",textAlign:"center"},children:"NO"})})]})]})},tO=e=>{let{isActive:t,character:i,setIsDragOver:o,handleDrop:a,onClick:l,index:c,flex:u,characterBoxSize:p,handleDelete:h}=e,[m,x]=(0,n.useState)(!1),g=p<=1?eH.FC:"https://cdn.openart.ai/assets/internal/uploads/image_P4b0_MmU_237x108_1757318296958.webp";return(0,r.jsxs)(s.Z,{sx:{flex:u,position:"relative",minHeight:0,borderRadius:"8px",overflow:"hidden",backgroundColor:(null==i?void 0:i.image_url)?"#101010":"transparent",border:t?"2px solid #2F66FF":"2px solid #2E2E2E",background:(null==i?void 0:i.image_url)?"transparent":`linear-gradient(0deg, rgba(0, 0, 0, 0.36) 0%, rgba(0, 0, 0, 0.36) 100%), url(${g}) lightgray 50% / cover no-repeat`,backgroundBlendMode:"normal, luminosity"},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),o(!0),x(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),o(!1),x(!1)},onDrop:e=>{x(!1),a(e)},onClick:l,children:[(null==i?void 0:i.image_url)?null:(0,r.jsxs)(d.Z,{variant:"body2",sx:{color:"var(--Gray-900)",fontWeight:600,fontSize:12,lineHeight:"18px",whiteSpace:"nowrap",position:"absolute",top:8,left:8,zIndex:1},children:["Pick Character ",c+1]}),(0,r.jsx)(tg.Z,{src:(null==i?void 0:i.image_url)||"",alt:(null==i?void 0:i.name)||"No character selected",sx:{width:"100%",height:"100%",borderRadius:"8px",transition:"border-color 0.3s ease-in-out",position:"relative",zIndex:1,...!(null==i?void 0:i.image_url)&&{backgroundColor:"transparent","& .MuiAvatar-fallback":{display:"none"}},"& .MuiAvatar-img":{objectFit:"contain",width:"100%",height:"100%"}}}),m?(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(9, 41, 247, 0.1)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:2},children:(0,r.jsx)(d.Z,{sx:{color:"#0929F7",fontWeight:600,fontSize:"14px",textAlign:"center"},children:"Drop image to create character"})}):null,p>1?(0,r.jsx)(s.Z,{sx:{position:"absolute",top:"4px",right:"4px",zIndex:3,cursor:"pointer",backgroundColor:"rgba(0, 0, 0, 0.13)",borderRadius:"6px",padding:"4px"},onClick:h,children:(0,r.jsx)(es.PhTrash,{size:16,sx:{cursor:"pointer"}})}):null]})};function tU(e){var t;let{firstCharacter:i,onFirstCharacterSelect:o,additionalCharacters:a,onAdditionalCharactersSelect:c,error:p,showPreviewAvatar:m=!0,maxCharacters:x=2,showTitle:g=!0,characterType:f="default",outfitChangesPosition:v="separate"}=e,{isMobile:b}=(0,h.j)(),y=(0,tR.k)(),w=(0,tn.B)(),[C,j]=(0,n.useState)(a.length+1),[k,F]=(0,n.useState)(0),S=(0,n.useRef)(0),{data:I=[],isLoading:_,isSuccess:Z}=(0,tD.Wr)(),A=null==I?void 0:I.filter(e=>"completed"===e.status),[E,M]=(0,n.useState)([]),[T,R]=(0,n.useState)(!1),[D,z]=(0,n.useState)(!1),[P,W]=(0,n.useState)(),[L,B]=(0,n.useState)("all"),H=(0,n.useMemo)(()=>[i,...a],[i,a]),$=(0,n.useMemo)(()=>new Set(H.filter(Boolean).map(e=>e.id)),[H]),O=(0,n.useMemo)(()=>H[k],[H,k]),{data:U}=(0,tz.$_)(),G=tP.En.includes(null==U?void 0:U.id),[N,V]=(0,n.useState)(""),{mutateAsync:K}=(t=()=>{},(0,tb.D)({mutationFn:tZ,onSuccess:e=>{t(e)}})),[q,Y]=(0,n.useState)([]),X=(0,n.useRef)(null),Q=(0,n.useRef)({}),ee=e=>({id:e.model_id,model_name:e.character_name,image_url:e.thumbnail,modelData:e}),et=(0,n.useMemo)(()=>E.map(e=>({id:e.id,model_name:e.name,image_url:e.image_url,reference_mode:e.reference_mode})).concat(A.map(ee)),[A,E]),{data:ei,isLoading:er,isSuccess:en}=(0,tD.Lg)(f),[ea,es]=(0,n.useState)(!1);(0,n.useEffect)(()=>{i&&Z&&en&&!ea&&(M([i,...a].map(e=>(null==e?void 0:e.id)&&!((I||[]).find(t=>t.model_id===e.id)||(ei||[]).find(t=>t.id===e.id))?{id:e.id,name:e.name,image_url:e.image_url,reference_mode:e.reference_mode}:null).filter(Boolean)),es(!0))},[Z,en]);let el=(0,n.useMemo)(()=>{if(!ei)return[];let e=[...tT.fg.filter(e=>!e.visibleIn||e.visibleIn.includes(f)),...ei];if(0===q.length)return e;let t=new Set(e.map(e=>e.id));return[...q.filter(e=>!t.has(e.id)),...e]},[ei,f,q]),ed=(0,n.useCallback)(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=e.id.startsWith("local-")?{type:"custom-quick",id:e.id,name:e.model_name,image_url:e.image_url,reference_mode:"quick",allowOutfitChanges:!1}:{type:"premade",id:e.id,name:e.model_name,image_url:e.image_url,modelData:e,allowOutfitChanges:!1};0===S.current?o(t):c([t])},[o,c]),ec=(0,n.useCallback)(e=>{let t="my-character";"quick"===e.reference_mode?t="custom-quick":"train"===e.reference_mode&&(t="custom-train");let i={type:t,id:e.id,name:e.model_name,image_url:e.image_url,reference_mode:"quick",modelData:e.modelData,allowOutfitChanges:!1};0===S.current?o(i):c([i])},[o,c]),eu=async e=>{M(t=>[{...e,reference_mode:"quick"},...t]);let t={type:"custom-quick",id:e.id,name:e.name,image_url:e.image_url,reference_mode:"quick"};0===S.current?o(t):c([t])},ep=e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.files;if(t.length>0){let e=t[0];e.type.startsWith("image/")&&(W(e),R(!0))}},eh=(0,n.useCallback)(async()=>{let e=N.trim();if(!e)return;let t=et.find(t=>t.id===e);if(t){ec(t),V("");return}let i=null==ei?void 0:ei.find(t=>t.id===e);if(i){ed(i,!1),V("");return}try{let t=await K(e);t&&(Y(e=>{let i=e.some(e=>e.id===t.id),r=null==ei?void 0:ei.some(e=>e.id===t.id),n=tT.fg.some(e=>e.id===t.id);return i||r||n?e:[t,...e]}),ed(t,!1),V(""))}catch(e){console.error("Failed to fetch character by id:",e)}},[N,et,ei,ec,ed,K]);return(0,r.jsxs)(u.Z,{sx:{width:"100%",maxWidth:"100%",flexDirection:"column",gap:1},children:[g?(0,r.jsx)(d.Z,{variant:"h6",sx:{color:"#CCCCCC",fontWeight:600,flexGrow:0},children:"Pick your Star(s)"}):null,(0,r.jsxs)(J.Z,{fullWidth:!0,error:!!p,sx:{width:"100%",flexGrow:1,position:"relative",height:"max-content"},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",gap:1,alignItems:"stretch",height:"auto",flexDirection:{xs:"column",sm:"row"}},children:[m?(0,r.jsx)(s.Z,{sx:{flexShrink:0,width:{xs:"100%",sm:240},height:"character_vlog"===f?{xs:180,sm:"calc(160px + 2.5rem + 16px + 72px)"}:{xs:180,sm:450},flexBasis:{xs:"auto",sm:240},position:"relative",mx:{xs:"auto",sm:0},borderRadius:"8px",overflow:"hidden"},children:(0,r.jsxs)(u.Z,{direction:{xs:C>1?"row":"column",sm:"column"},spacing:1,sx:{position:"relative",width:"100%",height:"100%",zIndex:2},children:[Array.from({length:C},(e,t)=>({index:t,id:`character-slot-${t}`})).map((e,t)=>(0,r.jsx)(n.Fragment,{children:(0,r.jsx)(tO,{flex:8,character:H[e.index],handleDrop:ep,setIsDragOver:t=>{t&&(F(e.index),S.current=e.index)},onClick:()=>{F(e.index),S.current=e.index},index:e.index,isActive:k===e.index,characterBoxSize:C,handleDelete:()=>{j(e=>e>1?e-1:e),0===e.index?(o(null),a.length>0&&(o(a[0]),c(a.slice(1)))):(c([]),F(0))}})},e.id)),C<x&&(0,r.jsx)(tE,{starNumber:C+1,onAdd:()=>{let e=C+1;j(e),S.current=e-1,F(e-1)},sx:{flex:2,background:"linear-gradient(0deg, rgba(0, 0, 0, 0.36) 0%, rgba(0, 0, 0, 0.36) 100%), url(https://cdn.openart.ai/assets/internal/uploads/image_cxkVRkqu_237x36_1756906732223.webp) lightgray 50% / cover no-repeat",backgroundBlendMode:"normal, luminosity"}})]})}):null,(0,r.jsxs)(eb.Z,{sx:{flex:1,bgcolor:"var(--Gray-50)",borderRadius:b?1.5:"8px",p:0,position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",height:(()=>{switch(f){case"character_vlog":return{xs:180,sm:"calc(160px + 2.5rem + 16px + 72px)"};case"script_to_video":return{xs:180,sm:"calc(160px + 16px + 72px + 100px)"};default:return{xs:180,sm:450}}})()},children:[(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:b?"none":"1px solid var(--Gray-200)",px:2,py:1.5},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",gap:1,flexShrink:0},children:[(0,r.jsx)(s.Z,{onClick:()=>B("all"),sx:{px:2,py:.5,borderRadius:"4px",backgroundColor:"all"===L?"#2E2E2E":"transparent",cursor:"pointer",transition:"all 0.2s ease","@media (hover: hover)":{"&:hover":{backgroundColor:"all"===L?"#2E2E2E":"rgba(46, 46, 46, 0.5)"}}},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"all"===L?"var(--Gray-800)":"var(--Gray-400)",fontWeight:"all"===L?600:400,fontSize:14,whiteSpace:"nowrap"},children:"All"})}),(0,r.jsx)(s.Z,{onClick:()=>B("my"),sx:{px:2,py:.5,borderRadius:"4px",backgroundColor:"my"===L?"#2E2E2E":"transparent",cursor:"pointer",transition:"all 0.2s ease","@media (hover: hover)":{"&:hover":{backgroundColor:"my"===L?"#2E2E2E":"rgba(46, 46, 46, 0.5)"}}},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"my"===L?"var(--Gray-800)":"var(--Gray-400)",fontWeight:"my"===L?600:400,fontSize:14,whiteSpace:"nowrap"},children:"My Characters"})}),(0,r.jsx)(s.Z,{onClick:()=>B("community"),sx:{px:2,py:.5,borderRadius:"4px",backgroundColor:"community"===L?"#2E2E2E":"transparent",cursor:"pointer",transition:"all 0.2s ease","@media (hover: hover)":{"&:hover":{backgroundColor:"community"===L?"#2E2E2E":"rgba(46, 46, 46, 0.5)"}}},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"community"===L?"var(--Gray-800)":"var(--Gray-400)",fontWeight:"community"===L?600:400,fontSize:14,whiteSpace:"nowrap"},children:"Community"})})]})}),(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,minHeight:0,p:{xs:1.5,sm:2},overflow:"hidden",maxHeight:{xs:G?"calc(160px + 2.5rem + 16px + 24px + 56px)":"calc(160px + 2.5rem + 16px + 24px)",sm:G?"calc(216px + 2.5rem + 16px + 32px + 56px)":"calc(216px + 2.5rem + 16px + 32px)"}},children:[(0,r.jsxs)(s.Z,{ref:X,sx:{display:"grid",gridTemplateColumns:{xs:"repeat(auto-fill, 80px)",sm:"repeat(auto-fill, minmax(80px, 1fr))"},gridTemplateRows:{xs:"repeat(2, 80px)",sm:"auto"},gridAutoFlow:{xs:"column",sm:"row"},gap:2.5,overflowY:{xs:"hidden",sm:"auto"},overflowX:{xs:"auto",sm:"hidden"},flex:1,minHeight:0,alignContent:"start",padding:1,"& > *":{justifySelf:"center"},WebkitOverflowScrolling:"touch",scrollbarWidth:{xs:"thin",sm:"thin"},scrollbarColor:{xs:"var(--Gray-300) var(--Gray-100)",sm:"var(--Gray-300) var(--Gray-100)"},"&::-webkit-scrollbar":{height:"8px",width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"var(--Gray-100)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"var(--Gray-300)",borderRadius:"4px","&:hover":{backgroundColor:"var(--Gray-400)"}}},children:["all"===L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tB,{size:80,onClick:()=>{w({onAuthenticated:()=>R(!0)})}}),y&&_?(0,r.jsx)(tH,{size:80,count:2}):y&&et.map(e=>(0,r.jsx)(tL,{character:e,isSelected:(null==O?void 0:O.id)===e.id,isAlreadySelected:$.has(e.id),size:80,onCharacterSelect:ec},e.id)),er?(0,r.jsx)(tH,{size:80,count:14}):el.map(e=>(0,r.jsx)(tW,{character:e,isSelected:(null==O?void 0:O.id)===e.id,isAlreadySelected:$.has(e.id),size:80,onCharacterSelect:e=>ed(e,!1),characterRef:t=>{Q.current[e.id]=t}},e.id))]}),"my"===L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tB,{size:80,onClick:()=>{w({onAuthenticated:()=>R(!0)})}}),y&&_?(0,r.jsx)(tH,{size:80,count:4}):y&&et.map(e=>(0,r.jsx)(tL,{character:e,isSelected:(null==O?void 0:O.id)===e.id,isAlreadySelected:$.has(e.id),size:80,onCharacterSelect:ec},e.id))]}),"community"===L&&(er?(0,r.jsx)(tH,{size:80,count:21}):el.map(e=>(0,r.jsx)(tW,{character:e,isSelected:(null==O?void 0:O.id)===e.id,isAlreadySelected:$.has(e.id),size:80,onCharacterSelect:e=>ed(e,!1),characterRef:t=>{Q.current[e.id]=t}},e.id)))]}),G?(0,r.jsxs)(s.Z,{sx:{display:"flex",gap:1,alignItems:"center",pt:2,flexShrink:0},children:[(0,r.jsx)(eo.Z,{variant:"outlined",size:"small",fullWidth:!0,placeholder:"Enter character model id (team only)",value:N,onChange:e=>V(e.target.value),onKeyDown:e=>{"Enter"===e.key&&eh()},sx:{maxWidth:480}}),(0,r.jsx)(l.Z,{variant:"contained",size:"small",onClick:eh,children:"Apply"})]}):null]}),(null==O?void 0:O.type)!=="custom-quick"&&"overall"===v?(0,r.jsx)(s.Z,{sx:{borderTop:b?"none":"1px solid var(--Gray-200)",px:2,py:1.5},children:(0,r.jsx)(t$,{allowOutfitChanges:null==O?void 0:O.allowOutfitChanges,onToggle:e=>{let t={...H[S.current],allowOutfitChanges:e};0===S.current?o(t):c([t])}})}):null]})]}),p?(0,r.jsx)(tv.Z,{children:p}):null,(null==O?void 0:O.type)!=="custom-quick"&&"separate"===v?(0,r.jsx)(t$,{allowOutfitChanges:null==O?void 0:O.allowOutfitChanges,sx:{p:2},onToggle:e=>{let t={...H[S.current],allowOutfitChanges:e};0===S.current?o(t):c([t])}}):null]}),(0,r.jsx)(tA.K,{open:T,onClose:()=>{R(!1),W(void 0)},onCharacterCreated:eu,initialFile:P}),(0,r.jsx)(tM.n,{open:D,onClose:()=>z(!1),onCharacterSelect:e=>ed(e,!0),selectedCharacter:O,characterType:f})]})}let tG=e=>{var t,i;if(!e||0===e.length)return[];let r=(null===(t=e[0])||void 0===t?void 0:t.name)||"Character",n=null===(i=e[1])||void 0===i?void 0:i.name;return 1!==e.length&&n?[{title:"\uD83D\uDECD️ Shopping Together",description:`@${r} and @${n} are shopping together`},{title:"\uD83C\uDF55 Cooking Date",description:`@${r} and @${n} are making pizza together in the kitchen`},{title:"✈️ Travel Adventure",description:`@${r} and @${n} are exploring the beautiful streets of Paris together`},{title:"\uD83C\uDFAE Gaming Session",description:`@${r} and @${n} are playing video games together`},{title:"☕ Coffee Chat",description:`@${r} is having coffee with @${n} at a cozy cafe`}]:[{title:"\uD83D\uDECD️ Shopping",description:`@${r} is shopping`},{title:"\uD83E\uDDD6 Spa Day",description:`@${r} is having a relaxing spa day`},{title:"\uD83C\uDF55 Make Pizza",description:`@${r} is making pizza in the kitchen`},{title:"✈️ Traveling",description:`@${r} is exploring the beautiful streets of Paris`},{title:"\uD83C\uDFAE Gaming",description:`@${r} is playing video game in the bedroom`}]};function tN(e){let{value:t,onChange:o,error:a,selectedCharacter:l,additionalCharacters:c}=e,u=(0,n.useRef)(null),p=(0,n.useRef)(null),h=(0,n.useRef)(!1),m=(0,n.useRef)(new Set),[x,g]=(0,n.useState)(l),[f,v]=(0,n.useState)(c),[b,y]=(0,n.useState)(""),w=(0,n.useCallback)((e,t)=>{let i=setTimeout(()=>{m.current.delete(i),e()},t);return m.current.add(i),i},[]);(0,n.useEffect)(()=>{let e=m.current;return()=>{e.forEach(clearTimeout),e.clear()}},[]);let C=(0,n.useMemo)(()=>{if(!l)return[];let e=[];return e.push(l),c&&c.length>0&&e.push(...c),e.filter((e,t,i)=>i.findIndex(t=>t.id===e.id)===t).map(e=>({key:e.name,value:e.name}))},[l,c]);(0,n.useEffect)(()=>{if(l&&b&&y(""),l!==x){if(g(l),l&&!x&&(!t||""===t.trim())){o("<<THE_MARKER>> "),w(()=>{if(u.current){let e=document.createRange(),t=window.getSelection();e.selectNodeContents(u.current),e.collapse(!1),null==t||t.removeAllRanges(),null==t||t.addRange(e),u.current.focus()}},100);return}if(l&&x&&l.id!==x.id){let e=t||"";if(e.includes("<<THE_MARKER>>")){if(u.current){let t=k(e);u.current.innerHTML=t,u.current.querySelectorAll(".mention-text").forEach(e=>{e.setAttribute("contenteditable","false")})}}else e&&!e.endsWith(" ")&&(e+=" "),o(e+="<<THE_MARKER>> "),w(()=>{if(u.current){let e=document.createRange(),t=window.getSelection();e.selectNodeContents(u.current),e.collapse(!1),null==t||t.removeAllRanges(),null==t||t.addRange(e),u.current.focus()}},100);return}if(!l&&x){let e=t||"";o(e=(e=e.replaceAll("<<THE_MARKER>>","")).replaceAll(/\s+/g," ").trim());return}}},[l,x,t,o,b,w]),(0,n.useEffect)(()=>{let e=c||[],i=f||[];if(e.length!==i.length||e.some((e,t)=>{var r;return(null==e?void 0:e.id)!==(null===(r=i[t])||void 0===r?void 0:r.id)})){v(c);let r=t||"",n=!1,a=Math.max(e.length,i.length);for(let t=0;t<a;t++){let o=e[t],a=i[t],s=(0,eH.R4)(t);a&&!o?r.includes(s)&&(r=r.replaceAll(s,""),n=!0):!a&&o?(r&&!r.endsWith(" ")&&(r+=" "),r+=`${s} `,n=!0):a&&o&&a.id!==o.id&&(n=!1,u.current&&r.includes(s)&&w(()=>{if(u.current){let e=k(r);u.current.innerHTML=e,u.current.querySelectorAll(".mention-text").forEach(e=>{e.setAttribute("contenteditable","false")})}},0))}n&&(r=r.replaceAll(/\s+/g," ").trim()),n&&r!==t&&(o(r),w(()=>{if(u.current){let e=document.createRange(),t=window.getSelection();e.selectNodeContents(u.current),e.collapse(!1),null==t||t.removeAllRanges(),null==t||t.addRange(e),u.current.focus()}},100))}},[c,f,t,o,w]);let j=(0,n.useCallback)(e=>{if(e.nodeType===Node.TEXT_NODE)return e;for(let i=e.childNodes.length-1;i>=0;i--){var t;let r=e.childNodes[i];if(r.nodeType===Node.TEXT_NODE&&(null===(t=r.textContent)||void 0===t?void 0:t.trim()))return r;if(r.nodeType===Node.ELEMENT_NODE){let e=j(r);if(e)return e}}return null},[]),k=(0,n.useCallback)(e=>{let t=e.replaceAll("\n","<br>");if(l){let e=`<span class="mention-text" data-character-id="${l.id}" contenteditable="false" data-character-name="${l.name}">@${l.name}</span>`;t=t.replaceAll("<<THE_MARKER>>",e)}return c&&c.length>0&&c.forEach((e,i)=>{let r=(0,eH.R4)(i),n=`<span class="mention-text" data-character-id="${e.id}" contenteditable="false" data-character-name="${e.name}">@${e.name}</span>`;t=t.replaceAll(r,n)}),t},[l,c]),F=(0,n.useCallback)(e=>{let t=e,i=document.createElement("div");return i.innerHTML=e,i.querySelectorAll(".mention-text").forEach(e=>{let i=e.dataset.characterId,r=e.textContent||"";l&&i===l.id&&(t=t.replace(r,"<<THE_MARKER>>")),c&&c.length>0&&c.forEach((e,n)=>{if(i===e.id){let e=(0,eH.R4)(n);t=t.replace(r,e)}})}),l&&l.name&&RegExp(`@${l.name.replaceAll(/[.*+?^${}()|[\]\\]/g,String.raw`\$&`)}`,"g").test(t)&&(t=t.replaceAll(`@${l.name}`,"<<THE_MARKER>>")),c&&c.length>0&&c.forEach((e,i)=>{if(e.name&&RegExp(`@${e.name.replaceAll(/[.*+?^${}()|[\]\\]/g,String.raw`\$&`)}`,"g").test(t)){let r=(0,eH.R4)(i);t=t.replaceAll(`@${e.name}`,r)}}),t},[l,c]),S=(0,n.useCallback)(()=>{if(!u.current)return;let e=u.current.innerHTML,t=u.current.textContent||"",i=F(t);b&&y(""),!(()=>{if(!e.includes("mention-text"))return!0;let i=!1;return l&&t.includes(`@${l.name}`)&&(i=!0),c&&c.length>0&&c.forEach(e=>{t.includes(`@${e.name}`)&&(i=!0)}),i})()&&e.includes("mention-text")&&(u.current.innerHTML=t),o(i)},[F,l,c,o,b]);(0,n.useEffect)(()=>{if(!u.current)return;let e=e=>{var t;e.preventDefault();let i=((null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text/plain"))??"").replaceAll(/\n\s*\n/g,"\n").trim();document.execCommand("insertText",!1,i)},t=e=>{var t,i,r,n,a,s,l,d;if(!h.current){if("Backspace"===e.key||"Delete"===e.key){let d=window.getSelection();if(!d||0===d.rangeCount)return;let c=d.getRangeAt(0);if(d.toString()===(null===(t=u.current)||void 0===t?void 0:t.textContent)){e.preventDefault(),u.current&&(u.current.innerHTML="",o(""));return}let p=null===(i=c.startContainer.parentElement)||void 0===i?void 0:i.closest(".mention-text");if(p){e.preventDefault(),p.remove(),u.current&&(!u.current.textContent||""===u.current.textContent.trim())?(u.current.innerHTML="",o("")):S();return}if("Backspace"===e.key&&c.collapsed&&u.current){let t=c.startContainer,i=c.startOffset;if(t.nodeType===Node.TEXT_NODE&&0===i){let i=t.previousSibling;if(i&&(null===(r=i.classList)||void 0===r?void 0:r.contains("mention-text"))){e.preventDefault(),i.remove(),w(()=>{u.current&&(""===(u.current.textContent||"").trim()?(u.current.innerHTML="",o("")):S())},0);return}}let d=u.current.querySelectorAll(".mention-text");if(d.length>0&&(t===u.current||t.nodeType===Node.TEXT_NODE&&0===i&&(null===(a=t.previousSibling)||void 0===a?void 0:null===(n=a.classList)||void 0===n?void 0:n.contains("mention-text")))){let i=null;if((null===(l=t.previousSibling)||void 0===l?void 0:null===(s=l.classList)||void 0===s?void 0:s.contains("mention-text"))?i=t.previousSibling:t===u.current&&d.length>0&&(i=Array.from(d).at(-1)||null),i){e.preventDefault(),i.remove(),w(()=>{u.current&&(""===(u.current.textContent||"").trim()?(u.current.innerHTML="",o("")):S())},0);return}}}}else if("Enter"===e.key){let t=window.getSelection();if(!t||0===t.rangeCount)return;let i=null===(d=t.getRangeAt(0).startContainer.parentElement)||void 0===d?void 0:d.closest(".mention-text");if(i){e.preventDefault();let r=document.createRange();r.setStartAfter(i),r.collapse(!0),t.removeAllRanges(),t.addRange(r)}}}},r=e=>{let t=e.target.closest(".mention-text");if(t){e.preventDefault();let i=window.getSelection(),r=document.createRange();r.setStartAfter(t),r.collapse(!0),null==i||i.removeAllRanges(),null==i||i.addRange(r)}},n=()=>{var e;let t=window.getSelection();if(!t||0===t.rangeCount)return;let i=null===(e=t.getRangeAt(0).startContainer.parentElement)||void 0===e?void 0:e.closest(".mention-text");if(i){let e=document.createRange();e.setStartAfter(i),e.collapse(!0),t.removeAllRanges(),t.addRange(e)}},a=e=>{h.current=!0},s=e=>{h.current=!1},l=e=>{w(()=>{u.current&&(u.current.querySelectorAll(".mention-text").forEach(e=>{e.setAttribute("contenteditable","false")}),o(F(u.current.textContent||"")))},0)},d=u.current;return d.addEventListener("paste",e),d.addEventListener("keydown",t),d.addEventListener("click",r),document.addEventListener("selectionchange",n),p.current&&(p.current.detach(d),p.current=null),i.e(7233).then(i.t.bind(i,27233,23)).then(e=>{let t=e.default;if(document.querySelectorAll(".vlog-tribute-container").forEach(e=>e.remove()),p.current=new t({trigger:"@",values:C,menuContainer:document.body,positionMenu:!0,selectTemplate:e=>e?`<span class="mention-text" data-character-id="${e.original.value}" contenteditable="false" data-character-name="${e.original.key}">@${e.original.key}</span>&nbsp;`:"",containerClass:"tribute-container vlog-tribute-container",menuItemTemplate:e=>`<div class="mention-item">@${e.original.key}</div>`,noMatchTemplate:()=>C&&C.length>0?'<div class="mention-item no-match">No matches found</div>':'<div class="mention-item no-match">Please select a character first</div>',allowSpaces:!0,requireLeadingSpace:!1,replaceTextSuffix:"",menuShowMinLength:0,autocompleteMode:!1,selectClass:"highlight"}),u.current){p.current.attach(u.current);let e=u.current;e.addEventListener("tribute-active-true",a),e.addEventListener("tribute-active-false",s),e.addEventListener("tribute-replaced",l)}}).catch(e=>{console.error("Failed to load tributejs:",e)}),()=>{p.current&&d&&p.current.detach(d),d.removeEventListener("paste",e),d.removeEventListener("keydown",t),d.removeEventListener("click",r),document.removeEventListener("selectionchange",n),d.removeEventListener("tribute-active-true",a),d.removeEventListener("tribute-active-false",s),d.removeEventListener("tribute-replaced",l)}},[C,F,o,w,S,l]),(0,n.useEffect)(()=>{u.current&&F(u.current.textContent||"")!==t&&(t.includes("<<THE_MARKER>>")&&l?(u.current.innerHTML=k(t),u.current.querySelectorAll(".mention-text").forEach(e=>{e.setAttribute("contenteditable","false")})):u.current.textContent=t)},[t,F,k,l]);let I=(0,n.useMemo)(()=>{if(!l)return"Please select a character first to describe their activities...";if(c&&c.length>0){let e=c[0].name;return`@${l.name} and @${e} are making pizza together in the kitchen`}return`@${l.name} is making pizza in the kitchen`},[l,c]),_=(0,n.useCallback)(e=>{if(!l){y("Please select a character first to use activity suggestions.");return}y("");let t=e,i=`@${l.name}`;t=t.replace(i,"<<THE_MARKER>>"),c&&c.length>0&&c.forEach((e,i)=>{let r=`@${e.name}`,n=(0,eH.R4)(i);t=t.replace(r,n)}),o(t)},[l,c,o]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("style",{children:`
        .vlog-tribute-container {
          position: absolute !important;
          background-color: #2E2E2E !important;
          border: 1px solid #444444 !important;
          border-radius: 4px !important;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
          z-index: 10000 !important;
          max-height: 200px !important;
          overflow-y: auto !important;
        }
        
        .vlog-tribute-container .tribute-item,
        .vlog-tribute-container .mention-item {
          padding: 8px 16px !important;
          color: #E0E0E0 !important;
          font-size: 14px !important;
          cursor: pointer !important;
          border: none !important;
          background: none !important;
        }
        
        .vlog-tribute-container .tribute-item:hover,
        .vlog-tribute-container .mention-item:not(.no-match):hover,
        .vlog-tribute-container .tribute-item.highlight,
        .vlog-tribute-container .mention-item.highlight {
          color: #6290FF !important;
          background-color: #3E3E3E !important;
        }
        
        .vlog-tribute-container .no-match {
          color: #999999 !important;
          cursor: default !important;
        }
        
        .mention-text {
          color: #6290FF !important;
          font-weight: 500 !important;
          margin: 0 1px !important;
          display: inline-block !important;
          user-select: none !important;
        }
      `}),(0,r.jsxs)(s.Z,{sx:{mb:4,position:"relative"},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,r.jsx)(s.Z,{sx:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,r.jsx)("path",{d:"M4 6h16M4 12h16M4 18h16",stroke:"#CCCCCC",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,r.jsx)(d.Z,{variant:"h6",sx:{color:"#CCCCCC",fontWeight:500,fontSize:{xs:14,md:16}},children:"Vlog Topic"})]}),!1,(0,r.jsxs)(s.Z,{sx:{backgroundColor:"#101010",borderRadius:1,p:1.5,border:"1px solid transparent",position:"relative",minHeight:60,"&:focus-within":{borderColor:"#339597"}},children:[(0,r.jsx)(s.Z,{ref:u,contentEditable:!0,onInput:S,sx:{width:"100%",minHeight:40,color:"primary.main",bgcolor:"transparent",caretColor:"white",fontSize:14,fontWeight:500,lineHeight:"1.43em",border:"none",outline:"none",whiteSpace:"pre-wrap",wordBreak:"break-word","&:empty::before":{content:`"${I}"`,color:"#666666",pointerEvents:"none"}}}),(0,r.jsx)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,gap:2},children:(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:(()=>{let e=[];return l&&e.push(l),c&&e.push(...c),tG(e).map((e,t)=>(0,r.jsx)(ey.Z,{label:e.title,onClick:()=>_(e.description),clickable:!0,sx:{backgroundColor:"#2E2E2E",color:"#E0E0E0",fontSize:{xs:12,sm:14},fontWeight:500,height:"auto",py:{xs:.25,sm:.5},px:{xs:1,sm:1.5},borderRadius:"9999px","&:hover":{backgroundColor:"#3E3E3E"},"& .MuiChip-label":{padding:{xs:"2px 0",sm:"4px 0"}}}},t))})()})})]}),a||b?(0,r.jsx)(d.Z,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:a||b}):null]})]})}var tV=i(75616),tK=i(69491),tq=i(22112),tY=i(6139);let tX=eB.Ry({character:eB.PG().refine(e=>null!=e,{message:"Please select a character"}),additional_characters:eB.IX(eB.PG()).optional(),activity:eB.Z_().min(1,"Please describe the activity"),aspectRatio:eB.Z_().min(1,"Please select an aspect ratio"),title:eB.Z_().min(1,"Please enter a title"),background_music:eB.Z_().nullable().optional(),imageModelConfig:eB.PG(),videoModelConfig:eB.PG(),expected_duration_seconds:eB.Rx().int().refine(e=>[30,60,90,120,150,180].includes(e),"Unsupported duration")}),tJ={character:null,additional_characters:[],activity:"",aspectRatio:"16:9",title:"My Character Vlog",background_music:"auto",imageModelConfig:{model:"character",parameters:{}},videoModelConfig:eH.Zc.value,expected_duration_seconds:30};function tQ(e){var t,i;let{onSubmit:a}=e,l=(0,tn.B)(),{errors:u,isGenerating:p,isRedirecting:h,selectedCharacter:g,additionalCharacters:f,activity:v,aspectRatio:b,backgroundMusic:y,expectedDurationSeconds:w,expandedPanels:C,imageModelConfig:j,videoModelConfig:k,imageModelOptions:F,videoModelOptions:S,handleCharacterSelect:I,handleActivityChange:_,handleTogglePanel:Z,handleAspectRatioSelect:A,handleModelSelect:E,handleBackgroundMusicChange:M,handleExpectedDurationChange:T,handleAdditionalCharacterSelect:R,onFormSubmit:D,onPreviewSubmit:P,MobilePreviewDialogComponent:W}=function(e){var t,i,r,a,s,l;let{onSubmit:d}=e,u=(0,o.useRouter)(),{isMobile:p,showMobilePreviewDialog:h,MobilePreviewDialogComponent:m}=eU(),[x,g]=(0,n.useState)({advancedSettings:!1,backgroundMusic:!1}),[f,v]=(0,n.useState)(!1),[b,y]=(0,n.useState)(!1),[w,C]=(0,n.useState)(null),{data:j}=(0,e7.w)(w,!!w);(0,n.useEffect)(()=>{var e;(null==j?void 0:null===(e=j.story)||void 0===e?void 0:e.id)&&b&&(y(!1),C(null),u.push(`/story/editor?story_id=${j.story.id}&view=list`))},[j,b,u]);let k=eG.E.getState().consumePrefill("character_vlog"),F=(0,eL.cI)({mode:"onChange",defaultValues:{...tJ,...k&&{character:null==k.character?tJ.character:(0,tK.ow)(k.character),additional_characters:null==k.additional_characters?tJ.additional_characters:(k.additional_characters||[]).map(e=>(0,tK.ow)(e)),activity:k.vlog_topic??tJ.activity,aspectRatio:k.aspect_ratio??tJ.aspectRatio,title:k.title??tJ.title,background_music:null==k.background_music?tJ.background_music:(0,eH.fz)(k),imageModelConfig:(null===(t=k.advanced_settings)||void 0===t?void 0:t.image_model_config)?null===(i=(0,eH.O8)(null===(r=k.advanced_settings)||void 0===r?void 0:r.image_model_config,eH.Fj))||void 0===i?void 0:i.value:tJ.imageModelConfig,videoModelConfig:(null===(a=k.advanced_settings)||void 0===a?void 0:a.video_model_config)?null===(s=(0,eH.O8)(null===(l=k.advanced_settings)||void 0===l?void 0:l.video_model_config,eH.E5))||void 0===s?void 0:s.value:tJ.videoModelConfig}},resolver:(0,eW.F)(tX)}),{handleSubmit:S,formState:{errors:I},setValue:_,watch:Z,setError:A,clearErrors:E}=F,M=Z("character"),T=Z("activity"),R=Z("aspectRatio"),D=Z("background_music"),z=Z("imageModelConfig"),P=Z("videoModelConfig"),W=Z("additional_characters"),L=Z("expected_duration_seconds"),{mutate:B,isLoading:H}=(0,tq.EY)(!1),$=(0,n.useMemo)(()=>(0,eH._p)(M),[M]),O=(0,n.useMemo)(()=>W&&W.length>0?eH.Fj.filter(e=>"seedream4"===e.value.model).map(e=>({name:e.name,icon:e.icon,disabled:!1,value:e.value})):(0,eH.FA)(eH.Fj,z).map(e=>({name:e.name,icon:e.icon,disabled:(0,eH.Rx)(e.value)&&$||!!M&&"quick"!==M.reference_mode&&"nano-banana"===e.value.model,value:e.value})),[W,$,M,z]),U=(0,n.useMemo)(()=>eH.E5.map(e=>({name:e.name,icon:e.icon,value:e.value})),[]);(0,n.useEffect)(()=>{if(M&&$){let e=eH.Fj.find(e=>(0,eH.Pb)(e.value));(null==e?void 0:e.value)&&_("imageModelConfig",e.value)}},[M,$,_]);let G=(0,n.useCallback)(e=>{var t;_("character",e),E("character"),_("imageModelConfig",null===(t=eH.Fj.find(e=>"Character"===e.name))||void 0===t?void 0:t.value)},[_,E]),N=(0,n.useCallback)(e=>{_("activity",e),E("activity")},[_,E]),V=(0,n.useCallback)(e=>{if(_("additional_characters",e),e.length>0){var t;_("imageModelConfig",null===(t=eH.Fj.find(e=>(0,eH.Pb)(e.value)))||void 0===t?void 0:t.value)}else _("imageModelConfig",tJ.imageModelConfig);E("additional_characters")},[_,E]),K=(0,n.useCallback)(e=>{g(t=>({...t,[e]:!t[e]}))},[]),q=(0,n.useCallback)(e=>{_("aspectRatio",e)},[_]),Y=(0,n.useCallback)((e,t)=>{if("imageModel"===e){let e=eH.Fj.find(e=>e.name===t);if(e){if((0,eH.Rx)(e.value)&&$||M&&"quick"!==M.reference_mode&&"nano-banana"===e.value.model)return;_("imageModelConfig",e.value)}}else if("videoModel"===e){let e=eH.E5.find(e=>e.name===t);e&&_("videoModelConfig",e.value)}},[_,$,M]),X=(0,n.useCallback)(e=>{_("background_music",e),E("background_music")},[_,E]),J=(0,n.useCallback)(e=>{_("expected_duration_seconds",e)},[_]),Q=(0,n.useCallback)(()=>{F.reset({character:tJ.character,activity:tJ.activity,aspectRatio:tJ.aspectRatio,title:tJ.title,background_music:tJ.background_music,imageModelConfig:tJ.imageModelConfig,videoModelConfig:tJ.videoModelConfig,expected_duration_seconds:tJ.expected_duration_seconds}),g({advancedSettings:!1,backgroundMusic:!1})},[F]),ee=(0,tV.NL)(),et=async(e,t)=>{var i;let r;if(e.character&&!e.activity.includes("<<THE_MARKER>>")){A("activity",{message:'Please use @ to mention the character in your vlog topic (e.g., "@character is cooking dinner")'});return}t&&y(!0),c.IP.getState().updateFormData({selectedCharacter:e.character,oneSentenceStory:e.activity,aspectRatio:e.aspectRatio,title:e.title});let n=(0,eH.ZX)(e.character),o=(()=>{var t;let i=e.expected_duration_seconds||30,r=null===(t=e.videoModelConfig)||void 0===t?void 0:t.model,n=5;"MiniMax-Hailuo-02"===r?n=6:"creatify-aurora"===r&&(n=15);let o=Math.floor(i/n),a=i-o*n;return 0===o?i>0?1:0:a>1?o+1:o})(),a="number"!=typeof e.expected_duration_seconds||30===e.expected_duration_seconds,s=(r=a?6:o,Math.max(1,Math.min(a?20:90,r)));B({title:e.title,character:n,aspect_ratio:"9:16"===e.aspectRatio?"9:16":"16:9",vlog_topic:e.activity,advanced_settings:{image_model_config:e.imageModelConfig,video_model_config:e.videoModelConfig},background_music:e.background_music,expected_duration_seconds:e.expected_duration_seconds,num_shots:s,...t&&{is_preview:!0},additional_characters:null===(i=e.additional_characters)||void 0===i?void 0:i.map(e=>(0,eH.ZX)(e))},{onSuccess:e=>{e.workflowRunId?(v(!0),t?p?h():C(e.workflowRunId):u.push(`/story/create/workflow/${e.workflowRunId}`)):d(),ee.invalidateQueries({queryKey:[tY.O]})},onError:e=>{t&&y(!1),A("root",{message:e instanceof Error?e.message:"Failed to generate character vlog"})}})};return{form:F,errors:I,isGenerating:H||b,isRedirecting:f,selectedCharacter:M,activity:T,aspectRatio:R,backgroundMusic:D,imageModelConfig:z,videoModelConfig:P,expectedDurationSeconds:L,expandedPanels:x,isCustomCharacter:$,imageModelOptions:O,videoModelOptions:U,additionalCharacters:W,handleCharacterSelect:G,handleActivityChange:N,handleTogglePanel:K,handleAspectRatioSelect:q,handleModelSelect:Y,handleBackgroundMusicChange:X,handleExpectedDurationChange:J,handleAdditionalCharacterSelect:V,onFormSubmit:S(e=>{et(e,!1)}),onPreviewSubmit:S(e=>{et(e,!0)}),resetForm:Q,MobilePreviewDialogComponent:m}}({onSubmit:a}),L=Object.entries(u).reduce((e,t)=>{let[i,r]=t;return(null==r?void 0:r.message)&&(e[i]={message:r.message}),e},{}),{totalCredits:B,totalCreditsExcludingVideoGeneration:H}=(0,th.q8)("story.character_vlog",{advanced_settings:{image_model_config:j,video_model_config:k},expected_duration_seconds:w}),[$]=(0,z.f)("story",{},{oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[B," credits"]})]}),newUI:(e,t,i)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK,textDecoration:"line-through"},children:[B," credits"]}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:"bold",fontSize:"12px",lineHeight:"1em",color:"#BFBFBF"},children:[(0,r.jsx)("span",{style:{color:tp.MK},children:t})," FREE Story Left"]})]}),upgradeDailyNewUI:null}),[O]=(0,z.f)("story",{},{disabled:!0,oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[H," credits"]})]}),newUI:(e,t,i)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[H," credits"]})]}),upgradeDailyNewUI:null});return(0,r.jsxs)(s.Z,{component:"form",onSubmit:e=>{e.preventDefault(),l({onAuthenticated:()=>D(e)})},sx:{display:"flex",flexDirection:"column",maxWidth:800,mx:"auto",mt:{xs:2,md:8},minHeight:"100vh"},children:[(0,r.jsxs)(s.Z,{sx:{flex:1,pb:2},children:[(0,r.jsx)(s.Z,{sx:{mb:2},children:(0,r.jsx)(tU,{firstCharacter:g,additionalCharacters:f,onFirstCharacterSelect:I,onAdditionalCharactersSelect:R,error:null===(t=u.character)||void 0===t?void 0:t.message,characterType:"character_vlog"})}),(0,r.jsx)(tN,{value:v,onChange:_,error:null===(i=u.activity)||void 0===i?void 0:i.message,selectedCharacter:g,additionalCharacters:f}),(0,r.jsx)(x,{value:b,onChange:A,sx:{mb:4}}),(0,r.jsx)(Y,{defaultMusicType:y?"upload":"auto",value:y,onChange:M,expanded:C.backgroundMusic,onExpandChange:(e,t)=>{t!==C.backgroundMusic&&Z("backgroundMusic")}}),(0,r.jsx)(s.Z,{sx:{mb:4},children:(0,r.jsx)(m,{icon:(0,r.jsx)(ta.Z,{sx:{color:"#CCCCCC",fontSize:20}}),title:"Video Duration",rightSide:(0,r.jsx)(J.Z,{sx:{width:200},children:(0,r.jsx)(Q.Z,{value:String(w),onChange:e=>T(parseInt(String(e.target.value),10)),displayEmpty:!0,sx:{backgroundColor:"#101010",borderRadius:"8px",height:"40px",color:"#FFFFFF",border:"1px solid transparent","&:hover":{border:"1px solid #333"},"&.Mui-focused":{border:"1px solid #2F66FF"},"& .MuiOutlinedInput-notchedOutline":{border:"none"},"& .MuiSelect-select":{padding:"8px 12px"},"& .MuiSelect-icon":{color:"#666666",fontSize:"16px"}},MenuProps:{PaperProps:{sx:{border:"1px solid #2e2e2e",borderRadius:"8px",mt:.5,minWidth:"160px","& .MuiMenuItem-root":{margin:"0px",minHeight:"auto",padding:"10px 12px","&:not(:last-child)":{borderBottom:"1px solid #2E2E2E"}}}}},children:[30,60,90,120,150,180].map(e=>(0,r.jsx)(N.Z,{value:String(e),children:(0,r.jsxs)(d.Z,{sx:{fontSize:14,color:"#FFFFFF"},children:[e,"s"]})},e))})})})}),(0,r.jsx)(s.Z,{sx:{mb:5},children:(0,r.jsx)(tc,{imageModelConfig:j,videoModelConfig:k,imageModelOptions:F,videoModelOptions:S,onModelSelect:E,expanded:C.advancedSettings,onChange:(e,t)=>{t!==C.advancedSettings&&Z("advancedSettings")}})})]}),(0,r.jsx)(et.i,{storyType:"vlog",isGenerating:p||h,disabled:p||h,errors:L,showCreditInfo:!0,promoQuotaUI:$,previewPromoQuotaUI:O,onCreateStory:D,onCreatePreview:()=>{l({onAuthenticated:()=>P()})}}),(0,r.jsx)(W,{})]})}var t0=i(27574),t1=i(12853),t2=e=>{let{value:t=!0,onChange:i}=e;return(0,r.jsx)(m,{icon:(0,r.jsx)(es.PhSlideshow,{size:20}),title:"Animated Video",titleHelp:(0,r.jsx)(tf.Z,{title:"ON = adds motion to each lyric shot. OFF = keeps each lyric on a still frame.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:16,sx:{color:"#BFBFBF"}})})}),rightSide:(0,r.jsx)(t1.r,{checked:t,onChange:e=>null==i?void 0:i(e.target.checked)})})};let t5=eB.Ry({musicUrl:eB.Z_().url(),musicDuration:eB.Rx(),aspectRatio:eB.Km(["16:9","9:16"]),advancedSettings:eB.Ry({imageModelConfig:eB.PG(),videoModelConfig:eB.PG()}),skipVideoGeneration:eB.O7().default(!0)}),t6={musicUrl:"",musicDuration:0,aspectRatio:"16:9",advancedSettings:{imageModelConfig:{model:"seedream4",parameters:{}},videoModelConfig:{model:"seedance-v1",parameters:{resolution:"720p",duration:5,videoMode:"lite"}}},skipVideoGeneration:!0},t4=e=>["seedream4","qwen-image","flux_kontext","nano-banana"].includes(e.model);var t3=i(65567),t8=i(5082),t9=i(81144),t7=i(23187),ie=i(46740),it=i(63108),ii=i(14930),ir=i(64150),io=i(75542);let ia=R.WK.map(e=>({id:e.id.toString(),title:e.name,artist:"OpenArt",url:e.url,duration:e.duration}));function is(e){let{onSelectMusic:t}=e,i=(0,e$.Z)(),o=(0,ii.Z)(i.breakpoints.down("md")),a=(0,ii.Z)(i.breakpoints.down("sm")),c=()=>a?2:o?3:4,[u,p]=(0,n.useState)(()=>{let e=c();return ia.slice(-e)}),[h,m]=(0,n.useState)(null),[x,g]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!0),b=(0,n.useCallback)(async()=>{g(!0),v(!1),await new Promise(e=>setTimeout(e,200));let e=[...ia].sort(()=>Math.random()-.5),t=a?2:o?3:4;p(e.slice(0,t)),v(!0),setTimeout(()=>g(!1),300)},[o,a]),y=(0,n.useCallback)(e=>{t&&t(e)},[t]),w=(0,n.useCallback)(e=>{m(e.id)},[]),C=(0,n.useCallback)(()=>{m(null)},[]);return(0,r.jsx)(s.Z,{sx:{mb:4,width:"100%"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",gap:{xs:1.5,sm:2,md:3},alignItems:"center",justifyContent:"center",flexDirection:"row"},children:[(0,r.jsx)(ir.Z,{in:f,timeout:300,children:(0,r.jsx)(s.Z,{sx:{display:"flex",gap:{xs:1,sm:1.5,md:2.5},flexDirection:"row",overflow:"hidden"},children:u.map((e,t)=>(0,r.jsx)(io.Z,{in:f,timeout:300+100*t,style:{transformOrigin:"0 0 0"},children:(0,r.jsx)(eA.Z,{onMouseEnter:t=>w(e),onMouseLeave:C,onClick:()=>y(e),sx:{background:h===e.id?"linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%)":"linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.005) 100%)",backdropFilter:h===e.id?"blur(10px)":"blur(5px)",borderRadius:1,cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:h===e.id?"translateY(-2px) scale(1.02)":"translateY(0) scale(1)",boxShadow:h===e.id?"0 8px 25px rgba(0, 0, 0, 0.15), 0 4px 10px rgba(0, 0, 0, 0.1)":"0 1px 3px rgba(0, 0, 0, 0.02)",border:h===e.id?"1px solid rgba(255, 255, 255, 0.15)":"1px solid rgba(255, 255, 255, 0.02)",opacity:h===e.id?1:.6,height:28,flexShrink:0,justifyContent:"center",alignItems:"center",position:"relative"},children:(0,r.jsx)(eE.Z,{sx:{height:"100%",width:"100%",padding:"0 !important",display:"flex",alignItems:"center",justifyContent:"center","&:last-child":{paddingBottom:"0 !important"}},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,padding:.7,width:"100%"},children:[(0,r.jsx)(s.Z,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(tg.Z,{sx:{width:25,height:25,backgroundColor:h===e.id?"rgba(255, 255, 255, 0.1)":"rgba(255, 255, 255, 0.05)",flexShrink:0,borderRadius:.5,border:h===e.id?"1px solid rgba(255, 255, 255, 0.05)":"1px solid rgba(255, 255, 255, 0.02)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},src:"https://storage.googleapis.com/cdn.openart.ai/music_video/CD_icon.png"})}),(0,r.jsx)(tf.Z,{title:`Click to select '${e.title}'`,arrow:!0,children:(0,r.jsx)(d.Z,{variant:"body2",sx:{color:h===e.id?"#E0E0E0":"#999999",fontWeight:500,lineHeight:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:{xs:"100px",sm:"120px",md:"150px"},flexShrink:0,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:e.title})})]})})})},e.id))})}),(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",flexShrink:0},children:(0,r.jsx)(tf.Z,{title:"Refresh examples",arrow:!0,children:(0,r.jsx)(l.Z,{onClick:b,disabled:x,sx:{minWidth:{xs:24,sm:24},height:24,borderColor:"rgba(255, 255, 255, 0.1)",color:x?"#666666":"#CCCCCC",borderRadius:2,transition:"all 0.3s ease",padding:0,"&:hover":{backgroundColor:"#333333",borderColor:"rgba(255, 255, 255, 0.2)",transform:x?"none":"scale(1.05)"},"&:disabled":{color:"#666666",borderColor:"rgba(255, 255, 255, 0.05)"}},children:(0,r.jsx)(it.Z,{sx:{fontSize:14,animation:x?"spin 0.8s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})})})})]})})}let il=(0,ie.F4)`
  0%, 100% {
    opacity: 0.4;
    transform: scaleY(1);
  }
  50% {
    opacity: 1;
    transform: scaleY(1.5);
  }
`,id=(0,ie.F4)`
  0%, 100% {
    opacity: 0.6;
    transform: scaleY(0.8);
  }
  25% {
    opacity: 0.9;
    transform: scaleY(1.4);
  }
  50% {
    opacity: 1;
    transform: scaleY(1.8);
  }
  75% {
    opacity: 0.8;
    transform: scaleY(1.2);
  }
`,ic=(0,ie.F4)`
  0%, 100% {
    transform: translateY(0px) scaleX(1);
    opacity: 0.3;
  }
  50% {
    transform: translateY(-10px) scaleX(1.1);
    opacity: 0.7;
  }
`,iu=(0,ie.F4)`
  0%, 100% {
    filter: drop-shadow(0 0 5px rgba(98, 144, 255, 0.3));
  }
  50% {
    filter: drop-shadow(0 0 20px rgba(98, 144, 255, 0.8));
  }
`,ip=(0,ie.F4)`
  0% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.8;
  }
  100% {
    opacity: 0.3;
  }
`,ih=(0,ie.F4)`
  0% {
    transform: translateX(-100%) rotate(45deg);
  }
  100% {
    transform: translateX(200%) rotate(45deg);
  }
`;var im=e=>{let{initialMusicUrl:t,selectedMusicExample:i,onSelectedMusicExampleProcessed:o,onChange:a,onUploadStart:c,onUploadError:u,onLinkChange:p,customAudioParser:h,linkPlaceholder:m="Enter Suno/TikTok music URL...",maxFileSize:x,onSelectMusicExample:g}=e,[f,y]=(0,n.useState)(null),[w,C]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!1),[F,S]=(0,n.useState)(!1),I=(0,n.useRef)(null),_=(0,n.useCallback)(async(e,t)=>{let i=await fetch(e),r=await i.blob();return new File([r],t,{type:r.type||"audio/mpeg"})},[]),Z=(0,n.useCallback)(async(e,t)=>{try{S(!0);let i=window.AudioContext||window.webkitAudioContext;if(!i){console.error("AudioContext not supported"),y({url:e,fileName:t,duration:0}),h&&await h(e,t),a&&a(e,t,0),S(!1);return}let r=new i,n=await fetch(e),o=await n.arrayBuffer(),s=await r.decodeAudioData(o);"closed"!==r.state&&r.close();let l={url:e,fileName:t,duration:s.duration};y(l),h&&await h(e,t),a&&a(e,t,s.duration)}catch(i){console.error("Failed to parse audio file:",i),y({url:e,fileName:t,duration:0}),h&&await h(e,t),a&&a(e,t,0)}finally{S(!1)}},[h,a]);(0,n.useEffect)(()=>{t&&Z(t,t.split("/").pop()||"")},[]);let{open:A,context:M,selectFile:T}=H({uploadProps:{enableTrimming:!0,maxDuration:300,minDuration:10,maxFileSize:x},onChange:(e,t)=>{e&&t?(Z(e,t),(0,q.B)("story_music_uploaded",{method:"file"})):a&&a("","",0)},onUploadStart:()=>{c&&c()},onUploadError:e=>{console.error("Music upload failed:",e),u&&u(e)}});(0,n.useEffect)(()=>{i&&(async()=>{try{let e=await _(i.url,`${i.title}.mp3`);T(e),o&&o()}catch(e){console.error("Failed to load music for trimming:",e),a&&a(i.url,i.title,i.duration),o&&o()}})()},[i,_,T,a,o]);let R=(0,n.useCallback)(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),D=(0,n.useCallback)(()=>{I.current&&(w?I.current.pause():I.current.play(),C(!w))},[w]);(0,n.useEffect)(()=>{let e=I.current;if(!e||!f)return;let t=()=>C(!1),i=()=>C(!1),r=()=>C(!0);return e.addEventListener("ended",t),e.addEventListener("pause",i),e.addEventListener("play",r),()=>{e.removeEventListener("ended",t),e.removeEventListener("pause",i),e.removeEventListener("play",r)}},[f]);let z=(0,n.useCallback)(()=>{y(null),C(!1),S(!1),I.current&&(I.current.pause(),I.current.currentTime=0),a&&a("","",0)},[a]),P=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),k(!0)},[]),W=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&k(!1)},[]),L=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),B=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),k(!1);let t=Array.from(e.dataTransfer.files);if(t.length>0){let e=t[0];e.type.startsWith("audio/")?T(e):(console.warn("Please drop an audio file"),u&&u(Error("Please select an audio file")))}},[T,u]),{open:$,context:G}=(0,K.K)({onSuccess:(e,t)=>{p&&p(e),(0,q.B)("story_music_uploaded",{method:"url",platform:null==t?void 0:t.platform,domain:null==t?void 0:t.domain})},placeholder:m,title:"Paste a Suno or TikTok Music Link",enableTrimming:!0,onFileReady:(e,t,i)=>{T(e)}});return F?(0,r.jsx)(s.Z,{sx:{minHeight:"158px",backgroundColor:"#0C2F75",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",position:"relative",padding:"31px 23px",overflow:"hidden"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",zIndex:1},children:[(0,r.jsx)(s.Z,{sx:{width:"48px",height:"48px",border:"3px solid rgba(255, 255, 255, 0.3)",borderTop:"3px solid white",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"16px","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"18px",lineHeight:"1.3em",letterSpacing:"-0.02em",color:"white",textAlign:"center",marginBottom:"8px"},children:"Analyzing Audio..."})]})}):f?(0,r.jsxs)(s.Z,{sx:{minHeight:{xs:"120px",sm:"158px"},backgroundColor:"#0C2F75",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",position:"relative",padding:{xs:"20px 16px",sm:"31px 23px"},overflow:"hidden"},children:[(0,r.jsx)(s.Z,{sx:{position:"absolute",left:0,top:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",padding:"0 4px"},children:Array.from({length:3}).map((e,t)=>(0,r.jsx)(s.Z,{sx:{display:"flex",gap:"11px",alignItems:"center",opacity:w?.35:.18,marginRight:t<2?"13px":0,transition:"opacity 0.3s ease-out"},children:Array.from({length:17}).map((e,i)=>{let n=[29,61,44,62,44,79,44,79,44,79,44,79,44,58,44,65,24][i]||44;return(0,r.jsx)(s.Z,{sx:{width:"5px",height:`${n}px`,backgroundColor:"rgba(255, 255, 255, 0.25)",borderRadius:"2.5px",animation:w?`${id} ${1.2+i%4*.3}s infinite ease-in-out`:`${ic} ${3+i%5*.4}s infinite ease-in-out`,animationDelay:`${.1*t+.05*i}s`,transformOrigin:"center",transition:"all 0.3s ease-out"}},`${t}-${i}`)})},t))}),w?(0,r.jsx)(s.Z,{sx:{position:"absolute",left:0,top:0,right:0,bottom:0,background:`
                                  radial-gradient(
                    ellipse at center,
                    rgba(98, 144, 255, 0.2) 0%,
                    rgba(147, 51, 234, 0.12) 50%,
                    transparent 70%
                  )
              `,borderRadius:"8px",animation:`${iu} 1.8s infinite`}}):null,(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start",width:"100%",paddingLeft:"23px",position:"relative",zIndex:1},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"18px"},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"4px"},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:{xs:"18px",sm:"20px"},lineHeight:"1.3em",letterSpacing:"-0.02em",color:"white",textAlign:"left"},children:f.fileName}),(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"15px",lineHeight:"1.3em",letterSpacing:"-0.02em",color:"#CCCCCC"},children:f.duration>0?R(f.duration):"0:00"})]}),(0,r.jsx)(E.Z,{onClick:D,sx:{width:"32px",height:"32px",backgroundColor:"white",borderRadius:"20px","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"},marginTop:"8px"},children:w?(0,r.jsx)(O.Z,{sx:{color:"#101010",fontSize:"16px"}}):(0,r.jsx)(U.Z,{sx:{color:"#101010",fontSize:"16px",marginLeft:"2px"}})})]})}),(0,r.jsx)(E.Z,{onClick:z,sx:{position:"absolute",top:"8px",right:"8px",width:"20px",height:"20px",backgroundColor:"#061A3F",borderRadius:"34px","&:hover":{backgroundColor:"rgba(6, 26, 63, 0.8)"}},children:(0,r.jsx)(ei.Z,{sx:{color:"rgba(255, 255, 255, 0.56)",fontSize:"12px"}})}),(0,r.jsx)("audio",{ref:I,src:f.url,style:{display:"none"}})]}):(0,r.jsxs)(s.Z,{onDragEnter:P,onDragLeave:W,onDragOver:L,onDrop:B,sx:{minHeight:"140px",backgroundColor:j?"rgba(98, 144, 255, 0.1)":"rgba(16, 16, 16, 1)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"10px",border:j?"2px dashed rgba(98, 144, 255, 0.8)":"2px dashed transparent",transition:"all 0.3s ease-in-out",position:"relative",flexDirection:"column"},children:[j?(0,r.jsxs)(s.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(98, 144, 255, 0.15)",borderRadius:"10px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:10,backdropFilter:"blur(2px)"},children:[(0,r.jsx)(t3.Z,{sx:{fontSize:48,color:"rgba(98, 144, 255, 1)",marginBottom:2,animation:`${il} 1s infinite`}}),(0,r.jsx)(d.Z,{sx:{color:"white",fontSize:"18px",fontWeight:600,textAlign:"center",marginBottom:1},children:"Drop your music file here"}),(0,r.jsx)(d.Z,{sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"14px",textAlign:"center"},children:"Supports MP3, WAV, M4A and other audio formats"})]}):null,(0,r.jsx)(t9.Z,{maxWidth:"md",children:(0,r.jsx)(eb.Z,{elevation:0,sx:{backgroundColor:"transparent",py:4,textAlign:"center",border:"none"},children:(0,r.jsxs)(s.Z,{sx:{position:"relative",zIndex:1},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,r.jsxs)(s.Z,{sx:{position:"absolute",left:0,top:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:.3,zIndex:0,overflow:"hidden"},children:[(0,r.jsx)(s.Z,{sx:{position:"absolute",right:"50%",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",flexDirection:"row-reverse"},children:Array.from({length:18}).map((e,t)=>{let i=t+1,n=1-(i-1)/17,o=.8-i/18*.5,a=20*Math.sin(.1*i);return(0,r.jsx)(s.Z,{sx:{width:"3px",height:`${Math.max(35+55*n+8*n*Math.abs(Math.sin(.3*i))+4*n*Math.abs(Math.cos(.1*i)),20)}px`,background:`linear-gradient(
                             0deg,
                             hsla(${210+a}, 70%, ${45+20*o}%, ${.8*o}) 0%,
                             hsla(${230+a}, 80%, ${55+25*o}%, ${1*o}) 50%,
                             hsla(${250+a}, 90%, ${65+30*o}%, ${1.2*o}) 100%
                           )`,borderRadius:"1.5px",animation:`${id} ${1.5+t%3*.3}s infinite`,animationDelay:`${.08*i}s`,transformOrigin:"bottom",marginRight:"5px"}},`left-${t}`)})}),(0,r.jsx)(s.Z,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center"},children:Array.from({length:18}).map((e,t)=>{let i=t+1,n=1-(i-1)/17,o=.8-i/18*.5,a=20*Math.sin(.1*i);return(0,r.jsx)(s.Z,{sx:{width:"3px",height:`${Math.max(35+55*n+8*n*Math.abs(Math.sin(.3*i))+4*n*Math.abs(Math.cos(.1*i)),20)}px`,background:`linear-gradient(
                             0deg,
                             hsla(${210+a}, 70%, ${45+20*o}%, ${.8*o}) 0%,
                             hsla(${230+a}, 80%, ${55+25*o}%, ${1*o}) 50%,
                             hsla(${250+a}, 90%, ${65+30*o}%, ${1.2*o}) 100%
                           )`,borderRadius:"1.5px",animation:`${id} ${1.5+t%3*.3}s infinite`,animationDelay:`${.08*i}s`,transformOrigin:"bottom",marginLeft:"5px"}},`right-${t}`)})}),(0,r.jsx)(s.Z,{sx:{position:"absolute",width:"200px",height:"200px",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:`
                      radial-gradient(
                        circle at center,
                        rgba(98, 144, 255, 0.15) 0%,
                        rgba(147, 51, 234, 0.08) 40%,
                        rgba(59, 130, 246, 0.05) 70%,
                        transparent 100%
                      )
                    `,animation:`${iu} 4s infinite`}})]}),(0,r.jsx)(s.Z,{sx:{position:"relative",display:"inline-flex",padding:3,borderRadius:3,marginBottom:4,width:100,height:100,alignItems:"center",justifyContent:"center",background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 50%),
                  linear-gradient(135deg, #444 0%, #222 50%, #111 100%)
                `,boxShadow:`
                  0 8px 32px rgba(0,0,0,0.5),
                  inset 0 1px 0 rgba(255,255,255,0.2),
                  inset 0 -1px 0 rgba(0,0,0,0.5)
                `,overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:3,background:`
                    linear-gradient(
                      45deg,
                      transparent 30%,
                      rgba(255,255,255,0.1) 40%,
                      rgba(255,255,255,0.3) 50%,
                      rgba(255,255,255,0.1) 60%,
                      transparent 70%
                    )
                  `,animation:`${ip} 3s ease-in-out infinite`,zIndex:1},"&::after":{content:'""',position:"absolute",top:"-50%",left:"-50%",width:"200%",height:"200%",background:"linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.4) 50%, transparent 70%)",animation:`${ih} 4s ease-in-out infinite`,zIndex:2}},children:(0,r.jsx)(v.Z,{sx:{fontSize:74,color:"white",position:"relative",zIndex:4,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5))"}})})]}),(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:{xs:"10px",sm:2},flexDirection:{xs:"row",sm:"row"},width:"100%",maxWidth:{xs:"310px",sm:"none"},margin:"0 auto"},children:[(0,r.jsx)(l.Z,{variant:"outlined",startIcon:(0,r.jsx)(b.Z,{sx:{color:{xs:"rgba(255, 255, 255, 0.95)",sm:"rgba(98, 144, 255, 1)"}}}),onClick:$,sx:{borderColor:{xs:"transparent",sm:"#666"},color:{xs:"rgba(255, 255, 255, 0.95)",sm:"white"},borderRadius:{xs:"52px",sm:25},textTransform:"none",fontSize:"14px",fontWeight:{xs:500,sm:400},lineHeight:{xs:"16px",sm:"normal"},whiteSpace:"nowrap",minWidth:{xs:0,sm:"155px"},width:{xs:"auto",sm:"auto"},padding:{xs:"8px 20px",sm:"6px 16px"},flexGrow:{xs:1,sm:0},flexBasis:{xs:0,sm:"auto"},backgroundColor:{xs:"rgba(255, 255, 255, 0.1)",sm:"transparent"},boxShadow:{xs:"inset 0px -1px 0px 0px rgba(0, 0, 0, 0.3), inset 0px 1px 0px 0px rgba(255, 255, 255, 0.06)",sm:"none"},"&:hover":{borderColor:{xs:"transparent",sm:"#888"},backgroundColor:{xs:"rgba(255, 255, 255, 0.15)",sm:"rgba(255,255,255,0.05)"}}},children:"Paste Link"}),(0,r.jsx)(s.Z,{sx:{display:{xs:"none",sm:"flex"},alignItems:"center"},children:(0,r.jsx)(t7.Z,{orientation:"vertical",flexItem:!0,sx:{backgroundColor:"rgba(68, 68, 68, 1)",height:20}})}),(0,r.jsx)(s.Z,{sx:{display:{xs:"block",sm:"none"},backgroundColor:"rgba(255, 255, 255, 0.15)",width:"1px",height:"16px",flexShrink:0}}),(0,r.jsx)(l.Z,{variant:"outlined",startIcon:(0,r.jsx)(t8.Z,{sx:{color:{xs:"rgba(255, 255, 255, 0.95)",sm:"rgba(98, 144, 255, 1)"}}}),onClick:A,sx:{borderColor:{xs:"transparent",sm:"#666"},color:{xs:"rgba(255, 255, 255, 0.95)",sm:"white"},borderRadius:{xs:"52px",sm:25},textTransform:"none",fontSize:"14px",fontWeight:{xs:500,sm:400},lineHeight:{xs:"16px",sm:"normal"},whiteSpace:"nowrap",minWidth:{xs:0,sm:"155px"},width:{xs:"auto",sm:"auto"},padding:{xs:"8px 20px",sm:"6px 16px"},flexGrow:{xs:1,sm:0},flexBasis:{xs:0,sm:"auto"},backgroundColor:{xs:"rgba(255, 255, 255, 0.1)",sm:"transparent"},boxShadow:{xs:"inset 0px -1px 0px 0px rgba(0, 0, 0, 0.3), inset 0px 1px 0px 0px rgba(255, 255, 255, 0.06)",sm:"none"},"&:hover":{borderColor:{xs:"transparent",sm:"#888"},backgroundColor:{xs:"rgba(255, 255, 255, 0.15)",sm:"rgba(255,255,255,0.05)"}}},children:"Upload / Drag"})]})]})})}),M,G,(0,r.jsx)(s.Z,{sx:{width:"100%",maxWidth:"100%"},children:(0,r.jsx)(is,{onSelectMusic:g})})]})},ix=i(93710);function ig(e){let{onSubmit:t}=e,{isMobile:i}=(0,h.j)(),a=(0,tn.B)(),[l,c]=n.useState(null),[u]=(0,ix.t1)(),[p,m]=n.useState(0),{errors:g,isGenerating:f,musicDuration:v,musicUrl:b,advancedSettings:y,aspectRatio:w,skipVideoGeneration:C,imageModelOptions:j,videoModelOptions:k,handleMusicUrlChange:F,handleAspectRatioSelect:S,handleSkipVideoGenerationChange:I,onFormSubmit:_,onPreviewSubmit:Z,handleModelSelect:A,MobilePreviewDialogComponent:E}=function(e){var t,i,r,a;let{onSubmit:s}=e,l=(0,o.useRouter)(),{isMobile:d,showMobilePreviewDialog:c,MobilePreviewDialogComponent:u}=eU(),[p,h]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)(null),{data:v}=(0,e7.w)(g,!!g);(0,n.useEffect)(()=>{var e;(null==v?void 0:null===(e=v.story)||void 0===e?void 0:e.id)&&m&&(x(!1),f(null),l.push(`/story/editor?story_id=${v.story.id}&view=list`))},[v,m,l]);let b=eG.E.getState().consumePrefill("music_video"),y=(0,eL.cI)({mode:"onChange",defaultValues:{musicUrl:(null==b?void 0:b.music_url)===void 0?t6.musicUrl:b.music_url,musicDuration:(null==b?void 0:b.music_duration)===void 0?t6.musicDuration:b.music_duration,aspectRatio:(null==b?void 0:b.aspect_ratio)===void 0?t6.aspectRatio:b.aspect_ratio,advancedSettings:(null==b?void 0:b.advanced_settings)===void 0?t6.advancedSettings:{imageModelConfig:(null===(t=(0,eH.O8)(null==b?void 0:null===(i=b.advanced_settings)||void 0===i?void 0:i.image_model_config,eH.Fj))||void 0===t?void 0:t.value)||t6.advancedSettings.imageModelConfig,videoModelConfig:(null===(r=(0,eH.O8)(null==b?void 0:null===(a=b.advanced_settings)||void 0===a?void 0:a.video_model_config,eH.E5))||void 0===r?void 0:r.value)||t6.advancedSettings.videoModelConfig},skipVideoGeneration:(null==b?void 0:b.skip_video_generation)===void 0?t6.skipVideoGeneration:b.skip_video_generation},resolver:(0,eW.F)(t5)}),{handleSubmit:w,formState:{errors:C},setValue:j,watch:k,setError:F,clearErrors:S}=y,I=k("musicUrl"),_=k("musicDuration"),Z=k("aspectRatio"),A=k("advancedSettings"),E=k("skipVideoGeneration"),{mutate:M,isLoading:T}=(0,e6.nn)(!1),R=(0,n.useMemo)(()=>{let e=eH.Fj.filter(e=>t4(e.value));return(0,eH.FA)(e,null==A?void 0:A.imageModelConfig).map(e=>({name:e.name,icon:e.icon,value:e.value}))},[null==A?void 0:A.imageModelConfig]),D=(0,n.useMemo)(()=>eH.E5.map(e=>({name:e.name,icon:e.icon,value:e.value})),[]),z=(0,n.useCallback)((e,t)=>{j("musicUrl",e),j("musicDuration",t),S("musicUrl"),S("musicDuration")},[j,S]),P=(0,n.useCallback)(e=>{j("aspectRatio",e),S("aspectRatio")},[j,S]),W=(0,n.useCallback)(e=>{j("skipVideoGeneration",e),S("skipVideoGeneration")},[j,S]),L=(0,n.useCallback)((e,t)=>{if("imageModel"===e){let e=eH.Fj.find(e=>e.name===t);e&&j("advancedSettings.imageModelConfig",e.value)}else if("videoModel"===e){let e=eH.E5.find(e=>e.name===t);e&&j("advancedSettings.videoModelConfig",e.value)}},[j]),B=(0,tV.NL)(),H=async(e,t)=>{let i=!1;if(t&&x(!0),e.musicUrl.trim()||(F("musicUrl",{message:"Please provide a music URL"}),i=!0),!i)try{let i={music_url:e.musicUrl,music_duration:e.musicDuration,advanced_settings:{image_model_config:e.advancedSettings.imageModelConfig,video_model_config:e.advancedSettings.videoModelConfig},aspect_ratio:e.aspectRatio,...t&&{is_preview:!0},skip_video_generation:e.skipVideoGeneration};M(i,{onSuccess:e=>{e.workflowRunId?t?d?c():f(e.workflowRunId):l.push(`/story/create/workflow/${e.workflowRunId}?category_id=lyrics_video`):s(),B.invalidateQueries({queryKey:[tY.O]})},onError:e=>{t&&x(!1),console.error("Generation failed:",e)}})}catch(e){F("musicUrl",{message:`Failed to process: ${e instanceof Error?e.message:"Unknown error"}`})}};return{form:y,errors:C,isGenerating:T||m,isUploadingImage:p,musicUrl:I,aspectRatio:Z,advancedSettings:A,musicDuration:_,skipVideoGeneration:E,imageModelOptions:R,videoModelOptions:D,handleMusicUrlChange:z,handleAspectRatioSelect:P,handleSkipVideoGenerationChange:W,onFormSubmit:w(async e=>{await H(e,!1)}),onPreviewSubmit:w(async e=>{await H(e,!0)}),handleModelSelect:L,MobilePreviewDialogComponent:u}}({onSubmit:t}),{totalCredits:M,totalCreditsExcludingVideoGeneration:T}=(0,th.q8)("story.music_video",{advanced_settings:{image_model_config:y.imageModelConfig,video_model_config:y.videoModelConfig},music_duration:v,skip_video_generation:C,video_type:"lyrics-video",num_shots:p}),[R]=(0,z.f)("story",{},{oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[M," ",i?"":"credits"]}),i?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})})]}),newUI:(e,t,n)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK,textDecoration:"line-through"},children:[M," ",i?"":"credits"]}),i?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:"bold",fontSize:"12px",lineHeight:"1em",color:"#BFBFBF"},children:[(0,r.jsx)("span",{style:{color:tp.MK},children:t})," FREE Story Left"]})]}),upgradeDailyNewUI:null}),[D]=(0,z.f)("story",{},{disabled:!0,oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[T," ",i?"":"credits"]}),i?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected image model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})})]}),newUI:(e,t,n)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[T," ",i?"":"credits"]}),i?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected image model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})})]}),upgradeDailyNewUI:null});return(0,r.jsxs)(s.Z,{component:"form",onSubmit:e=>{e.preventDefault(),a({onAuthenticated:()=>_(e)})},sx:{display:"flex",flexDirection:"column",maxWidth:800,mx:"auto",mt:{xs:2,md:8},minHeight:"100vh"},children:[(0,r.jsxs)(s.Z,{sx:{flex:1,pb:2},children:[(0,r.jsxs)(s.Z,{sx:{mb:1.5,mt:4},children:[(0,r.jsxs)(d.Z,{variant:"h6",color:"rgba(204, 204, 204, 1)",mb:2,gutterBottom:!0,children:["Upload a Song"," ",(0,r.jsx)("span",{style:{fontSize:"0.75em",fontWeight:400,color:"rgb(153, 153, 153)"},children:"(Up to 5 minutes)"})]}),(0,r.jsx)(im,{initialMusicUrl:b,selectedMusicExample:l,onSelectedMusicExampleProcessed:()=>c(null),onChange:(e,t,i)=>{F(e,i)},onUploadStart:()=>{},onUploadError:e=>{console.error("Upload error:",e)},onLinkChange:e=>{F(e,0)},linkPlaceholder:"Enter Suno music URL...",customAudioParser:async(e,t)=>{m((await u(e)).num_shots)}}),g.musicUrl?(0,r.jsx)(t0.Z,{severity:"error",sx:{mt:1},children:g.musicUrl.message}):null]}),(0,r.jsx)(s.Z,{sx:{mb:3},children:(0,r.jsx)(t2,{value:!C,onChange:e=>{I(!e)}})}),w&&S?(0,r.jsx)(s.Z,{sx:{mb:3},children:(0,r.jsx)(x,{aspectRatioOptions:["16:9","9:16"],value:w,onChange:e=>{("16:9"===e||"9:16"===e)&&S(e)},sx:{mb:2}})}):null,(0,r.jsx)(s.Z,{sx:{mb:4,width:"100%",maxWidth:"100%"},children:(0,r.jsx)(tc,{imageModelConfig:y.imageModelConfig,videoModelConfig:y.videoModelConfig,imageModelOptions:j,videoModelOptions:k,onModelSelect:A})})]}),(0,r.jsx)(et.i,{storyType:"music_video",isGenerating:f,promoQuotaUI:R,previewPromoQuotaUI:D,disabled:f||!b,showCreditInfo:!0,onCreateStory:()=>{a({onAuthenticated:()=>_()})},onCreatePreview:()=>{a({onAuthenticated:()=>{Z()}})}}),(0,r.jsx)(E,{})]})}var iv=i(98283),ib=i(45162),iy=i.n(ib),iw=i(56261);function iC(e){let{value:t,onChange:i,isHovered:o}=e,a=(0,n.useRef)(null);return(0,r.jsxs)(u.Z,{direction:"row",spacing:2.5,alignItems:"center",sx:{width:"100%",bgcolor:(0,iw.L)("Gray/50"),borderRadius:"13px",p:"6px",minHeight:114},children:[(0,r.jsxs)(s.Z,{sx:{position:"relative",width:184,height:102,borderRadius:"8px",overflow:"hidden",flexShrink:0},children:[(0,r.jsx)(iy(),{src:"https://cdn.openart.ai/assets/internal/uploads/image_Z7p7K1iI_1024x1024_1759126674218.webp",alt:"Continuous shot reference",fill:!0,sizes:"184px",style:{objectFit:"cover",zIndex:1,transition:"opacity 0.3s ease"}}),o?(0,r.jsx)(s.Z,{component:"video",ref:a,src:"https://cdn.openart.ai/production/2025-09/uploads/MS8PqLOpp3hwrLlttk93/file_sL0NfcQm_1759127270383.mp4",muted:!0,loop:!0,autoPlay:!0,playsInline:!0,preload:"metadata",sx:{position:"absolute",inset:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"8px",transition:"opacity 0.3s ease",zIndex:2}}):null]}),(0,r.jsxs)(u.Z,{direction:{xs:"column",lg:"row"},alignItems:{xs:"flex-start",lg:"center"},justifyContent:"space-between",spacing:{xs:2,lg:4},sx:{flex:1,pr:1.5},children:[(0,r.jsx)(d.Z,{component:"p",fontSize:14,lineHeight:"20px",fontWeight:500,sx:{color:(0,iw.L)("Gray/900",.6),maxWidth:{xs:"100%",lg:424}},children:"Connect shots so they flow like one seamless take."}),(0,r.jsx)(t1.r,{checked:t,onChange:e=>i(e.target.checked)})]})]})}let ij=[{name:"Custom",imageUrl:"https://cdn.openart.ai/music_video/CustomButton.png",isSpecial:!0,value:"custom",videoUrl:null},{name:"Auto Style",imageUrl:"https://cdn.openart.ai/music_video/Autobutton.png",isSpecial:!0,value:"auto",videoUrl:null},{name:"Y2K Collage",imageUrl:"https://cdn.openart.ai/music_video/k-pop.png"},{name:"Rock Haze",imageUrl:"https://cdn.openart.ai/music_video/Rock_Haze.jpg"},{name:"Noise Collage",imageUrl:"https://cdn.openart.ai/music_video/Noise_Collage.jpg"},{name:"City-Pop",imageUrl:"https://cdn.openart.ai/music_video/KDXS1116.jpeg"},{name:"Midnight Blue Soul",imageUrl:"https://cdn.openart.ai/music_video/openart-image_FYA_abWu_1750917048290_raw.jpg"},{name:"Bubble-Gum Punk",imageUrl:"https://cdn.openart.ai/music_video/openart-image_GWSVi_xj_1750920727228_raw.jpg"},{name:"EDM",imageUrl:"https://cdn.openart.ai/music_video/EDM.png"},{name:"Vaporwave",imageUrl:"https://cdn.openart.ai/music_video/Vaporwave.png"},{name:"Classical Rococo",imageUrl:"https://cdn.openart.ai/music_video/ClassicalRococo.png"},{name:"Metal Noir",imageUrl:"https://cdn.openart.ai/music_video/Sequence%2B01.00_01_28_05.Still036.jpg"},{name:"Miniature",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/miniature.jpg"},{name:"Pixel art",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/pixelart.jpg"},{name:"Cyberpunk",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/cyberpunk.jpg"},{name:"Psychedelic",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/psychedelic.jpg"},{name:"Ghibli",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/ghibli.jpg"},{name:"Pixar",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/pixar.jpg"},{name:"Photorealistic",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/photorealistic.jpg"},{name:"Anime",imageUrl:"https://cdn.openart.ai/storybuilder/video_style_thumnails/anime.jpg"}],ik="#101010",iF=e=>{let{value:t="",onChange:i,placeholder:o="Describe the style"}=e,[a,s]=(0,n.useState)(t),{isMobile:l}=(0,h.j)();return(0,r.jsx)(eI.E.div,{initial:{opacity:0,height:0,marginBottom:0},animate:{opacity:1,height:"auto",marginBottom:l?12:16},exit:{opacity:0,height:0,marginBottom:0},transition:{duration:.3,ease:[.4,0,.2,1]},style:{overflow:"hidden"},children:(0,r.jsx)(eo.Z,{value:a,onChange:e=>{let t=e.target.value;s(t),null==i||i(t)},placeholder:o,variant:"outlined",fullWidth:!0,size:"small",sx:{mx:0,"& .MuiOutlinedInput-root":{backgroundColor:"#1A1A1A",borderRadius:"6px",height:l?"36px":"40px",fontSize:l?"13px":"14px",fontWeight:500,p:1,minHeight:l?"44px":"40px","& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"}},"& .MuiOutlinedInput-input":{color:"#666666",padding:l?"10px 0px":"8px 0px","&::placeholder":{color:"#666666",opacity:1}}}})})},iS=[{name:"Custom",imageUrl:"https://cdn.openart.ai/music_video/CustomButton.png",isSpecial:!0,value:"",videoUrl:null},...R.TJ],iI={SCROLL_THRESHOLD:5},i_={mobile:{columnsCount:2,gap:8,padding:8,minCardHeight:60,fallbackHeight:160,customInputHeight:32,customInputMarginBottom:12,showStyleNumber:4},tablet:{columnsCount:4,gap:8,padding:8,minCardHeight:70,fallbackHeight:180,customInputHeight:40,customInputMarginBottom:16,showStyleNumber:6},desktop:{columnsCount:4,gap:8,padding:8,minCardHeight:70,fallbackHeight:180,customInputHeight:40,customInputMarginBottom:16,showStyleNumber:6}},iZ="#101010",iA=(e,t)=>e?i_.mobile:t?i_.tablet:i_.desktop,iE=()=>{let{isMobile:e,isTablet:t}=(0,h.j)();return(0,n.useMemo)(()=>iA(e,t),[e,t])},iM=()=>{let[e,t]=(0,n.useState)(0),i=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=()=>{i.current&&t(i.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),{containerWidth:e,containerRef:i}},iT=e=>{let[t,i]=(0,n.useState)(!1),r=(0,n.useRef)(null),{isMobile:o,isTablet:a}=(0,h.j)();return(0,n.useEffect)(()=>{let e=()=>{if(r.current){let{scrollTop:e,scrollHeight:t,clientHeight:n}=r.current;i(e+n<t-iI.SCROLL_THRESHOLD)}};e();let t=r.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[e]),{canScrollDown:t,scrollableRef:r,handleScrollDown:()=>{if(r.current){let{columnsCount:t,gap:i,padding:n,minCardHeight:s}=iA(o,a),l=e-2*n;r.current.scrollBy({top:Math.max(Math.max(0,(l-i*(t-1))/t),s)+i,behavior:"smooth"})}}}},iR=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=iE(),{cardWidth:r,cardHeight:o,containerHeight:a,columnsCount:s,gap:l,padding:d}=(0,n.useMemo)(()=>{let{columnsCount:r,gap:n,padding:o,minCardHeight:a,fallbackHeight:s,customInputHeight:l,customInputMarginBottom:d,showStyleNumber:c}=i,u=Math.max(0,(e-2*o-n*(r-1))/r),p=Math.max(u,a),h=Math.ceil(c/r),m=p*h+n*(h-1)+2*o;return t&&(m+=l+d),{cardWidth:u,cardHeight:p,containerHeight:m=Math.max(m,s),columnsCount:r,gap:n,padding:o}},[e,i,t]);return{cardWidth:r,cardHeight:o,containerHeight:a,columnsCount:s,gap:l,padding:d}},iD=e=>{let{delay:t=0}=e;return(0,r.jsx)(s.Z,{sx:{width:4,height:4,borderRadius:"50%",bgcolor:"rgba(255, 255, 255, 0.6)",animation:`pulse 1.5s ease-in-out infinite ${t}s`,"@keyframes pulse":{"0%, 100%":{opacity:.6},"50%":{opacity:1}}}})},iz=e=>{let{canScrollDown:t,onScrollDown:i}=e;return t?(0,r.jsxs)(s.Z,{onClick:i,sx:{position:"absolute",bottom:12,right:12,display:"flex",alignItems:"center",gap:.5,px:1,py:.5,bgcolor:"rgba(0, 0, 0, 0.7)",borderRadius:"12px",backdropFilter:"blur(4px)",zIndex:3,cursor:"pointer",transition:"all 0.2s","&:hover":{bgcolor:"rgba(0, 0, 0, 0.8)",transform:"scale(1.05)"},"&:active":{transform:"scale(0.95)"}},children:[(0,r.jsx)(iD,{delay:0}),(0,r.jsx)(iD,{delay:.2}),(0,r.jsx)(iD,{delay:.4})]}):null},iP=e=>{let{icon:t,title:i,selectedStyleName:n}=e;return(0,r.jsx)(eI.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},children:(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(eI.E.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{duration:.4,ease:"easeOut",delay:.1},children:t}),(0,r.jsx)(d.Z,{variant:"h6",sx:{fontFamily:"Inter",fontWeight:500,fontSize:"16px",color:"#AAAAAA"},children:i})]})})})},iW=e=>{let{styleOption:t,isSelected:i,onSelect:o,cardWidth:a,cardHeight:l}=e,c=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),{isMobile:m}=(0,h.j)();return(0,r.jsx)(s.Z,{sx:{height:`${l}px`,overflow:"hidden",borderRadius:"6px"},children:(0,r.jsx)(eI.E.div,{whileHover:m?{}:{scale:1.02},whileTap:{scale:.98},transition:{duration:.2,ease:"easeInOut"},style:{width:"100%",height:"100%"},children:(0,r.jsx)(eA.Z,{onClick:()=>{o(t)},onMouseEnter:()=>{!m&&(p(!0),c.current&&t.videoUrl&&c.current.play().catch(()=>{}))},onMouseLeave:()=>{!m&&(p(!1),c.current&&t.videoUrl&&(c.current.pause(),c.current.currentTime=0))},onTouchStart:()=>{m&&c.current&&t.videoUrl&&(p(!0),c.current.play().catch(()=>{}),setTimeout(()=>{p(!1),c.current&&(c.current.pause(),c.current.currentTime=0)},1e3))},sx:{cursor:"pointer",transition:"all 0.2s",backgroundColor:"transparent",boxShadow:"none",borderRadius:"4px",width:"100%",height:"100%",border:"none",opacity:1,filter:"none",...m&&{"&:active":{transform:"scale(0.95)"}}},children:(0,r.jsx)(eE.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:0,"&:last-child":{pb:0},position:"relative",height:"100%"},children:(0,r.jsxs)(s.Z,{sx:{backgroundColor:"transparent",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:"100%",height:"100%",overflow:"hidden",border:i?"3px solid #2F66FF":"3px solid transparent",transition:"border-color 0.2s ease"},children:[t.videoUrl?(0,r.jsx)("video",{ref:c,src:t.videoUrl,muted:!0,loop:!0,playsInline:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",opacity:u?1:0,transition:"opacity 0.3s ease",zIndex:2}}):null,t.imageUrl?(0,r.jsx)("img",{src:t.imageUrl,alt:t.name,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",zIndex:1}}):null,(0,r.jsx)(s.Z,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"linear-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%)",borderRadius:"0 0 4px 4px",pointerEvents:"none",zIndex:2.5}}),(0,r.jsx)(eI.E.div,{animate:{color:i?"#FFFFFF":"#CCC"},transition:{duration:.2},style:{position:"absolute",bottom:m?6:8,left:"50%",transform:"translateX(-50%)",zIndex:3},children:(0,r.jsx)(d.Z,{variant:"caption",sx:{textAlign:"center",fontWeight:600,fontSize:`${Math.max(Math.min(.12*a,m?11:12),10)}px`,lineHeight:"1.21em",whiteSpace:"nowrap"},children:t.name})})]})})})})})},iL=e=>{let{styles:t,selectedStyle:i,onStyleSelect:n,cardWidth:o,cardHeight:a,columnsCount:l=4,gap:d=1.5}=e;return(0,r.jsx)(s.Z,{sx:{display:"grid",gridTemplateColumns:`repeat(${l}, 1fr)`,gap:d/8,width:"100%",pb:.5},children:t.map((e,t)=>(0,r.jsx)(iW,{styleOption:e,isSelected:(null==i?void 0:i.name)===e.name,onSelect:n,cardWidth:o,cardHeight:a},e.name))})},iB=e=>{let{options:t=ij,value:i="auto",onChange:o}=e,[a,l]=(0,n.useState)(()=>"auto"===i?t.find(e=>"Auto Style"===e.name)||null:t.find(e=>e.name===i||"value"in e&&e.value===i)||null);(0,n.useEffect)(()=>{"auto"===i&&(null==a?void 0:a.name)==="Auto Style"&&(null==o||o("auto"))},[]);let d=(0,n.useMemo)(()=>(null==a?void 0:a.name)==="Custom",[a]),{isMobile:c}=(0,h.j)(),u=iE(),{containerWidth:p,containerRef:m}=iM(),{canScrollDown:x,scrollableRef:g,handleScrollDown:f}=iT(p),{cardWidth:v,cardHeight:b,containerHeight:y,columnsCount:w,gap:C,padding:j}=iR(p,d),{fallbackHeight:k}=u;return(0,r.jsxs)(s.Z,{sx:{position:"relative"},children:[(0,r.jsx)(iP,{icon:(0,r.jsx)(es.PhPaletteBold,{size:20,color:"#CCCCCC"}),title:"Choose a Style",selectedStyleName:null==a?void 0:a.name}),(0,r.jsxs)(eb.Z,{ref:m,elevation:0,sx:{bgcolor:ik,borderRadius:"8px",position:"relative",maxWidth:"100%",width:"100%",height:p>0?`${y}px`:`${k}px`,p:j/8,overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:`linear-gradient(180deg, ${ik}CC 0%, transparent 100%)`,zIndex:2,pointerEvents:"none"},"&::after":{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"4px",background:`linear-gradient(0deg, ${ik}CC 0%, transparent 100%)`,zIndex:2,pointerEvents:"none"}},children:[(0,r.jsxs)(s.Z,{ref:g,sx:{height:"100%",overflow:"auto","&::-webkit-scrollbar":{width:c?"0px":"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)",borderRadius:"2px"},"&::-webkit-scrollbar-thumb:hover":{background:"rgba(255, 255, 255, 0.3)"}},children:[(0,r.jsx)(eS.M,{children:d?(0,r.jsx)(iF,{value:"custom"===i?"":i,onChange:o,placeholder:"Describe the style"}):null}),(0,r.jsx)(iL,{styles:t,selectedStyle:a,onStyleSelect:e=>{if("Custom"===e.name){l(e),null==o||o("");return}l(e);let t="value"in e&&e.value?e.value:e.name;null==o||o(t||"auto")},cardWidth:v,cardHeight:b,columnsCount:w,gap:C})]}),(0,r.jsx)(iz,{canScrollDown:x,onScrollDown:f})]})]})};var iH=i(99288),i$=e=>{let{onTopicsChange:t,placeholder:i="What story do you want your music to tell? Leave it blank and we’ll craft one from your track."}=e,[o,a]=(0,n.useState)(""),[d,c]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),h=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=()=>{if(h.current){let e=Number.parseFloat(window.getComputedStyle(h.current).lineHeight)||24;p(h.current.scrollHeight>3*e+10)}};e();let t=setTimeout(e,0);return window.addEventListener("resize",e),()=>{clearTimeout(t),window.removeEventListener("resize",e)}},[o,3]);let m=e=>{e.length<=500&&(a(e),e.trim()?null==t||t(e.trim().split("\n").map(e=>e.trim()).filter(Boolean)):null==t||t([]))};return(0,r.jsxs)(s.Z,{sx:{width:"100%",maxWidth:800,backgroundColor:"var(--Gray-50)",px:2,borderRadius:"8px",position:"relative"},children:[(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"flex-start",py:1.5},children:(0,r.jsx)(s.Z,{ref:h,component:"textarea",placeholder:i,value:o,onChange:e=>m(e.target.value),maxLength:500,rows:d?10:3,sx:{width:"100%",border:"none",outline:"none",backgroundColor:"transparent",color:"var(--Gray-800)",fontSize:"0.95rem",padding:0,margin:0,fontFamily:"inherit",resize:"none",lineHeight:"1.5",transition:"all 0.2s ease",overflow:d?"auto":"hidden","&::placeholder":{color:"color-mix(in srgb, var(--Gray-800) 50%, transparent)"},"&:focus":{outline:"none",border:"none"},scrollbarWidth:d?"thin":"none","&::-webkit-scrollbar":{width:d?"6px":"0",display:d?"block":"none"},"&::-webkit-scrollbar-thumb":{backgroundColor:"var(--Gray-400)",borderRadius:"3px"},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"}}})}),u?(0,r.jsx)(l.Z,{onClick:()=>{c(!d)},sx:{position:"absolute",right:8,bottom:32,minWidth:"auto",padding:"4px 8px",fontSize:"12px",textTransform:"none",color:"var(--Gray-600)",backgroundColor:"var(--Gray-100)",borderRadius:1,"&:hover":{backgroundColor:"var(--Gray-200)"},display:"flex",alignItems:"center",gap:"4px"},children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(iH.Z,{sx:{fontSize:"16px"}}),"Collapse"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e_.Z,{sx:{fontSize:"16px"}}),"Expand"]})}):null,(0,r.jsxs)(s.Z,{sx:{position:"absolute",right:8,bottom:8,bgcolor:"var(--Gray-50)",color:"var(--Gray-400)",fontSize:"12px",px:1,borderRadius:1,pointerEvents:"none",zIndex:1},children:[o.length,"/",500]})]})},iO=e=>{let{value:t=!0,onChange:i}=e;return(0,r.jsx)(m,{icon:(0,r.jsx)(es.PhSlideshow,{size:20}),title:"Animated Video",titleHelp:(0,r.jsx)(tf.Z,{title:"ON = adds motion to each lyric shot. OFF = keeps each lyric on a still frame.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:16,sx:{color:"#BFBFBF"}})})}),rightSide:(0,r.jsx)(t1.r,{checked:t,onChange:e=>null==i?void 0:i(e.target.checked)})})},iU=e=>{let{videoType:t,handleConsistentStyleChange:i,handleCharacterSelect:o,handleAdditionalCharacterSelect:a,selectedCharacter:l,additionalCharacters:c,handleMusicVideoTopicChange:p,video_scenes:h,onVideoScenesChange:m,skipVideoGeneration:x,handleSkipVideoGenerationChange:g}=e,[f,v]=(0,n.useState)("auto"),[b,y]=(0,n.useState)("auto"),w=(0,e$.Z)(),C=(0,ii.Z)(w.breakpoints.down("md"));return(0,r.jsx)(s.Z,{sx:{borderRadius:2,width:"100%"},children:(0,r.jsxs)(s.Z,{sx:{width:"100%"},children:["consistent-style"===t&&(0,r.jsx)(s.Z,{sx:{mb:2,width:"100%"},children:(0,r.jsx)(iB,{value:"Custom"===f?b:f||"auto",onChange:e=>{let t=ij.find(t=>t.name.toLowerCase()===e.toLowerCase());t?(v(t.name),y(t.name),null==i||i(t.name)):(v("Custom"),y(e),null==i||i(e))}})}),"consistent-character"===t&&(0,r.jsxs)(s.Z,{sx:{width:"100%",borderRadius:3,mt:C?1:0},children:[(0,r.jsxs)(u.Z,{sx:{mb:C?2:3,mt:C?2:0},children:[(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",mb:C?1:2,children:[(0,r.jsx)(es.CustomCastCharacter,{size:20}),(0,r.jsx)(d.Z,{fontSize:"16px",fontWeight:500,sx:{color:"#CCCCCC",fontWeight:600,flexGrow:0,mb:2},children:"Cast Your Actor"})]}),(0,r.jsx)(tU,{firstCharacter:l,additionalCharacters:c,onFirstCharacterSelect:o,onAdditionalCharactersSelect:a,error:void 0,showTitle:!1,maxCharacters:1,showPreviewAvatar:!1,characterType:"music_video_consistent",outfitChangesPosition:"overall"})]}),(0,r.jsxs)(u.Z,{sx:{mb:C?2:3,mt:C?1:0},children:[(0,r.jsx)(u.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",mb:C?1:2,children:[(0,r.jsx)(es.CustomStoryline,{size:20}),(0,r.jsxs)(d.Z,{fontSize:"16px",fontWeight:500,sx:{color:"#CCCCCC",flexGrow:0,mb:2},children:["Write Storyline",(0,r.jsx)(s.Z,{component:"span",sx:{fontSize:C?"12px":"13px",color:e=>e.palette.Colors.Gray["400"],fontWeight:500,ml:.5},children:"(optional)"})]})]})}),(0,r.jsx)(i$,{onTopicsChange:p})]})]}),"singing-dancing"===t&&(0,r.jsxs)(s.Z,{sx:{width:"100%",borderRadius:3},children:[(0,r.jsxs)(u.Z,{sx:{mb:C?0:3},children:[(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",mb:C?1:2,mt:C?1:0,children:[(0,r.jsx)(es.CustomCastCharacter,{size:20}),(0,r.jsx)(d.Z,{fontSize:"16px",fontWeight:500,sx:{color:"#CCCCCC",fontWeight:600,flexGrow:0},children:"Choose Your Artist"})]}),(0,r.jsx)(tU,{firstCharacter:l,additionalCharacters:[],onFirstCharacterSelect:o,onAdditionalCharactersSelect:()=>{},maxCharacters:1,error:void 0,showPreviewAvatar:!1,showTitle:!1,characterType:"music_video_singing_dancing",outfitChangesPosition:"overall"})]}),(0,r.jsxs)(u.Z,{sx:{mb:C?2:3},children:[(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",mb:C?1:2,mt:C?2:0,children:[(0,r.jsx)(es.PhFilmStrip,{size:20}),(0,r.jsxs)(d.Z,{fontSize:"16px",fontWeight:500,sx:{color:"#CCCCCC",fontWeight:600,flexGrow:0},children:["Set the Scene",(0,r.jsx)(s.Z,{component:"span",sx:{fontSize:C?"12px":"13px",color:e=>e.palette.Colors.Gray["400"],fontWeight:500,ml:.5},children:"(optional)"})]})]}),(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",mb:C?0:2,sx:{position:"relative",width:"100%"},children:[(0,r.jsx)(eo.Z,{fullWidth:!0,multiline:!0,inputProps:{maxLength:350},minRows:1,maxRows:3,value:h||"",onChange:e=>null==m?void 0:m(e.target.value),placeholder:"Where’s your artist? What’s the vibe?",variant:"outlined",InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{bgcolor:e=>e.palette.Colors.Gray["50"],color:e=>e.palette.Colors.Gray["700"],border:"none"}}}),(0,r.jsxs)(s.Z,{sx:{position:"absolute",right:8,bottom:8,bgcolor:e=>e.palette.Colors.Gray["50"],color:e=>e.palette.Colors.Gray["400"],fontSize:"12px",px:1,borderRadius:1,pointerEvents:"none",zIndex:1},children:[(null==h?void 0:h.length)??0,"/350"]})]})]})]}),"lyrics-video"===t&&(0,r.jsx)(iO,{value:!x,onChange:e=>{g(!e)}})]})})},iG=i(56547),iN=i(57713);function iV(e){let{option:t}=e,{showMusicVideoEntry:i}=(0,iN.s)(),{isMobile:n}=(0,h.j)();return(0,r.jsxs)(u.Z,{onClick:()=>{n&&i()},sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:n?1:0,mb:{sm:2,md:6},p:n?1:0,borderRadius:n?1.5:0,background:n?"linear-gradient(180deg, #3D4A5B 0%, #393C3E 100%)":"transparent",boxShadow:n?"0 4px 16px 0 rgba(0, 0, 0, 0.25)":"none"},children:[(0,r.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:{sm:4,md:2},children:[(0,r.jsxs)(u.Z,{sx:{width:120,height:80},direction:"row",children:[(0,r.jsx)(iy(),{src:t.thumbnail,alt:t.title,height:80,width:80,style:{objectFit:"cover",zIndex:1,borderRadius:8}}),(0,r.jsx)(iy(),{src:"https://cdn.openart.ai/assets/internal/uploads/image_7zymQp7-_1168x1168_1759048232936.webp",alt:t.title,height:80,width:80,style:{objectFit:"cover",transform:"translateX(-50%)"}})]}),(0,r.jsxs)(u.Z,{direction:"column",gap:1,zIndex:2,sx:{position:"relative",left:n?"14px":""},children:[(0,r.jsx)(d.Z,{fontWeight:700,fontSize:18,children:t.title}),(0,r.jsx)(d.Z,{fontSize:n?12:14,fontWeight:500,color:"rgba(255, 255, 255, 0.40)",children:t.desc})]})]}),(0,r.jsxs)(u.Z,{component:iG.Z,direction:"row",alignItems:"center",spacing:1,onClick:()=>{i()},sx:{cursor:"pointer",width:"auto",backgroundColor:"transparent",borderRadius:1.5,p:0,transition:"background-color 0.3s ease"},children:[n?null:(0,r.jsx)(d.Z,{fontSize:14,fontWeight:500,color:"var(--Gray-900)",children:"Re-select"}),n?(0,r.jsx)(es.PhCaretRightBold,{}):(0,r.jsx)(es.PhCaretRight,{})]})]})}var iK=i(89187),iq=i(65577);function iY(e){let{showIcon:t=!0,iconSize:i=20,sx:n,value:o,onChange:a}=e,{isMobile:l}=(0,h.j)();return(0,r.jsx)(m,{icon:t?(0,r.jsx)(iq.Z,{sx:{color:"#CCCCCC",fontSize:i}}):null,title:"Match Video to Beat",rightSide:(0,r.jsx)(t1.r,{checked:o,onChange:e=>a(e.target.checked)}),isMobile:l,titleHelp:(0,r.jsx)(tf.Z,{title:"Each shot’s length adapts to your song’s beat, so the video grooves with the music.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:16,sx:{color:"#BFBFBF"}})})}),sx:n})}var iX=e=>{let{value:t=!0,showIcon:i=!0,onChange:n,label:o="Auto Captions",sx:a}=e;return(0,r.jsx)(m,{icon:i?(0,r.jsx)(es.PhTextTBold,{size:16}):null,title:o,rightSide:(0,r.jsx)(t1.r,{checked:t,onChange:e=>null==n?void 0:n(e.target.checked)}),sx:a,titleHelp:(0,r.jsx)(tf.Z,{title:"Displays your lyrics as on-screen captions so viewers can follow and sing along.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:16,sx:{color:"#BFBFBF"}})})})})};function iJ(e){var t;let{iconSize:i=20,sx:n,imageModelConfig:o,videoModelConfig:a,videoType:l,enableBRoll:c,handleEnableBRollChange:p,enableStartEndFrame:h,handleEnableStartEndFrameChange:x,enableBeatSync:g,handleEnableBeatSyncChange:v,upscaleToResolution:b,handleUpscaleToResolutionChange:j,autoCaptions:k,handleAutoCaptionsChange:F,imageModelOptions:S,videoModelOptions:I,onModelSelect:_,expanded:Z,onChange:A}=e;return(0,r.jsx)(s.Z,{sx:{position:"relative",...n},children:(0,r.jsxs)(y.Z,{expanded:Z,onChange:A,sx:{backgroundColor:"transparent",boxShadow:"none",border:"none","&:before":{display:"none"},"&.Mui-expanded":{margin:0}},children:[(0,r.jsx)(w.Z,{expandIcon:(0,r.jsx)(f.Z,{sx:{color:"#666",fontSize:16,backgroundColor:"#101010",borderRadius:"50%",width:24,height:24,padding:"4px"}}),sx:{padding:0,minHeight:"auto","&.Mui-expanded":{minHeight:"auto"},"& .MuiAccordionSummary-content":{margin:0,"&.Mui-expanded":{margin:0}},"& .MuiAccordionSummary-expandIconWrapper":{transition:"transform 0.3s","&.Mui-expanded":{transform:"rotate(180deg)"}}},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(ts.Z,{sx:{color:"#CCCCCC",fontSize:i}}),(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:"16px",lineHeight:"1.5em",color:"#CCCCCC"},children:"Advanced Options"})]})}),(0,r.jsx)(C.Z,{sx:{padding:"20px 8px 16px 8px"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:["singing-dancing"===l?(0,r.jsx)(m,{icon:null,title:"Include B-roll Shots",sx:{".row-selection-title":{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC"}},titleHelp:(0,r.jsx)(tf.Z,{title:"Adds extra scenery and cutaway shots (without the artist singing) throughout your video. Great for adding variety and keeping viewers engaged.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:16,sx:{color:"#BFBFBF"}})})}),rightSide:(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center"},children:(0,r.jsx)(t1.r,{checked:!!c,onChange:(e,t)=>p(t)})})}):null,"lyrics-video"!==l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(iY,{showIcon:!1,value:g,onChange:v,sx:{".row-selection-title":{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC"}}}),(0,r.jsx)(iX,{showIcon:!1,value:k,onChange:F,label:"Show Captions",sx:{".row-selection-title":{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC"}}})]}):null,(0,r.jsxs)(u.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(d.Z,{sx:{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC"},children:"Image Model"}),(0,r.jsx)(iK.Op,{label:"Select image model",value:(null===(t=eH.Fj.find(e=>e.value.model===o.model&&JSON.stringify(e.value.parameters)===JSON.stringify(o.parameters)))||void 0===t?void 0:t.name)||eH.Fj[0].name,options:S,onChange:e=>_("imageModel",e),sx:{width:"100%"}})]}),(0,r.jsxs)(u.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(d.Z,{sx:{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC"},children:"Video Model"}),(0,r.jsx)(tu,{videoModelConfig:a,videoModelOptions:I,onModelSelect:_,showResolutionSelect:"singing-dancing"!==l})]}),"singing-dancing"===l?(0,r.jsx)(m,{icon:null,title:"Resolution",sx:{".row-selection-title":{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"var(--Gray-700)"}},rightSide:(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center"},children:(0,r.jsxs)(Q.Z,{size:"small",value:b||"720p",onChange:e=>j&&j(e.target.value),sx:{width:148,backgroundColor:"var(--Gray-100)",color:"var(--Gray-700)",borderRadius:"10px","& fieldset":{borderColor:"var(--Gray-300) !important"},"&:hover fieldset":{borderColor:"var(--Gray-400) !important"},"&.Mui-focused fieldset":{borderColor:"var(--Blue-500) !important"},"& .MuiSelect-select":{paddingY:"6px",paddingX:"10px"},"& svg":{color:"var(--Gray-600)"}},MenuProps:{PaperProps:{sx:{backgroundColor:"var(--Gray-50)",border:"1px solid var(--Gray-300)",borderRadius:"8px",width:148,"& .MuiMenuItem-root":{color:"var(--Gray-700)",fontSize:"14px"}}}},children:[(0,r.jsx)(N.Z,{value:"720p",children:(0,r.jsxs)(s.Z,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr auto",alignItems:"center"},children:[(0,r.jsx)(s.Z,{}),(0,r.jsx)(d.Z,{sx:{color:"var(--Gray-700)",fontSize:"14px",justifySelf:"center"},children:"720p"})]})}),(0,r.jsx)(N.Z,{value:"2K",children:(0,r.jsxs)(s.Z,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr auto",alignItems:"center"},children:[(0,r.jsx)(s.Z,{}),(0,r.jsx)(d.Z,{sx:{color:"var(--Gray-700)",fontSize:"14px",justifySelf:"center"},children:"2K"})]})})]})})}):null]})})]})})}var iQ=i(79435),i0=i(10986),i1=i(52934);let i2=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],[t,i]=(0,n.useState)(!1),[r,o]=(0,n.useState)(null),{enqueueSnackbar:a}=(0,i0.Ds)();return{...(0,tb.D)({mutationFn:async t=>{i(!0),o(null);try{(0,q.B)("story_creation_requested",{story_type:"music_video",prompt:t.video_topic,video_type:t.video_type});let i=await e4.ZP.post("/stories/workflow/generate_music_video",t);if((0,q.B)(t.is_preview?"story_previewed":"story_created",{story_type:"music_video",video_type:t.video_type,prompt:t.video_topic,credits_num:t.is_preview?i1.v["story.music_video.preview"].credit:i1.v["story.music_video"].credit}),200!==i.status){let e=i.data;throw Error(`Failed to generate music video: ${e.message}`)}let r=i.data;if(!r.workflowRunId)return a("Music video generated successfully",{variant:"info"}),r;if(!e)return r;o(r.workflowRunId),a(`Music video generation started with workflow ${r.workflowRunId}`,{variant:"info"})}catch(e){throw console.error("Error generating music video",e),e}finally{i(!1),o(null)}}}),isGenerating:t,workflowRunId:r}},i5=eB.Ry({musicUrl:eB.Z_().url(),musicDuration:eB.Rx(),videoType:eB.Km(["consistent-style","singing-dancing","consistent-character","lyrics-video"]).optional(),character:eB.PG().optional(),consistentStyle:eB.Z_().optional(),referenceImageUrl:eB.Z_().optional(),musicVideoTopic:eB.Z_(),video_scenes:eB.Z_().optional(),aspectRatio:eB.Km(["16:9","9:16","1:1"]),upscaleToResolution:eB.Km(["720p","1080p","2K"]).default("720p"),enableBeatSync:eB.O7().optional(),enableBRoll:eB.O7().default(!0),enableStartEndFrame:eB.O7().default(!1),autoCaptions:eB.O7().default(!0),advancedSettings:eB.Ry({imageModelConfig:eB.PG(),videoModelConfig:eB.PG()}),additionalCharacters:eB.IX(eB.PG()).optional(),skipVideoGeneration:eB.O7().default(!1)}),i6={musicUrl:"",musicDuration:0,videoType:"singing-dancing",character:null,consistentStyle:"auto",referenceImageUrl:"",musicVideoTopic:"",video_scenes:"",aspectRatio:"16:9",upscaleToResolution:"720p",enableBeatSync:!0,enableBRoll:!0,enableStartEndFrame:!1,autoCaptions:!0,advancedSettings:{imageModelConfig:{model:"flux_kontext",parameters:{}},videoModelConfig:eH.Zc.value},skipVideoGeneration:!1,additionalCharacters:[]},i4={advancedSettings:{imageModelConfig:{model:"seedream4",parameters:{}},videoModelConfig:eH.Zc.value},skipVideoGeneration:!1},i3={...i6,advancedSettings:{imageModelConfig:{model:"seedream4",parameters:{}},videoModelConfig:eH.Zc.value},consistentStyle:"auto"},i8=e=>"consistent-style"===e?i3:"lyrics-video"===e?i4:i6,i9=e=>["seedream4","qwen-image","flux_kontext","nano-banana"].includes(e.model);function i7(e){let{onSubmit:t,videoType:i}=e,{isMobile:a}=(0,h.j)(),l=(0,tn.B)(),[c,p]=(0,ix.t1)(),[m,g]=n.useState(0),[f,v]=n.useState(null),[b,y]=n.useState(!1),{errors:w,isGenerating:C,character:j,consistentStyle:k,musicDuration:F,musicVideoTopic:S,video_scenes:I,musicUrl:_,advancedSettings:Z,aspectRatio:A,upscaleToResolution:E,enableBRoll:M,autoCaptions:T,enableBeatSync:R,enableStartEndFrame:D,imageModelOptions:P,videoModelOptions:W,skipVideoGeneration:L,handleMusicUrlChange:B,handleCharacterSelect:H,handleConsistentStyleChange:$,handleMusicVideoTopicChange:O,handleVideoScenesChange:U,handleAspectRatioSelect:G,handleUpscaleToResolutionChange:N,handleAutoCaptionsChange:V,handleAdditionalCharacterSelect:K,additionalCharacters:q,onFormSubmit:Y,onPreviewSubmit:X,handleModelSelect:J,handleEnableBRollChange:Q,handleEnableBeatSyncChange:ee,handleEnableStartEndFrameChange:ei,handleSkipVideoGenerationChange:er,MobilePreviewDialogComponent:en}=function(e){var t,i,r,a;let{onSubmit:s,activeVideoType:l}=e,d=(0,o.useRouter)(),{isMobile:c,showMobilePreviewDialog:u,MobilePreviewDialogComponent:p}=eU(),[h,m]=(0,n.useState)(!1),[x,g]=(0,n.useState)(!1),[f,v]=(0,n.useState)(null),{data:b}=(0,e7.w)(f,!!f);(0,n.useEffect)(()=>{var e;(null==b?void 0:null===(e=b.story)||void 0===e?void 0:e.id)&&x&&(g(!1),v(null),d.push(`/story/editor?story_id=${b.story.id}&view=list`))},[b,x,d]);let y=i8(l),w=eG.E.getState().getPrefill("music_video"),C=(0,eL.cI)({mode:"onChange",defaultValues:{musicUrl:(null==w?void 0:w.music_url)==null?i6.musicUrl:w.music_url,musicDuration:(null==w?void 0:w.music_duration)==null?i6.musicDuration:w.music_duration,videoType:l,character:(null==w?void 0:w.character)==null?i6.character:(0,tK.ow)(w.character),consistentStyle:(null==w?void 0:w.consistent_style)==null?i6.consistentStyle:w.consistent_style,referenceImageUrl:i6.referenceImageUrl,musicVideoTopic:(null==w?void 0:w.video_topic)==null?i6.musicVideoTopic:w.video_topic,aspectRatio:(null==w?void 0:w.aspect_ratio)==null?i6.aspectRatio:w.aspect_ratio,enableBRoll:(null==w?void 0:w.enable_broll)==null?i6.enableBRoll:w.enable_broll,enableStartEndFrame:(null==w?void 0:w.enable_start_end_frame)==null?i6.enableStartEndFrame:w.enable_start_end_frame,autoCaptions:(null==w?void 0:w.auto_captions)==null?i6.autoCaptions:w.auto_captions,enableBeatSync:(null==w?void 0:w.enable_beat_sync)==null?i6.enableBeatSync:w.enable_beat_sync,additionalCharacters:(null==w?void 0:w.additional_characters)==null?i6.additionalCharacters:w.additional_characters.map(e=>(0,tK.ow)(e)),advancedSettings:(null==w?void 0:w.advanced_settings)==null?y.advancedSettings:{imageModelConfig:(null===(t=(0,eH.O8)(null===(i=w.advanced_settings)||void 0===i?void 0:i.image_model_config,eH.Fj))||void 0===t?void 0:t.value)||y.advancedSettings.imageModelConfig,videoModelConfig:(null===(r=(0,eH.O8)(null===(a=w.advanced_settings)||void 0===a?void 0:a.video_model_config,eH.E5))||void 0===r?void 0:r.value)||y.advancedSettings.videoModelConfig},skipVideoGeneration:(null==w?void 0:w.skip_video_generation)==null?y.skipVideoGeneration:w.skip_video_generation},resolver:(0,eW.F)(i5)}),{handleSubmit:j,formState:{errors:k},setValue:F,watch:S,setError:I,clearErrors:_}=C,Z=S("musicUrl"),A=S("musicDuration"),E=S("videoType"),M=S("character"),T=S("consistentStyle"),R=S("referenceImageUrl"),D=S("musicVideoTopic"),z=S("video_scenes"),P=S("aspectRatio"),W=S("upscaleToResolution"),L=S("autoCaptions"),B=S("enableBRoll"),H=S("enableStartEndFrame"),$=S("enableBeatSync"),O=S("advancedSettings"),U=S("skipVideoGeneration"),G=S("additionalCharacters"),{mutate:N,isLoading:V}=i2(!1),{mutate:K,isLoading:q}=(0,e6.nn)(!1),Y=(0,n.useMemo)(()=>(0,eH._p)(M),[M]),X=(0,n.useMemo)(()=>{if(G&&G.length>0)return eH.Fj.filter(e=>"seedream4"===e.value.model).map(e=>({name:e.name,icon:e.icon,disabled:!1,value:e.value}));if("lyrics-video"===E){let e=eH.Fj.filter(e=>i9(e.value));return(0,eH.FA)(e,null==O?void 0:O.imageModelConfig).map(e=>({name:e.name,icon:e.icon,value:e.value}))}return(0,eH.FA)(eH.Fj,null==O?void 0:O.imageModelConfig).map(e=>({name:e.name,icon:e.icon,value:e.value,disabled:["consistent-style","story-focused"].includes(E)&&(0,eH.Rx)(e.value)||(0,eH.Rx)(e.value)&&Y||!!M&&"quick"!==M.reference_mode&&"nano-banana"===e.value.model}))},[G,E,Y,M,null==O?void 0:O.imageModelConfig]),J=(0,n.useMemo)(()=>{let e=(0,eH.GI)(E);return(H&&"singing-dancing"!==E?e.filter(e=>(0,eH.uv)(e.value)):e).map(e=>({name:e.name,icon:e.icon,value:e.value,disabled:!1}))},[E,H]);(0,n.useEffect)(()=>{if(M&&Y){let e=eH.Fj.find(e=>(0,eH.Pb)(e.value));(null==e?void 0:e.value)&&F("advancedSettings.imageModelConfig",e.value)}"lyrics-video"!==E&&F("skipVideoGeneration",!1)},[M,Y,F,E]),(0,n.useEffect)(()=>{"singing-dancing"!==E||W||F("upscaleToResolution","720p")},[E,W,F]),(0,n.useEffect)(()=>{F("videoType",l)},[l,F]),(0,n.useEffect)(()=>{let e=O.videoModelConfig,t=(0,eH.GI)(E);if(!t.some(t=>t.value.model===e.model&&JSON.stringify(t.value.parameters)===JSON.stringify(e.parameters))&&t.length>0){let e=t[0];"singing-dancing"!==E&&(e=eH.Zc),F("advancedSettings.videoModelConfig",e.value)}},[E,O.videoModelConfig,F]),(0,n.useEffect)(()=>{"consistent-style"===E&&(F("enableStartEndFrame",!0),F("advancedSettings.videoModelConfig",eH.gm.value))},[E,F]),(0,n.useEffect)(()=>{if(!H||"singing-dancing"===E)return;let e=O.videoModelConfig;if((0,eH.uv)(e))return;let t=(0,eH.GI)(E).find(e=>(0,eH.uv)(e.value));t&&F("advancedSettings.videoModelConfig",t.value)},[H,O.videoModelConfig,E,F]);let Q=(0,n.useCallback)(e=>{if(F("additionalCharacters",e),e.length>0){var t;F("advancedSettings.imageModelConfig",null===(t=eH.Fj.find(e=>(0,eH.Pb)(e.value)))||void 0===t?void 0:t.value)}else F("advancedSettings.imageModelConfig",i6.advancedSettings.imageModelConfig);_("additionalCharacters")},[F,_]),ee=(0,n.useCallback)((e,t)=>{F("musicUrl",e),F("musicDuration",t),_("musicUrl"),_("musicDuration")},[F,_]),et=(0,n.useCallback)(e=>{var t;F("character",e),_("character"),F("advancedSettings.imageModelConfig",null===(t=eH.Fj.find(e=>"Character"===e.name))||void 0===t?void 0:t.value)},[F,_]),ei=(0,n.useCallback)(e=>{F("consistentStyle",e)},[F]),er=(0,n.useCallback)(async e=>{try{F("referenceImageUrl",e),_("referenceImageUrl")}catch(e){I("referenceImageUrl",{message:`Upload failed: ${e instanceof Error?e.message:"Unknown error"}`})}},[F,I,_]),en=(0,n.useCallback)(()=>{F("referenceImageUrl",""),_("referenceImageUrl")},[F,_]),eo=(0,n.useCallback)(e=>{F("musicVideoTopic",e.join(",")),_("musicVideoTopic")},[F,_]),ea=(0,n.useCallback)(e=>{F("video_scenes",e)},[F]),es=(0,n.useCallback)(e=>{(0,n.startTransition)(()=>{d.replace(`/music-video/${(0,iQ.q)(e)}`,void 0,{shallow:!0,scroll:!1})}),F("videoType",e)},[F,d]),el=(0,n.useCallback)(e=>{F("aspectRatio",e),_("aspectRatio")},[F,_]),ed=(0,n.useCallback)(e=>{F("upscaleToResolution",e),_("upscaleToResolution")},[F,_]),ec=(0,n.useCallback)(e=>{F("enableBRoll",e)},[F]),eu=(0,n.useCallback)(e=>{F("enableStartEndFrame",e)},[F]),ep=(0,n.useCallback)(e=>{F("autoCaptions",e)},[F]),eh=(0,n.useCallback)((e,t,i)=>{if("imageModel"===e){let e=eH.Fj.find(e=>e.name===t);if(e){if((0,eH.Rx)(e.value)&&Y)return;F("advancedSettings.imageModelConfig",e.value)}}else if("videoModel"===e){let e=(0,eH.GI)(E),r=e.find(e=>e.name===t);if(i&&(r=e.find(e=>e.value.parameters===i&&e.name===t)),!r)return;if(H&&"singing-dancing"!==E&&!(0,eH.uv)(r.value)){let t=e.find(e=>"seedance-v1"===e.value.model);t&&F("advancedSettings.videoModelConfig",t.value);return}F("advancedSettings.videoModelConfig",r.value)}},[F,Y,E,H]),em=(0,n.useCallback)(e=>{F("enableBeatSync",e)},[F]),ex=(0,n.useCallback)(e=>{F("skipVideoGeneration",e),_("skipVideoGeneration")},[F,_]),eg=(0,tV.NL)(),ef=async(e,t)=>{let i=!1;if(t&&g(!0),e.musicUrl.trim()||(I("musicUrl",{message:"Please provide a music URL"}),i=!0),!i)try{var r;let i=e.character&&("consistent-character"===E||"singing-dancing"===E)?(0,eH.ZX)(e.character):null,n={music_url:e.musicUrl,character:i,additional_characters:null===(r=e.additionalCharacters)||void 0===r?void 0:r.map(e=>(0,eH.ZX)(e)),video_consistent_style:e.consistentStyle&&("consistent-style"===E||"lyrics-video"===E)?e.consistentStyle:null,reference_image_url:e.referenceImageUrl&&"consistent-style"===E?e.referenceImageUrl:null,video_topic:e.musicVideoTopic,..."singing-dancing"===E&&e.video_scenes?{video_scenes:e.video_scenes}:{},advanced_settings:{image_model_config:e.advancedSettings.imageModelConfig,video_model_config:e.advancedSettings.videoModelConfig},video_type:e.videoType,aspect_ratio:e.aspectRatio,enable_broll:e.enableBRoll,enable_start_end_frame:e.enableStartEndFrame,auto_captions:e.autoCaptions,enable_beat_sync:e.enableBeatSync,..."720p"!==e.upscaleToResolution&&{upscale_to_resolution:e.upscaleToResolution},...t&&{is_preview:!0},..."lyrics-video"===e.videoType&&{skip_video_generation:e.skipVideoGeneration}};if("lyrics-video"===e.videoType){K(n,{onSuccess:e=>{e.workflowRunId?t?c?u():v(e.workflowRunId):d.push(`/story/create/workflow/${e.workflowRunId}?category_id=lyrics_video`):s(),eg.invalidateQueries({queryKey:[tY.O]})},onError:e=>{t&&g(!1),console.error("Generation failed:",e)}});return}N(n,{onSuccess:e=>{e.workflowRunId?t?c?u():v(e.workflowRunId):d.push(`/story/create/workflow/${e.workflowRunId}?category_id=music_video`):s(),eg.invalidateQueries({queryKey:[tY.O]})},onError:e=>{t&&g(!1),console.error("Generation failed:",e)}})}catch(e){I("musicUrl",{message:`Failed to process: ${e instanceof Error?e.message:"Unknown error"}`})}};return{form:C,errors:k,isGenerating:V||q||x,isUploadingImage:h,musicUrl:Z,videoType:E,character:M,consistentStyle:T,referenceImageUrl:R,musicVideoTopic:D,video_scenes:z,aspectRatio:P,upscaleToResolution:W,enableBeatSync:$,enableBRoll:B,enableStartEndFrame:H,autoCaptions:L,advancedSettings:O,additionalCharacters:G,musicDuration:A,imageModelOptions:X,videoModelOptions:J,skipVideoGeneration:U,handleMusicUrlChange:ee,handleVideoTypeChange:es,handleCharacterSelect:et,handleConsistentStyleChange:ei,handleReferenceImageUpload:er,handleReferenceImageRemove:en,handleMusicVideoTopicChange:eo,handleVideoScenesChange:ea,handleAspectRatioSelect:el,handleUpscaleToResolutionChange:ed,handleEnableBRollChange:ec,handleEnableStartEndFrameChange:eu,handleAutoCaptionsChange:ep,handleAdditionalCharacterSelect:Q,onFormSubmit:j(async e=>{await ef(e,!1)}),onPreviewSubmit:j(async e=>{await ef(e,!0)}),handleModelSelect:eh,handleEnableBeatSyncChange:em,handleSkipVideoGenerationChange:ex,MobilePreviewDialogComponent:p}}({onSubmit:t,activeVideoType:i}),eo=n.useCallback(e=>{v(e)},[]),{totalCredits:ea,totalCreditsExcludingVideoGeneration:el}=(0,th.q8)("story.music_video",{advanced_settings:{image_model_config:Z.imageModelConfig,video_model_config:Z.videoModelConfig},video_type:i,video_consistent_style:k,music_duration:F,character:j,video_topic:S,num_shots:m,skip_video_generation:L,upscale_to_resolution:E}),ed=(0,n.useMemo)(()=>iv.w.find(e=>e.key===i),[i]),[ec]=(0,z.f)("music_video_story",{duration:F},{oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[p?"Calculating...":ea," ",a?"":"credits"]}),a?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})})]}),newUI:(e,t,i)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK,textDecoration:"line-through"},children:[p?"Calculating...":ea," ",a?"":"credits"]}),a?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:"bold",fontSize:"12px",lineHeight:"1em",color:"#BFBFBF"},children:[(0,r.jsx)("span",{style:{color:tp.MK},children:t})," FREE Story Left"]})]}),upgradeDailyNewUI:null}),[eu]=(0,z.f)("story",{},{disabled:!0,oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[p?"Calculating...":el," ",a?"":"credits"]}),a?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected image model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})})]}),newUI:(e,t,i)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.PhCurrencyEth,{size:12,sx:{color:tp.MK}}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-0.02em",color:tp.MK},children:[p?"Calculating...":el," ",a?"":"credits"]}),a?null:(0,r.jsx)(tf.Z,{title:"Credits are calculated based on the selected image model and music duration.",children:(0,r.jsx)(s.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:(0,r.jsx)(es.PhInfo,{size:12,sx:{color:"#BFBFBF"}})})})]}),upgradeDailyNewUI:null});return(0,r.jsxs)(s.Z,{component:"form",onSubmit:e=>{e.preventDefault(),l({onAuthenticated:()=>Y(e)})},sx:{display:"flex",flexDirection:"column",maxWidth:800,mx:"auto",mt:{xs:2,md:8},minHeight:"100vh"},children:[(0,r.jsxs)(s.Z,{sx:{flex:1,pb:2},children:[(0,r.jsx)(iV,{option:ed}),(0,r.jsxs)(s.Z,{sx:{mb:a?1:3,mt:a?3:4},children:[(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",sx:{mb:a?1:2},children:[(0,r.jsx)(es.CustomMusicUpload,{size:20}),(0,r.jsxs)(d.Z,{fontSize:"16px",fontWeight:500,color:"rgba(204, 204, 204, 1)",gutterBottom:!0,children:["Upload Music",(0,r.jsx)("span",{style:{fontSize:"0.75em",fontWeight:400,color:"rgb(153, 153, 153)"},children:"(Up to 5 minutes)"})]})]}),(0,r.jsx)(im,{initialMusicUrl:_,onSelectMusicExample:eo,selectedMusicExample:f,onSelectedMusicExampleProcessed:()=>v(null),onChange:(e,t,i)=>{B(e,i)},onUploadStart:()=>{},onUploadError:e=>{console.error("Upload error:",e)},onLinkChange:e=>{B(e,0)},linkPlaceholder:"Enter Suno/TikTok music URL...",customAudioParser:async(e,t)=>{"lyrics-video"===i&&g((await c(e)).num_shots)}}),w.musicUrl?(0,r.jsx)(t0.Z,{severity:"error",sx:{mt:1},children:w.musicUrl.message}):null]}),(0,r.jsxs)(s.Z,{sx:{mb:a?2:3,width:"100%",maxWidth:"100%"},children:[(0,r.jsx)(iU,{videoType:i,skipVideoGeneration:L,handleSkipVideoGenerationChange:er,handleConsistentStyleChange:$,handleCharacterSelect:H,handleAdditionalCharacterSelect:K,selectedCharacter:j,additionalCharacters:q,handleMusicVideoTopicChange:O,aspectRatio:A,video_scenes:I,onVideoScenesChange:U}),w.character?(0,r.jsx)(t0.Z,{severity:"error",sx:{mt:1},children:w.character.message}):null]}),"consistent-character"===i||"consistent-style"===i?(0,r.jsxs)(s.Z,{sx:{mb:a?2:3},onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:[(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",mb:a?1:2,children:[(0,r.jsx)(es.CustomShot,{size:20}),(0,r.jsx)(d.Z,{fontSize:"16px",fontWeight:500,color:"rgba(204, 204, 204, 1)",mb:2,gutterBottom:!0,children:"One-Take Style"})]}),(0,r.jsx)(iC,{value:!!D,onChange:e=>ei(e),isHovered:b})]}):null,A&&G?(0,r.jsx)(s.Z,{sx:{mb:a?2:3},children:(0,r.jsx)(x,{aspectRatioOptions:"singing-dancing"===i?["1:1","9:16","16:9"]:["9:16","16:9"],value:A,onChange:e=>{("16:9"===e||"9:16"===e||"1:1"===e)&&G(e)}})}):null,"lyrics-video"===i&&(0,r.jsx)(u.Z,{sx:{mb:a?2:3,mt:a?1:0},children:(0,r.jsx)(iB,{options:ij.filter(e=>"EDM"!==e.name),value:k,onChange:e=>{let t=ij.find(t=>t.name.toLowerCase()===e.toLowerCase());t?null==$||$(t.name):null==$||$(e)}})}),(0,r.jsx)(s.Z,{sx:{mb:a?2:3,width:"100%",maxWidth:"100%"},children:(0,r.jsx)(iJ,{imageModelConfig:Z.imageModelConfig,videoModelConfig:Z.videoModelConfig,imageModelOptions:P,videoModelOptions:W,onModelSelect:J,videoType:i,upscaleToResolution:E,handleUpscaleToResolutionChange:N,enableBRoll:M,handleEnableBRollChange:Q,enableStartEndFrame:D,handleEnableStartEndFrameChange:ei,enableBeatSync:R,handleEnableBeatSyncChange:ee,autoCaptions:T,handleAutoCaptionsChange:V})})]}),(0,r.jsx)(et.i,{storyType:"music_video",isGenerating:C,promoQuotaUI:ec,previewPromoQuotaUI:eu,disabled:C||!_||("singing-dancing"===i||"consistent-character"===i)&&!j,showCreditInfo:!0,onCreateStory:()=>{l({onAuthenticated:()=>Y()})},onCreatePreview:()=>{l({onAuthenticated:()=>X()})}}),(0,r.jsx)(en,{})]})}var re=i(87261);function rt(e){let t,i,{expanded:n,onToggle:o,character:a,error:c,onFirstCharacterSelect:p,iconSize:h=16,sx:m}=e;return(0,r.jsx)(s.Z,{sx:{mb:4,position:"relative",...m},children:(0,r.jsxs)(y.Z,{expanded:n,onChange:(e,t)=>o(t),sx:{backgroundColor:"transparent",boxShadow:"none",border:"none","&:before":{display:"none"},"&.Mui-expanded":{margin:0}},children:[(0,r.jsxs)(w.Z,{expandIcon:(0,r.jsx)(re.Z,{sx:{color:"#666",fontSize:16,backgroundColor:"#101010",borderRadius:"50%",width:24,height:24,padding:"4px"}}),sx:{padding:0,minHeight:"auto","&.Mui-expanded":{minHeight:"auto"},"& .MuiAccordionSummary-content":{margin:0,display:"flex",justifyContent:"space-between",alignItems:"center","&.Mui-expanded":{margin:0}},"& .MuiAccordionSummary-expandIconWrapper":{transition:"transform 0.3s","&.Mui-expanded":{transform:"rotate(180deg)"}}},children:[(t=(0,r.jsx)(es.PhPersonArmsSpread,{size:h,sx:{color:"#CCCCCC"}}),i="Add Your Character (optional)",(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[t,(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:{xs:"14px",md:"16px"},lineHeight:"1.5em",color:"#CCCCCC"},children:i})]})),(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1,pr:1},children:[(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:{xs:"14px",md:"16px"},lineHeight:"1.43em",color:"#AAAAAA",maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(null==a?void 0:a.name)||"None"}),a?(0,r.jsx)(l.Z,{size:"small",variant:"text",onClick:e=>{e.stopPropagation(),p(null)},onMouseDown:e=>e.stopPropagation(),sx:{minWidth:"auto",padding:"2px 6px",color:"var(--Gray-500)",fontSize:12,textTransform:"none","&:hover":{backgroundColor:"transparent",color:"var(--Gray-300)"}},startIcon:(0,r.jsx)(es.PhX,{size:12,sx:{color:"currentColor"}})}):null]})]}),(0,r.jsx)(C.Z,{sx:{padding:"16px 0 0 0"},children:(0,r.jsxs)(u.Z,{spacing:1,children:[(0,r.jsx)(t0.Z,{severity:"info",children:"They’ll appear in your visuals to help illustrate your story."}),(0,r.jsx)(tU,{firstCharacter:a,onFirstCharacterSelect:p,additionalCharacters:[],onAdditionalCharactersSelect:()=>{},error:c,maxCharacters:1,showTitle:!1,showPreviewAvatar:!1,characterType:"script_to_video",outfitChangesPosition:"overall"})]})})]})})}let ri=(0,ea.ZP)(Z.Z)(e=>{let{theme:t}=e;return{"& .MuiDialog-paper":{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"11px",width:"444px",maxWidth:"444px"}}}),rr=(0,ea.ZP)(en.Z)(e=>{let{theme:t}=e;return{color:"#FFFFFF",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"1.21em",padding:"16px 20px 24px 20px",position:"relative"}}),rn=(0,ea.ZP)(A.Z)(e=>{let{theme:t}=e;return{padding:"0 20px 16px 20px",display:"flex",flexDirection:"column",gap:"24px"}}),ro=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{position:"relative",height:"132px"}}),ra=(0,ea.ZP)(eo.Z)(e=>{let{theme:t}=e;return{"& .MuiOutlinedInput-root":{backgroundColor:"#101010",borderRadius:"8px",height:"132px",border:"none","& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"},"& textarea":{color:"#FFFFFF",fontFamily:"Inter",fontWeight:500,fontSize:"12px",resize:"none","&::placeholder":{color:"#444444",opacity:1}}}}}),rs=(0,ea.ZP)(d.Z)(e=>{let{theme:t}=e;return{position:"absolute",bottom:"11px",right:"12px",color:"#444444",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.83em"}}),rl=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column"}}),rd=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"}}),rc=(0,ea.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#1D1D1D",border:"1px solid #444444",borderRadius:"5px",color:"#B5B5B5",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"1.02em",padding:"10px 27px",width:"131px",height:"44px",textTransform:"none","&:hover":{backgroundColor:"#2A2A2A",border:"1px solid #555555"}}}),ru=(0,ea.ZP)(er.Z)(e=>{let{theme:t}=e;return{borderRadius:"5px",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"1.21em",padding:"17px 42px",height:"44px",textTransform:"none",gap:"4px"}});function rp(e){let{open:t,onClose:i,onGenerate:o,isGenerating:a}=e,[s,l]=(0,n.useState)(""),c=async()=>{s.trim()&&o&&await o(s.trim()),null==i||i(void 0,"backdropClick")},u=()=>{l(""),null==i||i(void 0,"backdropClick")};return(0,r.jsxs)(ri,{open:t,onClose:u,maxWidth:!1,children:[(0,r.jsxs)(rr,{children:[(0,r.jsx)(d.Z,{fontSize:16,fontWeight:600,color:"#FFFFFF",children:"Idea to video"}),(0,r.jsx)(E.Z,{onClick:u,sx:{position:"absolute",right:8,top:8,color:"#888888"},children:(0,r.jsx)(ei.Z,{})})]}),(0,r.jsxs)(rn,{children:[(0,r.jsx)(rl,{children:(0,r.jsxs)(ro,{children:[(0,r.jsx)(ra,{fullWidth:!0,multiline:!0,rows:4,placeholder:"What topic would you like to explain today? Add any extra inputs you'd like here.",value:s,onChange:e=>{let t=e.target.value;t.length<=100&&l(t)},variant:"outlined"}),(0,r.jsxs)(rs,{children:[s.length,"/",100]})]})}),(0,r.jsxs)(rd,{children:[(0,r.jsx)(rc,{onClick:u,children:"Cancel"}),(0,r.jsxs)(ru,{className:"oa-button-primary",onClick:c,variant:"contained",disabled:!s.trim(),loading:a,children:[(0,r.jsx)(es.CustomRewrite,{}),(0,r.jsx)(d.Z,{children:"Generate script"})]})]})]})]})}let rh=(0,i(31764).Z)(er.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#1A1A1A",background:"#1A1A1A",position:"relative",borderRadius:"8px",padding:"4px 8px",height:"32px",color:"#FFFFFF",fontSize:"12px",fontWeight:500,letterSpacing:"-0.01em",textTransform:"none",border:"1.5px solid transparent",backgroundImage:"linear-gradient(#1A1A1A, #1A1A1A), linear-gradient(135deg, #072A6E 0%, #24AFB1 57.27%, #5E6EFF 100%)",backgroundOrigin:"border-box",backgroundClip:"padding-box, border-box","& .MuiButton-startIcon":{marginRight:"4px","& svg":{fontSize:"14px",color:"#FFFFFF"}},"&:hover":{backgroundColor:"#1A1A1A",background:"#1A1A1A",backgroundImage:"linear-gradient(#1A1A1A, #1A1A1A), linear-gradient(135deg, #072A6E 0%, #24AFB1 57.27%, #5E6EFF 100%)",backgroundOrigin:"border-box",backgroundClip:"padding-box, border-box",filter:"brightness(1.2)"}}}),rm=[{id:"cat-webinar",emoji:"\uD83D\uDC31",text:"Cat Webinar",fullScript:"A cat gives a webinar on how to take over the world in 5 steps",style:"photorealistic"},{id:"puma-intro",emoji:"�",text:"Puma Intro",fullScript:`Meet the Americas' ultimate predator—the puma. Silent, powerful, and absolutely magnificent.
Also known as mountain lion or cougar, the puma is the most widely distributed wild cat in the world. Stretching from Canada to South America, these incredible hunters have conquered every terrain—from tropical rainforests to snow-capped mountains.
Weighing up to 100 kilograms, pumas are nature's perfect athletes. They can leap 5.5 meters vertically and over 12 meters horizontally. These solitary hunters stalk their prey with deadly precision, capable of taking down animals twice their size.
As apex predators, pumas maintain the delicate balance of American ecosystems. But habitat loss threatens their survival. Protecting these magnificent cats means preserving the wild heart of the Americas.
The puma—America's silent sovereign, forever wild, forever free.`,style:"photorealistic"},{id:"travel-asia",emoji:"�",text:"Travel in Asia",fullScript:"Top 5 cities to visit in Asia",style:"microworld"},{id:"tech-innovations",emoji:"\uD83D\uDCBB",text:"Tech Innovations",fullScript:"Five Tech Innovations That Defined the 1980s",style:"pixelart"}],rx=(0,ea.ZP)(u.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#101010",border:"1px solid #2E2E2E",borderRadius:"12px",padding:"20px 16px",display:"flex",flexDirection:"column",gap:"16px",width:"100%"}}),rg=(0,ea.ZP)(ey.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#1A1A1A",color:"#CCCCCC",fontSize:"14px",fontWeight:500,height:"32px",borderRadius:"21px",padding:"4px 12px","& .MuiChip-label":{padding:0},"&:hover":{backgroundColor:"#2A2A2A",cursor:"pointer"}}});function rf(e){let{value:t,scriptOverLimit:i,scriptLength:o,maxScriptLength:a,onChange:l,error:c,helperText:p,autoRewrite:h,onClickUndo:m,canUndo:x,isRewriting:g,setAutoRewrite:f,handleSuggestionClick:v}=e,[b,y]=(0,n.useState)(!1),w=(0,n.useRef)(null);return(0,r.jsxs)(s.Z,{sx:{mb:4},children:[(0,r.jsxs)(rx,{justifyContent:"space-between",sx:{px:{xs:1,md:1.5},py:{xs:1,md:1.5}},children:[(0,r.jsx)(eo.Z,{name:"scriptContent",value:t,onChange:e=>{l(e)},placeholder:"Enter your voice-over script: anything you write here will be narrated and come to life on screen.",multiline:!0,variant:"standard",fullWidth:!0,InputProps:{disableUnderline:!0,sx:{flex:1,alignItems:"flex-start",height:"auto","& .MuiInputBase-input":{maxHeight:{xs:"200px",md:"400px"},minHeight:{xs:"200px",md:"380px"},overflowY:"auto !important",padding:"8px",borderRadius:"8px",transition:"background-color 0.2s ease","&:focus":{backgroundColor:"rgba(255, 255, 255, 0.03)",outline:"none"},"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)",borderRadius:"2px"},"&::-webkit-scrollbar-thumb:hover":{background:"rgba(255, 255, 255, 0.3)"}}}},inputProps:{sx:{color:"#FFFFFF",fontSize:{xs:"14px",md:"16px"},fontWeight:500,lineHeight:1.5,"&::placeholder":{color:"#666",opacity:1}}},sx:{flex:1,display:"flex","& .MuiInputBase-root":{flex:1,display:"flex"}}}),(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:"12px"},children:[(0,r.jsx)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,r.jsxs)(u.Z,{direction:"row",spacing:1.5,alignItems:"center",children:[(0,r.jsx)(iG.Z,{sx:{backgroundColor:"transparent",border:"1px solid #2E2E2E",borderRadius:"8px",padding:"4px 8px",height:"32px"},onClick:()=>{y(!b)},ref:w,disabled:g,children:(0,r.jsxs)(u.Z,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[(0,r.jsx)(t1.r,{checked:h,onClick:e=>{e.stopPropagation()},onChange:e=>{f(e.target.checked)}}),(0,r.jsx)(d.Z,{fontSize:12,fontWeight:500,sx:{textAlign:"left"},children:"Auto-Polish Script"}),(0,r.jsx)(tf.Z,{title:"Turn on to enhance your voice-over script with AI. Turn off to use your script exactly as written, without optimization.",children:(0,r.jsx)(es.PhInfo,{color:"#666"})})]})}),x?(0,r.jsx)(ey.Z,{component:"div",size:"small",sx:{borderRadius:"8px",padding:"none",backgroundColor:"white",color:tp.tE,cursor:"pointer"},label:(0,r.jsx)(u.Z,{direction:"row",alignItems:"center",spacing:.2,onClick:m,children:(0,r.jsx)(d.Z,{variant:"editor-label1",children:"Undo"})})}):null]})}),(0,r.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(t7.Z,{sx:{borderColor:"#2E2E2E",flex:1,mr:2}}),(0,r.jsxs)(d.Z,{variant:"caption",sx:{color:i?"#ff4444":"#666",fontSize:"12px",whiteSpace:"nowrap"},children:[o,"/",a]})]}),(0,r.jsx)(u.Z,{direction:"row",spacing:1.5,alignItems:"center",sx:{width:"100%",overflow:"auto"},children:(0,r.jsx)(u.Z,{direction:"row",spacing:1,alignItems:"center",sx:{flex:1},children:rm.map((e,t)=>(0,r.jsx)(rg,{label:e.text,onClick:()=>v(e)},e.id))})})]})]}),p?(0,r.jsx)(d.Z,{variant:"caption",sx:{color:c?"error.main":"text.secondary",mt:1,display:"block"},children:p}):null]})}function rv(e){var t;let{iconSize:i=20,sx:n,imageModelConfig:o,videoModelConfig:a,autoCaptions:l,handleAutoCaptionsChange:c,imageModelOptions:p,videoModelOptions:h,onModelSelect:m,expanded:x,onChange:g,expandedPanels:v,togglePanel:b,backgroundMusic:j,handleBackgroundMusicChange:k}=e;return(0,r.jsx)(s.Z,{sx:{position:"relative",...n},children:(0,r.jsxs)(y.Z,{expanded:x,onChange:g,sx:{backgroundColor:"transparent",boxShadow:"none",border:"none","&:before":{display:"none"},"&.Mui-expanded":{margin:0}},children:[(0,r.jsx)(w.Z,{expandIcon:(0,r.jsx)(f.Z,{sx:{color:"#666",fontSize:16,backgroundColor:"#101010",borderRadius:"50%",width:24,height:24,padding:"4px"}}),sx:{padding:0,minHeight:"auto","&.Mui-expanded":{minHeight:"auto"},"& .MuiAccordionSummary-content":{margin:0,"&.Mui-expanded":{margin:0}},"& .MuiAccordionSummary-expandIconWrapper":{transition:"transform 0.3s","&.Mui-expanded":{transform:"rotate(180deg)"}}},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(ts.Z,{sx:{color:"#CCCCCC",fontSize:i}}),(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:"16px",lineHeight:"1.5em",color:"#CCCCCC"},children:"Advanced Options"})]})}),(0,r.jsx)(C.Z,{sx:{padding:"20px 8px 16px 8px"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,r.jsx)(iX,{showIcon:!1,value:l,onChange:e=>c(e)}),(0,r.jsx)(Y,{showIcon:!1,defaultMusicType:j?"upload":"auto",iconSize:16,value:j,onChange:e=>k(e),expanded:v.backgroundMusic,onExpandChange:(e,t)=>{t!==v.backgroundMusic&&b("backgroundMusic",t)},sx:{mb:0}}),(0,r.jsxs)(u.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(d.Z,{sx:{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC"},children:"Image Model"}),(0,r.jsx)(iK.Op,{label:"Select image model",value:(null===(t=eH.Fj.find(e=>e.value.model===o.model&&JSON.stringify(e.value.parameters)===JSON.stringify(o.parameters)))||void 0===t?void 0:t.name)||eH.Fj[0].name,options:p,onChange:e=>m("imageModel",e),sx:{width:"100%"}})]}),(0,r.jsxs)(u.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(d.Z,{sx:{fontWeight:600,fontSize:"14px",lineHeight:"1.4em",color:"#CCCCCC"},children:"Video Model"}),(0,r.jsx)(tu,{videoModelConfig:a,videoModelOptions:h,onModelSelect:m})]})]})})]})})}let rb=e=>{let{value:t="",onChange:i,placeholder:o="Describe the style"}=e,[a,s]=(0,n.useState)(t),{isMobile:l}=(0,h.j)();return(0,r.jsx)(eI.E.div,{initial:{opacity:0,height:0,marginBottom:0},animate:{opacity:1,height:"auto",marginBottom:l?12:16},exit:{opacity:0,height:0,marginBottom:0},transition:{duration:.3,ease:[.4,0,.2,1]},style:{overflow:"hidden"},children:(0,r.jsx)(eo.Z,{value:a,onChange:e=>{let t=e.target.value;s(t),null==i||i(t)},placeholder:o,multiline:!0,rows:3,variant:"outlined",fullWidth:!0,size:"small",sx:{mx:0,"& .MuiOutlinedInput-root":{backgroundColor:"#1A1A1A",borderRadius:"6px",fontSize:l?"13px":"14px",fontWeight:500,padding:"8px",px:1,py:0,"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"}},"& .MuiOutlinedInput-input":{color:"white",padding:l?"10px 0px":"8px 0px","&::placeholder":{color:"#666666",opacity:1}}}})})},ry=(e,t)=>e?i_.mobile:t?i_.tablet:i_.desktop,rw=()=>{let{isMobile:e,isTablet:t}=(0,h.j)();return(0,n.useMemo)(()=>ry(e,t),[e,t])},rC=()=>{let[e,t]=(0,n.useState)(0),i=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=()=>{i.current&&t(i.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),{containerWidth:e,containerRef:i}},rj=e=>{let[t,i]=(0,n.useState)(!1),r=(0,n.useRef)(null),{isMobile:o,isTablet:a}=(0,h.j)();return(0,n.useEffect)(()=>{let e=()=>{if(r.current){let{scrollTop:e,scrollHeight:t,clientHeight:n}=r.current;i(e+n<t-iI.SCROLL_THRESHOLD)}};e();let t=r.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[e]),{canScrollDown:t,scrollableRef:r,handleScrollDown:()=>{if(r.current){let{columnsCount:t,gap:i,padding:n,minCardHeight:s}=ry(o,a),l=e-2*n;r.current.scrollBy({top:Math.max(Math.max(0,(l-i*(t-1))/t),s)+i,behavior:"smooth"})}}}},rk=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=rw(),{cardWidth:o,cardHeight:a,containerHeight:s,columnsCount:l,gap:d,padding:c}=(0,n.useMemo)(()=>{let{columnsCount:n,gap:o,padding:a,minCardHeight:s,fallbackHeight:l,customInputHeight:d,customInputMarginBottom:c,showStyleNumber:u}=r,p=Math.max(0,(e-2*a-o*(n-1))/n),h=Math.max(p,s),m=Math.ceil(u/n),x=h*m+o*(m-1)+2*a;return t&&(x+=d+c),Math.ceil(i/n)>m&&(x+=.25*h),{cardWidth:p,cardHeight:h,containerHeight:x=Math.max(x,l),columnsCount:n,gap:o,padding:a}},[e,r,t,i]);return{cardWidth:o,cardHeight:a,containerHeight:s,columnsCount:l,gap:d,padding:c}},rF=e=>{let{delay:t=0}=e;return(0,r.jsx)(s.Z,{sx:{width:4,height:4,borderRadius:"50%",bgcolor:"rgba(255, 255, 255, 0.6)",animation:`pulse 1.5s ease-in-out infinite ${t}s`,"@keyframes pulse":{"0%, 100%":{opacity:.6},"50%":{opacity:1}}}})},rS=e=>{let{canScrollDown:t,onScrollDown:i}=e;return t?(0,r.jsxs)(s.Z,{onClick:i,sx:{position:"absolute",bottom:12,right:12,display:"flex",alignItems:"center",gap:.5,px:1,py:.5,bgcolor:"rgba(0, 0, 0, 0.7)",borderRadius:"12px",backdropFilter:"blur(4px)",zIndex:3,cursor:"pointer",transition:"all 0.2s","&:hover":{bgcolor:"rgba(0, 0, 0, 0.8)",transform:"scale(1.05)"},"&:active":{transform:"scale(0.95)"}},children:[(0,r.jsx)(rF,{delay:0}),(0,r.jsx)(rF,{delay:.2}),(0,r.jsx)(rF,{delay:.4})]}):null},rI=e=>{let{icon:t,title:i,selectedStyleName:n}=e;return(0,r.jsx)(eI.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},children:(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(eI.E.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{duration:.4,ease:"easeOut",delay:.1},children:t}),(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:{xs:"14px",md:"16px"},color:"#AAAAAA"},children:i})]}),(0,r.jsx)(eS.M,{mode:"wait",children:n?(0,r.jsx)(eI.E.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2,ease:"easeInOut"},children:(0,r.jsx)(d.Z,{sx:{fontWeight:500,fontSize:{xs:"14px",md:"16px"},color:"#AAAAAA"},children:n})},n):null})]})})},r_=e=>{let{styleOption:t,isSelected:i,onSelect:o,cardWidth:a,cardHeight:l}=e,c=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),{isMobile:m}=(0,h.j)();return(0,r.jsx)(s.Z,{sx:{height:`${l}px`,overflow:"hidden",border:i?"2px solid #2F66FF":"2px solid transparent",borderRadius:"6px",transition:"border-color 0.2s ease"},children:(0,r.jsx)(eI.E.div,{whileHover:m?{}:{scale:1.02},whileTap:{scale:.98},transition:{duration:.2,ease:"easeInOut"},style:{width:"100%",height:"100%"},children:(0,r.jsx)(eA.Z,{onClick:()=>{o(t)},onMouseEnter:()=>{!m&&(p(!0),c.current&&t.videoUrl&&c.current.play().catch(()=>{}))},onMouseLeave:()=>{!m&&(p(!1),c.current&&t.videoUrl&&(c.current.pause(),c.current.currentTime=0))},onTouchStart:()=>{m&&c.current&&t.videoUrl&&(p(!0),c.current.play().catch(()=>{}),setTimeout(()=>{p(!1),c.current&&(c.current.pause(),c.current.currentTime=0)},1e3))},sx:{cursor:"pointer",transition:"all 0.2s",backgroundColor:"transparent",boxShadow:"none",borderRadius:"4px",width:"100%",height:"100%",border:"none",...m&&{"&:active":{transform:"scale(0.95)"}}},children:(0,r.jsx)(eE.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:0,"&:last-child":{pb:0},position:"relative",height:"100%"},children:(0,r.jsxs)(s.Z,{sx:{backgroundColor:"Custom"===t.name?"rgba(90, 72, 202, 0.46)":"#1A1A1A",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:"100%",height:"100%",overflow:"hidden"},children:[t.videoUrl?(0,r.jsx)("video",{ref:c,src:t.videoUrl,muted:!0,loop:!0,playsInline:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",opacity:u?1:0,transition:"opacity 0.3s ease",zIndex:2}}):null,t.imageUrl?(0,r.jsx)("img",{src:t.imageUrl,alt:t.name,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",zIndex:1}}):null,(0,r.jsx)(s.Z,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"50%",background:"linear-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%)",borderRadius:"0 0 4px 4px",pointerEvents:"none",zIndex:2.5}}),(0,r.jsx)(eI.E.div,{animate:{color:i?"#FFFFFF":"#CCC"},transition:{duration:.2},style:{position:"absolute",bottom:m?6:8,left:"50%",transform:"translateX(-50%)",zIndex:3},children:(0,r.jsx)(d.Z,{variant:"caption",sx:{textAlign:"center",fontWeight:500,fontSize:`${Math.max(Math.min(.12*a,m?11:12),9)}px`,lineHeight:"1.21em",whiteSpace:"nowrap",textShadow:"0 1px 2px rgba(0, 0, 0, 0.8)"},children:t.name})})]})})})})})},rZ=e=>{let{styles:t,selectedStyle:i,onStyleSelect:n,cardWidth:o,cardHeight:a,columnsCount:l=4,gap:d=1.5}=e;return(0,r.jsx)(s.Z,{sx:{display:"grid",gridTemplateColumns:`repeat(${l}, 1fr)`,gap:d/8,width:"100%",pb:.5},children:t.map((e,t)=>(0,r.jsx)(r_,{styleOption:e,isSelected:(null==i?void 0:i.name)===e.name,onSelect:n,cardWidth:o,cardHeight:a},e.name))})},rA=e=>{let{value:t="photorealistic",onChange:i}=e,[o,a]=(0,n.useState)(iS.find(e=>e.value===t)||iS[0]);(0,n.useEffect)(()=>{a(iS.find(e=>e.value===t)||iS[0])},[t]);let l=(0,n.useMemo)(()=>!R.TJ.some(e=>e.value===(null==o?void 0:o.value)),[o]),{isMobile:d}=(0,h.j)(),c=rw(),{containerWidth:u,containerRef:p}=rC(),{canScrollDown:m,scrollableRef:x,handleScrollDown:g}=rj(u),{cardWidth:f,cardHeight:v,containerHeight:b,columnsCount:y,gap:w,padding:C}=rk(u,l,iS.length),{fallbackHeight:j}=c;return(0,r.jsxs)(s.Z,{sx:{position:"relative"},children:[(0,r.jsx)(rI,{icon:(0,r.jsx)(es.PhPaletteBold,{size:16,sx:{color:"#AAAAAA"}}),title:"Choose Visual Style",selectedStyleName:null==o?void 0:o.name}),(0,r.jsxs)(eb.Z,{ref:p,elevation:0,sx:{bgcolor:iZ,borderRadius:"8px",position:"relative",maxWidth:"100%",width:"100%",height:u>0?`${b}px`:`${j}px`,p:C/8,overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:`linear-gradient(180deg, ${iZ}CC 0%, transparent 100%)`,zIndex:2,pointerEvents:"none"},"&::after":{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"4px",background:`linear-gradient(0deg, ${iZ}CC 0%, transparent 100%)`,zIndex:2,pointerEvents:"none"}},children:[(0,r.jsxs)(s.Z,{ref:x,sx:{height:"100%",overflow:"auto","&::-webkit-scrollbar":{width:d?"0px":"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)",borderRadius:"2px"},"&::-webkit-scrollbar-thumb:hover":{background:"rgba(255, 255, 255, 0.3)"}},children:[(0,r.jsx)(eS.M,{children:l?(0,r.jsx)(rb,{value:t,onChange:i,placeholder:"Describe the style"}):null}),(0,r.jsx)(rZ,{styles:iS,selectedStyle:o,onStyleSelect:e=>{a(e),null==i||i(e.value||"photorealistic")},cardWidth:f,cardHeight:v,columnsCount:y,gap:w})]}),(0,r.jsx)(rS,{canScrollDown:m,onScrollDown:g})]})]})};var rE=i(3674),rM=i(9421),rT=i(60588),rR=i(89252);let rD={vertical:"bottom",horizontal:"right"},rz={vertical:"bottom",horizontal:"left"},rP=e=>{let{sx:t={},title:i,value:o,autoPick:a=!1,onChange:l,options:c,anchorOrigin:p=rD,transformOrigin:h=rz}=e,[m,x]=(0,n.useState)(null),g=(0,n.useMemo)(()=>{if(c)return a?[{key:"auto",label:"Auto",thumbnail:"https://cdn.openart.ai/assets/speech-voice/9.png"},...c]:c;let e=e9.B8.map(e=>({key:e.key,label:e.label,thumbnail:e.thumbnail,voice:e.voice}));return a?[{key:"auto",label:"Auto",thumbnail:"https://cdn.openart.ai/assets/speech-voice/9.png"},...e]:e},[a,c]),f=(0,n.useMemo)(()=>g.find(e=>e.key===o),[o,g]),[v,b]=(0,n.useState)(!1),[y,w]=(0,n.useState)(null),C=n.useRef(null),j=()=>{C.current&&(C.current.pause(),C.current.currentTime=0),w(null),b(!1),x(null)},k=e=>{null==l||l(e),j()},F=(e,t)=>{if(t.stopPropagation(),y===e){C.current&&(C.current.pause(),C.current.currentTime=0,C.current=null),w(null);return}C.current&&(C.current.pause(),C.current.currentTime=0),w(e);let i=g.find(t=>t.key===e),r=(null==i?void 0:i.voice)||(null==i?void 0:i.previewUrl);if(r){let e=new Audio(r);C.current=e,e.play().then(()=>{e.addEventListener("ended",()=>{w(null),C.current=null})}).catch(e=>{console.error("Error playing audio:",e),w(null),C.current=null})}};return(0,r.jsxs)(u.Z,{direction:"row",justifyContent:"space-between",sx:{backgroundColor:rR.P,borderRadius:rR.tO,height:40,p:1.5,cursor:"pointer",...t},alignItems:"center",onClick:e=>{x(e.currentTarget),b(!0)},children:[f?i({selectedVoice:f}):null,(0,r.jsx)(rT.ZP,{open:v,anchorEl:m,onClose:j,keepMounted:!1,style:{zIndex:1500},anchorOrigin:p,transformOrigin:h,slotProps:{paper:{sx:{backgroundColor:"#1A1A1A",borderRadius:"6px",width:199,maxHeight:300,overflowY:"auto","&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(255, 255, 255, 0.3)",borderRadius:"1px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"rgba(255, 255, 255, 0.5)"},"&::-webkit-scrollbar-thumb:active":{backgroundColor:"rgba(255, 255, 255, 0.6)"}}}},disableEnforceFocus:!0,disableAutoFocus:!0,disableRestoreFocus:!0,onClick:e=>e.stopPropagation(),children:(0,r.jsx)(s.Z,{sx:{padding:"8px 4px"},children:(0,r.jsx)(u.Z,{spacing:.5,children:g.map(e=>(0,r.jsxs)(u.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{padding:"4px 8px",height:32,borderRadius:rR.zO,backgroundColor:o===e.key?rR.VY:"transparent","&:hover":{backgroundColor:o===e.key?rR.VY:"rgba(255, 255, 255, 0.1)"},cursor:"pointer"},onClick:()=>k(e.key),children:[(0,r.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:1,sx:{flex:1,overflow:"hidden"},children:[e.renderAvatar?e.renderAvatar():(0,r.jsx)("img",{src:e.thumbnail,alt:e.label,style:{width:24,height:24,overflow:"hidden",backgroundColor:"#555",border:"0.5px solid #2E2E2E",borderRadius:"50%",flexShrink:0}}),(0,r.jsx)(d.Z,{fontSize:14,fontWeight:500,sx:{color:"#CCCCCC",textAlign:"left",lineHeight:1.14,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(null==e?void 0:e.label)||""})]}),(0,r.jsx)(s.Z,{sx:{width:16,height:16,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",flexShrink:0,ml:1,opacity:"auto"===e.key?0:1,pointerEvents:"auto"===e.key?"none":"auto"},onClick:t=>F(e.key,t),children:y===e.key?(0,r.jsx)(es.PhPauseFill,{size:10,style:{color:"white",cursor:"pointer"}}):(0,r.jsx)(es.PhPlayFill,{size:10,style:{color:"white",cursor:"pointer"}})})]},e.key))})})})]})};var rW=i(81833);let rL=e=>{let{value:t="auto",onChange:i}=e,{data:o=rW.iB}=(0,rM.K)({provider:"elevenlabs"}),a=(0,n.useMemo)(()=>o.filter(e=>{var t;return(null==e?void 0:null===(t=e.labels)||void 0===t?void 0:t.use_case)==="narration"}).sort((e,t)=>e.name.localeCompare(t.name)).map(e=>({key:e.voiceId,label:e.name,previewUrl:e.previewUrl,renderAvatar:()=>(0,r.jsx)(rE.r,{hash:e.voiceId,sx:{width:24,height:24,overflow:"hidden",border:"0.5px solid #2E2E2E",flexShrink:0}})})),[o]);return(0,r.jsx)(m,{icon:(0,r.jsx)(es.RiSpeakAiLine,{size:16}),title:"Choose a Narrator Voice",rightSide:(0,r.jsx)(rP,{value:t,onChange:i,options:a,autoPick:!0,sx:{backgroundColor:"transparent",p:0,height:"auto"},title:e=>{let{selectedVoice:t}=e;return(0,r.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:1,children:[(null==t?void 0:t.renderAvatar)?t.renderAvatar():(0,r.jsx)("img",{src:(null==t?void 0:t.thumbnail)||"https://cdn.openart.ai/assets/speech-voice/9.png",alt:(null==t?void 0:t.label)||"Voice",style:{width:24,height:24,overflow:"hidden",backgroundColor:"#555",border:"0.5px solid #2E2E2E",borderRadius:"50%"}}),(0,r.jsx)(d.Z,{fontSize:{xs:"14px",md:"16px"},fontWeight:500,children:(null==t?void 0:t.label)||"Auto"}),(0,r.jsx)(f.Z,{sx:{color:"#666",fontSize:16,backgroundColor:"#101010",borderRadius:"50%",width:24,height:24,padding:"4px"}})]})}})})},rB=()=>(0,r.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"ai-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,r.jsx)("stop",{offset:"0%",stopColor:"#072A6E"}),(0,r.jsx)("stop",{offset:"50%",stopColor:"#339597"}),(0,r.jsx)("stop",{offset:"100%",stopColor:"#5E6EFF"})]})}),(0,r.jsx)("path",{d:"M5.33382 13.9996C5.33382 13.9996 5.33382 13.9999 6.00049 13.9999V14.6666H5.33382V13.9996Z",fill:"url(#ai-gradient)"}),(0,r.jsx)("path",{d:"M12.8499 10.1576L9.56864 13.4386C8.91059 14.0966 7.97668 14.3876 7.29237 14.5245C6.93747 14.5956 6.6197 14.6308 6.39028 14.6485C6.27511 14.6574 6.18101 14.6619 6.11418 14.6642C6.08074 14.6653 6.05404 14.6659 6.03486 14.6663L6.01178 14.6666L6.00463 14.6666L6.00218 14.6666L6.00124 14.6666C6.00124 14.6666 6.00049 14.6666 6.00049 13.9999L5.33382 13.9996L5.33383 13.9983L5.33383 13.9958L5.33388 13.9887L5.33416 13.9656C5.33448 13.9464 5.33508 13.9197 5.33624 13.8862C5.33854 13.8194 5.34306 13.7252 5.35192 13.61C5.36957 13.3805 5.40481 13.0627 5.4758 12.7077C5.61265 12.0233 5.9035 11.0892 6.56136 10.4314L9.84257 7.15039L12.8499 10.1576Z",fill:"url(#ai-gradient)"}),(0,r.jsx)("path",{d:"M13.7928 9.21478L15.3315 7.67612L15.3338 7.40322C15.3361 7.12312 15.2393 6.77388 15.1136 6.4716C14.9825 6.15624 14.7787 5.79232 14.4934 5.50697C14.208 5.22163 13.8441 5.0179 13.5287 4.88676C13.2264 4.76107 12.8772 4.66431 12.5971 4.66665L12.3242 4.66893L10.7854 6.20761L13.7928 9.21478Z",fill:"url(#ai-gradient)"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.98697 3.98642L4.68426 1.89453H5.31672L6.01401 3.98642L8.1059 4.68371V5.31617L6.01401 6.01346L5.31672 8.10535H4.68426L3.98697 6.01346L1.89508 5.31617V4.68371L3.98697 3.98642Z",fill:"url(#ai-gradient)"})]}),rH=(0,ea.ZP)(Z.Z)(e=>{let{theme:t}=e;return{"& .MuiDialog-paper":{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"11px",padding:"20px",width:"444px",maxWidth:"444px",margin:0}}}),r$=(0,ea.ZP)(u.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column",gap:"16px",width:"100%"}}),rO=(0,ea.ZP)(u.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"row",gap:"8px"}}),rU=(0,ea.ZP)(s.Z)(e=>{let{theme:t}=e;return{width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center"}}),rG=(0,ea.ZP)(d.Z)(e=>{let{theme:t}=e;return{fontWeight:600,fontSize:"24px",lineHeight:"28px",color:"#FFFFFF"}}),rN=(0,ea.ZP)(d.Z)(e=>{let{theme:t}=e;return{fontWeight:500,fontSize:"16px",lineHeight:"28px",color:"#E0E0E0",textAlign:"left",width:"100%"}}),rV=(0,ea.ZP)(u.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"row",gap:"12px",width:"100%"}}),rK=(0,ea.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#1D1D1D",border:"1px solid #444444",borderRadius:"5px",padding:"10px 27px",height:"44px",color:"#FFFFFF",fontWeight:600,fontSize:"16px",lineHeight:"16.35px",textTransform:"none",textAlign:"center",flex:1,"&:hover":{backgroundColor:"#2A2A2A",border:"1px solid #555555"}}}),rq=(0,ea.ZP)(er.Z)(e=>{let{theme:t}=e;return{backgroundColor:"#2E2E2E",borderRadius:"5px",padding:"17px 8px",height:"44px",color:"#FFFFFF",fontWeight:600,fontSize:"16px",gap:"8px","&:hover":{backgroundColor:"#3E3E3E"},"& .MuiLoadingButton-loadingIndicator":{color:"#FFFFFF",position:"absolute"},"&.MuiLoadingButton-loading":{color:"transparent"}}});function rY(e){let{open:t,onClose:i,onProceedAnyway:n,onRewriteWithAI:o,isRewriting:a}=e;return(0,r.jsx)(rH,{open:t,onClose:i,children:(0,r.jsx)(A.Z,{sx:{padding:0},children:(0,r.jsxs)(r$,{children:[(0,r.jsxs)(rO,{children:[(0,r.jsx)(rU,{children:(0,r.jsx)("img",{src:eN,alt:"Warning",width:23,height:23})}),(0,r.jsx)(rG,{children:"Warning"})]}),(0,r.jsx)(rN,{children:"Looks like your voiceover script is very short — the generated video will be just about 5 seconds. Need help expanding it with AI?"}),(0,r.jsxs)(rV,{children:[(0,r.jsx)(rK,{onClick:n,children:"Proceed Anyway"}),(0,r.jsxs)(rq,{variant:"contained",onClick:o,loading:a,children:[(0,r.jsx)(rB,{}),(0,r.jsx)(d.Z,{fontSize:16,fontWeight:600,color:"#FFFFFF",children:"Rewrite with AI"})]})]})]})})})}let rX=eB.Ry({script_content:eB.Z_().min(1,"Please enter a script").refine(e=>e.replaceAll(" ","").replaceAll(/\n\s*\n/g,"\n").trim().length<=900,"Script is too long"),voiceover_voice:eB.Z_().default("auto"),background_music:eB.Z_().nullable().optional(),aspect_ratio:eB.Km(["16:9","9:16"]).default("16:9"),visual_style:eB.Z_().default("photorealistic"),auto_rewrite:eB.O7().default(!1),auto_captions:eB.O7().default(!0),imageModelConfig:eB.PG(),videoModelConfig:eB.PG(),character:eB.PG(()=>!0).nullable().optional()}),rJ={script_content:"",voiceover_voice:"auto",background_music:"auto",aspect_ratio:"16:9",visual_style:"photorealistic",auto_rewrite:!0,auto_captions:!0,imageModelConfig:eH.xS.value,videoModelConfig:eH.Zc.value,character:null};var rQ=i(14360);function r0(e){var t,i;let{onSubmit:a}=e,[l,p]=(0,n.useState)(!1),{form:h,isGenerating:m,canGenerate:g,isRewriting:f,scriptContent:v,scriptOverLimit:b,scriptLength:y,maxScriptLength:w,voiceStyle:C,backgroundMusic:j,imageModelConfig:k,videoModelConfig:F,imageModelOptions:S,videoModelOptions:I,character:_,aspectRatio:Z,visualStyle:A,autoCaptions:E,expandedPanels:M,togglePanel:T,onFormSubmit:D,handleModelSelect:z,handleScriptContentChange:P,handleAspectRatioSelect:W,handleVisualStyleSelect:L,handleVoiceoverVoiceChange:B,handleBackgroundMusicChange:H,handleCharacterSelect:$,handleRewriteScript:O,undoScriptContent:U,handleAutoCaptionsChange:G,canUndo:N,autoRewrite:V,handleAutoRewriteChange:K,handleSuggestionClick:q,onPreviewSubmit:Y,Node:X,MobilePreviewDialogComponent:J}=function(){var e,t,i,a,s,l;let{onSubmit:d}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=(0,o.useRouter)(),{isMobile:p,showMobilePreviewDialog:h,MobilePreviewDialogComponent:m}=eU(),{mutate:x,isLoading:g}=(0,e6.vi)(!1),[f,v]=e8(),[b,y]=(0,n.useState)(!1),[w,C]=(0,n.useState)(!1),[j,k]=(0,n.useState)(null),{data:F}=(0,e7.w)(j,!!j);(0,n.useEffect)(()=>{var e;(null==F?void 0:null===(e=F.story)||void 0===e?void 0:e.id)&&w&&(C(!1),k(null),u.push(`/story/editor?story_id=${F.story.id}&view=list`))},[F,w,u]);let[S,I]=(0,n.useState)([]),[_,Z]=(0,n.useState)(-1),[A,E]=(0,n.useState)({advancedSettings:!1,backgroundMusic:!1,characterSelection:!1}),[M,T]=(0,n.useState)(!1),D=eG.E.getState().consumePrefill("script_to_video"),z=null==D?void 0:D.character,P=(0,eL.cI)({mode:"onChange",defaultValues:{...rJ,...D&&{script_content:null==D.script_content?rJ.script_content:D.script_content,voiceover_voice:D.voiceover_voice??rJ.voiceover_voice,background_music:null==D.background_music?rJ.background_music:(0,eH.fz)(D),aspect_ratio:D.aspect_ratio??rJ.aspect_ratio,visual_style:D.visual_style??rJ.visual_style,auto_rewrite:D.auto_rewrite??rJ.auto_rewrite,auto_captions:D.auto_captions??rJ.auto_captions,imageModelConfig:(null===(e=D.advanced_settings)||void 0===e?void 0:e.image_model_config)?null===(t=(0,eH.O8)(null===(i=D.advanced_settings)||void 0===i?void 0:i.image_model_config,eH.Fj))||void 0===t?void 0:t.value:rJ.imageModelConfig,videoModelConfig:(null===(a=D.advanced_settings)||void 0===a?void 0:a.video_model_config)?null===(s=(0,eH.O8)(null===(l=D.advanced_settings)||void 0===l?void 0:l.video_model_config,eH.E5))||void 0===s?void 0:s.value:rJ.videoModelConfig,character:z?(0,eH.ow)(z):rJ.character}},resolver:(0,eW.F)(rX)}),{handleSubmit:W,setValue:L,reset:B,setError:H}=P,$=P.watch("script_content"),O=P.watch("voiceover_voice"),U=P.watch("background_music"),G=P.watch("aspect_ratio"),N=P.watch("visual_style"),V=P.watch("auto_rewrite"),K=P.watch("auto_captions"),q=P.watch("imageModelConfig"),Y=P.watch("videoModelConfig"),X=P.watch("character"),J=(0,n.useMemo)(()=>{let e=eH.Fj.filter(e=>"character"!==e.value.model);return(0,eH.FA)(e,q).map(e=>({name:e.name,icon:e.icon,value:e.value,disabled:(0,eH.Rx)(e.value)&&!X}))},[q,X]),Q=(0,n.useMemo)(()=>eH.E5.map(e=>({name:e.name,icon:e.icon,value:e.value})),[]),ee=(0,n.useCallback)((e,t)=>{E(i=>({...i,[e]:"boolean"==typeof t?t:!i[e]}))},[]),et=(0,n.useMemo)(()=>$.replaceAll(" ","").replaceAll(/\n\s*\n/g,"\n").trim().length,[$]),ei=rX.safeParse(P.getValues()).success,er=W(async e=>{if(et<100&&!e.auto_rewrite){y(!0);return}await ea(e,!1)}),en=W(async e=>{if(et<100&&!e.auto_rewrite){y(!0);return}C(!0),await ea(e,!0)}),eo=(0,tV.NL)(),ea=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{T(!0),c.IP.getState().updateFormData({oneSentenceStory:e.script_content,aspectRatio:e.aspect_ratio,selectedCharacter:e.character||void 0});let i=e.character?(0,eH.ZX)(e.character):null,r={script_content:e.script_content,voiceover_voice:e.voiceover_voice,voiceover_provider:"elevenlabs",background_music:e.background_music||"auto",aspect_ratio:e.aspect_ratio,visual_style:e.visual_style,auto_rewrite:e.auto_rewrite,auto_captions:e.auto_captions,advanced_settings:{image_model_config:e.imageModelConfig,video_model_config:e.videoModelConfig},...i&&{character:i},...t&&{is_preview:!0}};x(r,{onSuccess:e=>{e.workflowRunId?t?p?h():k(e.workflowRunId):u.push(`/story/create/workflow/${e.workflowRunId}?category_id=script_to_video`):null==d||d(),eo.invalidateQueries({queryKey:[tY.O]})},onError:e=>{t&&C(!1),H("root",{message:e instanceof Error?e.message:"Failed to generate character vlog"})}})}catch(e){console.error("Form submission error:",e)}finally{T(!1)}},es=(0,n.useCallback)((e,t)=>{if("imageModel"===e){let e=eH.Fj.find(e=>e.name===t);e&&L("imageModelConfig",e.value)}else if("videoModel"===e){let e=eH.E5.find(e=>e.name===t);e&&L("videoModelConfig",e.value)}},[L]),el=(0,n.useCallback)(async e=>{try{let t=P.getValues("script_content"),{enhancedScript:i}=await f({story:e});L("script_content",i),I(e=>{let r=[...e];return t.trim()&&(0===r.length||r.at(-1)!==t)&&r.push(t),i&&i!==r.at(-1)&&r.push(i),r}),Z(e=>S.length+(t.trim()&&S.at(-1)!==t?1:0))}catch(e){console.error("Error rewriting script:",e)}},[f,L,P,S]),ed=(0,n.useCallback)(()=>{if(_>0){let e=_-1;L("script_content",S[e]),Z(e)}},[_,S,L]),ec=(0,n.useCallback)(e=>{L("script_content",e)},[L]),eu=(0,n.useCallback)(e=>{L("background_music",e)},[L]),ep=(0,n.useCallback)(e=>{L("aspect_ratio",e)},[L]),eh=(0,n.useCallback)(e=>{L("visual_style",e);let t=R.TJ.find(t=>t.value===e);t&&"imageModelConfig"in t&&t.imageModelConfig&&L("imageModelConfig",t.imageModelConfig)},[L]),em=(0,n.useCallback)(e=>{L("voiceover_voice",e)},[L]),ex=(0,n.useCallback)(e=>{L("auto_rewrite",e)},[L]),eg=(0,n.useCallback)(e=>{L("auto_captions",e)},[L]),ef=(0,n.useCallback)(e=>{L("character",e)},[L]),ev=(0,n.useCallback)(()=>{B(rJ),E({advancedSettings:!1,backgroundMusic:!1,characterSelection:!1})},[B]),eb=(0,n.useCallback)(e=>{L("script_content",e.fullScript),L("visual_style",e.style),L("auto_rewrite",!0)},[L]),ey=(0,r.jsx)(rY,{open:b,isRewriting:v,onProceedAnyway:()=>{y(!1),P.handleSubmit(e=>ea(e,!1))()},onRewriteWithAI:async()=>{await el(P.getValues("script_content")),y(!1)},onClose:()=>y(!1)});return{form:P,isGenerating:g||w,isRewriting:v,scriptContent:$,scriptOverLimit:et>900,scriptLength:et,maxScriptLength:900,voiceStyle:O,backgroundMusic:U,aspectRatio:G,autoCaptions:K,visualStyle:N,autoRewrite:V,imageModelConfig:q,videoModelConfig:Y,character:X,imageModelOptions:J,videoModelOptions:Q,isSubmitting:M,onFormSubmit:er,onPreviewSubmit:en,resetForm:ev,expandedPanels:A,togglePanel:ee,handleModelSelect:es,handleBackgroundMusicChange:eu,handleAspectRatioSelect:ep,handleVisualStyleSelect:eh,handleVoiceoverVoiceChange:em,handleScriptContentChange:ec,handleRewriteScript:el,handleAutoRewriteChange:ex,handleSuggestionClick:eb,handleAutoCaptionsChange:eg,handleCharacterSelect:ef,undoScriptContent:ed,canUndo:_>0,canGenerate:ei,Node:ey,MobilePreviewDialogComponent:m}}({onSubmit:a}),Q=(0,tn.B)(),ee=Object.entries(h.formState.errors).reduce((e,t)=>{let[i,r]=t;return(null==r?void 0:r.message)&&(e[i]={message:r.message}),e},{}),ei=()=>{p(!0)},er=async e=>{await O(e),p(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{component:"form",onSubmit:e=>{e.preventDefault(),Q({onAuthenticated:()=>D(e)})},sx:{width:"100%",maxWidth:1100,mx:"auto",mt:{xs:0,md:8},px:{xs:0,sm:2,md:0},py:{xs:0,md:0}},children:(0,r.jsxs)(u.Z,{direction:{xs:"column",md:"row"},spacing:{xs:3,lg:0},sx:{width:"100%",alignItems:{xs:"stretch",md:"flex-start"}},children:[(0,r.jsxs)(u.Z,{sx:{width:{xs:"100%",md:"50%"},pr:{xs:0,md:2}},spacing:{xs:2,sm:2.5},children:[(0,r.jsxs)(u.Z,{direction:{xs:"column",sm:"row"},spacing:{xs:2,sm:0},sx:{justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"}},children:[(0,r.jsx)(d.Z,{fontSize:{xs:18,sm:16},fontWeight:600,color:"#CCC",sx:{mb:{xs:0,sm:0},display:{xs:"none",sm:"block"}},children:"Voice-over Script"}),(0,r.jsx)(s.Z,{sx:{flexShrink:0},children:(0,r.jsx)(rh,{onClick:()=>{Q({onAuthenticated:()=>ei()})},sx:{width:{xs:"100%",sm:"auto"},minWidth:{xs:"100%",sm:"auto"},py:{xs:1.5,sm:1},fontSize:{xs:14,sm:13}},children:(0,r.jsxs)(u.Z,{direction:"row",alignItems:"center",gap:1,justifyContent:"center",children:[(0,r.jsx)(es.CustomRewrite,{}),(0,r.jsx)(d.Z,{fontSize:{xs:14,sm:13},fontWeight:500,lineHeight:18.2,color:"#FFFFFF",children:"Create Script with AI"})]})})})]}),(0,r.jsx)(rf,{value:v,scriptOverLimit:b,scriptLength:y,maxScriptLength:w,onChange:e=>P(e.target.value),error:!!h.formState.errors.script_content,helperText:null===(t=h.formState.errors.script_content)||void 0===t?void 0:t.message,onClickUndo:U,canUndo:N,isRewriting:f,autoRewrite:V,setAutoRewrite:K,handleSuggestionClick:q})]}),(0,r.jsxs)(s.Z,{sx:{width:{xs:"100%",md:"50%"},pl:{xs:0,md:2},display:"flex",flexDirection:"column",minHeight:0,maxHeight:{xs:"none",md:"calc(100vh - 200px)"}},children:[(0,r.jsxs)(u.Z,{spacing:{xs:3,sm:2.5},sx:{flex:1,minHeight:0,overflowY:{xs:"visible",md:"auto"},pr:{md:1},pb:{xs:2,md:4},"& > *":{flexShrink:0},scrollbarGutter:{md:"stable"},...(0,rQ.ap)({scrollbarWidth:4})},children:[(0,r.jsx)(rA,{value:A,onChange:e=>L(e)}),(0,r.jsx)(rt,{expanded:M.characterSelection,onToggle:e=>T("characterSelection",e),character:_,error:null===(i=h.formState.errors.character)||void 0===i?void 0:i.message,onFirstCharacterSelect:$}),(0,r.jsx)(rL,{value:C,onChange:e=>B(e)}),(0,r.jsx)(x,{iconSize:16,value:Z,onChange:e=>W(e)}),(0,r.jsx)(rv,{iconSize:16,autoCaptions:E,handleAutoCaptionsChange:G,backgroundMusic:j,handleBackgroundMusicChange:H,expandedPanels:M,togglePanel:T,imageModelConfig:k,videoModelConfig:F,imageModelOptions:S,videoModelOptions:I,onModelSelect:z,expanded:M.advancedSettings,onChange:(e,t)=>{t!==M.advancedSettings&&T("advancedSettings",t)}})]}),(0,r.jsx)(s.Z,{sx:e=>({backgroundColor:{xs:"transparent",md:"var(--Gray-100)"},[e.breakpoints.up("md")]:{position:"sticky",bottom:0,left:0,right:0,pr:e.spacing(4)}}),children:(0,r.jsx)(et.i,{storyType:"script",isGenerating:m,disabled:!g,errors:ee,showCreditInfo:!0,onCreateStory:()=>{Q({onAuthenticated:()=>D()})},onCreatePreview:()=>{Q({onAuthenticated:()=>Y()})}})})]})]})}),(0,r.jsx)(rp,{open:l,onClose:()=>{p(!1)},onGenerate:er,isGenerating:f}),X,(0,r.jsx)(J,{})]})}var r1=i(92295);function r2(e){let{mode:t,videoType:i}=e,n=(0,o.useRouter)(),u=(0,r1.Z)(),{isMobile:p}=(0,h.j)(),m=c.YS.use.updateGenerationStatus(),x=()=>{m("script",{loading:!0})},g=()=>{n.push("/story"),localStorage.removeItem("script_creation_form_data"),localStorage.removeItem("vlog_creation_form_data"),localStorage.removeItem("music_video_creation_form_data")};return(0,r.jsxs)(s.Z,{sx:{position:"relative",px:{xs:2,sm:5},backgroundColor:p?"#262626":"transparent"},children:[(0,r.jsx)(s.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"30vh",backgroundImage:`url('${(()=>{switch(t){case"vlog":default:return"https://cdn.openart.ai/assets/Character_vlog_banner.png";case"script":return"https://cdn.openart.ai/assets/Explainer_video_banner.png";case"mv":switch(i){case"singing-dancing":return"https://cdn.openart.ai/assets/internal/uploads/image_ezUUlBzb_1920x774_1759668304411.webp";case"lyrics-video":return"https://cdn.openart.ai/assets/internal/uploads/image_hlkE24EV_1920x774_1759668159635.webp";case"consistent-character":return"https://cdn.openart.ai/assets/internal/uploads/image_FhvGFdgH_1920x774_1759668176267.webp";case"consistent-style":return"https://cdn.openart.ai/assets/internal/uploads/image_uM-IOur4_1920x774_1759668324600.webp"}return"https://cdn.openart.ai/assets/Music_vlog_banner.png";case"asmr":return"https://cdn.openart.ai/assets/internal/uploads/image_ynpFU3UO_1920x503_1757842307853.webp"}})()}')`,filter:`brightness(${"vlog"===t?2:1.5})`,mask:"linear-gradient(to bottom, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.8) 30%, rgba(255, 255, 255, 0.3) 70%, rgba(255, 255, 255, 0) 100%)",WebkitMask:"linear-gradient(to bottom, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.8) 30%, rgba(255, 255, 255, 0.3) 70%, rgba(255, 255, 255, 0) 100%)",backgroundSize:"cover",backgroundPosition:"top",backgroundRepeat:"no-repeat"}}),(0,r.jsxs)(s.Z,{sx:{height:{xs:"unset",md:`calc(${u.height} - ${tp.gF}px)`},overflow:"auto",pb:1,position:"relative","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"4px"}},children:[(0,r.jsxs)(s.Z,{sx:{mt:2,mb:{xs:3,sm:4}},children:[(0,r.jsx)(s.Z,{sx:{display:{xs:"block",sm:"none"}},children:(0,r.jsxs)(s.Z,{sx:{position:"relative",mb:{xs:1,md:2}},children:[(0,r.jsx)(l.Z,{onClick:g,sx:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",minWidth:40,width:40,height:40,borderRadius:"50%",p:0,color:"text.primary","&:hover":{backgroundColor:"action.hover"}},children:(0,r.jsx)(a.Z,{sx:{fontSize:24}})}),(0,r.jsx)(d.Z,{variant:"h5",component:"h1",sx:{fontSize:24,fontWeight:700,color:"text.primary",lineHeight:1.2,textAlign:"center",px:6},children:(e=>{switch(e){case"vlog":return"Character Vlog";case"script":return"Explainer Video";case"mv":return"Music Video";case"asmr":return"ASMR Video";default:return"Create Story"}})(t)})]})}),(0,r.jsx)(s.Z,{sx:{display:{xs:"none",sm:"flex"},alignItems:"center"},children:(0,r.jsx)(l.Z,{startIcon:(0,r.jsx)(a.Z,{}),sx:{mr:2},onClick:g,children:"Back"})})]}),(()=>{switch(t){case"vlog":default:return(0,r.jsx)(tQ,{onSubmit:x});case"script":return(0,r.jsx)(r0,{onSubmit:x});case"mv":return(0,r.jsx)(i7,{onSubmit:x,videoType:i});case"lyrics":return(0,r.jsx)(ig,{onSubmit:x});case"asmr":return(0,r.jsx)(to,{onSubmit:x})}})()]})]})}},8207:function(e,t,i){i.d(t,{l:function(){return F}});var r=i(52676),n=i(75271),o=i(74608),a=i.n(o),s=i(28136),l=i(80110),d=i(56407),c=i(22988),u=i(77379),p=i(27574),h=i(29984),m=i(76651),x=i(36772),g=i(87750),f=i(90610),v=i(97708),b=i(28403),y=i(88764),w=i(77913),C=i(94959),j=i(97779),k=i(30872);function F(e){let{initShareStory:t}=e,{stories:i=[],isLoading:o,fetchNextPage:F,hasNextPage:S}=(0,y.lk)(),[I,_]=(0,n.useState)("all"),{stories:Z,recommId:A,isFetching:E,fetchNextPage:M,hasNextPage:T,isFetchingNextPage:R}=(0,y.uO)({category_id:"all"===I?void 0:I}),{isMobile:D}=(0,j.j)(),{isTeamPlan:z}=(0,k.V)(),P=(0,n.useMemo)(()=>[{name:"All",value:"all"},...w.Uf],[]),W=e=>(0,r.jsx)(l.Z,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:600,fontSize:{xs:"28px",md:"32px"},color:"#fff",mb:{sm:0,md:2},fontFamily:"Poppins",letterSpacing:"-0.04em"},children:e});return(0,r.jsxs)(d.Z,{sx:{width:"100%"},children:[(0,r.jsxs)(c.Z,{sx:{mt:{sm:0,md:1},p:{xs:"12px 0 16px",md:"12px 0 16px"},mb:{sm:0,md:4}},children:[W("Create Your Way"),(0,r.jsx)(v.B,{cards:b.l4,useCompactLayout:D}),(0,r.jsx)(c.Z,{sx:{mt:{sm:0,md:3}},children:(0,r.jsx)(x.Y,{})})]}),i.length>0&&(0,r.jsxs)(c.Z,{sx:{mb:{sm:0,md:2}},children:[(0,r.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[W(z?"Shared Team Story":"My Story"),(0,r.jsxs)(u.Z,{component:a(),href:"/story/my",sx:{color:"#6290FF"},children:["View all",(0,r.jsx)(s.Z,{sx:{fontSize:"16px"}})]})]}),z?(0,r.jsx)(p.Z,{severity:"info",sx:{mb:2},children:"Stories created by your team are here! Only solo editing for now—collab mode is on the way!"}):null,o?(0,r.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4},children:(0,r.jsx)(h.Z,{size:32,sx:{color:"#013FFE"}})}):(0,r.jsx)(f.n,{stories:i,maxItems:4,fetchNextPage:F,hasNextPage:S})]}),(0,r.jsxs)(c.Z,{sx:{mb:4},children:[(0,r.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[W("Community Stories"),(0,r.jsxs)(u.Z,{component:a(),href:"/story/community",sx:{color:"#6290FF"},children:["View all",(0,r.jsx)(s.Z,{sx:{fontSize:"16px"}})]})]}),(0,r.jsx)(d.Z,{direction:"row",spacing:1,sx:{mb:2,gap:1,flexWrap:{xs:"nowrap",sm:"wrap"},overflowX:{xs:"auto",sm:"visible"},"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:P.map(e=>(0,r.jsx)(m.Z,{label:e.name,clickable:!0,onClick:()=>_(e.value),color:I===e.value?"primary":"default",variant:I===e.value?"filled":"outlined",sx:{height:28,borderRadius:"18px",fontWeight:600,color:I===e.value?"#111111":"#E0E0E0",borderColor:"rgba(255,255,255,0.2)",flexShrink:{xs:0,sm:"unset"}}},e.value))}),(0,r.jsx)(C.n.Provider,{value:A,children:(0,r.jsx)(g.V,{initCommunityStory:t,stories:Z,isLoading:E,emptyText:"✨ No published stories available yet. Check back soon for inspiring community stories!",fetchNextPage:M,hasNextPage:T,showVideoOutdatedHint:!1,isFetchingNextPage:R})})]})]})}},51760:function(e,t,i){i.d(t,{$:function(){return l}});var r=i(52676),n=i(75271),o=i(22988),a=i(80110),s=i(39204);function l(e){let{status:t,mobile:i,sx:l,mobileSx:d,showActiveAnimation:c=!0}=e,[u,p]=(0,n.useState)(0);return((0,n.useEffect)(()=>{t&&p((e=>{if("string"==typeof e&&e.includes("failed"))return -1;switch(e){case"pending":case"processing:creating_story":case"processing:generating_storyboard":default:return 0;case"processing:generating_images":case"paused":return 1;case"processing:generating_videos":case"processing:generating_timeline":case"processing:exporting_video":case"processing:user_exporting_video":case"completed":return 2}})(t))},[t]),i)?(0,r.jsx)(o.Z,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",...d},children:[{label:"Creating Story",icon:"\uD83D\uDCDD"},{label:"Generating Images",icon:"\uD83C\uDFA8"},{label:"Creating Videos",icon:"\uD83C\uDFAC"}].map((e,t)=>{let i=t===u&&-1!==u,n=t<u&&-1!==u;return(0,r.jsxs)(o.Z,{sx:{width:"100%",display:"flex",alignItems:"center",gap:"16px"},children:[(0,r.jsx)(o.Z,{sx:{width:"48px",height:"48px",borderRadius:"50%",backgroundColor:i?"#FFFFFF":n?"rgba(255, 255, 255, 0.6)":"rgba(255, 255, 255, 0.1)",border:i?"2px solid rgba(255, 255, 255, 0.8)":"2px solid rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",position:"relative",zIndex:2,color:i?"#000000":n?"#000000":"#FFFFFF"},children:n?"✓":e.icon}),(0,r.jsxs)(o.Z,{sx:{flex:1},children:[(0,r.jsx)(a.Z,{sx:{color:i?"#FFFFFF":n?"rgba(255, 255, 255, 0.8)":"#888888",fontSize:"16px",fontWeight:i?600:400,lineHeight:"1.4"},children:e.label}),i?(0,r.jsx)(a.Z,{sx:{color:"#888888",fontSize:"14px",mt:"4px",lineHeight:"1.3"},children:"In progress..."}):null]}),i&&c?(0,r.jsx)(o.Z,{sx:{display:"flex",gap:"4px"},children:[0,1,2].map(e=>(0,r.jsx)(s.E.div,{initial:{opacity:.3},animate:{opacity:1},transition:{duration:.6,repeat:1/0,repeatType:"reverse",delay:.2*e},style:{width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#FFFFFF"}},`dot-${e}`))}):null]},e.label)})}):(0,r.jsx)(o.Z,{sx:{position:"relative",display:"flex",alignItems:"center",gap:"8.5px",zIndex:2,...l},children:[{label:"Creating Story Script",width:"190px"},{label:"Creating Images",width:"149px"},{label:"Creating Videos",width:"149px"}].map((e,t)=>{let i=t===u&&-1!==u,n=t<u&&-1!==u;return(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:"8.5px"},children:[(0,r.jsx)(s.E.div,{initial:{scale:.95,opacity:.8},animate:{scale:i?1.02:.95,opacity:i?1:.3},transition:{duration:.3},children:(0,r.jsx)(o.Z,{sx:{width:e.width,height:"39.5px",borderRadius:"8.5px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"},children:(0,r.jsx)(a.Z,{color:i||n?"#FFFFFF":"#D9D9D9",sx:{fontWeight:700,fontSize:"17px",lineHeight:"1.21em",textAlign:"center",...i&&c&&{background:"linear-gradient(90deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,1) 50%, rgba(255,255,255,0.4) 100%)",backgroundSize:"200% 100%",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent",animation:"skeleton-wave 1.6s ease-in-out 0.5s infinite","@keyframes skeleton-wave":{"0%":{backgroundPosition:"200% 0"},"100%":{backgroundPosition:"-200% 0"}}}},children:e.label})})}),t<2?(0,r.jsx)(s.E.div,{initial:{scale:1},animate:{scale:i?1.05:1},transition:{duration:.3},children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"66",height:"14",viewBox:"0 0 66 14",fill:"none",style:{transition:"all 0.3s ease"},children:["M61.9526 0.339844H57.4707L61.3124 6.7426L57.4707 13.1454H61.9526L65.154 6.7426L61.9526 0.339844Z","M51.0679 0.339844H46.5859L50.4276 6.7426L46.5859 13.1454H51.0679L54.2692 6.7426L51.0679 0.339844Z","M39.5435 0.339844H35.0615L38.9032 6.7426L35.0615 13.1454H39.5435L42.7448 6.7426L39.5435 0.339844Z","M26.7368 0.339844H22.2549L26.0965 6.7426L22.2549 13.1454H26.7368L29.9382 6.7426L26.7368 0.339844Z","M16.4917 0.339844H12.0098L15.8514 6.7426L12.0098 13.1454H16.4917L19.6931 6.7426L16.4917 0.339844Z","M4.96728 0.339844H0.485352L4.327 6.7426L0.485352 13.1454H4.96728L8.16866 6.7426L4.96728 0.339844Z"].map((e,t)=>(0,r.jsx)("path",{d:e,fill:n?"rgba(255, 255, 255, 0.6)":"#D9D9D9",fillOpacity:.29,style:{transition:"fill 0.1s ease"}},e))})}):null]},e.label)})})}},12120:function(e,t,i){i.d(t,{X:function(){return l}});var r=i(52676),n=i(75271),o=i(45029),a=i(19005),s=i(16585);let l=e=>{let{story:t,origin:i,children:l}=e,{data:d}=(0,a.$_)(),[c,u]=(0,n.useState)(new Set),[p,h]=(0,n.useState)(null),[m,x]=(0,n.useState)(0),[g,f]=(0,n.useState)(null),v=(0,o.I)(),b=(0,n.useRef)(null),y=(0,n.useRef)(""),w=(0,n.useCallback)((e,r)=>{t&&(0,s.B)("story_video_play",{play_event:e,story_id:t.id,story_type:t.category_id,viewer_id:(null==d?void 0:d.id)||"",origin:i,...r})},[t,null==d?void 0:d.id,i]);(0,n.useEffect)(()=>{let e=(null==t?void 0:t.id)||"";if(!e)return;let{sessionId:i,credential:r}=v.createCredentialAndSession({itemId:e});b.current=r,y.current=i},[null==d?void 0:d.id,null==t?void 0:t.id,v]);let C=(0,n.useCallback)(()=>{let e=b.current;e&&y.current&&v.updatePlayWithCredential({credential:e,sessionId:y.current,portion:1}).catch(()=>{}).finally(()=>{v.endPlayWithCredential(e),b.current=null,y.current=null})},[v]),j=(0,n.useCallback)(e=>{let t=e.currentTarget,i=t.currentTime,r=t.duration;h(Date.now()),f(i),w("start",{current_time:i,duration:r})},[w]),k=(0,n.useCallback)(e=>{let t=e.currentTarget,i=t.currentTime,r=t.duration,n=0;p&&(n=Date.now()-p,x(e=>e+n),h(null)),w("pause",{current_time:i,duration:r,watch_time:n})},[w,p]),F=(0,n.useCallback)(e=>{let t=e.currentTarget.duration,i=0;p&&(i=Date.now()-p,x(e=>e+i),h(null)),w("complete",{current_time:t,duration:t,watch_time:i,total_watch_time:m+i}),C()},[w,p,m,C]),S=(0,n.useCallback)(e=>{let t=e.currentTarget,i=t.currentTime/t.duration*100;[25,50,75].forEach(e=>{i>=e&&!c.has(e)&&(u(t=>new Set(t).add(e)),w(`progress_${e}`,{current_time:t.currentTime,duration:t.duration,progress:e}))}),b.current&&y.current&&t.duration>0&&1==Math.round(100*Math.max(0,Math.min(1,t.currentTime/t.duration)))/100&&C()},[c,w,C]),I=(0,n.useCallback)(e=>{let t=e.currentTarget,i=t.currentTime;w("seeking",{current_time:i,duration:t.duration,seek_from:g,seek_to:i}),f(i)},[w,g]),_=(0,n.useCallback)(e=>{let t=e.currentTarget,i=t.error;w("error",{error_code:null==i?void 0:i.code,error_message:null==i?void 0:i.message,current_time:t.currentTime,duration:t.duration})},[w]),Z=(0,n.useCallback)(e=>{let t=e.currentTarget;w("load_start",{video_url:t.src,duration:t.duration})},[w]);return(0,r.jsx)(r.Fragment,{children:l({onPlay:j,onPause:k,onEnded:F,onTimeUpdate:S,onSeeking:I,onError:_,onLoadStart:Z})})}},49099:function(e,t,i){i.d(t,{n:function(){return w}});var r=i(52676),n=i(75271),o=i(90145),a=i(13724),s=i(91415),l=i(80148),d=i(80110),c=i(14930),u=i(97792),p=i(11955),h=i(6721),m=i(72660),x=i(22988),g=i(19509),f=i(57672),v=i(2895),b=i(52423);let y=e=>{let{character:t,isSelected:i,onClick:n,characterRef:o}=e;return(0,r.jsx)("div",{ref:o,children:(0,r.jsxs)(a.Z,{onClick:()=>n(t),sx:{cursor:"pointer",bgcolor:"#1A1A1A",border:i?"2px solid #0929F7":"1px solid #2E2E2E",borderRadius:"13px",overflow:"hidden",transition:"all 0.2s ease-in-out","@media (hover: hover)":{"&:hover":{transform:"scale(1.02)",borderColor:i?"#0929F7":"#444444"}}},children:[(0,r.jsx)(s.Z,{component:"img",image:t.image_url,alt:t.model_name,sx:{height:"200px",objectFit:"cover",bgcolor:"#2E2E2E"}}),(0,r.jsx)(l.Z,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#FFFFFF",fontWeight:500,fontSize:14,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.model_name})})]})})};function w(e){let{open:t,onClose:i,onCharacterSelect:a,selectedCharacter:s,characterType:l="default"}=e,w=(0,f.Z)(),C=(0,c.Z)(w.breakpoints.down("md")),j=(0,n.useRef)({}),{data:k}=(0,b.Lg)(l),F=n.useMemo(()=>[...v.fg.filter(e=>!e.visibleIn||e.visibleIn.includes(l)),...k||[]],[k,l]);(0,n.useEffect)(()=>{if(t&&s&&F){let e=setTimeout(()=>{let e=j.current[s.id];e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100);return()=>clearTimeout(e)}},[t,s,F]);let S=e=>{a(e),i()};return(0,r.jsxs)(u.Z,{open:t,onClose:i,fullScreen:C,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{bgcolor:"#101010",border:"1px solid #2E2E2E",borderRadius:C?0:"16px",maxHeight:"90vh"}},children:[(0,r.jsxs)(p.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",color:"#FFFFFF",fontWeight:600,fontSize:20,p:3,pb:1},children:["All Characters",(0,r.jsx)(h.Z,{onClick:i,sx:{color:"#AAAAAA","@media (hover: hover)":{"&:hover":{color:"#FFFFFF",bgcolor:"#2E2E2E"}}},children:(0,r.jsx)(o.Z,{})})]}),(0,r.jsx)(m.Z,{sx:{p:3,pt:1},children:(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(d.Z,{variant:"h6",sx:{color:"#CCCCCC",fontWeight:600,mb:2,fontSize:16},children:"By OpenArt"}),(0,r.jsx)(g.ZP,{container:!0,spacing:2,children:F.map(e=>(0,r.jsx)(g.ZP,{item:!0,xs:6,sm:4,md:3,lg:2.4,children:(0,r.jsx)(y,{character:e,isSelected:(null==s?void 0:s.id)===e.id,onClick:S,characterRef:t=>{j.current[e.id]=t}})},e.id))})]})})]})}},86775:function(e,t,i){i.d(t,{b:function(){return n}});var r=i(52676);function n(e){let{width:t=188,height:i=188,className:n}=e;return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:i,viewBox:"0 0 188 188",fill:"none",className:n,children:[(0,r.jsx)("g",{filter:"url(#filter0_n_131_3390)",children:(0,r.jsx)("path",{d:"M24.2466 72.3885C24.2466 69.8656 26.2918 67.8203 28.8148 67.8203H153.914C156.437 67.8203 158.482 69.8656 158.482 72.3885V147.589C158.482 152.246 154.706 156.022 150.048 156.022H32.6802C28.0225 156.022 24.2466 152.246 24.2466 147.589V72.3885Z",fill:"#1C455C"})}),(0,r.jsx)("mask",{id:"mask0_131_3390",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"21",y:"18",width:"135",height:"45",children:(0,r.jsx)("rect",{width:"134.938",height:"17.7766",rx:"4.56822",transform:"matrix(0.977859 -0.209264 -0.209264 -0.977859 23.9863 63.7305)",fill:"#D9D9D9"})}),(0,r.jsxs)("g",{mask:"url(#mask0_131_3390)",children:[(0,r.jsx)("rect",{width:"16.3599",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 -8.86987 58.5977)",fill:"#D9D9D9"}),(0,r.jsx)("rect",{width:"16.6745",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 6.63013 63.832)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"16.3599",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 22.427 69.168)",fill:"#0E4B6E"}),(0,r.jsx)("rect",{width:"16.6745",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 37.9272 74.4023)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"16.6745",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 69.2246 84.9727)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"16.6745",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 100.585 95.5645)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"16.3599",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 53.7251 79.7383)",fill:"#0E4B6E"}),(0,r.jsx)("rect",{width:"16.3599",height:"110.213",transform:"matrix(0.947423 0.319984 0.579713 -0.814821 85.0942 90.334)",fill:"#0E4B6E"})]}),(0,r.jsx)("mask",{id:"mask1_131_3390",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"24",y:"67",width:"135",height:"16",children:(0,r.jsx)("rect",{x:"24.2466",y:"67.8203",width:"134.236",height:"14.8947",rx:"4.56822",fill:"#D9D9D9"})}),(0,r.jsxs)("g",{mask:"url(#mask1_131_3390)",children:[(0,r.jsx)("rect",{width:"15.6447",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 -6.64697 77.7852)",fill:"#D9D9D9"}),(0,r.jsx)("rect",{width:"15.9455",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 7.34131 70.7793)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"15.6447",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 21.5974 63.6367)",fill:"#0E4B6E"}),(0,r.jsx)("rect",{width:"15.9455",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 35.5857 56.6309)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"15.9455",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 63.8301 42.4824)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"15.9455",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 92.1318 28.3047)",fill:"#479ED0"}),(0,r.jsx)("rect",{width:"15.6447",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 49.8423 49.4883)",fill:"#0E4B6E"}),(0,r.jsx)("rect",{width:"15.6447",height:"102.113",transform:"matrix(0.894096 -0.447875 0.791739 0.61086 78.1514 35.3066)",fill:"#0E4B6E"})]}),(0,r.jsx)("circle",{cx:"96.284",cy:"118.071",r:"19.6785",fill:"white",fillOpacity:"0.12"}),(0,r.jsx)("path",{d:"M103.359 116.801C104.057 117.363 104.057 118.427 103.359 118.989L94.3544 126.246C93.4349 126.987 92.0668 126.333 92.0668 125.152L92.0668 110.638C92.0668 109.457 93.4349 108.803 94.3544 109.544L103.359 116.801Z",fill:"#479ED0"}),(0,r.jsx)("circle",{cx:"26.3549",cy:"63.9543",r:"5.97383",fill:"#0E4B6E"}),(0,r.jsx)("circle",{cx:"26.3548",cy:"63.9537",r:"2.98692",fill:"#479ED0"}),(0,r.jsx)("defs",{children:(0,r.jsxs)("filter",{id:"filter0_n_131_3390",x:"24.2466",y:"67.8203",width:"134.235",height:"88.2012",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,r.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,r.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,r.jsx)("feTurbulence",{type:"fractalNoise",baseFrequency:"10 10",stitchTiles:"stitch",numOctaves:"3",result:"noise",seed:"2931"}),(0,r.jsx)("feColorMatrix",{in:"noise",type:"luminanceToAlpha",result:"alphaNoise"}),(0,r.jsx)("feComponentTransfer",{in:"alphaNoise",result:"coloredNoise1",children:(0,r.jsx)("feFuncA",{type:"discrete",tableValues:"1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 "})}),(0,r.jsx)("feComposite",{operator:"in",in2:"shape",in:"coloredNoise1",result:"noise1Clipped"}),(0,r.jsx)("feFlood",{floodColor:"rgba(0, 0, 0, 0.25)",result:"color1Flood"}),(0,r.jsx)("feComposite",{operator:"in",in2:"noise1Clipped",in:"color1Flood",result:"color1"}),(0,r.jsxs)("feMerge",{result:"effect1_noise_131_3390",children:[(0,r.jsx)("feMergeNode",{in:"shape"}),(0,r.jsx)("feMergeNode",{in:"color1"})]})]})})]})}i(75271)},84643:function(e,t,i){i.d(t,{Eq:function(){return s},SZ:function(){return l},TI:function(){return c},js:function(){return a},jw:function(){return d}});var r=i(52676);i(75271);var n=i(34061),o=i(44567);let a=e=>{let{width:t=13,height:i=15,fill:n="#888888",className:o}=e;return(0,r.jsx)("svg",{width:t,height:i,viewBox:"0 0 13 15",fill:n,xmlns:"http://www.w3.org/2000/svg",className:o,children:(0,r.jsx)("path",{d:"M8.49892 1.99974C8.49892 1.60423 8.38164 1.2176 8.16191 0.888744C7.94217 0.559889 7.62986 0.303577 7.26445 0.152222C6.89905 0.000866449 6.49697 -0.038735 6.10906 0.0384253C5.72115 0.115586 5.36483 0.306042 5.08516 0.585711C4.80549 0.865379 4.61503 1.2217 4.53787 1.60961C4.46071 1.99752 4.50031 2.3996 4.65167 2.76501C4.80302 3.13041 5.05934 3.44273 5.38819 3.66246C5.71705 3.88219 6.10368 3.99948 6.49919 3.99948C7.02955 3.99948 7.53819 3.78879 7.91321 3.41377C8.28824 3.03874 8.49892 2.5301 8.49892 1.99974ZM6.49919 2.99961C6.30143 2.99961 6.10812 2.94097 5.94369 2.8311C5.77926 2.72123 5.65111 2.56507 5.57543 2.38237C5.49975 2.19967 5.47995 1.99863 5.51853 1.80467C5.55711 1.61072 5.65234 1.43256 5.79217 1.29272C5.93201 1.15289 6.11017 1.05766 6.30412 1.01908C6.49808 0.980502 6.69912 1.0003 6.88182 1.07598C7.06452 1.15166 7.22068 1.27981 7.33055 1.44424C7.44041 1.60867 7.49906 1.80198 7.49906 1.99974C7.49906 2.26492 7.39371 2.51924 7.2062 2.70675C7.01869 2.89426 6.76437 2.99961 6.49919 2.99961ZM12.9671 4.98122C12.9102 4.70124 12.7573 4.44991 12.5348 4.27067C12.3123 4.09142 12.0342 3.9955 11.7485 3.99948H1.24987C0.964964 3.99947 0.6886 4.0968 0.466578 4.27535C0.244556 4.45391 0.0902009 4.70295 0.0290901 4.98123C-0.0320207 5.25952 0.00378064 5.55032 0.130562 5.80547C0.257343 6.06062 0.467494 6.26479 0.726194 6.38416H0.734318L3.90578 7.78086L2.59345 12.7627C2.45613 13.0652 2.4446 13.4098 2.56139 13.7208C2.67817 14.0318 2.91371 14.2836 3.21618 14.4209C3.51865 14.5582 3.86328 14.5698 4.17426 14.453C4.48524 14.3362 4.73709 14.1007 4.8744 13.7982L6.49919 10.9942L8.12397 13.7982C8.26836 14.0878 8.51944 14.3101 8.82438 14.4183C9.12931 14.5266 9.46435 14.5123 9.75901 14.3786C10.0537 14.2449 10.285 14.0021 10.4043 13.7013C10.5236 13.4005 10.5216 13.0652 10.3987 12.7658L9.08635 7.78398L12.2578 6.38729H12.2659C12.5288 6.27191 12.7429 6.06805 12.871 5.81116C12.9991 5.55426 13.0331 5.26059 12.9671 4.98122ZM11.8547 5.47491L8.29708 7.04095C8.18816 7.08894 8.09994 7.17422 8.04828 7.28144C7.99662 7.38866 7.9849 7.51079 8.01524 7.62588L9.44443 13.0608C9.45171 13.0899 9.46197 13.1182 9.47505 13.1452C9.49602 13.19 9.5032 13.2401 9.49568 13.289C9.48816 13.3379 9.46628 13.3835 9.43281 13.42C9.39934 13.4565 9.35579 13.4822 9.30768 13.4939C9.25957 13.5056 9.20907 13.5028 9.16259 13.4857C9.10044 13.4629 9.04987 13.4164 9.02198 13.3564C9.01569 13.3428 9.00859 13.3297 9.00073 13.317L6.93163 9.74872C6.88768 9.67296 6.8246 9.61008 6.74871 9.56636C6.67282 9.52265 6.58677 9.49964 6.49919 9.49964C6.4116 9.49964 6.32556 9.52265 6.24966 9.56636C6.17377 9.61008 6.11069 9.67296 6.06674 9.74872L3.99951 13.3139C3.99165 13.3266 3.98456 13.3397 3.97827 13.3533C3.95038 13.4133 3.89981 13.4598 3.83766 13.4826C3.79118 13.4996 3.74068 13.5025 3.69257 13.4908C3.64446 13.4791 3.60091 13.4534 3.56744 13.4169C3.53397 13.3804 3.51209 13.3348 3.50457 13.2859C3.49705 13.2369 3.50423 13.1869 3.5252 13.142C3.53827 13.115 3.54854 13.0868 3.55582 13.0577L4.98313 7.624C5.01347 7.50892 5.00176 7.38678 4.95009 7.27956C4.89843 7.17234 4.81021 7.08707 4.7013 7.03908L1.14364 5.47491C1.09257 5.45054 1.05128 5.40957 1.02652 5.35869C1.00176 5.30781 0.994998 5.25003 1.00733 5.19481C1.01967 5.13959 1.05038 5.09019 1.09443 5.05468C1.13849 5.01917 1.19329 4.99967 1.24987 4.99935H11.7485C11.8052 4.99924 11.8603 5.01845 11.9047 5.05381C11.9491 5.08916 11.9801 5.13857 11.9927 5.1939C12.0053 5.24923 11.9987 5.3072 11.9739 5.35827C11.9492 5.40934 11.9078 5.45047 11.8566 5.47491H11.8547Z",fill:n})})},s=e=>{let{width:t=12,height:i=14,fill:n="#888888",className:o}=e;return(0,r.jsx)("svg",{width:t,height:i,viewBox:"0 0 12 14",fill:n,xmlns:"http://www.w3.org/2000/svg",className:o,children:(0,r.jsx)("path",{d:"M11.6114 1.6594L6.15686 0.023029C6.07542 -0.00141634 5.98939 -0.0064847 5.90565 0.00822853C5.82191 0.0229418 5.74276 0.057029 5.67453 0.107769C5.6063 0.15851 5.55088 0.224498 5.51269 0.300466C5.4745 0.376434 5.4546 0.460278 5.45458 0.545305V7.92671C4.89597 7.42707 4.18279 7.1343 3.43425 7.09731C2.6857 7.06033 1.94714 7.28138 1.342 7.72352C0.736854 8.16567 0.301794 8.80211 0.109529 9.52648C-0.0827369 10.2509 -0.0205594 11.0193 0.28567 11.7033C0.591899 12.3874 1.12363 12.9456 1.79198 13.2847C2.46034 13.6238 3.22484 13.7232 3.9577 13.5663C4.69056 13.4095 5.34738 13.0059 5.81839 12.4229C6.28941 11.84 6.54607 11.113 6.54549 10.3635V4.55101L11.2978 5.9767C11.3792 6.00115 11.4653 6.00621 11.549 5.9915C11.6327 5.97679 11.7119 5.9427 11.7801 5.89196C11.8483 5.84122 11.9038 5.77523 11.942 5.69926C11.9801 5.6233 12 5.53945 12.0001 5.45442V2.18168C12 2.06441 11.9622 1.95028 11.8922 1.8562C11.8222 1.76213 11.7237 1.69312 11.6114 1.6594ZM3.27275 12.5454C2.84122 12.5454 2.41939 12.4174 2.06059 12.1777C1.70179 11.9379 1.42214 11.5972 1.257 11.1985C1.09186 10.7998 1.04865 10.3611 1.13284 9.93789C1.21703 9.51466 1.42483 9.12589 1.72996 8.82076C2.03509 8.51562 2.42386 8.30782 2.84709 8.22364C3.27033 8.13945 3.70902 8.18266 4.1077 8.3478C4.50638 8.51293 4.84713 8.79258 5.08687 9.15138C5.32662 9.51018 5.45458 9.93202 5.45458 10.3635C5.45458 10.9422 5.22471 11.4972 4.81554 11.9063C4.40636 12.3155 3.85141 12.5454 3.27275 12.5454ZM10.9092 4.72147L6.54549 3.41237V1.27826L10.9092 2.59077V4.72147Z",fill:n})})},l=e=>{let{width:t=14,height:i=12,fill:n="#888888",className:o}=e;return(0,r.jsx)("svg",{width:t,height:i,viewBox:"0 0 14 12",fill:n,xmlns:"http://www.w3.org/2000/svg",className:o,children:(0,r.jsx)("path",{d:"M13.5 0H9C8.61189 0 8.2291 0.0903627 7.88197 0.263932C7.53483 0.437501 7.23287 0.68951 7 1C6.76713 0.68951 6.46517 0.437501 6.11803 0.263932C5.7709 0.0903627 5.38811 0 5 0H0.5C0.367392 0 0.240215 0.0526785 0.146447 0.146447C0.0526784 0.240215 0 0.367392 0 0.5V9.5C0 9.63261 0.0526784 9.75979 0.146447 9.85355C0.240215 9.94732 0.367392 10 0.5 10H5C5.39782 10 5.77936 10.158 6.06066 10.4393C6.34196 10.7206 6.5 11.1022 6.5 11.5C6.5 11.6326 6.55268 11.7598 6.64645 11.8536C6.74021 11.9473 6.86739 12 7 12C7.13261 12 7.25979 11.9473 7.35355 11.8536C7.44732 11.7598 7.5 11.6326 7.5 11.5C7.5 11.1022 7.65804 10.7206 7.93934 10.4393C8.22064 10.158 8.60218 10 9 10H13.5C13.6326 10 13.7598 9.94732 13.8536 9.85355C13.9473 9.75979 14 9.63261 14 9.5V0.5C14 0.367392 13.9473 0.240215 13.8536 0.146447C13.7598 0.0526785 13.6326 0 13.5 0ZM5 9H1V1H5C5.39782 1 5.77936 1.15804 6.06066 1.43934C6.34196 1.72064 6.5 2.10218 6.5 2.5V9.5C6.06769 9.17463 5.54107 8.99909 5 9ZM13 9H9C8.45893 8.99909 7.93231 9.17463 7.5 9.5V2.5C7.5 2.10218 7.65804 1.72064 7.93934 1.43934C8.22064 1.15804 8.60218 1 9 1H13V9ZM9 2.5H11.5C11.6326 2.5 11.7598 2.55268 11.8536 2.64645C11.9473 2.74021 12 2.86739 12 3C12 3.13261 11.9473 3.25979 11.8536 3.35355C11.7598 3.44732 11.6326 3.5 11.5 3.5H9C8.86739 3.5 8.74021 3.44732 8.64645 3.35355C8.55268 3.25979 8.5 3.13261 8.5 3C8.5 2.86739 8.55268 2.74021 8.64645 2.64645C8.74021 2.55268 8.86739 2.5 9 2.5ZM12 5C12 5.13261 11.9473 5.25979 11.8536 5.35355C11.7598 5.44732 11.6326 5.5 11.5 5.5H9C8.86739 5.5 8.74021 5.44732 8.64645 5.35355C8.55268 5.25979 8.5 5.13261 8.5 5C8.5 4.86739 8.55268 4.74021 8.64645 4.64645C8.74021 4.55268 8.86739 4.5 9 4.5H11.5C11.6326 4.5 11.7598 4.55268 11.8536 4.64645C11.9473 4.74021 12 4.86739 12 5ZM12 7C12 7.13261 11.9473 7.25979 11.8536 7.35355C11.7598 7.44732 11.6326 7.5 11.5 7.5H9C8.86739 7.5 8.74021 7.44732 8.64645 7.35355C8.55268 7.25979 8.5 7.13261 8.5 7C8.5 6.86739 8.55268 6.74021 8.64645 6.64645C8.74021 6.55268 8.86739 6.5 9 6.5H11.5C11.6326 6.5 11.7598 6.55268 11.8536 6.64645C11.9473 6.74021 12 6.86739 12 7Z",fill:n})})},d=e=>{let{width:t=13,height:i=13,fill:n="#888888",className:o}=e;return(0,r.jsx)("svg",{width:t,height:i,viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:o,children:(0,r.jsx)("path",{d:"M5.08172 3.3928C3.8894 4.73678 2.53748 6.67583 1.36899 9.01425C1.28328 9.18567 1.13298 9.31602 0.951161 9.37663C0.76934 9.43724 0.57089 9.42313 0.399467 9.33742C0.228044 9.25171 0.0976913 9.10141 0.0370842 8.91959C-0.0235228 8.73777 -0.00941947 8.53932 0.0762919 8.36789C1.29822 5.92476 2.71947 3.87955 4.00061 2.43447C4.64046 1.71302 5.2572 1.12733 5.81039 0.715686C6.08627 0.509865 6.35925 0.337986 6.6214 0.215216C6.87489 0.095334 7.1652 6.28568e-06 7.46346 6.28568e-06C7.63096 -0.000621184 7.79528 0.0457411 7.93774 0.133826C8.08021 0.221911 8.19512 0.348188 8.26941 0.49831C8.38279 0.72363 8.39507 0.964115 8.39218 1.12661C8.38641 1.47109 8.29469 1.9015 8.17697 2.33987C7.93504 3.23754 7.5104 4.42769 7.08865 5.60267L7.02943 5.76733C6.62068 6.90404 6.21842 8.02269 5.957 8.91603C5.8867 9.15724 5.82917 9.37269 5.78439 9.56238C6.28559 9.16013 6.90377 8.55422 7.55879 7.91003L7.58045 7.88909C8.21669 7.26368 8.89049 6.60217 9.45812 6.14792C9.74049 5.9226 10.0445 5.70811 10.3377 5.58462C10.5833 5.4799 11.1466 5.31019 11.5849 5.74855C11.8623 6.02587 11.9388 6.38696 11.959 6.65561C11.9807 6.93726 11.9475 7.24057 11.8962 7.52945C11.7951 8.10719 11.59 8.78098 11.4029 9.38906L11.3733 9.48655C11.2058 10.0289 11.057 10.5135 10.9725 10.902C11.1603 10.7143 11.3914 10.4153 11.6615 9.97402C11.711 9.89312 11.776 9.82278 11.8528 9.767C11.9295 9.71123 12.0165 9.67111 12.1087 9.64895C12.201 9.62679 12.2967 9.62301 12.3904 9.63783C12.4841 9.65265 12.5739 9.68579 12.6548 9.73534C12.7357 9.78489 12.8061 9.8499 12.8619 9.92663C12.9176 10.0034 12.9578 10.0903 12.9799 10.1826C13.0021 10.2748 13.0059 10.3705 12.991 10.4642C12.9762 10.5579 12.9431 10.6478 12.8935 10.7287C12.5014 11.3686 12.0955 11.8885 11.6651 12.2113C11.2145 12.5493 10.6252 12.74 10.0286 12.4417C9.58956 12.2214 9.4899 11.7845 9.46751 11.5419C9.44368 11.2797 9.48195 10.9937 9.53178 10.7366C9.62567 10.2506 9.80982 9.65554 9.98314 9.09296L10.0229 8.96442C10.2157 8.33756 10.3912 7.75188 10.4742 7.27885L10.4916 7.17413L10.3608 7.27524C9.85676 7.67894 9.23352 8.2899 8.57128 8.94058L8.54962 8.96225C7.91338 9.58693 7.23959 10.2492 6.67195 10.7027C6.38958 10.9287 6.08554 11.1432 5.79234 11.2667C5.5468 11.3714 4.9835 11.5412 4.54514 11.1028C4.32198 10.8796 4.26493 10.598 4.24688 10.4268C4.23014 10.2335 4.23571 10.0389 4.26349 9.84692C4.31259 9.46561 4.4267 9.00197 4.57113 8.51089C4.84556 7.5735 5.26082 6.41657 5.66307 5.29791L5.72951 5.11376C6.15776 3.92072 6.55929 2.79267 6.78172 1.96506L6.83517 1.75851C6.78049 1.79596 6.72656 1.83449 6.6734 1.87406C6.22348 2.20915 5.67896 2.71901 5.08172 3.3928Z",fill:n})})},c=e=>{let{fill:t="#666666",size:i,className:a,sx:s,...l}=e;return(0,r.jsx)(n.Ld,{width:"16",height:"16",viewBox:"0 0 20 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,sx:(0,o.j)({...i?{width:i,height:i,fontSize:i}:{}},s),...l,children:(0,r.jsx)("path",{d:"M16.875 3H6.875C6.70924 3 6.55027 3.06585 6.43306 3.18306C6.31585 3.30027 6.25 3.45924 6.25 3.625V6.75H3.125C2.95924 6.75 2.80027 6.81585 2.68306 6.93306C2.56585 7.05027 2.5 7.20924 2.5 7.375V17.375C2.5 17.5408 2.56585 17.6997 2.68306 17.8169C2.80027 17.9342 2.95924 18 3.125 18H13.125C13.2908 18 13.4497 17.9342 13.5669 17.8169C13.6842 17.6997 13.75 17.5408 13.75 17.375V14.25H16.875C17.0408 14.25 17.1997 14.1842 17.3169 14.0669C17.4342 13.9497 17.5 13.7908 17.5 13.625V3.625C17.5 3.45924 17.4342 3.30027 17.3169 3.18306C17.1997 3.06585 17.0408 3 16.875 3ZM12.5 16.75H3.75V8H12.5V16.75ZM16.25 13H13.75V7.375C13.75 7.20924 13.6842 7.05027 13.5669 6.93306C13.4497 6.81585 13.2908 6.75 13.125 6.75H7.5V4.25H16.25V13Z",fill:t})})}},89187:function(e,t,i){i.d(t,{wY:function(){return p},VB:function(){return h.V},p6:function(){return m.p},Op:function(){return x.O},$P:function(){return I},NT:function(){return ew},nE:function(){return eC.n},Bw:function(){return ej.B},mU:function(){return ek.m},ls:function(){return eF.l},Vo:function(){return eR}});var r=i(52676),n=i(75271),o=i(49200),a=i(7672),s=i(22988),l=i(6721);(0,n.forwardRef)((e,t)=>{let{children:i,gap:d=1.5,onScroll:c,scrollAmount:u=200}=e,p=(0,n.useRef)(null),h=t||p,[m,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),v=(0,n.useCallback)(()=>{let e="object"==typeof h&&(null==h?void 0:h.current);if(e){let{scrollLeft:t,scrollWidth:i,clientWidth:r}=e;x(t>0),f(t<i-r-1)}},[h]);(0,n.useEffect)(()=>{v();let e="object"==typeof h&&(null==h?void 0:h.current);if(e){e.addEventListener("scroll",v);let t=new ResizeObserver(v);return t.observe(e),()=>{e.removeEventListener("scroll",v),t.disconnect()}}},[v,h]);let b=e=>{let t="object"==typeof h&&(null==h?void 0:h.current);if(t){let i="left"===e?t.scrollLeft-u:t.scrollLeft+u;t.scrollTo({left:i,behavior:"smooth"})}null==c||c(e)};return(0,r.jsxs)(s.Z,{sx:{position:"relative",display:"flex",alignItems:"center"},children:[(0,r.jsx)(l.Z,{size:"small",onClick:()=>b("left"),sx:{position:"absolute",left:-8,zIndex:2,bgcolor:"#FFFFFF",color:"#000000",width:32,height:32,opacity:m?1:0,visibility:m?"visible":"hidden",transition:"all 0.3s ease-in-out","&:hover":{bgcolor:"#F0F0F0"}},children:(0,r.jsx)(o.Z,{fontSize:"small"})}),(0,r.jsx)(s.Z,{ref:h,sx:{display:"flex",gap:d,overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},maskImage:m&&g?"linear-gradient(to right, transparent, black 16px, black calc(100% - 16px), transparent)":m&&!g?"linear-gradient(to right, transparent, black 16px, black 100%)":!m&&g?"linear-gradient(to right, black 0%, black calc(100% - 16px), transparent)":"none",WebkitMaskImage:m&&g?"linear-gradient(to right, transparent, black 16px, black calc(100% - 16px), transparent)":m&&!g?"linear-gradient(to right, transparent, black 16px, black 100%)":!m&&g?"linear-gradient(to right, black 0%, black calc(100% - 16px), transparent)":"none"},children:i}),(0,r.jsx)(l.Z,{size:"small",onClick:()=>b("right"),sx:{position:"absolute",right:-8,zIndex:2,bgcolor:"#FFFFFF",color:"#000000",width:32,height:32,opacity:g?1:0,visibility:g?"visible":"hidden",transition:"all 0.3s ease-in-out","&:hover":{bgcolor:"#F0F0F0"}},children:(0,r.jsx)(a.Z,{fontSize:"small"})})]})}).displayName="HorizontalScrollableContainer";var d=i(75419),c=i(24181),u=i(86061);let p=(0,n.memo)(e=>{let{src:t,alt:i="",className:o,style:a,errorState:p,width:h="100%",height:m="100%",borderRadius:x=0,objectFit:g="cover",backgroundColor:f="#1A1A1A",showSkeleton:v=!0,rootMargin:b="50px",threshold:y=.1,onLoad:w,onError:C,enableFullscreen:j=!1}=e,[k,F]=(0,n.useState)(!1),[S,I]=(0,n.useState)(!1),[_,Z]=(0,n.useState)(!1),[A,E]=(0,n.useState)(!1),[M,T]=(0,n.useState)(!1),R=(0,n.useRef)(null);(0,n.useEffect)(()=>{p&&Z(!0)},[p]),(0,n.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[i]=t;i.isIntersecting&&(I(!0),e.disconnect())},{threshold:y,rootMargin:b});return R.current&&e.observe(R.current),()=>e.disconnect()},[y,b]);let D=(0,n.useCallback)(()=>{F(!0),Z(!1),null==w||w()},[w]),z=(0,n.useCallback)(e=>{Z(!0),F(!0),null==C||C()},[C]),P=(0,n.useCallback)(()=>{T(!0)},[]),W=(0,n.useCallback)(()=>{T(!1)},[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Z,{ref:R,className:o,sx:{width:h,height:m,backgroundColor:f,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",borderRadius:x,overflow:"hidden",...a},onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1),children:[!v||k||_?null:(0,r.jsx)(c.Z,{variant:"rectangular",width:"100%",height:"100%",sx:{position:"absolute",top:0,left:0,bgcolor:"#2A2A2A",borderRadius:x,"&::after":{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent)"}}}),S?(0,r.jsx)(s.Z,{component:"img",src:t,alt:i,onLoad:D,onError:z,sx:{width:"100%",height:"100%",objectFit:g,objectPosition:"center",opacity:k?1:0,transition:"opacity 0.3s ease",display:_?"none":"block"}}):null,_?(0,r.jsx)(s.Z,{sx:{width:"100%",height:"100%",backgroundColor:"#2A2A2A",display:"flex",alignItems:"center",justifyContent:"center",color:"#666666",fontSize:"12px",fontFamily:"Inter, sans-serif",userSelect:"none",borderRadius:x},children:"Error"}):null,j&&k&&!_&&A?(0,r.jsx)(l.Z,{onClick:P,sx:{position:"absolute",bottom:"8px",right:"8px",color:"#FFFFFF",backgroundColor:"rgba(0, 0, 0, 0.6)",padding:"4px",width:"32px",height:"32px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},children:(0,r.jsx)(d.Z,{sx:{fontSize:"18px"}})}):null]}),j?(0,r.jsx)(u.x,{open:M,src:t,alt:i,onClose:W}):null]})});p.displayName="LazyImage",i(32146);var h=i(87750),m=i(8393),x=i(58474);i(93573);var g=i(91022),f=i(94894),v=i(65543),b=i(90145),y=i(29984),w=i(97792),C=i(72660),j=i(32964),k=i(92971),F=i(67030);let S=e=>!!e&&("boolean"==typeof e.mozHasAudio?e.mozHasAudio:"number"==typeof e.mozChannels&&e.mozChannels>0||!!e.audioTracks&&e.audioTracks.length>0||"number"==typeof e.webkitAudioDecodedByteCount&&e.webkitAudioDecodedByteCount>0),I=e=>{let{videoUrl:t,poster:i,showImageToolbox:o=!1,onDelete:a}=e,[s,c]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!1),[x,I]=(0,n.useState)(0),[_,Z]=(0,n.useState)(0),[A,E]=(0,n.useState)(!1),[M,T]=(0,n.useState)(!0),[R,D]=(0,n.useState)(!1),z=(0,n.useRef)(null),P=(0,n.useRef)(null),{targetRef:W,shouldLoad:L}=(0,F.S)({rootMargin:"50px",threshold:.1,freezeOnceVisible:!0}),B=()=>{E(!0)},H=()=>{E(!1)},$=()=>{let e=S(z.current);return e&&D(!0),e},O=e=>{let t=e.currentTarget,i=t.muted||0===t.volume;i!==M&&T(i)};return(0,n.useEffect)(()=>{z.current&&(z.current.muted=M,z.current.volume=M?0:1),P.current&&(P.current.muted=M,P.current.volume=M?0:1)},[M]),(0,n.useEffect)(()=>{T(!0),D(!1)},[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(j.Z,{ref:W,sx:{width:"100%",height:"100%",position:"relative",cursor:"pointer",overflow:"hidden",borderRadius:"8px"},onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:[(0,r.jsx)("video",{ref:z,poster:i,src:L?t:void 0,loop:!0,muted:M,playsInline:!0,onEnded:()=>{c(!1),z.current&&(z.current.currentTime=0,I(0))},onLoadStart:()=>{m(!0)},onCanPlay:()=>{m(!1),$()},onTimeUpdate:()=>{z.current&&I(z.current.currentTime),R||$()},onLoadedMetadata:()=>{z.current&&Z(z.current.duration),$()},onClick:()=>{z.current&&(z.current.paused?(c(!0),z.current.play()):(c(!1),z.current.pause()),R||$())},onVolumeChange:O,style:{width:"100%",height:"100%",objectFit:"contain"}}),a?(0,r.jsx)(k._,{visible:o,url:t||i,onDelete:a}):null,h?(0,r.jsx)(j.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0, 0, 0, 0.6)",borderRadius:"50%",width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:(0,r.jsx)(y.Z,{size:24,sx:{color:"#FFFFFF"}})}):null,!s&&!h&&(0,r.jsx)(j.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",opacity:u?1:.7,transition:"opacity 0.2s ease",backgroundColor:"rgba(0, 0, 0, 0.6)",borderRadius:"50%",width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)",transform:"translate(-50%, -50%) scale(1.1)"}},children:(0,r.jsx)(g.Z,{sx:{color:"#FFFFFF",fontSize:"24px",marginLeft:"2px"}})}),u||s?(0,r.jsxs)(j.Z,{sx:{position:"absolute",bottom:0,left:0,right:0,opacity:u?1:.8,transition:"opacity 0.2s ease"},children:[(0,r.jsx)(j.Z,{sx:{position:"absolute",bottom:0,left:0,right:0,width:"100%",height:"4px",backgroundColor:"rgba(255, 255, 255, 0.3)",borderRadius:"2px",cursor:"pointer"},onClick:e=>{if(z.current&&_>0){let t=e.currentTarget.getBoundingClientRect(),i=(e.clientX-t.left)/t.width*_;z.current.currentTime=i,I(i)}},children:(0,r.jsx)(j.Z,{sx:{width:`${_>0?x/_*100:0}%`,height:"100%",backgroundColor:"#FFFFFF",borderRadius:"2px",transition:"width 0.1s ease"}})}),(0,r.jsxs)(j.Z,{sx:{position:"absolute",bottom:"10px",right:"10px",display:"flex",alignItems:"center",gap:"8px"},children:[R?(0,r.jsx)(l.Z,{onClick:e=>{e.stopPropagation();let t=!M;T(t),z.current&&(z.current.muted=t,z.current.volume=t?0:1),P.current&&(P.current.muted=t,P.current.volume=t?0:1)},"aria-label":M?"Unmute video":"Mute video",sx:{color:"var(--Gray-900)",padding:"4px",transition:"background-color 0.2s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:M?(0,r.jsx)(f.Z,{sx:{fontSize:"20px"}}):(0,r.jsx)(v.Z,{sx:{fontSize:"20px"}})}):null,(0,r.jsx)(l.Z,{onClick:e=>{e.stopPropagation(),B()},"aria-label":"Enter fullscreen",sx:{color:"var(--Gray-900)",padding:"4px",transition:"background-color 0.2s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:(0,r.jsx)(d.Z,{sx:{fontSize:"20px"}})})]})]}):null]}),(0,r.jsx)(w.Z,{open:A,onClose:H,maxWidth:!1,fullWidth:!0,sx:{"& .MuiDialog-paper":{backgroundColor:"#000000",margin:0,maxWidth:"100vw",maxHeight:"100vh",width:"100vw",height:"100vh",borderRadius:0}},children:(0,r.jsxs)(C.Z,{sx:{padding:0,position:"relative",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,r.jsx)(l.Z,{onClick:H,sx:{position:"absolute",top:"16px",right:"16px",color:"#FFFFFF",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,r.jsx)(b.Z,{})}),(0,r.jsx)("video",{ref:P,src:t,poster:i,controls:!0,autoPlay:s,loop:!0,muted:M,playsInline:!0,onVolumeChange:O,style:{width:"100%",height:"100%",objectFit:"contain"}})]})})]})};var _=i(45162),Z=i.n(_),A=i(66266),E=i(58684),M=i(80110),T=i(56407),R=i(76651),D=i(91415),z=i(13724),P=i(75616),W=i(2733),L=i(39204),B=i(42312),H=i(86262),$=i(69491),O=i(81479),U=i(88764),G=i(97779),N=i(27806),V=i(93710),K=i(328),q=i(16585),Y=i(33010);let X=e=>{let{storyStatus:t}=e;return(0,r.jsxs)(s.Z,{sx:{height:"100%",width:"100%",px:"40px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(253deg, #202020 -15.03%, #393939 59.06%, #202020 117.83%), #2E2E2E"},children:[(0,r.jsx)(Z(),{src:"https://cdn.openart.ai/story/home/my/storyErrorStatus.png",alt:"Story card error",width:69,height:60}),(0,r.jsx)(M.Z,{sx:{mt:1,color:"#888",textAlign:"center",fontFamily:"Inter",fontSize:"12px",fontWeight:500,lineHeight:"normal"},children:(0,O.MZ)(t).description})]})},J=()=>(0,r.jsx)(s.Z,{sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(253deg, #202020 -15.03%, #393939 59.06%, #202020 117.83%), #2E2E2E"},children:(0,r.jsx)(K.Z,{icon:"fa6-solid:compass-drafting",width:32,height:32,color:"#666666"})}),Q=e=>{let{title:t,formattedDate:i,typeImage:n}=e;return(0,r.jsxs)(T.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{p:0,px:{xs:1,sm:1.5},pt:1,gap:1},children:[(0,r.jsx)(s.Z,{sx:{flex:"0 0 auto"},children:(0,r.jsx)(Z(),{src:n,alt:"Story card error",width:20,height:20})}),(0,r.jsxs)(s.Z,{sx:{flex:"1 1 auto",overflow:"hidden"},children:[(0,r.jsx)(M.Z,{variant:"subtitle1",component:"h3",sx:{color:"#FFF",fontSize:{xs:"12px",sm:"14px"},fontStyle:"normal",fontWeight:600,lineHeight:"22px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t,children:t}),(0,r.jsx)(M.Z,{variant:"caption",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:{xs:"10px",sm:"12px"}},children:i})]})]})},ee=e=>{let{story:t,onDelete:i,isDeleting:n,setWorkflowRunId:o,setIsRegenerating:a}=e,l=(0,A.useRouter)(),[d,c]=(0,V.oH)(),u=["failed:generating_timeline","failed:exporting_video","failed:user_exporting_video"].includes(t.status),p=["failed:exporting_video","failed:generating_images","failed:generating_timeline","failed:user_exporting_video","failed:generating_videos"].includes(t.status),h=async()=>{a(!0),o(await d({story_id:t.id,force_music_reselection:!1,rebuild_timeline:!0}))};return(0,r.jsxs)(T.Z,{direction:"row",justifyContent:u?"space-between":"center",alignItems:"center",sx:{p:0,px:1.5,pt:2.2,gap:1},children:[u?(0,r.jsxs)(s.Z,{sx:{position:"relative"},children:[(0,r.jsx)(E.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"10px 12px",width:116,height:36,backgroundColor:"#013FFE",border:"1px solid rgba(255, 255, 255, 0.16)",borderRadius:"8px",backdropFilter:"blur(23.5px)",cursor:"pointer","@media (hover: hover)":{"&:hover":{backgroundColor:"#0235e6"}}},loading:c,onClick:h,children:!c&&(0,r.jsx)(M.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"14px",lineHeight:"1.21em",color:"#FFFFFF",textAlign:"center"},children:"Recover"})}),(0,r.jsx)(R.Z,{label:"FREE",size:"small",sx:{position:"absolute",top:-6,right:-6,height:16,minWidth:28,background:"linear-gradient(135deg, #00C851 0%, #007E33 100%)",color:"#FFFFFF",fontSize:"10px",fontWeight:700,fontFamily:"Inter",borderRadius:"8px",zIndex:10,"& .MuiChip-label":{px:"6px",py:"2px"}}})]}):null,p?(0,r.jsx)(E.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"10px 12px",width:116,height:36,backgroundColor:"#1A1A1A",border:"1px solid rgba(255, 255, 255, 0.16)",borderRadius:"8px",backdropFilter:"blur(23.5px)",cursor:"pointer","@media (hover: hover)":{"&:hover":{backgroundColor:"#2A2A2A"}}},onClick:()=>{(0,q.B)("editor_opened",{story_id:null==t?void 0:t.id,opened_from:"story_card"}),l.push(`/story/editor?story_id=${null==t?void 0:t.id}`)},children:(0,r.jsx)(M.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"14px",lineHeight:"1.21em",color:"#FFFFFF",textAlign:"center"},children:"Open Editor"})}):null,!(p||u)&&(0,r.jsx)(E.Z,{loading:n,sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"10px 12px",width:116,height:36,backgroundColor:"#1A1A1A",border:"1px solid rgba(255, 255, 255, 0.16)"},onClick:()=>{null==i||i(t.id)},children:(0,r.jsx)(M.Z,{children:"Delete"})})]})},et=e=>{let{icon:t,onClick:i,isLoading:n}=e;return(0,r.jsx)(E.Z,{loading:n,disableRipple:!0,disableElevation:!0,sx:{width:24,height:24,p:0,minWidth:"unset",backgroundColor:"#262626",borderRadius:"3.75px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",border:"none",outline:"none",boxShadow:"none","@media (hover: hover)":{"&:hover":{backgroundColor:"#404040",boxShadow:"none"}},"&:focus":{boxShadow:"none"},"&:active":{boxShadow:"none"},"&.Mui-disabled":{backgroundColor:"#262626",color:"inherit"},"& .MuiLoadingButton-loadingIndicator":{color:"#FFFFFF",position:"absolute"},"&.MuiLoadingButton-loading":{color:"transparent"}},onClick:e=>{e.stopPropagation(),e.preventDefault(),i(e)},children:t})},ei=e=>{let{children:t,sx:i,onClick:n}=e;return(0,r.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.14)",borderRadius:"6px",p:.5,backdropFilter:"blur(9.4px)",...i},onClick:e=>{e.stopPropagation(),e.preventDefault(),n()},children:t})};function er(e){var t;let{story:i,id:o,title:a,isOpenPreview:l,onOpenPreview:d,canEdit:c=!0,canDelete:u=!0,onDelete:p,isDeleting:h,onExport:x,isRebuilding:g,workflowRunId:f,onExportComplete:v,onVideoTimeUpdate:b}=e,y=null==i?void 0:null===(t=i.status)||void 0===t?void 0:t.startsWith("processing:"),[w,C]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!1),[F,S]=(0,n.useState)(!1),[I,_]=(0,n.useState)(!1),[Z,E]=(0,n.useState)(null),[V,K]=(0,n.useState)(!1),[er,en]=(0,n.useState)(null),eo=(0,P.NL)(),{mutateAsync:ea}=(0,U.GH)(),es=(0,A.useRouter)(),{isMobile:el}=(0,G.j)(),[ed,ec]=(0,W.Z)("profile-story-auto-sound",{defaultValue:!1,listenStorageChange:!0}),[eu,ep]=(0,n.useState)(!1),eh=(0,n.useRef)(null),[em,ex]=(0,n.useState)(0),eg=(0,$.tu)(null==i?void 0:i.category_id),[ef,ev]=(0,n.useState)(null),eb=f||ef,ey="object"==typeof(null==i?void 0:i.created_at)?`Published on ${new Date((null==i?void 0:i.published_at._seconds)*1e3+(null==i?void 0:i.published_at._nanoseconds)/1e6).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}`:`Published on ${null==i?void 0:i.published_at}`,ew=null==i?void 0:i.last_export_thumbnail_url,eC=(0,n.useCallback)(()=>{if(eh.current){let e=eh.current.currentTime;Math.abs(e-em)>=.1&&(ex(e),null==b||b(e))}},[b,em]),ej=(0,n.useMemo)(()=>(0,O.v4)(null==i?void 0:i.status)?(0,r.jsx)(X,{storyStatus:null==i?void 0:i.status}):(null==i?void 0:i.status.startsWith("draft"))&&!ew?(0,r.jsx)(J,{}):y?(0,r.jsx)(m.Z,{text:(0,$.Xe)(null==i?void 0:i.status)}):ew?(0,r.jsx)(L.E.div,{transition:{type:"spring",stiffness:300,damping:30},style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:(0,r.jsx)(D.Z,{component:"img",image:ew,alt:a,sx:{maxHeight:"100%",maxWidth:"100%",width:"100%",height:"100%",objectFit:"cover"}})}):(0,r.jsx)(s.Z,{sx:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.900"},children:(0,r.jsx)(M.Z,{variant:"body2",color:"text.secondary",children:"No preview"})}),[y,null==i?void 0:i.status,ew,a]),ek=(0,n.useMemo)(()=>(0,$.j7)(null==i?void 0:i.category_id),[null==i?void 0:i.category_id]),eF=(0,n.useMemo)(()=>(0,O.v4)(null==i?void 0:i.status)?(0,r.jsx)(ee,{story:i,setWorkflowRunId:ev,setIsRegenerating:C,isDeleting:h,onDelete:async()=>{await (null==p?void 0:p(o))}}):(0,r.jsx)(Q,{title:a,formattedDate:(null==i?void 0:i.is_template)?"By OpenArt":ey,typeImage:ek}),[p,ey,o,h,i,a,ek]),eS=(0,n.useMemo)(()=>(0,O.Jc)(null==i?void 0:i.status)?(0,r.jsxs)(T.Z,{className:"action-buttons",direction:"column",justifyContent:"center",alignItems:"center",spacing:1,sx:{position:"absolute",top:8,right:8,zIndex:2,opacity:0,visibility:"visible",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out"},children:[c?(0,r.jsx)(et,{icon:(0,r.jsx)(N.PhPen,{}),isLoading:j,onClick:async e=>{e.stopPropagation(),e.preventDefault();try{if(k(!0),(0,q.B)("editor_opened",{story_id:null==i?void 0:i.id,opened_from:"story_card"}),null==i?void 0:i.is_template){let e=await ea({templateStoryId:i.id,operation:"edit"});window.open(`/story/editor?story_id=${e.id}`,"_blank")}else window.open(`/story/editor?story_id=${o}`,"_blank")}finally{k(!1)}}}):null,(null==i?void 0:i.is_template)?null:(0,r.jsx)(et,{icon:(0,r.jsx)(N.PhShareFat,{}),onClick:e=>{E(e.currentTarget),_(!0)}}),(null==i?void 0:i.is_template)?null:(0,r.jsx)(et,{isLoading:g,icon:(0,r.jsx)(N.PhDownloadSimple,{}),onClick:async e=>{en(e.currentTarget),K(!0)}}),u?(0,r.jsx)(et,{icon:(0,r.jsx)(N.PhTrash,{}),isLoading:h||F,onClick:async()=>{try{(null==i?void 0:i.is_template)?(S(!0),await ea({templateStoryId:i.id,operation:"delete"})):await (null==p?void 0:p(o))}finally{S(!1)}}}):null]}):(0,r.jsx)(T.Z,{className:"action-buttons",direction:"column",justifyContent:"center",alignItems:"center",spacing:1,sx:{position:"absolute",top:8,right:8,zIndex:2,opacity:0,visibility:"visible",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out"},children:(0,r.jsx)(et,{icon:(0,r.jsx)(N.PhTrash,{}),isLoading:h||F,onClick:async()=>{try{(null==i?void 0:i.is_template)?(S(!0),await ea({templateStoryId:i.id,operation:"delete"})):await (null==p?void 0:p(o))}finally{S(!1)}}})}),[null==i?void 0:i.status,null==i?void 0:i.is_template,i.id,c,j,g,u,h,F,o,ea,p]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(z.Z,{sx:{pb:1.5,width:"100%",overflow:"hidden",position:"relative",backgroundColor:"#1A1A1A",borderRadius:"8px",border:"1px solid #2E2E2E",background:"#1A1A1A","@media (hover: hover)":{"&:hover .action-buttons":{opacity:1,visibility:"visible"}},cursor:"pointer"},onClick:()=>{let e=(0,O.gu)(i);(0,O.Jc)(null==i?void 0:i.status)?null==d||d():e?es.push(`/story/editor?story_id=${o}&view=list`):(null==i?void 0:i.status)==="draft"?((0,q.B)("editor_opened",{story_id:null==i?void 0:i.id,opened_from:"story_card"}),es.push(`/story/editor?story_id=${o}`)):(null==i?void 0:i.status)==="failed"||(null==i?void 0:i.status.startsWith("failed:"))||es.push(`/story/my/${o}`)},onMouseEnter:()=>{ep(!0),eh.current&&eh.current.play()},onMouseLeave:()=>{ep(!1),eh.current&&(eh.current.pause(),eh.current.currentTime=0,ex(0))},children:[(0,r.jsxs)(s.Z,{sx:{position:"relative",height:146,width:"100%",overflow:"hidden"},children:[!el&&eu?(0,r.jsx)(s.Z,{component:"video",ref:eh,muted:!ed,autoPlay:!0,loop:!0,preload:"metadata",poster:ew,onTimeUpdate:eC,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",zIndex:2,opacity:eu?1:0,transition:"opacity 0.3s ease",pointerEvents:"none"},children:(0,r.jsx)("source",{src:i.last_export_url,type:"video/mp4"})}):null,ej,eS,(null==i?void 0:i.is_template)?(0,r.jsx)(R.Z,{label:"Example",size:"small",sx:{position:"absolute",top:8,right:8,zIndex:3,background:"rgba(0, 0, 0, 0.58)",border:"1px solid rgba(255, 255, 255, 0.08)",backdropFilter:"blur(10.9px)",color:"rgba(255, 255, 255, 0.62)",fontFamily:"Inter",fontSize:"14px",fontWeight:600,height:"24px",borderRadius:"6px","& .MuiChip-label":{px:"8px",py:"4px"}}}):null,eb?(0,r.jsx)(B.d,{workflowRunId:eb,storyId:o,onComplete:v||(()=>{ev(null),w&&((0,Y.tO)(eo,i),C(!1))}),shouldAutoDownload:!l&&!w}):null]}),(0,r.jsx)(T.Z,{direction:"row",width:"100%",height:"50px",sx:{px:{xs:.2,md:1},pt:{xs:.2,md:1},pb:2,position:"absolute",top:"0px",left:"0px",background:eu?"linear-gradient(0deg, rgba(0, 0, 0, 0.00) 0%, #000 161%)":"none",zIndex:3},alignItems:"center",justifyContent:"space-between",children:(0,r.jsxs)(T.Z,{direction:"row",spacing:{xs:0,md:.5},alignItems:"start",sx:{opacity:{xs:1,md:eu?1:0}},children:[(0,r.jsx)(ei,{onClick:()=>{ec(!ed)},sx:{display:{xs:"none",md:"block"}},children:ed?(0,r.jsx)(N.CustomSoundOn,{width:14,height:14}):(0,r.jsx)(N.CustomSoundOff,{width:14,height:14})}),(0,r.jsx)(ei,{children:(0,r.jsxs)(T.Z,{direction:"row",spacing:.5,alignItems:"center",children:[(0,r.jsx)(eg,{width:14,height:14,color:"rgba(255, 255, 255, 0.75)"}),(0,r.jsx)(M.Z,{fontSize:{xs:11,md:12},fontWeight:600,lineHeight:1.21,color:"rgba(255, 255, 255, 0.6)",textAlign:"center",letterSpacing:"-0.12px",children:(0,$.Oo)(null==i?void 0:i.category_id)})]})})]})}),eF]}),(0,r.jsx)(H.Z,{open:I,anchorEl:Z,onClose:()=>{_(!1),E(null)},story:i}),(0,r.jsx)(H.Z,{open:V,anchorEl:er,onClose:()=>{K(!1),en(null)},story:i,openDirectlyToExportOptions:!0})]})}var en=i(19509),eo=i(77379),ea=i(57672),es=i(53874),el=i(8765),ed=i(19242),ec=i(24368),eu=i(23679),ep=i(46237),eh=i(86775),em=i(722),ex=i(66627),eg=i(3935),ef=i(19005);function ev(){return(0,r.jsxs)(s.Z,{sx:{width:"100%",backgroundColor:"#1A1A1A",borderRadius:"8px",border:"1px solid #2E2E2E",overflow:"hidden",pb:1.5},children:[(0,r.jsx)(c.Z,{variant:"rectangular",width:"100%",height:146,sx:{backgroundColor:"#2A2A2A",borderRadius:"8px 8px 0 0"}}),(0,r.jsxs)(s.Z,{sx:{p:0,px:{xs:1,sm:1.5},pt:1,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(c.Z,{variant:"rectangular",width:20,height:20,sx:{backgroundColor:"#2A2A2A",borderRadius:"4px",flexShrink:0}}),(0,r.jsxs)(s.Z,{sx:{flex:"1 1 auto",overflow:"hidden"},children:[(0,r.jsx)(c.Z,{variant:"text",width:"70%",height:22,sx:{backgroundColor:"#2A2A2A",mb:.5}}),(0,r.jsx)(c.Z,{variant:"text",width:"50%",height:16,sx:{backgroundColor:"#2A2A2A"}})]})]})]})}let eb=e=>{switch(e){case"character_vlog":return"/story/create/vlog";case"script_to_video":return"/story/create/script";case"music_video":return"/story/create/mv";default:return"/story/editor"}},ey=e=>{switch(e){case"character_vlog":return"Create Character Vlog →";case"script_to_video":return"Create Script to Video →";case"music_video":return"Create Music Video →";case"create_from_scratch":return"Create from Scratch →";default:return"Create Story →"}};function ew(e){let{stories:t,fetchNextPage:i,hasNextPage:o=!1,isFetchingNextPage:a=!1,title:l,maxItems:d,isLoading:c=!1}=e,u=(0,P.NL)(),{isMobile:p}=(0,G.j)(),{showModal:h}=(0,el.dd)(),[m]=(0,V.oH)(),[x]=(0,V.lj)(),g=(0,ec.aT)(),[f,v]=(0,n.useState)(!1),[b,y]=(0,n.useState)(null),[w,C]=(0,n.useState)(()=>new Map),[j,k]=(0,n.useState)(()=>new Map),[F,S]=(0,n.useState)(()=>new Map),[I,_]=(0,n.useState)(!1),{data:Z}=(0,ef.CD)(),A=(0,ea.Z)(),[E,T]=(0,n.useState)(0),{ref:R,inView:D}=(0,ed.YD)({threshold:.1,triggerOnce:!1}),z=(0,n.useMemo)(()=>d?t.slice(0,d):t,[t,d]),W=(0,n.useMemo)(()=>z.filter(e=>e.status.startsWith("processing")).map(e=>e.workflow_run_id),[z]),L=(0,n.useCallback)((e,t)=>{u.setQueryData(ex.Y.lists(),(0,es.Uy)(i=>{if(null==i?void 0:i.pages){for(let r of i.pages)for(let i of r.stories)if(i.workflow_run_id===e){let e=t.story;(0,O.v4)(t.status)?i.status="failed":e&&e.status!==i.status&&Object.assign(i,e);return}}}))},[u]);(0,n.useEffect)(()=>{D&&i&&o&&!a&&i()},[D,i,o,a]),(0,eg.i)(W,!0,L);let B=b?z.find(e=>e.id===b.id):null,H=(0,n.useCallback)(e=>{var t,i,r,n;_((null===(i=e.video_editor_timeline)||void 0===i?void 0:null===(t=i.tracks)||void 0===t?void 0:t.length)>0&&(null===(n=e.video_editor_timeline)||void 0===n?void 0:null===(r=n.mediaAssets)||void 0===r?void 0:r.length)>0)},[]),$=(0,n.useCallback)(e=>{H(e),y(e),v(!0)},[H]),U=(0,n.useCallback)(()=>{v(!1),y(null)},[]),N=(0,n.useCallback)(()=>{if(b&&b.id!==z.at(-1).id){let e=z[z.indexOf(b)+1];H(e),y(e)}},[b,z,H]),K=(0,n.useCallback)(()=>{if(b&&b.id!==z[0].id){let e=z[z.indexOf(b)-1];H(e),y(e)}},[b,z,H]),Y=(0,n.useCallback)(()=>{if(!B)return;let e=B.last_export_url;if(e){let t=document.createElement("a");t.download=`${B.title||"openart-story"}.mp4`,t.href=e,t.target="_self",t.click()}else console.error("No last export URL found")},[B]),X=(0,n.useCallback)(async()=>{if(B){k(e=>new Map(e).set(B.id,!0));try{let e=await m({story_id:B.id,force_music_reselection:!1});C(t=>new Map(t).set(B.id,e))}finally{k(e=>{let t=new Map(e);return t.delete(B.id),t})}}},[B,m]),J=(0,n.useCallback)(e=>{f||T(e)},[f]),Q=(0,n.useCallback)(async e=>{g.confirm({title:"Delete Story",content:"Are you sure you want to delete this Story? This action cannot be undone.",iconType:"warning",onConfirm:async()=>{S(t=>new Map(t).set(e,!0));try{if(await x(e),(null==b?void 0:b.id)===e&&f){let t=z.findIndex(t=>t.id===e),i=z[t+1]||z[t-1];i?y(i):(v(!1),y(null))}}finally{S(t=>{let i=new Map(t);return i.delete(e),i})}},onCancel:()=>{S(t=>{let i=new Map(t);return i.delete(e),i})}})},[g,x,null==b?void 0:b.id,f,z]),ee=(0,n.useCallback)(e=>{C(t=>{let i=new Map(t);return i.delete(e),i}),k(t=>{let i=new Map(t);return i.delete(e),i})},[]),et=(0,n.useCallback)(async e=>{k(t=>new Map(t).set(e,!0));try{let t=await m({story_id:e,force_music_reselection:!1});C(i=>new Map(i).set(e,t))}finally{k(t=>{let i=new Map(t);return i.delete(e),i})}},[m]),ei=(0,n.useCallback)(async()=>{if(B){if(p){h(ep.$);return}(0,q.B)("editor_opened",{story_id:B.id,opened_from:"story_card_list"}),v(!1),window.open(`/story/editor?story_id=${B.id}`,"_blank")}},[B,p,h]),ew=(0,n.useCallback)(e=>!!Z&&Z.id===(null==e?void 0:e.created_by_user_id),[Z]);return(0,r.jsxs)(s.Z,{sx:{mb:4,width:"100%"},children:[l?(0,r.jsx)(M.Z,{variant:"h6",component:"h2",sx:{fontWeight:700,mb:2,color:"#E0E0E0"},children:l}):null,c?(0,r.jsx)(en.ZP,{container:!0,spacing:2,children:Array.from({length:8},(e,t)=>(0,r.jsx)(en.ZP,{item:!0,xs:6,sm:4,md:4,lg:3,children:(0,r.jsx)(ev,{})},`skeleton-${t}`))}):z.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(en.ZP,{container:!0,spacing:2,children:z.map(e=>(0,r.jsx)(en.ZP,{item:!0,xs:6,sm:4,md:4,lg:3,children:(0,r.jsx)(er,{story:e,id:e.id,title:e.title,thumbnail:e.last_export_thumbnail_url,isOpenPreview:(null==b?void 0:b.id)===e.id,onOpenPreview:()=>$(e),onExport:()=>et(e.id),workflowRunId:w.get(e.id),onExportComplete:()=>ee(e.id),isRebuilding:j.get(e.id)||!1,onDelete:()=>Q(e.id),isDeleting:F.get(e.id)||!1,canDelete:ew(e),canEdit:ew(e),onVideoTimeUpdate:J})},e.id))}),!d&&(o||a)?(0,r.jsx)(s.Z,{ref:R,children:a?(0,r.jsx)(en.ZP,{container:!0,spacing:2,sx:{mt:2},children:Array.from({length:4},(e,t)=>(0,r.jsx)(en.ZP,{item:!0,xs:6,sm:4,md:4,lg:3,children:(0,r.jsx)(ev,{})},`loading-skeleton-${t}`))}):null}):null,B?(0,r.jsx)(em.z,{story:B,currentVideoTime:E,open:f,onClose:U,workflowRunId:w.get(B.id)||null,isRebuilding:j.get(B.id)||!1,onDownload:ew(B)?X:Y,onExportComplete:()=>ee(B.id),canNavigateNext:b?b.id!==z.at(-1).id:null,canNavigatePrev:b?b.id!==z[0].id:null,onNext:N,onPrev:K,onEdit:ei,showVideoOutdatedHint:!1,useDirectDownload:!ew(B),onDelete:()=>Q(B.id),isDeleting:F.get(B.id)||!1,canDelete:!!Z&&Z.id===(null==B?void 0:B.created_by_user_id),useStoryPreviewPlayer:ew(B)&&I,bottomContent:ew(B)||"create_from_scratch"!==B.category_id?null:(0,r.jsx)(eo.Z,{sx:{backgroundColor:A.palette.Colors.Blue["500"],color:A.palette.Colors.Gray["900"],fontSize:"16px",fontWeight:700,lineHeight:"23px",textTransform:"none",width:"100%",height:"44px",borderRadius:"8px",gap:"10px","&:hover":{backgroundColor:A.palette.Colors.Blue["400"]}},target:"_blank",href:eb(B.category_id),children:ey(B.category_id)})}):null]}):(0,r.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8},children:[(0,r.jsx)(s.Z,{sx:{mb:2.5,display:"flex",justifyContent:"center"},children:(0,r.jsx)(eh.b,{})}),(0,r.jsx)(M.Z,{variant:"body1",sx:{color:"#E0E0E0",mb:2.5,textAlign:"center",fontWeight:600,fontSize:"14px",lineHeight:"20px",maxWidth:"418px"},children:"Start your storytelling journey — create your first story!"}),(0,r.jsx)(eu.l,{})]})]})}i(92204),i(79446),i(60905);var eC=i(90610);i(33621),i(7006);var ej=i(97708),ek=i(56541),eF=i(8207);i(7999),i(3178),i(92295),i(28167);var eS=i(28136),eI=i(14930),e_=i(41899);function eZ(e){let{open:t,onClose:i}=e,n=(0,ea.Z)(),o=(0,eI.Z)(n.breakpoints.down("md"));return(0,r.jsxs)(w.Z,{open:t,onClose:i,maxWidth:!1,fullScreen:o,PaperProps:{sx:{backgroundColor:"#2F66FF",borderRadius:{xs:0,md:"16px"},border:{xs:"none",md:"1.6px solid #2E2E2E"},width:{xs:"100%",md:"873px"},height:{xs:"100%",md:"663px"},position:"relative",overflow:"hidden"}},children:[(0,r.jsx)(j.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:{xs:"220px",md:"160px"},display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(j.Z,{sx:{width:"95%",height:"95%",borderRadius:"14px",backgroundImage:"url(https://cdn.openart.ai/assets/edit_image.webp)",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"}})}),!o&&(0,r.jsx)(j.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"64px",height:"64px",backgroundImage:"url(/cursor-pointer.svg)",backgroundSize:"contain",backgroundRepeat:"no-repeat",filter:"drop-shadow(0px 2.67px 2.13px rgba(0, 0, 0, 0.5))",pointerEvents:"none"}}),(0,r.jsx)(l.Z,{onClick:i,sx:{position:"absolute",top:{xs:"16px",md:"18px"},right:{xs:"16px",md:"18px"},width:{xs:"40px",md:"30px"},height:{xs:"40px",md:"30px"},backgroundColor:"#101010",borderRadius:"24px",color:"#FFFFFF","&:hover":{backgroundColor:"#2A2A2A"}},children:(0,r.jsx)(e_.Tw,{sx:{fontSize:{xs:"16px",md:"12px"}}})}),(0,r.jsx)(j.Z,{sx:{position:"absolute",bottom:0,left:"0",width:"100%",height:{xs:"220px",md:"190px"},backgroundColor:"#101010"},children:(0,r.jsxs)(j.Z,{sx:{mt:{xs:"24px",md:"40px"},px:{xs:"16px",md:"0"},display:"flex",flexDirection:"column",alignItems:"center",gap:{xs:"16px",md:"20px"}},children:[(0,r.jsx)(M.Z,{sx:{fontFamily:"Inter",fontWeight:700,fontSize:{xs:"20px",md:"24px"},lineHeight:"1.21em",color:"#FFFFFF",textAlign:"center"},children:"Powerful editing tools"}),(0,r.jsxs)(j.Z,{sx:{display:"flex",gap:{xs:"24px",md:"44px"},flexDirection:{xs:"column",md:"row"},alignItems:"center",justifyContent:"center",width:"100%",maxWidth:{xs:"100%",md:"none"}},children:[(0,r.jsxs)(j.Z,{sx:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,r.jsx)(M.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:{xs:"14px",md:"15px"},lineHeight:"1.21em",color:"#AAAAAA",textAlign:"center"},children:"\uD83C\uDFAC Add or replace video shots"}),(0,r.jsx)(M.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:{xs:"14px",md:"15px"},lineHeight:"1.21em",color:"#AAAAAA",textAlign:"center"},children:"\uD83D\uDD01 Regenerate clips with a single click"})]}),(0,r.jsxs)(j.Z,{sx:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,r.jsx)(M.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:{xs:"14px",md:"15px"},lineHeight:"1.21em",color:"#AAAAAA",textAlign:"center"},children:"\uD83C\uDFB5 Auto soundtrack sync"}),(0,r.jsx)(M.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:{xs:"14px",md:"15px"},lineHeight:"1.21em",color:"#AAAAAA",textAlign:"center"},children:"✂️ AI-assisted video editor"})]})]})]})})]})}var eA=i(51760);function eE(e){let{side:t,delay:i=0}=e;return(0,r.jsx)(s.Z,{sx:{position:"absolute",[t]:"30px",top:"left"===t?"5px":"17px",height:"548px",overflow:"hidden",display:"flex",flexDirection:"column",width:"70.42px"},children:(0,r.jsx)(L.E.div,{initial:{y:0},animate:{y:-82.94},transition:{duration:3,ease:"linear",repeat:1/0,delay:i},style:{display:"flex",flexDirection:"column"},children:Array.from({length:Math.ceil(6.607185917530745)+2},(e,t)=>(0,r.jsx)(s.Z,{sx:{width:"70.42px",height:"45.38px",backgroundColor:"rgba(255, 255, 255, 0.10)",borderRadius:"5.48px",marginBottom:"37.56px",flexShrink:0}},t))})})}function eM(e){let{status:t,onPreviewEdit:i}=e;return(0,r.jsxs)(s.Z,{sx:{width:"100%",background:"rgba(74,71,70,1) 100%)",display:"flex",flexDirection:"column"},children:[(0,r.jsxs)(s.Z,{sx:{textAlign:"center",mb:"32px"},children:[(0,r.jsx)(M.Z,{sx:{color:"#FFFFFF",fontSize:"24px",fontWeight:700,mb:"8px"},children:"Creating Your Story"}),(0,r.jsx)(M.Z,{sx:{color:"#888888",fontSize:"16px",lineHeight:"1.4"},children:"This may take a few minutes"})]}),(0,r.jsxs)(s.Z,{sx:{backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:"16px",p:"24px",mb:"32px",border:"2px solid rgba(255, 255, 255, 0.1)",flex:1},children:[(0,r.jsx)(eA.$,{status:t,mobile:!0}),(0,r.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(m.Z,{sx:{background:"transparent",transform:"scale(0.8)"}})}),(0,r.jsxs)(s.Z,{sx:{textAlign:"center",mb:"24px"},children:[(0,r.jsx)(M.Z,{sx:{color:"#FFFFFF",fontSize:"16px",lineHeight:"1.5",mb:"8px",fontWeight:500},children:"Step away any time—we'll keep working in the background."}),(0,r.jsx)(M.Z,{sx:{color:"#888888",fontSize:"14px",lineHeight:"1.4",fontWeight:500},children:"You can tweak it in the editor once it's ready."})]}),(0,r.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(eo.Z,{onClick:i,sx:{backgroundColor:"#444444",color:"#FFFFFF",borderRadius:"12px",padding:"16px 32px",fontSize:"16px",fontWeight:600,textTransform:"none",minWidth:"160px","&:hover":{backgroundColor:"#555555"}},endIcon:(0,r.jsx)(eS.Z,{}),children:"Preview Edit"})})]}),(0,r.jsx)(s.Z,{sx:{textAlign:"center",mt:"auto"},children:(0,r.jsx)(M.Z,{sx:{color:"#888888",fontSize:"12px",lineHeight:"1.4"},children:"Processing typically takes 2-5 minutes depending on story length"})})]})}function eT(e){let{status:t,onPreviewEdit:i}=e,o=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e,t,i,r;let n=o.current;if(!n)return;let a=n.getContext("2d");if(!a)return;let s=[],l=0,d=()=>{let i=a.createImageData(e,t),r=new Uint32Array(i.data.buffer),n=r.length;for(let e=0;e<n;e++).5>Math.random()&&(r[e]=4278190080);s.push(i)},c=()=>{9===l?l=0:l++,a.putImageData(s[l],0,0)},u=()=>{c(),i=window.setTimeout(()=>{window.requestAnimationFrame(u)},40)},p=()=>{e=n.offsetWidth,t=n.offsetHeight,n.width=e,n.height=t,s=[];for(let e=0;e<10;e++)d();u()},h=()=>{window.clearTimeout(r),r=window.setTimeout(()=>{window.clearTimeout(i),p()},200)};return p(),window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h),window.clearTimeout(i),window.clearTimeout(r)}},[]),(0,r.jsx)(s.Z,{sx:{width:"100%",maxWidth:"1120px",height:"928px",position:"relative",mx:"auto",mt:"40px"},children:(0,r.jsxs)(s.Z,{sx:{position:"relative",left:0,width:"100%",height:"548px",background:"linear-gradient(to right, rgba(36,31,31,1) 0%, rgba(36,31,31,1) 32%, rgba(74,71,70,1) 100%)",backgroundSize:"cover",backgroundPosition:"center",overflow:"hidden",border:"2px solid rgba(255, 255, 255, 0.1)",borderRadius:"12px"},children:[(0,r.jsx)(s.Z,{component:"canvas",ref:o,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",opacity:.15,zIndex:1}}),(0,r.jsx)(eA.$,{status:t,sx:{position:"absolute",top:"40px",left:"50%",transform:"translateX(-50%)"}}),(0,r.jsx)(s.Z,{sx:{position:"absolute",width:"100%",height:"100%",boxShadow:"inset 0px 0px 150px 20px black",mixBlendMode:"multiply",animation:"vignette-anim 3s infinite","@keyframes vignette-anim":{"0%, 100%":{opacity:1},"50%":{opacity:.7}}}}),(0,r.jsx)(s.Z,{sx:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",gap:"19px",zIndex:100},children:(0,r.jsx)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"19px",width:"100%",height:"100%"},children:(0,r.jsxs)(T.Z,{direction:"column",justifyContent:"center",alignItems:"center",spacing:1.5,children:[(0,r.jsx)(m.Z,{sx:{background:"transparent"}}),(0,r.jsxs)(T.Z,{spacing:1,alignItems:"center",children:[(0,r.jsx)(M.Z,{sx:{fontWeight:500,fontSize:"14px",lineHeight:"1.21em",color:"#888888",textAlign:"center"},children:"Step away any time—we'll keep working in the background."}),(0,r.jsx)(M.Z,{sx:{fontWeight:500,fontSize:"14px",lineHeight:"1.21em",color:"#888888",textAlign:"center"},children:"You can tweak it in editor once it's ready."})]}),(0,r.jsx)(eo.Z,{onClick:i,sx:{backgroundColor:"#444444",color:"#FFFFFF",borderRadius:"6px",padding:"17px 24px",fontWeight:700,fontSize:"16px",lineHeight:"1.6em",textTransform:"none",minWidth:"155px",mt:"20px !important",height:"48px","&:hover":{backgroundColor:"#444444"}},endIcon:(0,r.jsx)(eS.Z,{}),children:"Preview edit"})]})})}),(0,r.jsx)(eE,{side:"left",delay:0}),(0,r.jsx)(eE,{side:"right",delay:1})]})})}function eR(e){let{status:t}=e,[i,o]=(0,n.useState)(!1),a=(0,ea.Z)(),{showModal:s}=(0,el.dd)(),l=(0,eI.Z)(a.breakpoints.down("md"));return(0,r.jsxs)(r.Fragment,{children:[l?(0,r.jsx)(eM,{status:t,onPreviewEdit:()=>{s(ep.$)}}):(0,r.jsx)(eT,{status:t,onPreviewEdit:()=>{o(!0)}}),(0,r.jsx)(eZ,{open:i,onClose:()=>{o(!1)}})]})}i(42580),i(49099)},42580:function(e,t,i){i.d(t,{K:function(){return a}});var r=i(52676),n=i(75271),o=i(93573);function a(e){let{onSuccess:t,placeholder:i,title:a,enableTrimming:s=!1,onFileReady:l}=e,[d,c]=(0,n.useState)(!1),u=()=>c(!1),p=(0,r.jsx)(o.m,{open:d,onClose:u,onSuccess:(e,i)=>{t(e,i),u()},onFileReady:s?(e,t,i)=>{l&&l(e,t,i)}:void 0,placeholder:i,title:a});return{open:()=>c(!0),close:u,context:p}}},60454:function(e,t,i){i.d(t,{E5:function(){return r.E5},FA:function(){return r.FA},FC:function(){return r.FC},Fj:function(){return r.Fj},GI:function(){return r.GI},O8:function(){return o.O8},Oo:function(){return o.Oo},PR:function(){return r.PR},Pb:function(){return r.Pb},R4:function(){return o.R4},Rx:function(){return r.Rx},VY:function(){return r.VY},Wy:function(){return r.Wy},ZX:function(){return o.ZX},Zc:function(){return r.Zc},_p:function(){return o._p},fz:function(){return o.Pw},gm:function(){return r.gm},l4:function(){return n.l4},ow:function(){return o.ow},tu:function(){return o.tu},uv:function(){return r.uv},w3:function(){return r.w3},xS:function(){return r.xS},yD:function(){return r.yD}});var r=i(2895),n=i(28403),o=i(69491)},79435:function(e,t,i){i.d(t,{h:function(){return a},q:function(){return o}});let r={"consistent-style":"styles","singing-dancing":"singing-dancing","consistent-character":"story","lyrics-video":"lyrics"},n=Object.fromEntries(Object.entries(r).map(e=>{let[t,i]=e;return[i,t]}));function o(e){return r[e]}function a(e){return n[e]}},98283:function(e,t,i){i.d(t,{w:function(){return r}});let r=[{key:"singing-dancing",title:"Singing Video",desc:"Sing your song with a virtual artist.",image:"https://cdn.openart.ai/assets/internal/uploads/image_OxhlMO4t_640x640_1759047689175.webp",thumbnail:"https://cdn.openart.ai/assets/internal/uploads/image_SvBqfONa_1024x1024_1759108368557.webp",background:"https://cdn.openart.ai/assets/internal/uploads/image_i8mbTvWc_1920x1115_1759048761594.webp",hoverPlayVideo:"https://cdn.openart.ai/production/2025-10/uploads/XdOBH7cjWoraFnVomAyP/file_qpJQCKQm_1759675622250.mp4",titleImage:"/assets/home_singing_video.svg"},{key:"consistent-character",title:"Narrative Video",desc:"Bring your music to life with a story.",image:"https://cdn.openart.ai/assets/internal/uploads/image_8x33yaqp_640x640_1759047779571.webp",thumbnail:"https://cdn.openart.ai/assets/internal/uploads/image_91QvhvAQ_1024x1024_1759108368221.webp",background:"https://cdn.openart.ai/assets/internal/uploads/image_Of3I74t9_1920x1115_1759048758192.webp",hoverPlayVideo:"https://cdn.openart.ai/production/2025-10/uploads/XdOBH7cjWoraFnVomAyP/file_1B3gwgXx_1759675622222.mp4",titleImage:"/assets/home_narrative_video.svg"},{key:"consistent-style",title:"Visualizer",desc:"Turn your track into pure visual vibes.",image:"https://cdn.openart.ai/assets/internal/uploads/image_UygNoWNu_1024x1024_1759108368193.webp",thumbnail:"https://cdn.openart.ai/assets/internal/uploads/image_UygNoWNu_1024x1024_1759108368193.webp",background:"https://cdn.openart.ai/assets/internal/uploads/image_-xTEcxEJ_1460x848_1759237728719.webp",hoverPlayVideo:"https://cdn.openart.ai/production/2025-10/uploads/XdOBH7cjWoraFnVomAyP/file_G1mXDBxj_1759675622236.mp4",titleImage:"/assets/home_visualizer_video.svg"},{key:"lyrics-video",title:"Lyrics Video",desc:"Make your words move with the beat.",image:"https://cdn.openart.ai/assets/internal/uploads/image_-x8BWSoQ_1080x1080_1759235784265.webp",thumbnail:"https://cdn.openart.ai/assets/internal/uploads/image_-x8BWSoQ_1080x1080_1759235784265.webp",background:"https://cdn.openart.ai/assets/internal/uploads/image_ZdKw3VAj_1460x848_1759237403280.webp",hoverPlayVideo:"https://cdn.openart.ai/production/2025-10/uploads/XdOBH7cjWoraFnVomAyP/file_mEyGgdB6_1759675622426.mp4",titleImage:"/assets/home_lyrics_video.svg"}]},57497:function(e,t,i){i.d(t,{q:function(){return A}});var r=i(52676),n=i(75271),o=i(80110),a=i(82639),s=i(56547),l=i(70811),d=i(32964),c=i(10986),u=i(84643);function p(e){let{items:t,titleSx:i,spacing:n}=e;return(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(o.Z,{sx:{color:"#FFFFFF",fontSize:"16px",fontWeight:700,lineHeight:"23px",...i},children:"Generation Detail"}),(0,r.jsx)(l.Z,{direction:"column",spacing:1,sx:{border:"1px solid #2E2E2E",borderRadius:"4px",padding:"12px"},children:t.map((e,i)=>(0,r.jsx)(h,{item:e,isLast:i===t.length-1,spacing:n},e.key))})]})}function h(e){let{item:t,isLast:i,spacing:n}=e;return"column"===t.layout?(0,r.jsxs)(l.Z,{direction:"column",spacing:.5,children:[(0,r.jsxs)(l.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,r.jsx)(l.Z,{alignItems:"center",justifyContent:"center",sx:{width:"16px",height:"16px"},children:t.icon}),(0,r.jsx)(o.Z,{sx:{color:"#AAAAAA",fontSize:"14px",fontWeight:500,lineHeight:"23px"},children:t.label})]}),(0,r.jsx)(l.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",sx:{padding:"5px 0"},children:t.content})]}):(0,r.jsxs)(l.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:void 0===n?3.5:n,sx:{padding:"5px 0"},children:[(0,r.jsxs)(l.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,r.jsx)(l.Z,{alignItems:"center",justifyContent:"center",sx:{width:"16px",height:"16px"},children:t.icon}),(0,r.jsx)(o.Z,{sx:{color:"#AAAAAA",fontSize:"14px",fontWeight:500,lineHeight:"23px"},children:t.label})]}),"string"==typeof t.content?(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"14px",fontWeight:500,lineHeight:"18px",letterSpacing:"-0.28px",textAlign:"center"},children:t.content}):t.content]})}function m(e){if(!e)return"Flux";switch(e.model){case"flux_kontext":return"Flux Kontext";case"fluxdev":return"Flux Dev";case"character":return"Character";case"gpt":return"GPT";case"nano-banana":return"Nano Banana";case"seedream4":return"Seedream 4.0";case"qwen-image":return"Qwen Image";case"imagen4":return"Imagen 4";default:return"Flux"}}function x(e){if(!e)return"Kling";switch(e.model){case"kling":default:return"Kling";case"kling2.1":return"Kling 2.1";case"pixverse4.5":case"pixverse5":return"PixVerse";case"veo2":return"Veo 2";case"veo3_fast":return"Veo3 Fast";case"hedra":return"Hedra";case"wan-i2v":return"Wan 2.1";case"wan-multi-talk":return"OpenArt Lipsync";case"seedance-v1":return"Seedance 1.0";case"MiniMax-Hailuo-02":return"MiniMax Hailuo 02";case"creatify-aurora":return"Creatify Aurora";case"vidu-q2":return"VIDU Q2";case"kling2-5":return"Kling 2.5"}}var g=i(60454),f=i(79446),v=i(27806);let b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return e.length<=t?e:`${e.slice(0,Math.max(0,t))}...`};function y(e){var t,i,h;let{story:y,titleSx:w,spacing:C}=e,j=(0,f.B)(),k=y.category_inputs,F=(0,n.useMemo)(()=>{let e=k.vlog_topic.replaceAll("<<THE_MARKER>>",`@${k.character.name||"Character"}`);return k.additional_characters&&k.additional_characters.length>0&&k.additional_characters.forEach((t,i)=>{e=e.replaceAll((0,g.R4)(i),`@${t.name}`)}),e},[k.vlog_topic,k.character,k.additional_characters]),S=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if("auto"===k.background_music){var t;let i=null===(t=k.background_music_auto_selection)||void 0===t?void 0:t.selectedSong;return i?`Auto: ${e?b(i.name):i.name}`:"Auto"}return e?b(k.background_music):k.background_music};return(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsxs)(l.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,r.jsx)(o.Z,{sx:{color:"#FFFFFF",fontSize:"16px",fontWeight:700,lineHeight:"23px",...w},children:"Story topic"}),(0,r.jsx)(a.Z,{title:"Copy",sx:{},children:(0,r.jsx)(s.Z,{onClick:()=>{j({onAuthenticated:()=>{(0,c.yv)("Story topic copied!",{variant:"success"}),navigator.clipboard.writeText(F)}})},children:(0,r.jsx)(u.TI,{size:20,sx:{cursor:"pointer"}})})})]}),(0,r.jsx)(d.Z,{sx:{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"4px",padding:"8px"},children:(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"14px",fontWeight:500,lineHeight:"20px",wordBreak:"break-word"},children:F})})]}),(0,r.jsx)(p,{titleSx:w,spacing:C,items:[...(null===(t=k.character)||void 0===t?void 0:t.character_image_url)?[{key:"character",label:"Character",icon:(0,r.jsx)(v.PhPersonArmsSpread,{color:"#888",fontSize:16}),layout:"column",content:(0,r.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,r.jsx)(d.Z,{sx:{width:"56px",height:"56px",borderRadius:"5px",overflow:"hidden"},children:(0,r.jsx)("img",{src:k.character.character_image_url,alt:"Character",style:{width:"100%",height:"100%",objectFit:"cover"}})}),k.additional_characters&&k.additional_characters.length>0?(0,r.jsx)(l.Z,{direction:"row",spacing:1,children:k.additional_characters.map((e,t)=>(0,r.jsx)(d.Z,{sx:{width:"56px",height:"56px",borderRadius:"5px",overflow:"hidden"},children:(0,r.jsx)("img",{src:e.character_image_url,alt:"Character",style:{width:"100%",height:"100%",objectFit:"cover"}})},t))}):null]})}]:[],...k.background_music?[{key:"background_music",label:"Background music",icon:(0,r.jsx)(v.PhMusicNote,{color:"#888",fontSize:16}),layout:"row",content:(0,r.jsx)(a.Z,{title:S(!1),children:(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"12px",fontWeight:500},children:S()})})}]:[],...(null===(i=k.advanced_settings)||void 0===i?void 0:i.image_model_config)?[{key:"image_model",label:"Image model",icon:(0,r.jsx)(v.PhImage,{color:"#888",fontSize:16}),layout:"row",content:m(k.advanced_settings.image_model_config)}]:[],...(null===(h=k.advanced_settings)||void 0===h?void 0:h.video_model_config)?[{key:"video_model",label:"Video model",icon:(0,r.jsx)(v.PhVideo,{color:"#888",fontSize:16}),layout:"row",content:x(k.advanced_settings.video_model_config)}]:[]]})]})}var w=i(39204);let C=()=>(0,r.jsx)(w.E.div,{style:{width:"28px",height:"28px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)("img",{src:"https://cdn.openart.ai/assets/storyDetailMusic.png",alt:"Music visualization",style:{width:"100%",height:"100%",objectFit:"contain"}})});function j(e){var t,i,n;let{story:a,titleSx:c,spacing:u}=e,h=(0,f.B)(),g=a.category_inputs,b=g.title?g.title:g.music_url?g.music_url.split("/").at(-1).replace(/\.[^/.]+$/,""):"Unknown Track";return(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(l.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:(0,r.jsx)(o.Z,{sx:{color:"#FFFFFF",fontSize:"16px",fontWeight:700,lineHeight:"23px",...c},children:"Music"})}),(0,r.jsxs)(d.Z,{sx:{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"4px",padding:"8px 12px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px"},children:[(0,r.jsxs)(l.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(C,{}),(0,r.jsx)(d.Z,{sx:{flex:1},children:(0,r.jsx)(o.Z,{sx:{color:"#E0E0E0",fontSize:"11px",fontWeight:500,lineHeight:"14px",letterSpacing:"-0.02em",textAlign:"center",wordBreak:"break-word"},children:b})})]}),(0,r.jsx)(s.Z,{sx:{backgroundColor:"#262626",borderRadius:"4px",padding:"4px"},onClick:()=>h({onAuthenticated:async()=>{if(g.music_url)try{let e=await fetch(g.music_url);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.blob(),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=b||"music",document.body.append(r),r.click(),r.remove(),URL.revokeObjectURL(i)}catch(e){console.error("Download failed:",e),window.open(g.music_url,"_blank")}}}),children:(0,r.jsx)(v.PhDownloadSimple,{color:"#888",fontSize:16})})]})]}),(0,r.jsx)(p,{titleSx:c,spacing:u,items:[...(null===(t=g.character)||void 0===t?void 0:t.character_image_url)?[{key:"character",label:"Character",icon:(0,r.jsx)(v.PhPersonArmsSpread,{color:"#888",fontSize:16}),layout:"column",content:(0,r.jsx)(d.Z,{sx:{width:"56px",height:"56px",borderRadius:"5px",overflow:"hidden"},children:(0,r.jsx)("img",{src:g.character.character_image_url,alt:"Character",style:{width:"100%",height:"100%",objectFit:"cover"}})})}]:[],...g.video_consistent_style?[{key:"video_consistent_style",label:"Style",icon:(0,r.jsx)(v.PhPalette,{color:"#888",fontSize:16}),layout:"row",content:g.video_consistent_style}]:[],...(null===(i=g.advanced_settings)||void 0===i?void 0:i.image_model_config)?[{key:"image_model",label:"Image model",icon:(0,r.jsx)(v.PhImage,{color:"#888",fontSize:16}),layout:"row",content:m(g.advanced_settings.image_model_config)}]:[],...(null===(n=g.advanced_settings)||void 0===n?void 0:n.video_model_config)?[{key:"video_model",label:"Video model",icon:(0,r.jsx)(v.PhVideo,{color:"#888",fontSize:16}),layout:"row",content:x(g.advanced_settings.video_model_config)}]:[]]})]})}var k=i(81241);let F=e=>{let t=k.B8.find(t=>t.key===e);return(null==t?void 0:t.label)||e},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return e.length<=t?e:`${e.slice(0,Math.max(0,t))}...`};function I(e){var t,i;let{story:n,titleSx:s,spacing:d}=e,c=n.category_inputs,u=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if("auto"===c.voiceover_voice){var t;let i=null===(t=c.voiceover_voice_auto_selection)||void 0===t?void 0:t.voiceover;if(i){let t=F(i);return`Auto: ${e?S(t):t}`}return"Auto"}return e?S(c.voiceover_voice):c.voiceover_voice},h=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if("auto"===c.background_music){var t;let i=null===(t=c.background_music_auto_selection)||void 0===t?void 0:t.selectedSong;return i?`Auto: ${e?S(i.name):i.name}`:"Auto"}return e?S(c.background_music):c.background_music};return(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsx)(_,{prompt:c.script_content,title:"Script",titleSx:s}),c.rewrite_script?(0,r.jsx)(_,{prompt:c.rewrite_script,title:"Rewrite Script",titleSx:s}):null,(0,r.jsx)(p,{spacing:d,items:[...c.visual_style?[{key:"visual_style",label:"Style",icon:(0,r.jsx)(v.PhPalette,{color:"#888",fontSize:16}),layout:"row",content:c.visual_style}]:[],...c.voiceover_voice?[{key:"voiceover_voice",label:"Voiceover",icon:(0,r.jsx)(v.PhPersonArmsSpread,{color:"#888",fontSize:16}),layout:"row",content:(0,r.jsx)(a.Z,{title:u(!1),children:(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"12px",fontWeight:500},children:u()})})}]:[],...c.background_music?[{key:"background_music",label:"Background music",icon:(0,r.jsx)(v.PhMusicNote,{color:"#888",fontSize:16}),layout:"row",content:(0,r.jsx)(a.Z,{title:h(!1),children:(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"12px",fontWeight:500},children:h()})})}]:[],...(null===(t=c.advanced_settings)||void 0===t?void 0:t.image_model_config)?[{key:"image_model",label:"Image model",icon:(0,r.jsx)(v.PhImage,{color:"#888",fontSize:16}),layout:"row",content:m(c.advanced_settings.image_model_config)}]:[],...(null===(i=c.advanced_settings)||void 0===i?void 0:i.video_model_config)?[{key:"video_model",label:"Video model",icon:(0,r.jsx)(v.PhVideo,{color:"#888",fontSize:16}),layout:"row",content:x(c.advanced_settings.video_model_config)}]:[]],titleSx:s})]})}let _=e=>{let{prompt:t,title:i,titleSx:p}=e,h=(0,f.B)(),[m,x]=(0,n.useState)(!1),[g,v]=(0,n.useState)(!1),b=(0,n.useRef)(null);return(0,n.useEffect)(()=>{b.current&&v(b.current.scrollHeight>100)},[t]),(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsxs)(l.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,r.jsx)(o.Z,{sx:{color:"#FFFFFF",fontSize:"16px",fontWeight:700,lineHeight:"23px",...p},children:i}),(0,r.jsx)(a.Z,{title:"Copy",sx:{},children:(0,r.jsx)(s.Z,{onClick:()=>{h({onAuthenticated:()=>{(0,c.yv)("Story topic copied!",{variant:"success"}),navigator.clipboard.writeText(t)}})},children:(0,r.jsx)(u.TI,{size:20,sx:{cursor:"pointer"}})})})]}),(0,r.jsxs)(d.Z,{sx:{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"4px",padding:"8px"},children:[(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"14px",fontWeight:500,lineHeight:"20px",wordBreak:"break-word",display:"-webkit-box",WebkitLineClamp:m?"none":5,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},ref:b,children:t}),g?(0,r.jsx)(s.Z,{onClick:()=>x(!m),sx:{marginTop:"8px",padding:"4px 8px",borderRadius:"4px",backgroundColor:"#2E2E2E","&:hover":{backgroundColor:"#3A3A3A"}},children:(0,r.jsx)(o.Z,{sx:{color:"#FFFFFF",fontSize:"12px",fontWeight:500},children:m?"Show less":"Show more"})}):null]})]})};function Z(e){var t,i;let{story:n,titleSx:c,spacing:h}=e,g=n.category_inputs,f=e=>{try{var t,i;(null===(i=window.navigator)||void 0===i?void 0:null===(t=i.clipboard)||void 0===t?void 0:t.writeText)&&window.navigator.clipboard.writeText(e)}catch(e){}},b=(()=>{if("auto"===g.background_music){var e,t;let i=null===(t=g.background_music_auto_selection)||void 0===t?void 0:null===(e=t.selectedSong)||void 0===e?void 0:e.name;return i?`Auto: ${i}`:"Auto"}return g.background_music})();return(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsxs)(l.Z,{direction:"column",spacing:1.5,children:[(0,r.jsxs)(l.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,r.jsx)(o.Z,{sx:{color:"#FFFFFF",fontSize:"16px",fontWeight:700,lineHeight:"23px",...c},children:"ASMR Type"}),g.asmr_type?(0,r.jsx)(a.Z,{title:"Copy",children:(0,r.jsx)(s.Z,{onClick:()=>f(g.asmr_type),children:(0,r.jsx)(u.TI,{size:20,sx:{cursor:"pointer"}})})}):null]}),(0,r.jsx)(d.Z,{sx:{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"4px",padding:"8px"},children:(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"14px",fontWeight:500,lineHeight:"20px",wordBreak:"break-word"},children:g.asmr_type||"Unknown"})})]}),(0,r.jsx)(p,{titleSx:c,spacing:h,items:[...g.script_content?[{key:"script_content",label:"Script",icon:(0,r.jsx)(v.PhArticle,{color:"#888",fontSize:16}),layout:"column",content:(0,r.jsxs)(d.Z,{sx:{backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",borderRadius:"4px",padding:"8px"},children:[(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"12px",fontWeight:500,lineHeight:"18px",whiteSpace:"pre-wrap"},children:g.script_content}),(0,r.jsx)(d.Z,{sx:{display:"flex",justifyContent:"flex-end",mt:1},children:(0,r.jsx)(a.Z,{title:"Copy",children:(0,r.jsx)(s.Z,{onClick:()=>f(g.script_content),children:(0,r.jsx)(u.TI,{size:18,sx:{cursor:"pointer"}})})})})]})}]:[],...g.background_music?[{key:"background_music",label:"Background music",icon:(0,r.jsx)(v.PhMusicNote,{color:"#888",fontSize:16}),layout:"row",content:(0,r.jsx)(a.Z,{title:b,children:(0,r.jsx)(o.Z,{sx:{color:"#888888",fontSize:"12px",fontWeight:500},children:b})})}]:[],...(null===(t=g.advanced_settings)||void 0===t?void 0:t.image_model_config)?[{key:"image_model",label:"Image model",icon:(0,r.jsx)(v.PhImage,{color:"#888",fontSize:16}),layout:"row",content:m(g.advanced_settings.image_model_config)}]:[],...(null===(i=g.advanced_settings)||void 0===i?void 0:i.video_model_config)?[{key:"video_model",label:"Video model",icon:(0,r.jsx)(v.PhVideo,{color:"#888",fontSize:16}),layout:"row",content:x(g.advanced_settings.video_model_config)}]:[]]})]})}function A(e){switch(e){case"character_vlog":return y;case"script_to_video":return I;case"music_video":return j;case"asmr_video":return Z;default:return null}}},55070:function(e,t,i){i.d(t,{e:function(){return d}});var r=i(75271),n=i(10986),o=i(93710),a=i(12186),s=i(2917);let l=async(e,t,i)=>{try{t(!0);let{title:r,activeImageUrls:n,activeVideoUrls:l,activeVoiceOverAudioUrls:d,lipSyncAudioUrls:c,musicUrls:u,backgroundMusicUrls:p}=await (0,o.bA)(e),h=[...n,...l,...d,...c,...u,...p].length,m=0,x=e=>{m++,null==i||i(Math.floor(m/h*90))},g=(e,t,i)=>`${({activeImage:"images",activeVideo:"videos",activeVoiceOverAudio:"audios",music:"music",backgroundMusic:"music",lipSyncAudio:"audios"})[e]}/${({activeImage:"image",activeVideo:"video",activeVoiceOverAudio:"voiceover",music:"music",backgroundMusic:"background_music",lipSyncAudio:"lip_sync"})[e]}_${t}.${i}`,f=async function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:15,o=arguments.length>5?arguments[5]:void 0,s=[],l={activeImage:"jpg"},d={activeImage:"jpg"};for(let c=0;c<i.length;c+=n){let u=i.slice(c,c+n),p=await Promise.allSettled(u.map(async i=>{try{let n=a.EH[l[r]]||a.GN,[s]=await n(i.url,!1),[,c]=(0,a.Js)(i.url),u=String(i.index+1).padStart(3,"0"),p=g(r,u,d[r]||c);return await e.add(`${t}/${p}`,s),null==o||o(i),!0}catch(e){return console.error(`Failed to download: ${i.url}`,e),!1}}));s.push(...p)}return s},v=async(e,t,i,r,n)=>{let o=await f(e,t,i,r,15,n),a=o.filter(e=>"fulfilled"===e.status&&!e.value).length;if(a>0){let e=`${r} files`;throw Error(`${a} ${e} failed to download`)}return o},b=async(e,t,i,r,n)=>{0!==i.length&&await v(e,t,i,r,n)},y=new s.s;await b(y,r,n,"activeImage",x),await b(y,r,l,"activeVideo",x),await b(y,r,d,"activeVoiceOverAudio",x),await b(y,r,c,"lipSyncAudio",x),await b(y,r,u,"music",x),await b(y,r,p,"backgroundMusic",x),null==i||i(90),await y.save(`${r||"OpenArt story"}.zip`,{processCallback:e=>{null==i||i(Math.floor(90+e/100*10))}}),null==i||i(100)}catch(e){console.error("Download all assets failed:",e),(0,n.yv)("Failed to download all assets",{variant:"error"})}finally{setTimeout(()=>t(!1),500)}};function d(e){let[t,i]=(0,r.useState)(!1),[n,o]=(0,r.useState)(0);return[t,(0,r.useCallback)(async()=>{e&&(o(0),await l(e,i,o))},[e,i]),n]}},57713:function(e,t,i){i.d(t,{s:function(){return a}});var r=i(66266),n=i(8765),o=i(38262);let a=()=>{let{showModal:e}=(0,n.dd)(),t=(0,r.useRouter)();return{showMusicVideoEntry:()=>{window.history.replaceState({},"","/music-video"),e(o.B,{onClose:()=>{},closeCallback:()=>{let e=t.asPath;return window.history.replaceState({},"",e),Promise.resolve()}})}}}},92204:function(e,t,i){i.d(t,{IP:function(){return d},YS:function(){return c}});var r=i(67197),n=i(2345),o=i(52973),a=i(47469),s=i(57170);let l={currentStep:"form",generationStatus:{isGeneratingScript:!1,isGeneratingShots:!1,isExporting:!1},formData:{title:"",oneSentenceStory:"",numShots:5,customSystemPrompt:"",selectedCharacter:null,mode:"vlog"},storyScript:null,shots:[],exportOptions:{global_speed_multiplier:1}},d=(0,n.U)()((0,o.mW)((0,o.tJ)((0,a.n)((e,t)=>({...l,setCurrentStep:t=>e(e=>{e.currentStep=t}),updateFormData:t=>e(e=>{Object.assign(e.formData,t)}),updateGenerationStatus:(t,i)=>{switch(t){case"script":e(e=>{if(void 0!==i.loading&&(e.generationStatus.isGeneratingScript=i.loading),void 0!==i.error&&(e.generationStatus.scriptGenerationError=i.error),i.data){let t=i.data.script.shots.map(e=>({id:(e.id||(0,r.x0)()).toString(),prompt:e.imagePrompt,script:e.voiceoverScript||e.shot_description,imageStatus:"idle",videoStatus:"idle"}));e.storyScript={fullText:i.data.script.fullText||"",title:i.data.script.title||"My Story"},e.shots=t,e.currentStep="script"}});break;case"shot":{let{id:t,type:r,status:n,url:o}=i;e(e=>{let i=e.shots.findIndex(e=>e.id===t);-1!==i&&(e.shots[i]["image"===r?"imageStatus":"videoStatus"]=n,o&&(e.shots[i]["image"===r?"generatedImageUrl":"generatedVideoUrl"]=o)),"video"===r&&"success"===n&&o&&e.shots.every(e=>"success"===e.videoStatus&&e.generatedVideoUrl)&&(e.currentStep="preview")});break}case"export":e(e=>{void 0!==i.loading&&(e.generationStatus.isExporting=i.loading),void 0!==i.error&&(e.generationStatus.exportError=i.error),void 0!==i.progress&&(e.generationStatus.exportProgress=i.progress),void 0!==i.exportedVideoUrl&&(e.exportedVideo={url:i.exportedVideoUrl,createdAt:new Date})})}},updateStoryScript:t=>e(e=>{e.storyScript?Object.assign(e.storyScript,t):e.storyScript=t}),updateShot:(t,i)=>e(e=>{let r=e.shots.findIndex(e=>e.id===t);-1!==r&&Object.assign(e.shots[r],i)}),updateShots:t=>e(e=>{e.shots=t}),addShot:t=>e(e=>{e.shots.push(t)}),removeShot:t=>e(e=>{e.shots=e.shots.filter(e=>e.id!==t)}),updateExportOptions:t=>e(e=>{Object.assign(e.exportOptions,t)}),updateExportedVideo:t=>e(e=>{e.exportedVideo?Object.assign(e.exportedVideo,t):e.exportedVideo=t}),resetStore:()=>e(()=>l)})),{name:"story-creation-storage",partialize:e=>({formData:e.formData,storyScript:e.storyScript,shots:e.shots,exportOptions:e.exportOptions,exportedVideo:e.exportedVideo})}),{name:"story-creation-store"})),c=(0,s.N)(d)},80749:function(e,t,i){i.d(t,{E:function(){return r}});let r=(0,i(2345).U)((e,t)=>({prefill:{},setPrefill:(t,i)=>e(e=>({prefill:{...e.prefill,[t]:i}})),getPrefill:e=>t().prefill[e],consumePrefill:e=>t().prefill[e],clearPrefill:t=>e(e=>{if(!t)return{prefill:{}};let i={...e.prefill};return i[t]=null,{prefill:i}})}))},92971:function(e,t,i){i.d(t,{_:function(){return p}});var r=i(52676),n=i(75271),o=i(82639),a=i(32964),s=i(8765),l=i(31573),d=i(27806),c=i(12186);let u={padding:"6px",borderRadius:"6px",border:"1px solid rgba(255, 255, 255, 0.14)",background:"rgba(0, 0, 0, 0.20)",backdropFilter:"blur(4.5px)",cursor:"pointer","&:hover":{borderColor:"var(--Blue-400)"}};function p(e){let{url:t,visible:i=!1,onEdit:p,onDelete:h,onEditWithPalette:m,onStyleApply:x,onStyleApplyToAll:g,applyAllLoading:f=!1,onDownload:v}=e,{showModal:b}=(0,s.dd)(),[y,w]=(0,n.useState)(!1),C=!!(m||x||g),j=!!p,k=!!h;if(!C&&!j&&!k)return null;let F=e=>{b(l.K,{anchorEl:e,onApply:(e,t)=>{t?null==g||g(e):null==x||x(e)},applyAllLoading:f,onClose:()=>{w(!1)}}),w(!0)},S=e=>{C&&!1!==(null==m?void 0:m())&&F(e)},I=async e=>{if(e.stopPropagation(),t)try{await (0,c.GN)(t,!0)}catch(e){console.error("Failed to download media asset",e)}null==v||v()};return(0,r.jsxs)(a.Z,{sx:{position:"absolute",top:"10px",right:"10px",display:"flex",gap:1,opacity:i||y?1:0,transform:i||y?"translateY(0)":"translateY(-4px)",pointerEvents:i||y?"auto":"none",transition:"opacity 0.2s ease, transform 0.2s ease"},children:[C?(0,r.jsx)(o.Z,{title:"Stylize",children:(0,r.jsx)(a.Z,{sx:{...u,background:y?"rgba(19, 83, 255, 0.20)":"rgba(0, 0, 0, 0.20)"},role:"button",tabIndex:i||y?0:-1,"aria-label":"Edit with palette","aria-pressed":y,onClick:e=>{e.stopPropagation(),S(e.currentTarget)},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation(),S(e.currentTarget))},children:(0,r.jsx)(d.PhPaintBrush,{size:16})})}):null,j?(0,r.jsx)(o.Z,{title:"Edit Image",children:(0,r.jsx)(a.Z,{sx:{...u},role:"button",tabIndex:i||y?0:-1,"aria-label":"Edit in Chat to Edit",onClick:e=>{e.stopPropagation(),null==p||p()},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation(),null==p||p())},children:(0,r.jsx)(d.StreamlineAiEditSpark,{size:16})})}):null,(0,r.jsx)(o.Z,{title:"Download",children:(0,r.jsx)(a.Z,{sx:{...u},role:"button",tabIndex:i?0:-1,"aria-label":"Download",onClick:e=>{e.stopPropagation(),I(e)},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation(),I(e))},children:(0,r.jsx)(d.PhDownloadSimple,{size:16})})}),k?(0,r.jsx)(o.Z,{title:"Delete",children:(0,r.jsx)(a.Z,{sx:{...u},role:"button",tabIndex:i?0:-1,"aria-label":"Delete image",onClick:e=>{e.stopPropagation(),null==h||h()},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation(),null==h||h())},children:(0,r.jsx)(d.PhTrash,{size:16})})}):null]})}},95826:function(e,t,i){i.d(t,{d:function(){return u}});var r=i(52676),n=i(75271),o=i(77379),a=i(29984),s=i(22988),l=i(80110),d=i(60588),c=i(27806);let u=e=>{var t;let{show:i=!1,onRegenerateVoice:u,onRegenerateShot:p,isRegeneratingVoice:h=!1,isRegeneratingShot:m=!1,disabled:x=!1,voiceoverCredits:g=5,allContentCredits:f=0,onMenuOpenChange:v}=e,[b,y]=(0,n.useState)("voiceover"),[w,C]=(0,n.useState)(null),j=(0,n.useRef)(null),k=h||m,F=()=>{C(null),null==v||v(!1)},S=e=>{y(e),F()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Z,{ref:j,onClick:()=>{"voiceover"===b?u():p()},disabled:x||k,sx:{backgroundColor:i?"var(--Blue-500)":"var(--Gray-300)",color:"var(--Gray-900)",borderRadius:"4px",height:"28px",px:"8px",py:"5px",fontFamily:"Inter",fontWeight:600,fontSize:"12px",lineHeight:"normal",textTransform:"none",gap:"4px",transition:"all 0.2s ease","&:hover":{backgroundColor:i?"var(--Blue-400)":"var(--Gray-300)"},"&.Mui-disabled":{backgroundColor:"var(--Gray-300)",color:"var(--Gray-600)"}},children:[k?(0,r.jsx)(a.Z,{size:12,sx:{color:"var(--Gray-900)"}}):null,(0,r.jsxs)("span",{children:["Retry ","voiceover"===b?"Voiceover":"All Assets"]}),(0,r.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",gap:"0px"},children:[(0,r.jsx)(c.PhCurrencyEth,{size:10}),(0,r.jsx)(l.Z,{sx:{ml:.5,fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:1.8,letterSpacing:"-0.02em"},children:"voiceover"===b?g:f})]}),(0,r.jsx)(s.Z,{component:"span",onClick:e=>{e.stopPropagation(),C(j.current),null==v||v(!0)},sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px",padding:"6px 5px",cursor:"pointer","&:hover":{opacity:.8}},children:(0,r.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M2.25 4.5L6 8.25L9.75 4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,r.jsxs)(d.ZP,{anchorEl:w,open:!!w,onClose:F,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{backgroundColor:"var(--Gray-50)",border:"1px solid var(--Gray-100)",borderRadius:"6px",padding:"8px",minWidth:(null===(t=j.current)||void 0===t?void 0:t.offsetWidth)||"auto",display:"flex",flexDirection:"column",gap:"4px"}}},children:[(0,r.jsx)(s.Z,{onClick:()=>S("voiceover"),sx:{height:"36px",padding:"6px 8px",borderRadius:"6px",fontFamily:"Inter",fontWeight:500,fontSize:"14px",lineHeight:"24px",cursor:"pointer",display:"flex",alignItems:"center",backgroundColor:"voiceover"===b?"color-mix(in srgb, var(--Gray-700) 16%, transparent)":"transparent","&:hover":{backgroundColor:"voiceover"===b?"color-mix(in srgb, var(--Gray-700) 16%, transparent) !important":"color-mix(in srgb, var(--Gray-700) 8%, transparent) !important"}},children:"Regenerate Voiceover"}),(0,r.jsx)(s.Z,{onClick:()=>S("all-content"),sx:{height:"36px",padding:"6px 8px",borderRadius:"6px",fontFamily:"Inter",fontWeight:500,fontSize:"14px",lineHeight:"24px",cursor:"pointer",display:"flex",alignItems:"center",backgroundColor:"all-content"===b?"color-mix(in srgb, var(--Gray-700) 16%, transparent)":"transparent","&:hover":{backgroundColor:"all-content"===b?"color-mix(in srgb, var(--Gray-700) 16%, transparent) !important":"color-mix(in srgb, var(--Gray-700) 8%, transparent) !important"}},children:"Regenerate All Assets"})]})]})}},31573:function(e,t,i){i.d(t,{K:function(){return f}});var r=i(52676),n=i(75271),o=i(60588),a=i(80110),s=i(45138),l=i(22988),d=i(43517),c=i(53152),u=i(77379),p=i(39204),h=i(3473),m=i(79855),x=i(27806);let g=[{id:"custom",label:"Custom",imageUrl:""},{id:"photorealistic",label:"Photorealistic",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_2LaKhlw0_184x184_1762434585425.webp"},{id:"cinematic",label:"Cinematic",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_E_WkMVBo_184x184_1762414358618.webp"},{id:"storyboard",label:"Storyboard",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_zyAm5FJl_184x184_1762414259562.webp"},{id:"vintage",label:"Vintage",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_neEoRiiS_184x184_1762414259568.webp"},{id:"low_key",label:"Low Key",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_RFznVr_C_184x184_1762414259594.webp"},{id:"indie",label:"Indie",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_f5M1oADl_184x184_1762414259531.webp"},{id:"y2k",label:"Y2K",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_-DA33o9q_184x184_1762414259577.webp"},{id:"comic",label:"Comic",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_4c6qbjIr_184x184_1762414259603.webp"},{id:"animation",label:"Animation",imageUrl:"https://cdn.openart.ai/assets/1000012743.webp"},{id:"microworld",label:"Microworld",imageUrl:"https://cdn.openart.ai/assets/internal/uploads/image_U1svahuc_1024x1024_1753339280304.webp"},{id:"crayon",label:"Crayon",imageUrl:"https://cdn.openart.ai/assets/openart-video_c0ad5287_1750598479630.webp"},{id:"pixelart",label:"Pixel Art",imageUrl:"https://cdn.openart.ai/assets/1000012558-1.webp"},{id:"ghibli",label:"Ghibli-style",imageUrl:"https://cdn.openart.ai/assets/1000012739.webp"},{id:"cyberpunk",label:"Cyberpunk",imageUrl:"https://cdn.openart.ai/assets/1000012558-2.webp"}];function f(e){let{open:t,onClose:i,onApply:p,anchorEl:f,anchorOrigin:b,transformOrigin:y,applyAllLoading:w=!1,forceApplyToAll:C=!1}=e,j=!!t,k=i??(()=>{}),F=(0,m.A)({hasImageUrl:!0}),[S,I]=(0,n.useState)("photorealistic"),[_,Z]=(0,n.useState)(""),[A,E]=(0,n.useState)(!1);(0,n.useEffect)(()=>{I("photorealistic"),j&&!C&&E(!1)},[C,j]);let M=e=>{I(e)},T=F.length,R=!!C||A,D=15*(T||0),z=R?D:15;return(0,r.jsxs)(o.ZP,{open:j,anchorEl:f,onClose:k,anchorOrigin:{vertical:(null==b?void 0:b.vertical)??"bottom",horizontal:(null==b?void 0:b.horizontal)??"right"},transformOrigin:{vertical:(null==y?void 0:y.vertical)??"top",horizontal:(null==y?void 0:y.horizontal)??"right"},TransitionProps:{timeout:250},slotProps:{paper:{sx:{backgroundColor:"var(--Gray-50)",borderRadius:"12px",border:"1px solid var(--Gray-200)",width:"416px",padding:"12px",boxShadow:"0px 4px 24px rgba(0, 0, 0, 0.4)",display:"flex",flexDirection:"column",gap:"12px",mt:1,overflow:"visible"}}},children:[(0,r.jsx)(a.Z,{sx:{color:"var(--Gray-500)",fontSize:"14px",fontWeight:600,fontFamily:"Inter",letterSpacing:"-0.28px"},children:"Style"}),"custom"===S?(0,r.jsx)(s.Z,{fullWidth:!0,multiline:!0,minRows:1,maxRows:6,placeholder:"Describe the style",value:_,onChange:e=>Z(e.target.value),variant:"outlined",disabled:"custom"!==S,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"var(--Gray-100)",borderRadius:"8px",fontSize:"14px",fontWeight:500,fontFamily:"Inter",color:"var(--Gray-700)",padding:0,"& fieldset":{borderColor:"var(--Gray-200)"},"&:hover fieldset":{borderColor:"var(--Gray-400)"},"&.Mui-focused fieldset":{borderColor:"var(--Blue-500)",borderWidth:"1px"},"&.Mui-disabled":{backgroundColor:"var(--Gray-100)","& fieldset":{borderColor:"var(--Gray-200)"}}},"& .MuiOutlinedInput-input":{padding:"12px","&::placeholder":{color:"var(--Gray-400)",opacity:1}}},inputProps:{"aria-label":"Custom style description"}}):null,(0,r.jsx)(l.Z,{sx:{position:"relative","&:after":{content:'""',position:"absolute",left:0,right:0,bottom:0,height:"32px",pointerEvents:"none",background:"linear-gradient(to bottom, transparent 0%, var(--Gray-50) 80%)",zIndex:1}},children:(0,r.jsx)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:"8px",height:"240px",overflowY:"auto",paddingBottom:"24px",marginLeft:"-12px",marginRight:"-12px",marginTop:"-12px",px:"12px",paddingTop:"12px"},children:(0,h.Z)(g,4).map(e=>{let t=e.map(e=>e.id).join("-");return(0,r.jsx)(l.Z,{sx:{display:"flex",gap:"8px"},children:e.map(e=>(0,r.jsx)(v,{option:e,isSelected:S===e.id,onSelect:()=>M(e.id)},e.id))},t)})})}),C?null:(0,r.jsx)(d.Z,{control:(0,r.jsx)(c.Z,{checked:A,onChange:e=>E(e.target.checked),sx:{color:"var(--Gray-400)","&.Mui-checked":{color:"var(--Blue-500)"}}}),label:(0,r.jsx)(a.Z,{sx:{color:"var(--Gray-600)",fontSize:"13px",fontWeight:500},children:"Apply to all images"}),sx:{ml:0,alignSelf:"flex-start"}}),(0,r.jsxs)(l.Z,{sx:{display:"flex",gap:"14px"},children:[(0,r.jsx)(u.Z,{variant:"outlined",onClick:k,sx:{flex:1,height:"36px",borderRadius:"6px",borderColor:"var(--Gray-300)",color:"var(--Gray-700)",fontSize:"14px",fontWeight:600,fontFamily:"Inter",textTransform:"none","&:hover":{borderColor:"var(--Gray-400)",backgroundColor:"transparent"}},children:"Cancel"}),(0,r.jsxs)(u.Z,{variant:"contained",onClick:()=>{let e="custom"===S&&_.trim()||S;null==p||p(e,R),k()},sx:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,height:"36px",borderRadius:"6px",backgroundColor:"var(--Blue-500)",color:"var(--Gray-900)",fontSize:C?"12px":"14px",fontWeight:700,fontFamily:"Inter",textTransform:"none",boxShadow:"none","&:hover":{backgroundColor:"var(--Blue-600)",boxShadow:"none"},"&.Mui-disabled":{cursor:"not-allowed",backgroundColor:"color-mix(in srgb, var(--Blue-500) 60%, transparent)",color:"color-mix(in srgb, var(--Gray-900) 80%, transparent)"},gap:"4px"},disabled:0===T||!!(R&&w),children:[w?"Applying...":C?"Apply to All images":"Apply",(0,r.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(x.PhCurrencyEth,{size:12}),(0,r.jsxs)(a.Z,{sx:{ml:.5,fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:1.8,letterSpacing:"-0.02em"},children:[" ",C?D:R?`15 x ${T} = ${D}`:z]})]})]})]})]})}function v(e){let{option:t,isSelected:i,onSelect:o}=e,[s,d]=(0,n.useState)(!1),c="custom"===t.id;return(0,r.jsxs)(l.Z,{component:p.E.div,whileHover:{scale:1.05},whileTap:{scale:.98},onClick:o,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),sx:{position:"relative",width:"92px",height:"92px",borderRadius:"5.75px",overflow:"hidden",cursor:"pointer",border:i?"2px solid var(--Blue-700)":"none",transition:"border 0.2s ease"},children:[(0,r.jsx)(l.Z,{sx:{position:"absolute",inset:0,backgroundColor:c?"var(--Gray-200)":"var(--Gray-400)",background:!c&&t.imageUrl?`url(${t.imageUrl}) center/cover`:c?"var(--Gray-200)":"linear-gradient(135deg, var(--Gray-300) 0%, var(--Gray-400) 50%, var(--Gray-300) 100%)",borderRadius:"3.473px",display:"flex",alignItems:"center",justifyContent:"center"},children:c?(0,r.jsx)(l.Z,{sx:{borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:(0,r.jsx)(x.PhPencilSimpleLine,{size:30,color:"var(--Gray-600)"})}):null}),!c&&(0,r.jsx)(l.Z,{sx:{position:"absolute",left:"50%",top:"47.92px",transform:"translateX(-50%)",width:"92px",height:"44.083px",background:"linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, #030303 100%)",pointerEvents:"none"}}),(0,r.jsx)(a.Z,{component:p.E.div,animate:{color:c?s||i?"var(--Gray-700)":"var(--Gray-600)":s||i?"var(--Gray-900)":"var(--Gray-700)"},transition:{duration:.2},sx:{position:"absolute",left:"50%",top:c?"70%":"78.46px",transform:"translate(-50%, -50%)",fontSize:"12px",fontWeight:600,fontFamily:"Inter",textAlign:"center",lineHeight:1.6,width:"83.578px",pointerEvents:"none"},children:t.label})]})}},17727:function(e,t,i){i.d(t,{Y:function(){return S}});var r=i(52676),n=i(75271),o=i(90145),a=i(65543),s=i(23156),l=i(97792),d=i(11955),c=i(80110),u=i(6721),p=i(72660),h=i(56407),m=i(22988),x=i(24181),g=i(89187),f=i(60465),v=i(91022);let b=(0,i(2345).U)((e,t)=>({currentPlayingId:null,currentAudioRef:null,setPlaying:(i,r)=>{let n=t();n.currentAudioRef&&n.currentPlayingId!==i&&(n.currentAudioRef.pause(),n.currentAudioRef.currentTime=0,n.currentAudioRef=null),e({currentPlayingId:i,currentAudioRef:r})},stop:i=>{let r=t();r.currentPlayingId===i&&(r.currentAudioRef&&(r.currentAudioRef.pause(),r.currentAudioRef.currentTime=0),e({currentPlayingId:null,currentAudioRef:null}))},stopAll:()=>{let i=t();i.currentAudioRef&&(i.currentAudioRef.pause(),i.currentAudioRef.currentTime=0),e({currentPlayingId:null,currentAudioRef:null})}})),y=(e,t)=>{let i=(0,n.useRef)(null),{currentPlayingId:r,setPlaying:o,stop:a}=b(),s=r===e;return(0,n.useEffect)(()=>()=>{i.current&&(i.current.pause(),i.current.currentTime=0,i.current=null),a(e)},[e,a]),(0,n.useEffect)(()=>{i.current&&(i.current.pause(),i.current.currentTime=0,i.current=null,a(e))},[t,e,a]),{isPlaying:s,handlePlayPause:()=>{if(!t)return;if(s&&i.current){i.current.pause(),i.current.currentTime=0,a(e);return}if(i.current&&!s){i.current.play(),o(e,i.current);return}let r=new Audio(t);i.current=r,r.addEventListener("ended",()=>{r.currentTime=0,a(e),i.current=null}),r.addEventListener("error",()=>{console.error("Failed to play audio"),r.currentTime=0,a(e),i.current=null}),r.play().then(()=>{o(e,r)}).catch(t=>{console.error("Error playing audio:",t),r&&(r.currentTime=0),a(e),i.current=null})}}},w=(0,n.memo)(e=>{let{audioUrl:t,size:i=32}=e,{isPlaying:o,handlePlayPause:a}=y((0,n.useMemo)(()=>t||"",[t]),t),s=(0,n.useCallback)(e=>{e.stopPropagation(),a()},[a]);if(!t)return null;let l=.5*i;return(0,r.jsx)(u.Z,{onClick:s,sx:{width:`${i}px`,height:`${i}px`,flexShrink:0,borderRadius:"50%",backgroundColor:o?"rgba(1, 63, 254, 0.15)":"#252525",border:o?"1px solid #013FFE":"1px solid transparent",color:o?"#013FFE":"#AAAAAA",transition:"all 0.2s ease","&:hover":{backgroundColor:o?"rgba(1, 63, 254, 0.2)":"rgba(170, 170, 170, 0.1)",color:"#013FFE"}},children:o?(0,r.jsx)(f.Z,{sx:{fontSize:`${l}px`}}):(0,r.jsx)(v.Z,{sx:{fontSize:`${l}px`}})})});w.displayName="AudioPlayButton";var C=i(1188),j=i(78359),k=i(73676),F=i(27806);let S=(0,n.memo)(e=>{let{open:t,onClose:i,shotId:f,genHistory:v,activeAudioId:b,onSelect:y,isLoading:S=!1}=e,I=(0,C.jU)(e=>{var t;return null===(t=e.story)||void 0===t?void 0:t.id}),{removeMediaAsset:_}=(0,k.PJ)(I),Z=(0,j.fH)(e=>e.setShotVoiceoverGenHistory),A=(0,n.useMemo)(()=>[1,2,3],[]),E=(0,n.useCallback)(e=>{"completed"===e.generationStatus&&y(e)},[y]),M=(0,n.useCallback)((e,t)=>{t.stopPropagation(),Z(f,v.filter(t=>t.resource.id!==e)),_(e)},[v,Z,f,_]);return(0,r.jsxs)(l.Z,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"#1C1D1E",backgroundImage:"none",borderRadius:"12px",border:"1px solid #2E2E2E"}},children:[(0,r.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,py:2,borderBottom:"1px solid #2E2E2E"},children:[(0,r.jsx)(c.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontSize:"16px",fontWeight:700},children:"Voice History"}),(0,r.jsx)(u.Z,{onClick:i,sx:{color:"#888","&:hover":{color:"#CCCCCC",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:(0,r.jsx)(o.Z,{fontSize:"small"})})]}),(0,r.jsx)(p.Z,{sx:{p:"24px !important",maxHeight:"600px",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"#444444",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{background:"#555555"}},children:(0,r.jsx)(h.Z,{spacing:"12px",children:S?A.map(e=>(0,r.jsx)(m.Z,{sx:{padding:"16px",borderRadius:"8px",backgroundColor:"#1A1A1A",border:"1px solid #2E2E2E",position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.03), transparent)",animation:"shimmer 2s infinite"},"@keyframes shimmer":{"0%":{left:"-100%"},"100%":{left:"100%"}}},children:(0,r.jsxs)(h.Z,{direction:"row",alignItems:"center",spacing:"16px",children:[(0,r.jsxs)(m.Z,{sx:{position:"relative",width:48,height:48,flexShrink:0},children:[(0,r.jsx)(x.Z,{variant:"circular",width:48,height:48,sx:{bgcolor:"#252525",position:"absolute"}}),(0,r.jsx)(m.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:16,height:16,borderRadius:"50%",bgcolor:"#1A1A1A",opacity:.5}})]}),(0,r.jsxs)(h.Z,{spacing:"8px",sx:{flex:1,minWidth:0},children:[(0,r.jsxs)(h.Z,{direction:"row",alignItems:"center",spacing:"8px",children:[(0,r.jsx)(x.Z,{variant:"rectangular",width:70,height:18,sx:{bgcolor:"#252525",borderRadius:"4px"}}),(0,r.jsx)(x.Z,{variant:"rectangular",width:80,height:20,sx:{bgcolor:"rgba(170, 170, 170, 0.1)",borderRadius:"4px"}})]}),(0,r.jsxs)(h.Z,{spacing:"6px",children:[(0,r.jsx)(x.Z,{variant:"rectangular",width:"95%",height:12,sx:{bgcolor:"#252525",borderRadius:"3px"}}),(0,r.jsx)(x.Z,{variant:"rectangular",width:"75%",height:12,sx:{bgcolor:"#252525",borderRadius:"3px"}})]})]}),(0,r.jsx)(m.Z,{sx:{flexShrink:0,width:28,display:"flex",justifyContent:"center"},children:(0,r.jsx)(x.Z,{variant:"circular",width:28,height:28,sx:{bgcolor:"#252525"}})})]})},e)):v.map((e,t)=>{let i=e.resource.id===b;return(0,r.jsx)(m.Z,{onClick:()=>E(e),sx:{position:"relative",padding:"16px",borderRadius:"8px",backgroundColor:i?"rgba(1, 63, 254, 0.08)":"#1A1A1A",border:i?"1px solid #013FFE":"1px solid #2E2E2E",cursor:"completed"===e.generationStatus?"pointer":"default",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{backgroundColor:"completed"===e.generationStatus?i?"rgba(1, 63, 254, 0.12)":"#222222":void 0,transform:"completed"===e.generationStatus?"translateY(-1px)":void 0,boxShadow:"completed"===e.generationStatus?i?"0 4px 12px rgba(1, 63, 254, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.3)":void 0},...i&&{boxShadow:"0 2px 8px rgba(1, 63, 254, 0.15)"}},children:(0,r.jsxs)(h.Z,{direction:"row",alignItems:"center",spacing:"16px",children:["generating"===e.generationStatus?(0,r.jsx)(m.Z,{sx:{width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"#252525",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(g.p6,{logoSize:28})}):"failed"===e.generationStatus?(0,r.jsx)(m.Z,{sx:{width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"#252525",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(a.Z,{sx:{color:"#fa4d56",fontSize:"26px"}})}):(0,r.jsx)(w,{audioUrl:e.resource.url,size:48}),(0,r.jsxs)(h.Z,{spacing:"6px",sx:{flex:1,minWidth:0},children:[(0,r.jsxs)(h.Z,{direction:"row",alignItems:"center",spacing:"8px",children:[(0,r.jsxs)(c.Z,{sx:{color:i?"#FFFFFF":"#CCCCCC",fontFamily:"Inter",fontSize:"14px",fontWeight:600,lineHeight:1.2},children:["Voice ",v.length-t]}),"generating"===e.generationStatus?(0,r.jsx)(m.Z,{sx:{px:"8px",py:"3px",borderRadius:"4px",backgroundColor:"rgba(170, 170, 170, 0.15)"},children:(0,r.jsx)(c.Z,{sx:{color:"#AAAAAA",fontSize:"10px",fontWeight:600,lineHeight:1},children:"GENERATING"})}):"failed"===e.generationStatus?(0,r.jsx)(m.Z,{sx:{px:"8px",py:"3px",borderRadius:"4px",backgroundColor:"rgba(250, 77, 86, 0.15)"},children:(0,r.jsx)(c.Z,{sx:{color:"#fa4d56",fontSize:"10px",fontWeight:600,lineHeight:1},children:"FAILED"})}):null]}),(0,r.jsx)(c.Z,{sx:{color:"#888888",fontFamily:"Inter",fontSize:"12px",fontWeight:400,lineHeight:1.5,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:e.resource.prompt||"Voice over"})]}),(0,r.jsx)(m.Z,{sx:{flexShrink:0,width:"28px",display:"flex",justifyContent:"center"},children:i?(0,r.jsx)(m.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"50%",backgroundColor:"#013FFE"},children:(0,r.jsx)(s.Z,{sx:{color:"#FFFFFF",fontSize:"18px"}})}):"failed"===e.generationStatus?(0,r.jsx)(u.Z,{size:"small",onClick:t=>M(e.resource.id,t),sx:{width:"28px",height:"28px",padding:0,color:"#fa4d56","&:hover":{backgroundColor:"rgba(250, 77, 86, 0.1)"}},children:(0,r.jsx)(F.PhX,{size:16})}):null})]})},e.resource.id)})})})]})});S.displayName="VoiceHistoryModal"},52954:function(e,t,i){i.d(t,{e:function(){return r}});let r=(e,t)=>{let i=(e||"").trim(),r=new Set,n=[];return((t||[]).forEach(e=>{let t=(e||"").trim();!t||r.has(t)||(r.add(t),n.push(t))}),i)?[i,...n.filter(e=>e!==i)]:n}},45040:function(e,t,i){i.d(t,{U:function(){return o}});var r=i(78359),n=i(13605);let o=()=>{let e=(0,n.Xt)(),t=null==e?void 0:e["custom-credit-cost"];return{generationCreditsImage:(0,r.fH)(e=>e.calculateGenerationCredits("image",t)),generationCreditsVideo:(0,r.fH)(e=>e.calculateGenerationCredits("video",t))}}},67030:function(e,t,i){i.d(t,{S:function(){return n}});var r=i(75271);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{rootMargin:t="50px",threshold:i=.1,freezeOnceVisible:n=!1}=e,[o,a]=(0,r.useState)(!1),[s,l]=(0,r.useState)(!1),d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let e=d.current;if(!e)return;if(n&&s){a(!0);return}let r=new IntersectionObserver(e=>{let[t]=e,i=t.isIntersecting;a(i),i&&!s&&l(!0)},{rootMargin:t,threshold:i});return r.observe(e),()=>{r.unobserve(e)}},[t,i,n,s]),{targetRef:d,isIntersecting:o,wasEverVisible:s,shouldLoad:n?s:o}}},79334:function(e,t,i){i.d(t,{Bx:function(){return c},EL:function(){return u},cU:function(){return p}});var r=i(13200),n=i(75616),o=i(21964),a=i(10986);i(66627);var s=i(47462),l=i(46973),d=i(6139);let c=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{enqueueSnackbar:n}=(0,a.Ds)(),{enabled:o=!0}=i;return(0,r.a)({queryKey:s.PL.media(e||"",t||""),queryFn:async()=>e&&t&&(await l.ZP.get(`stories/${e}/shots/${t}`)).data.media_resources||{images:[],videos:[],audio:[]},enabled:!!e&&!!t&&o,staleTime:1/0,refetchOnMount:!1,refetchOnReconnect:!1,refetchOnWindowFocus:!1,keepPreviousData:!0,onError:e=>{console.error("Error loading shot media:",e),n(`Error: ${e.message}`,{variant:"error"})}})},u=e=>{let t=(0,n.NL)(),{enqueueSnackbar:i}=(0,a.Ds)();return(0,o.D)({mutationFn:async t=>{let{shotId:i,mediaTypesArray:r,imagePrompt:n="",videoPrompt:o="",voiceOver:a="",advancedSettings:s,end_frame_image_url:d,reference_image_urls:c,style:u}=t;if(!e)throw Error("No story ID provided");let p={media_types:r};return n&&(p.image_prompt=n),o&&(p.video_prompt=o),a&&(p.voice_over=a),s&&(p.advanced_settings=s),d&&(p.end_frame_image_url=d),Array.isArray(c)&&(p.reference_image_urls=c),u&&(p.style=u),(await l.ZP.post(`stories/workflow/regenerate_shot?storyId=${e}&shotId=${i}`,p)).data},onSuccess:(e,i)=>{t.invalidateQueries({queryKey:[d.O]})},onError:e=>{console.error("Error regenerating shot media:",e),i(`Error: ${e.message}`,{variant:"error"})}})},p=e=>{let t=(0,n.NL)(),{enqueueSnackbar:i}=(0,a.Ds)();return(0,o.D)({mutationFn:async t=>{let{mediaTypes:i,shotIds:r,advancedSettings:n,end_frame_image_url_shot_map:o,reference_image_urls_shot_map:a,style:s}=t;if(!e)throw Error("No story ID provided");return(await l.ZP.post(`stories/workflow/batch_generate?storyId=${e}`,{media_types:i,...r?{shot_ids:r}:{},...n?{advanced_settings:n}:{},...o?{end_frame_image_url_shot_map:o}:{},...a?{reference_image_urls_shot_map:a}:{},...s?{style:s}:{}})).data},onSuccess:(e,i)=>{t.invalidateQueries({queryKey:[d.O]})},onError:(e,t)=>{console.error(`Error starting batch ${t.mediaTypes.join("/")} generation:`,e),i(`Error: ${e.message}`,{variant:"error"})}})};t.ZP=c},18420:function(e,t,i){i.d(t,{D7:function(){return d},MH:function(){return l},no:function(){return s}}),i(75271);var r=i(75616),n=i(21964),o=i(65027),a=i(46973);let s=()=>{let e=(0,r.NL)(),{mutate:t,mutateAsync:i,isLoading:s}=(0,n.D)({mutationFn:async e=>(await a.ZP.post("/stories",e)).data,onSuccess:async()=>{try{await e.refetchQueries({queryKey:[o.B4],type:"active"})}catch(e){console.error("[useCreateStory] Failed to sync onboarding status:",e)}}});return{createStory:t,createStoryAsync:i,isLoading:s}},l=e=>{let{mutate:t,mutateAsync:i,isLoading:r}=(0,n.D)({mutationFn:async t=>(await a.ZP.patch(`/stories/${e}`,t)).data});return{updateStory:t,updateStoryAsync:i,isLoading:r}},d=()=>{let{mutate:e,mutateAsync:t,isLoading:i}=(0,n.D)({mutationFn:async e=>(await a.ZP.post("/stories/workflow/resume",e)).data});return{resumeStory:e,resumeStoryAsync:t,isResuming:i}}},81479:function(e,t,i){i.d(t,{dr:function(){return v},u9:function(){return b},To:function(){return p},MZ:function(){return A},_F:function(){return I},cl:function(){return F},gu:function(){return _},NJ:function(){return S},zB:function(){return y},wC:function(){return C},Jc:function(){return k},Wx:function(){return j},v4:function(){return Z},HK:function(){return x},ho:function(){return w}});var r=i(53778),n=i(67197),o=i(54669);let a=e=>structuredClone(e);var s=i(17856),l=i(25770),d=i(38218),c=i(32687),u=i(95239);function p(e){return{shot_id:(0,n.x0)(),shot_type:"empty",image_prompt:"",video_prompt:"",...e}}function h(e,t){return t&&e.find(e=>e.id===t)||null}function m(e,t,i){return(0,s.YI)(e,t,void 0,i)}function x(){var e,t;let i=o.jU.getState().story,s=null==i?void 0:null===(e=i.storyboard)||void 0===e?void 0:e.shots_map,d=(null==i?void 0:i.category_id)==="music_video"&&(null==i?void 0:null===(t=i.category_inputs)||void 0===t?void 0:t.video_type)==="singing-dancing",p=s?(0,c.MU)(s).filter(e=>"empty"!==e.shot_type&&!e.is_hidden):[],x=a(l.D.getState().mediaAssets),v=a(l.D.getState().tracks),b=l.D.getState().globalConfig.fps,y=[],w=[],C=0,j=v.findIndex(e=>"video"===u.wD.getTrackCategory(e,x)),k=v.findIndex(e=>"voiceover"===u.wD.getTrackCategory(e,x)),F=v[j],S=v[k],I=null;for(let e of((null==F?void 0:F.items)&&(I=F.items.find(e=>"logo"===e.type)||null),p)){let t,i;let n=h(x,e.active_video_id),o=h(x,e.active_image_id),a=h(x,e.active_voice_over_audio_id);if(e.active_video_id&&!n||e.active_image_id&&!o||e.active_voice_over_audio_id&&!a){console.error(`MediaAsset not found for shot ${e.shot_id}`);continue}if(n){let o=f(F,e.shot_id,e.active_video_id),a=g(F,e.shot_id);if(o)(t=(0,r.Z)(o)).startTimeInFrames=C;else if(t=m(n,C,b),a){let{id:e,effects:i,speed:r,volume:o,groupId:s}=a;t.id=e,t.effects=i,t.speed=r,t.volume=o,t.groupId=s;let l=h(x,a.mediaAssetId),c=null==l?void 0:l.metadata,u=function(e,t,i,r){let n=t.frames??0,o=(null==i?void 0:i.frames)??0;if(r&&i&&e){let r,a;let s=i.fps,l=t.fps,d=Math.max(0,e.sourceTrimStartFrames??0),c=Math.min(e.sourceTrimEndFrames??o,o);s===l?(r=d,a=c-d):(r=d/s*l,a=(c-d)/s*l);let u=r+a;if(u<=n)return{sourceTrimStartFrames:r,sourceTrimEndFrames:u};if(a<=n)return{sourceTrimStartFrames:n-a,sourceTrimEndFrames:n}}return{sourceTrimStartFrames:0,sourceTrimEndFrames:n}}(a,n.metadata,c,d);t.sourceTrimStartFrames=u.sourceTrimStartFrames,t.sourceTrimEndFrames=u.sourceTrimEndFrames;let p=(u.sourceTrimEndFrames-u.sourceTrimStartFrames)/n.metadata.fps;t.durationInFrames=p*b/t.speed}i=t,y.push(t)}else if(o){let n=f(F,e.shot_id,e.active_image_id),a=g(F,e.shot_id);if(n)(t=(0,r.Z)(n)).startTimeInFrames=C;else if(t=m(o,C,b),a){let{id:e,effects:i,groupId:r,durationInFrames:n}=a;t.id=e,t.effects=i,t.groupId=r,t.durationInFrames=n}i=t,y.push(t)}if(a){let i=f(S,e.shot_id,e.active_voice_over_audio_id),n=g(S,e.shot_id);if(i)(t=(0,r.Z)(i)).startTimeInFrames=C;else if(t=m(a,C,b),n){let{id:e,effects:i,groupId:r,speed:o,volume:a}=n;t.id=e,t.effects=i,t.groupId=r,t.speed=o,t.volume=a,t.durationInFrames=t.durationInFrames/t.speed}w.push(t)}if(!i){let{timelineItem:t,mediaAsset:r}=(0,u.B4)({id:u.HP,url:u.hM,shot_id:e.shot_id,type:"video"},"Failed Video",C);i=t,y.push(t),x.push(r)}C=i.startTimeInFrames+i.durationInFrames}if(F)F.items=y,I&&(I.startTimeInFrames=C,F.items.push(I)),v[j]=F;else if(y.length>0){let e=[...y];I&&(I.startTimeInFrames=C,e.push(I)),v.push({id:`track_video_${(0,n.x0)()}`,type:"video",name:"Video Track",items:e})}return S?(S.items=w,v[k]=S):w.length>0&&v.push({id:`track_voiceover_${(0,n.x0)()}`,type:"audio",subtype:"voiceover",name:"Voiceover Track",items:w}),{tracks:v,mediaAssets:x}}function g(e,t){if((null==e?void 0:e.items)&&(null==e?void 0:e.items.length)!==0)return e.items.find(e=>e.shotId===t)}function f(e,t,i){if((null==e?void 0:e.items)&&(null==e?void 0:e.items.length)!==0)return e.items.find(e=>e.shotId===t&&e.mediaAssetId===i)}function v(e,t){let i=function(e){switch(e.model){case"character":return"create.model.character";case"flux_kontext":default:return"create.model.Flux_Kontext";case"fluxdev":return"create.model.Flux_dev";case"gpt":return`editing.chatToEdit:gpt-${e.parameters.quality}`;case"seedream4":return"create.model.byteplus_seedream_4";case"nano-banana":return"create.model.nano-banana";case"qwen-image":return"create.model.qwen-image"}}(e);return(0,d.du)([i],{[i]:1},t)}function b(e,t){let i=function(e){if("pixverse4.5"===e.model||"pixverse5"===e.model)return`video.${e.model}.5.${e.parameters.resolution}`;if("kling2-5"===e.model&&"pro"===e.parameters.videoMode)return"video.kling2-5.5.pro";if("kling2.1"===e.model&&"std"===e.parameters.videoMode)return"video.kling2.1.5.std";if("kling2.1"===e.model&&"pro"===e.parameters.videoMode)return"video.kling2.1.5.pro";if("kling"===e.model&&"std"===e.parameters.videoMode)return"video.kling.5.std";if("kling"===e.model&&"pro"===e.parameters.videoMode)return"video.kling.5.pro";if("wan-i2v"===e.model)return"video.wan-i2v";else if("wan2.2-i2v"===e.model)return"video.wan-i2v-2.2.720p";else if("seedance-v1"===e.model)return"video.seedance-v1.5.lite.720p";else if("MiniMax-Hailuo-02"===e.model)return"video.MiniMax-Hailuo-02.6.512P";else if("creatify-aurora"===e.model)return"app.talking-video.creatifyAurora";else return"video.kling.5.pro"}(e);return(0,d.du)([i],{[i]:1},t)}function y(e){return Object.values(e).filter(e=>"empty"===e.shot_type?null!=e.image_prompt&&""!==e.image_prompt.trim():"uploaded_video"!==e.shot_type)}function w(e){return!e.is_hidden&&("empty"!==e.shot_type||null!=e.active_video_id&&""!==e.active_video_id.trim())}function C(e){return Object.values(e).filter(w)}function j(e){return""===e||null==e}function k(e){return"completed"===e||"failed:user_exporting_video"===e}function F(e){return(null==e?void 0:e.is_preview)&&!(null==e?void 0:e.paused_at)}function S(e){return(null==e?void 0:e.is_preview)&&"paused"===e.status}function I(e){return(null==e?void 0:e.is_preview)&&!!(null==e?void 0:e.resumed_at)}function _(e){return F(e)||S(e)}function Z(e){return e.startsWith("failed")&&"failed:user_exporting_video"!==e}function A(e){if(!e.startsWith("failed:"))return{description:""};switch(e){case"failed:creating_story":return{description:"Creating story failed. The credits has been refunded."};case"failed:generating_storyboard":return{description:"Generating storyboard failed. The credits has been refunded."};case"failed:generating_images":return{description:"Generating images failed. The credits has been refunded."};case"failed:generating_videos":return{description:"Generating videos failed. The credits has been refunded."};case"failed:generating_timeline":return{description:"Generating timeline failed. Please try the recover option."};case"failed:exporting_video":return{description:"Exporting video failed. Please try the recover option."};case"failed:user_exporting_video":return{description:"Exporting video failed. Please try again."};default:return{description:"Something went wrong. The credits has been refunded."}}}},13058:function(e,t,i){i.d(t,{ZY:function(){return b}});var r=i(75271),n=i(54669),o=i(2345),a=i(52973),s=i(47469),l=i(57170);let d=(e,t)=>{if(e===t)return!0;if(null==e||null==t||typeof e!=typeof t)return!1;if("object"!=typeof e)return e===t;if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let[i,r]of e.entries())if(!d(r,t[i]))return!1;return!0}if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();let i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let n of i)if(!r.includes(n)||!d(e[n],t[n]))return!1;return!0},c=e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map(c);let t={};for(let i in e)e.hasOwnProperty(i)&&(t[i]=c(e[i]));return t},u=e=>JSON.stringify(e).length,p=()=>`snapshot_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,h={undoStack:[],redoStack:[],maxHistorySize:20,enabled:!0,isRestoring:!1,currentOperation:null,useCompression:!1},m=(0,o.U)()((0,a.mW)((0,s.n)((e,t)=>({...h,createSnapshot:(i,r,n)=>{let o=t();if(!o.enabled||o.isRestoring)return;let a=r(),s={id:p(),timestamp:Date.now(),description:i,shotsMap:c(a.shotsMap),tracks:c(a.tracks),metadata:n};e(e=>{e.undoStack.push(s),e.undoStack.length>e.maxHistorySize&&e.undoStack.shift(),e.redoStack=[]})},startOperation:(i,r)=>{let n=t();if(!n.enabled||n.isRestoring)return;let o=r(),a={id:p(),timestamp:Date.now(),description:`Before ${i}`,shotsMap:c(o.shotsMap),tracks:c(o.tracks)};e(e=>{e.currentOperation={description:i,startSnapshot:a}})},endOperation:i=>{let r=t();if(!r.currentOperation||!r.enabled||r.isRestoring)return!1;let n=i(),{startSnapshot:o,description:a}=r.currentOperation,s={shotsMap:c(n.shotsMap),tracks:c(n.tracks)},l=o&&!d({shotsMap:o.shotsMap,tracks:o.tracks},s);return l&&e(e=>{e.undoStack.push(o),e.undoStack.length>e.maxHistorySize&&e.undoStack.shift(),e.redoStack=[]}),e(e=>{e.currentOperation=null}),l},cancelOperation:()=>{e(e=>{e.currentOperation=null})},restoreSnapshot:async(t,i)=>{e(e=>{e.isRestoring=!0});try{await i({shotsMap:c(t.shotsMap),tracks:c(t.tracks)})}finally{e(e=>{e.isRestoring=!1})}},undo:async(i,r)=>{let n=t();if(!n.canUndo()||n.isRestoring)return;let o=i(),a={id:p(),timestamp:Date.now(),description:"Redo point",shotsMap:c(o.shotsMap),tracks:c(o.tracks)},s=n.undoStack.at(-1);e(e=>{e.undoStack.pop(),e.redoStack.push(a)}),await t().restoreSnapshot(s,r)},redo:async(i,r)=>{let n=t();if(!n.canRedo()||n.isRestoring)return;let o=i(),a={id:p(),timestamp:Date.now(),description:"Undo point from redo",shotsMap:c(o.shotsMap),tracks:c(o.tracks)},s=n.redoStack.at(-1);e(e=>{e.redoStack.pop(),e.undoStack.push(a)}),await t().restoreSnapshot(s,r)},canUndo:()=>{let e=t();return e.undoStack.length>0&&!e.isRestoring},canRedo:()=>{let e=t();return e.redoStack.length>0&&!e.isRestoring},clearHistory:()=>{e(e=>{e.undoStack=[],e.redoStack=[],e.currentOperation=null})},setEnabled:t=>{e(e=>{e.enabled=t})},setMaxHistorySize:t=>{e(e=>{for(e.maxHistorySize=Math.max(1,t);e.undoStack.length>e.maxHistorySize;)e.undoStack.shift()})},setUseCompression:t=>{e(e=>{e.useCompression=t})},getHistoryInfo:()=>{let e=t(),i=e.undoStack.length+e.redoStack.length,r=Math.round((e.undoStack.reduce((e,t)=>e+u(t),0)+e.redoStack.reduce((e,t)=>e+u(t),0))/1024);return{undoCount:e.undoStack.length,redoCount:e.redoStack.length,canUndo:e.canUndo(),canRedo:e.canRedo(),isOperationActive:null!==e.currentOperation,memoryUsage:{totalSnapshots:i,estimatedSizeKB:r}}}})),{name:"video-editor-snapshot-history-store"})),x=(0,l.N)(m);var g=i(79855),f=i(6966),v=i(25770);let b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return y((0,g.B)(),(0,v.D)(),e)},y=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{maxHistorySize:o=20,enableKeyboardShortcuts:a=!0}=i,s=x(),l=n.jU.use.syncData(),{updateShot:d}=(0,f.Q)();(0,r.useEffect)(()=>{s.setMaxHistorySize(o)},[o,s]);let c=(0,r.useCallback)(()=>{var e,t;let i=g.B.getState(),r=v.D.getState();return{shotsMap:(null===(t=i.story)||void 0===t?void 0:null===(e=t.storyboard)||void 0===e?void 0:e.shots_map)??{},tracks:r.tracks??[]}},[]),u=(0,r.useCallback)(i=>{let r=e.story;r?e.setStory({...r,storyboard:{...r.storyboard,shots_map:i.shotsMap}}):console.warn("⚠️ Cannot apply shotsMap: no current story"),t.setTracks(i.tracks)},[e,t]),p=(0,r.useCallback)((e,t)=>{s.createSnapshot(e,c,t)},[s,c]),h=(0,r.useCallback)(e=>{s.startOperation(e,c)},[s,c]),m=(0,r.useCallback)(()=>s.endOperation(c),[s,c]),b=(0,r.useCallback)(()=>{s.cancelOperation()},[s]),y=(0,r.useCallback)(async()=>{await s.undo(c,u),l([],{fullSync:!0})},[s,c,u,l]),w=(0,r.useCallback)(async()=>{await s.redo(c,u),l([],{fullSync:!0})},[s,c,u,l]);return(0,r.useEffect)(()=>{if(!a)return;let e=e=>{let t=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;t&&"z"===e.key&&!e.shiftKey?(e.preventDefault(),y()):t&&("y"===e.key||"z"===e.key&&e.shiftKey)&&(e.preventDefault(),w())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,y,w]),{createSnapshot:p,startOperation:h,endOperation:m,cancelOperation:b,undo:y,redo:w,canUndo:s.canUndo(),canRedo:s.canRedo(),clearHistory:s.clearHistory,setEnabled:s.setEnabled,historyInfo:s.getHistoryInfo(),operations:{addShotWithSnapshot:async(t,i,r)=>{h("Add shot");try{await e.addShot(t,i,r)}finally{m()}},removeShotWithSnapshot:async(t,i)=>{h("Remove shot");try{await e.removeShot(t,i)}finally{m()}},updateShotWithSnapshot:async(e,t,i)=>{h("Update shot");try{await d(e,t,i)}finally{m()}},reorderShotsWithSnapshot:async(t,i,r)=>{h("Reorder shots");try{await e.reorderShots(t,i,r)}finally{m()}},addTrack:e=>{h("Add track"),m()},removeTrack:e=>{h("Remove track"),m()},updateTrack:(e,t)=>{h("Update track"),m()},batchOperation:async(e,t)=>{h(e);try{await t()}finally{setTimeout(()=>{m()&&l([],{fullSync:!0})},0)}}}}}},1188:function(e,t,i){i.d(t,{Jc:function(){return r.Jc},Sz:function(){return r.Sz},jU:function(){return r.jU},rM:function(){return r.rM},vw:function(){return r.vw},xX:function(){return r.xX}});var r=i(54669);i(79855)},54669:function(e,t,i){i.d(t,{Jc:function(){return l},Kr:function(){return s},Sz:function(){return p},jU:function(){return a},rM:function(){return u},vw:function(){return d},xX:function(){return c}});var r=i(75271),n=i(81479),o=i(79855);let a=(0,i(57170).N)(o.B),s=()=>{var e,t;return(null===(t=a.use.story())||void 0===t?void 0:null===(e=t.storyboard)||void 0===e?void 0:e.shots)||[]},l=()=>{let e=a.use.story(),t=null==e?void 0:e.category_inputs;return(0,r.useMemo)(()=>(null==t?void 0:t.character)||null,[t])},d=()=>{let e=a.use.story(),t=null==e?void 0:e.category_inputs;return(0,r.useMemo)(()=>t?null==t?void 0:t.additional_characters:[],[t])},c=()=>{var e;let t=a.use.story(),i=a.use.syncData(),n=a.use.updateStoryRecurringProps(),o=(0,r.useCallback)(async e=>{n(e);try{var r;await i(Object.keys((null==t?void 0:null===(r=t.storyboard)||void 0===r?void 0:r.shots_map)||{}),{forceSync:!0})}catch(e){console.error("Failed to sync aspect ratio change:",e)}},[n,i,null==t?void 0:null===(e=t.storyboard)||void 0===e?void 0:e.shots_map]);return{recurringProps:(0,r.useMemo)(()=>{var e;return null==t?void 0:null===(e=t.storyboard)||void 0===e?void 0:e.recurring_props},[t]),handleRecurringPropsChange:o}},u=()=>{let e=(0,o.B)(e=>e.story),t=(0,o.B)(e=>e.isLoading);return(0,r.useMemo)(()=>t||!e||(0,n.gu)(e),[e,t])},p=()=>{let e=(0,o.B)(e=>e.story),t=(0,o.B)(e=>e.isLoading);return(0,r.useMemo)(()=>t||!e||(0,n.cl)(e),[e,t])}},78359:function(e,t,i){i.d(t,{Au:function(){return j},FT:function(){return C},Gl:function(){return _},PR:function(){return A},aY:function(){return Z},bG:function(){return k},fH:function(){return y},gN:function(){return E},hd:function(){return I},k3:function(){return w},l:function(){return F},rR:function(){return S}});var r=i(75271),n=i(69937),o=i(67197),a=i(2345),s=i(52973),l=i(47469),d=i(60454),c=i(81479),u=i(54669),p=i(19005),h=i(8468),m=i(57170);let x=(0,n.Z)(()=>{(0,h.gf)().invalidateQueries([p.uE])},1e3),g={imageGenHistory:[],videoGenHistory:[],voiceoverGenHistory:[],hoveredImageId:"",hoveredVideoId:"",hasActiveImageChanged:!1,isCurrentImageRetried:!1,endFrameReferenceImage:"",videoIngredientMode:"keyframe"},f=(e,t)=>({resource:e,id:(0,o.x0)(),workflowId:e.workflow_run_id,error:e.status_message,generationStatus:"pending"===e.status||"generating"===e.status?"generating":"completed"===e.status?"completed":"failed",generatedAt:1e3*e.created_at._seconds,isPlaceholder:!1,referenceImageGenerationId:null==t?void 0:t.referenceImageGenerationId,referenceVoiceoverAudioGenerationId:null==t?void 0:t.referenceVoiceoverAudioGenerationId}),v={shotStates:{},shotRegenerating:{},advancedSettings:{image_model_config:d.VY,video_model_config:d.Zc},workflowRunList:[],newShotIds:[],activeShotId:"",hoveredShotId:"",needCreateShot:!1,referenceImages:{}},b=(0,a.U)()((0,s.mW)((0,l.n)((e,t)=>({...v,setAdvancedSettings:t=>e(e=>{e.advancedSettings={...e.advancedSettings,...t}}),addImageGenerationPlaceholder:(t,i,r,n)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g};let a={id:(0,o.x0)(),resource:{id:`placeholder-${i}`,user_id:"",resource_type:"image",title:"Generating...",story_id:"",shot_id:t,source:"generated",ai_model:"",prompt:r,workflow_run_id:i,configs:{},is_deleted:!1,created_at:{_seconds:Math.floor(Date.now()/1e3),_nanoseconds:0},updated_at:{_seconds:Math.floor(Date.now()/1e3),_nanoseconds:0},url:"",status:"pending"},workflowId:i,generationStatus:"generating",generatedAt:Date.now(),isPlaceholder:!0};e.shotStates[t].imageGenHistory=e.shotStates[t].imageGenHistory||[],e.shotStates[t].imageGenHistory=[a,...e.shotStates[t].imageGenHistory],n&&(e.shotStates[t].hoveredImageId=a.resource.id)}),addImageMediaResource:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].imageGenHistory=e.shotStates[t].imageGenHistory||[];let r=f(i),n=e.shotStates[t].imageGenHistory,o=n.findIndex(e=>e.resource.id===i.id);-1!==o?n[o]=r:n.unshift(r),n.sort((e,t)=>t.generatedAt-e.generatedAt),r.resource.id&&(e.shotStates[t].hoveredImageId=r.resource.id)}),addVideoGenerationPlaceholder:(t,i,r,n,a,s)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g};let l={id:(0,o.x0)(),resource:{id:`placeholder-${i}`,user_id:"",resource_type:"video",title:"Generating...",story_id:"",shot_id:t,source:"generated",ai_model:"",prompt:r,workflow_run_id:i,configs:{},is_deleted:!1,created_at:{_seconds:Math.floor(Date.now()/1e3),_nanoseconds:0},updated_at:{_seconds:Math.floor(Date.now()/1e3),_nanoseconds:0},url:"",status:"pending",reference_image:n},workflowId:i,generationStatus:"generating",generatedAt:Date.now(),isPlaceholder:!0,referenceImageGenerationId:s};e.shotStates[t].videoGenHistory=e.shotStates[t].videoGenHistory||[],e.shotStates[t].videoGenHistory.unshift(l),a&&(e.shotStates[t].hoveredVideoId=l.resource.id)}),addVoiceoverGenerationPlaceholder:(t,i,r)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g};let n={id:(0,o.x0)(),resource:{id:`placeholder-${i}`,user_id:"",resource_type:"audio",subtype:"voiceover",title:"Generating Voice...",story_id:"",shot_id:t,source:"generated",ai_model:"",prompt:r,workflow_run_id:i,configs:{},is_deleted:!1,created_at:{_seconds:Math.floor(Date.now()/1e3),_nanoseconds:0},updated_at:{_seconds:Math.floor(Date.now()/1e3),_nanoseconds:0},url:"",status:"pending"},workflowId:i,generationStatus:"generating",generatedAt:Date.now(),isPlaceholder:!0};e.shotStates[t].voiceoverGenHistory=e.shotStates[t].voiceoverGenHistory||[],e.shotStates[t].voiceoverGenHistory.unshift(n)}),updateGenerationStatus:(t,i,r)=>e(e=>{if(!e.shotStates[t])return;let n=("image"===r.resource_type?e.shotStates[t].imageGenHistory:"audio"===r.resource_type?e.shotStates[t].voiceoverGenHistory:e.shotStates[t].videoGenHistory).find(e=>e.workflowId===i);n&&(n.generationStatus="pending"===r.status||"generating"===r.status?"generating":"completed"===r.status?"completed":"failed",n.error=r.status_message,n.resource.status=r.status,n.resource.status_message=r.status_message)}),completeGeneration:function(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e(e=>{if(!e.shotStates[t])return;let a="image"===r.resource_type?e.shotStates[t].imageGenHistory:"audio"===r.resource_type?e.shotStates[t].voiceoverGenHistory:e.shotStates[t].videoGenHistory,s=a.findIndex(e=>e.workflowId===i);if(-1!==s){let e=a[s].resource.prompt,t={...r,prompt:r.prompt||e};a[s]={...a[s],resource:t,generationStatus:"completed",isPlaceholder:!1,...n}}else{let e={id:(0,o.x0)(),resource:r,workflowId:i,generationStatus:"completed",generatedAt:Date.now(),isPlaceholder:!1,...n};a.unshift(e)}})},removeGenerationItem:(t,i)=>e(e=>{}),initializeShotStates:t=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g}}),setShotImageGenHistory:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].imageGenHistory=i}),setShotVideoGenHistory:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].videoGenHistory=i}),setShotVoiceoverGenHistory:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].voiceoverGenHistory=i}),clearShotImageGenHistory:t=>e(e=>{e.shotStates[t]&&(e.shotStates[t].imageGenHistory=[])}),clearShotVideoGenHistory:t=>e(e=>{e.shotStates[t]&&(e.shotStates[t].videoGenHistory=[])}),clearShotVoiceoverGenHistory:t=>e(e=>{e.shotStates[t]&&(e.shotStates[t].voiceoverGenHistory=[])}),addExistingMediaResources:(t,i,r,n,o)=>e(e=>{let a=n.filter(e=>"voiceover"===e.subtype);e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].imageGenHistory=e.shotStates[t].imageGenHistory||[],e.shotStates[t].videoGenHistory=e.shotStates[t].videoGenHistory||[],e.shotStates[t].voiceoverGenHistory=e.shotStates[t].voiceoverGenHistory||[];let s=new Set(e.shotStates[t].imageGenHistory.map(e=>e.workflowId)),l=new Set(e.shotStates[t].videoGenHistory.map(e=>e.workflowId)),d=new Set(e.shotStates[t].voiceoverGenHistory.map(e=>e.workflowId)),c=a.filter(e=>!d.has(e.workflow_run_id)).map(e=>f(e)),u=i.filter(e=>!s.has(e.workflow_run_id)).map(e=>{let t;return(null==o?void 0:o.init)&&e.id===(null==o?void 0:o.activeImageId)&&(t=null==o?void 0:o.activeVoiceoverAudioId),f(e,{referenceVoiceoverAudioGenerationId:t})}),p=r.filter(e=>!l.has(e.workflow_run_id)).map(e=>{let t,i;return(null==o?void 0:o.init)&&e.id===(null==o?void 0:o.activeVideoId)&&(t=null==o?void 0:o.activeImageId,i=null==o?void 0:o.activeVoiceoverAudioId),f(e,{referenceImageGenerationId:t,referenceVoiceoverAudioGenerationId:i})});e.shotStates[t].imageGenHistory=e.shotStates[t].imageGenHistory.concat(u),e.shotStates[t].videoGenHistory=e.shotStates[t].videoGenHistory.concat(p),e.shotStates[t].voiceoverGenHistory=e.shotStates[t].voiceoverGenHistory.concat(c),e.shotStates[t].imageGenHistory.sort((e,t)=>t.generatedAt-e.generatedAt),e.shotStates[t].videoGenHistory.sort((e,t)=>t.generatedAt-e.generatedAt),e.shotStates[t].voiceoverGenHistory.sort((e,t)=>t.generatedAt-e.generatedAt)}),setIsCurrentImageRetried:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].isCurrentImageRetried=i}),checkActiveImageChanged:(e,i,r)=>{let n=t().shotStates[e];if(!n)return!1;let o=n.videoGenHistory.find(e=>{var t;return(null===(t=e.resource)||void 0===t?void 0:t.id)===r});return!!o&&o.referenceImageGenerationId!==i&&!n.isCurrentImageRetried},setShotRegenerating:(t,i,r)=>e(e=>{e.shotRegenerating[t]={...e.shotRegenerating[t],[i]:r}}),setHoveredMediaId:function(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e(e=>{if(e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t]["image"===i?"hoveredImageId":"hoveredVideoId"]=r,!r&&n){var o,a,s;e.shotStates[t]["image"===i?"hoveredImageId":"hoveredVideoId"]=(null===(s=e.shotStates[t])||void 0===s?void 0:null===(a=s["image"===i?"imageGenHistory":"videoGenHistory"][0])||void 0===a?void 0:null===(o=a.resource)||void 0===o?void 0:o.id)||""}})},getHoveredMediaId:(e,i)=>t().shotStates[e]["image"===i?"hoveredImageId":"hoveredVideoId"],addWorkflowRun:t=>e(e=>{let i=new Set(e.workflowRunList.map(e=>e.workflow_run_id)),r=t.filter(e=>!i.has(e.id)).map(e=>({workflow_run_id:e.id,status:"pending",shot_id:e.shot_id,created_at:Date.now(),updated_at:Date.now()}));e.workflowRunList.push(...r)}),removeWorkflowRun:t=>e(e=>{e.workflowRunList=e.workflowRunList.filter(e=>!t.includes(e.workflow_run_id))}),setHasActiveImageChanged:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].hasActiveImageChanged=i}),setEndFrameReferenceImage:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].endFrameReferenceImage=i}),calculateGenerationCredits:(e,i)=>{let{advancedSettings:r}=t();return"image"===e?(0,c.dr)(r.image_model_config.value,i):(0,c.u9)(r.video_model_config.value,i)},refreshCredits:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?(0,h.gf)().invalidateQueries([p.uE]):x()},setActiveShotId:t=>e(e=>{e.activeShotId=t}),setHoveredShotId:t=>e(e=>{e.hoveredShotId=t}),setNeedCreateShot:(t,i)=>e(e=>{e.needCreateShot=t,i&&setTimeout(()=>{u.jU.getState().setViewMode(i)},300)}),setReferenceImages:(t,i)=>e(e=>{e.referenceImages[t]=i}),setVideoIngredientMode:(t,i)=>e(e=>{e.shotStates[t]=e.shotStates[t]||{...g},e.shotStates[t].videoIngredientMode=i})})),{name:"video-editor-state-management-store"})),y=(0,m.N)(b),w=()=>y(e=>e.advancedSettings),C=(e,t)=>{let i=y(i=>{var r,n;return"image"===t?null===(r=i.shotStates[e])||void 0===r?void 0:r.imageGenHistory:null===(n=i.shotStates[e])||void 0===n?void 0:n.videoGenHistory});return(0,r.useMemo)(()=>i||[],[i])},j=e=>{let t=y(t=>{var i;return null===(i=t.shotStates[e])||void 0===i?void 0:i.imageGenHistory});return(0,r.useMemo)(()=>t||[],[t])},k=e=>{let t=y(t=>{var i;return null===(i=t.shotStates[e])||void 0===i?void 0:i.videoGenHistory});return(0,r.useMemo)(()=>t||[],[t])},F=e=>{let t=y(t=>{var i;return null===(i=t.shotStates[e])||void 0===i?void 0:i.voiceoverGenHistory});return(0,r.useMemo)(()=>t||[],[t])},S=(e,t)=>y(i=>{var r;return(null===(r=i.shotRegenerating[e])||void 0===r?void 0:r[t])||!1}),I=(e,t)=>(0,u.jU)(i=>{var r,n,o,a;return(null===(a=i.story)||void 0===a?void 0:null===(o=a.storyboard)||void 0===o?void 0:null===(n=o.shots_map)||void 0===n?void 0:null===(r=n[e])||void 0===r?void 0:r[`active_${t}_id`])||""}),_=(e,t)=>y(i=>{var r,n;return"image"===t?(null===(r=i.shotStates[e])||void 0===r?void 0:r.hoveredImageId)||"":(null===(n=i.shotStates[e])||void 0===n?void 0:n.hoveredVideoId)||""}),Z=e=>y(t=>t.activeShotId===e?"#2F66FF":t.hoveredShotId===e?"rgba(158, 166, 189, 0.80)":"#2E2E2E"),A=(e,t,i)=>y(r=>r.checkActiveImageChanged(e,t,i)),E=e=>y(t=>{var i;return null===(i=t.shotStates[e])||void 0===i?void 0:i.endFrameReferenceImage})},79855:function(e,t,i){let r,n,o;i.d(t,{A:function(){return k},B:function(){return j}});var a=i(75271),s=i(69937),l=i(2345),d=i(52973),c=i(47469),u=i(46973),p=i(33010);let h=async(e,t)=>{if(!e.id)throw Error("Story ID is required for sync");let i=await u.ZP.post(`/stories/${e.id}/sync`,t);return(0,p.WJ)({...e,is_export_outdated:!0}),i.data},m=(n=null,o=null,function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Promise((e,i)=>{r&&(clearTimeout(r),o&&o(Error("Debounced call cancelled"))),n=e,o=i,r=setTimeout(async()=>{try{let e=await h(...t);n&&n(e)}catch(e){o&&o(e)}finally{n=null,o=null}},1e3)})}),x=async(e,t,i)=>{var r;let n=Object.fromEntries(Object.entries(t||{shots_map:null===(r=e.storyboard)||void 0===r?void 0:r.shots_map,video_editor_timeline:e.video_editor_timeline}).filter(e=>{let[t,i]=e;return null!=i&&("object"!=typeof i||0!==Object.keys(i).length||"additional_characters"===t)}));if(0===Object.keys(n).length){console.warn("No data to sync");return}return(null==i?void 0:i.immediate)?h(e,n):m(e,n)};var g=i(81479),f=i(83918),v=i(25770),b=i(32687);let y=async()=>{let e=j.getState(),t=v.D.getState(),i=new f.O(t).mediaAssetInUse,{story:r,pendingSyncShotIds:n}=e;if(!r||0===n.length)return;let o=[...n];j.setState(e=>{e.syncingShotIds=[...e.pendingSyncShotIds],e.pendingSyncShotIds=[],e.syncStatus="syncing"});try{var a,s;let e={};(null===(a=r.storyboard)||void 0===a?void 0:a.shots_map)&&o.forEach(t=>{r.storyboard.shots_map[t]&&(e[t]=r.storyboard.shots_map[t])});let n=r.category_inputs,l=[...(null==n?void 0:n.additional_characters)??[]],d={recurring_props:(null===(s=r.storyboard)||void 0===s?void 0:s.recurring_props)||[],shots_map:Object.keys(e).length>0?e:void 0,video_editor_timeline:{tracks:t.tracks,mediaAssets:i,globalConfig:t.globalConfig},additional_characters:l},c=Object.fromEntries(Object.entries(d).filter(e=>{let[t,i]=e;return void 0!==i}));await x(r,c,{immediate:!0}),j.setState(e=>{e.syncingShotIds=[],e.syncStatus="idle",e.hasUnsavedChanges=e.pendingSyncShotIds.length>0,e.syncError=""});let{pendingSyncShotIds:u}=j.getState();u.length>0&&w()}catch(e){console.error("Error syncing shots:",o,e),j.setState(t=>{t.pendingSyncShotIds=[...o,...t.pendingSyncShotIds],t.syncingShotIds=[],t.syncStatus="error",t.syncError=e instanceof Error?e.message:"Unknown error"})}},w=(0,s.Z)(y,1e3),C={story:null,isLoading:!1,syncStatus:"idle",syncError:"",error:null,hasUnsavedChanges:!1,viewMode:"video-editor",pendingSyncShotIds:[],syncingShotIds:[],uploadingAssets:[]},j=(0,l.U)()((0,d.mW)((0,c.n)((e,t)=>({...C,setStory:t=>e(e=>{var i;e.story={...t,storyboard:{...t.storyboard,shots:(0,b.MU)(null===(i=t.storyboard)||void 0===i?void 0:i.shots_map)}},e.error=null,e.hasUnsavedChanges=!1},!1,"setStory"),setLoading:t=>e(e=>{e.isLoading=t},!1,"setLoading"),setError:t=>e(e=>{e.error=t,e.isLoading=!1},!1,"setError"),setViewMode:t=>e(e=>{e.viewMode=t},!1,"setViewMode"),updateStoryMetadata:t=>e(e=>{e.story&&(Object.assign(e.story,t),e.hasUnsavedChanges=!0)},!1,"updateStoryMetadata"),updateStoryCategoryInputs:t=>e(e=>{if(!e.story)return;let i=e.story.category_inputs||{};e.story.category_inputs={...i,...t},e.hasUnsavedChanges=!0},!1,"updateStoryCategoryInputs"),updateStoryRecurringProps:t=>e(e=>{e.story.storyboard.recurring_props=t,e.hasUnsavedChanges=!0},!1,"updateRecurringProps"),updateEditorGlobalConfig:t=>e(e=>{e.story.video_editor_timeline.globalConfig={...e.story.video_editor_timeline.globalConfig,...t},e.hasUnsavedChanges=!0},!1,"updateEditorGlobalConfig"),getShotById:e=>{var i;let{story:r}=t();return(null==r?void 0:null===(i=r.storyboard)||void 0===i?void 0:i.shots_map)&&r.storyboard.shots_map[e]||null},updateShot:(i,r,n)=>new Promise(o=>e(e=>{var a,s;let{rebuildTimeline:l=!0}=n||{};if(!(null===(s=e.story)||void 0===s?void 0:null===(a=s.storyboard)||void 0===a?void 0:a.shots))return;let d=e.story.storyboard.shots.findIndex(e=>e.shot_id===i),c=null;-1!==d&&(e.story.storyboard.shots_map=(0,b.vB)(e.story.storyboard.shots_map,i,r),Object.assign(e.story.storyboard.shots[d],r),l&&(c=t().recalculateTimelineTiming()),e.hasUnsavedChanges=!0),null==c||c.then(()=>{o()})},!1,"updateShot")),reorderShots:(i,r,n)=>new Promise(o=>{let a=null,{rebuildTimeline:s=!0}=n||{};e(e=>{let n,l;let d=e.story.storyboard.shots[i];if(i<r?(n=e.story.storyboard.shots[r],l=e.story.storyboard.shots[r+1]):(n=e.story.storyboard.shots[r-1],l=e.story.storyboard.shots[r]),a=d.shot_id,e.story.storyboard.shots_map){let t=(0,b.Pu)(e.story.storyboard.shots_map,d.shot_id,null==n?void 0:n.shot_id,null==l?void 0:l.shot_id),i=(0,b.MU)(t);e.story.storyboard.shots_map=t,e.story.storyboard.shots=i}let c=null;s&&(c=t().recalculateTimelineTiming()),e.hasUnsavedChanges=!0,null==c||c.then(()=>{o()})},!1,"reorderShots"),a&&t().syncData([a])}),addShot:(i,r,n)=>new Promise(o=>e(e=>{if(!e.story)return;let{rebuildTimeline:a=!0}=n||{};if(void 0!==r){let t=e.story.storyboard.shots[r-1],n=e.story.storyboard.shots[r];e.story.storyboard.shots_map=(0,b.l9)(e.story.storyboard.shots_map,i,null==t?void 0:t.shot_id,null==n?void 0:n.shot_id),e.story.storyboard.shots=(0,b.MU)(e.story.storyboard.shots_map)}else e.story.storyboard.shots.push(i);e.pendingSyncShotIds.includes(i.shot_id)||e.syncingShotIds.includes(i.shot_id)||e.pendingSyncShotIds.push(i.shot_id);let s=null;a&&(s=t().recalculateTimelineTiming()),e.hasUnsavedChanges=!0,null==s||s.then(()=>{o()})},!1,"addShot")),removeShot:(i,r)=>new Promise(n=>e(e=>{var o,a;if(!(null===(a=e.story)||void 0===a?void 0:null===(o=a.storyboard)||void 0===o?void 0:o.shots))return;let{rebuildTimeline:s=!0}=r||{};e.story.storyboard.shots_map=(0,b.ij)(e.story.storyboard.shots_map,i),e.story.storyboard.shots=(0,b.MU)(e.story.storyboard.shots_map);let l=null;s&&(l=t().recalculateTimelineTiming()),e.hasUnsavedChanges=!0,null==l||l.then(()=>{t().syncData([i],{deleteIds:[i]}),n()})},!1,"removeShot")),reset:()=>e(e=>{Object.assign(e,C)},!1,"reset"),markAsSaved:()=>e(e=>{e.hasUnsavedChanges=!1},!1,"markAsSaved"),recalculateTimelineTiming:()=>new Promise(t=>setTimeout(()=>{e(e=>{v.D.getState().rebuildTimeline().then(()=>{t()}),e.hasUnsavedChanges=!0},!1,"recalculateTimelineTiming")},0)),queueShotsForSync:t=>e(e=>{let i=t.filter(t=>!e.pendingSyncShotIds.includes(t)&&!e.syncingShotIds.includes(t));e.pendingSyncShotIds.push(...i),e.hasUnsavedChanges=!0},!1,"queueShotsForSync"),clearSyncQueues:()=>e(e=>{e.pendingSyncShotIds=[],e.syncingShotIds=[],e.syncStatus="idle"},!1,"clearSyncQueues"),syncData:async(i,r)=>{var n,o;let{story:a}=t(),{forceSync:s=!1,deleteIds:l=[],fullSync:d=!1}=r||{};if(!a){console.warn("No story to sync");return}let c=null===(n=a.storyboard)||void 0===n?void 0:n.shots_map,u=d?Object.keys((null===(o=a.storyboard)||void 0===o?void 0:o.shots_map)||{}):i;if(u&&u.length>0&&e(e=>{let t=u.filter(t=>!e.pendingSyncShotIds.includes(t)&&!e.syncingShotIds.includes(t));t.length>0&&(e.pendingSyncShotIds.push(...t),e.hasUnsavedChanges=!0)}),l&&l.length>0)try{let e={};l.forEach(t=>{let i=c[t];if(!i){e[t]=null;return}"auto"===i.shot_type?e[t]={...i}:e[t]=null});let t={shots_map:e,video_editor_timeline:a.video_editor_timeline};await x(a,t,{immediate:!0})}catch(e){console.error("Error deleting shots:",l,e)}if(e(e=>{e.syncStatus="waitSync"}),s){w.cancel();let{pendingSyncShotIds:e}=t();e.length>0&&await y()}else{let{pendingSyncShotIds:e}=t();e.length>0&&w()}},addUploadingAsset:t=>e(e=>{e.uploadingAssets.push(t)},!1,"addUploadingAsset"),updateUploadingAsset:(t,i)=>e(e=>{let r=e.uploadingAssets.findIndex(e=>e.id===t);-1!==r&&Object.assign(e.uploadingAssets[r],i)},!1,"updateUploadingAsset"),removeUploadingAsset:t=>e(e=>{e.uploadingAssets=e.uploadingAssets.filter(e=>e.id!==t)},!1,"removeUploadingAsset"),clearUploadingAssets:()=>e(e=>{e.uploadingAssets=[]},!1,"clearUploadingAssets"),getUploadingAssetsByType:e=>{let{uploadingAssets:i}=t();return i.filter(t=>t.type===e)}})),{name:"video-editor-store",trace:!0})),k=function(){var e;let{hasImageUrl:t=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=j(e=>e.story);return(0,a.useMemo)(()=>{var e;return(null==i?void 0:null===(e=i.storyboard)||void 0===e?void 0:e.shots.filter(e=>(0,g.ho)(e)&&(!t||!!e.active_image_url)))||[]},[null==i?void 0:null===(e=i.storyboard)||void 0===e?void 0:e.shots,t])}},85872:function(e,t,i){i.d(t,{d:function(){return w}});var r=i(52676),n=i(75271),o=i(56407),a=i(22988),s=i(21909),l=i(29984),d=i(80110),c=i(27574),u=i(41599),p=i(14719),h=i(98939),m=i(16581),x=i(52961),g=i(76029),f=i(15526),v=i(95239);let b=[],y=[];function w(e){let{storyId:t,tracks:i=b,mediaAssets:w=y,globalConfig:C=m.Kz}=e,j=(0,n.useRef)(null);(0,g.N)({playerRef:j}),(0,x.Lv)();let{isLoading:k,error:F,localError:S}=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.Kz,o=f.wK.use.init(),a=f.wK.use.isLoading(),s=f.wK.use.error(),[l,d]=(0,n.useState)(null),c=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{(async()=>{if(c.current||(d(null),!e&&0===t.length))return;let n=i.filter(e=>!v.wD.isValidTrack(e));if(n.length>0){d("Invalid track data provided"),console.error("Invalid tracks:",n);return}let a=t.filter(e=>!v.wD.isValidMediaAsset(e));if(a.length>0){d("Invalid media asset data provided"),console.error("Invalid assets:",a);return}0===i.length&&console.warn("No initial tracks provided"),e||0!==t.length||console.warn("No storyId or initial media assets provided");try{c.current=!0,o({storyId:e,mediaAssets:t.length>0?t:[],tracks:i,globalConfig:{...r,watermark:r.watermark||m.wf,fps:r.fps||m.UG,captions:r.captions||{enabled:!0}}})}catch(t){let e=t instanceof Error?t.message:"Failed to initialize timeline";console.error("Timeline initialization failed:",t),d(e),c.current=!1}})()},[o,e,i,t,r]),{isLoading:a,error:s,localError:l}}(t,w,i,C),I=F||S,{timelineEditorHeight:_,timelineEditorMaxHeight:Z,handleDragByClientY:A}=function(){var e;let[t,i]=(0,u.Z)("timelineEditorHeight",{defaultValue:210}),r=f.wK.use.tracks(),o=f.wK.use.mediaAssets(),a=f.wK.use.globalConfig(),s=(0,n.useMemo)(()=>{var e;if(!r)return 180;let t=(null==a?void 0:null===(e=a.captions)||void 0===e?void 0:e.enabled)??!0,i=e=>{switch(v.wD.getTrackCategory(e,o)){case"video":case"image":return m.gd;case"caption":return t?m.Zk:0;case"voiceover":case"music":return m.ZR;default:return 0}},n=r.map(e=>i(e)).filter(e=>e>0),s=r.some(e=>"video"===v.wD.getTrackCategory(e,o)&&e.items.length>0),l=r.some(e=>"music"===v.wD.getTrackCategory(e,o)&&e.items.length>0),d=s&&!l,c=n.reduce((e,t)=>e+t,0),u=n.length+(d?1:0),p=u>1?(u-1)*m.ew:0;return m.d1+m.gI+c+(d?m.ZR:0)+p+18},[r,o,null==a?void 0:null===(e=a.captions)||void 0===e?void 0:e.enabled]),[l,d]=(0,n.useState)(()=>Math.min("number"==typeof window.innerHeight?Math.floor(.6*window.innerHeight):400,Math.ceil(s)));(0,n.useEffect)(()=>{function e(){d(Math.min("number"==typeof window.innerHeight?Math.floor(.6*window.innerHeight):400,Math.ceil(s)))}return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[s]);let c=(0,n.useCallback)(e=>{i(t=>{let i=t+e;return i<180&&(i=180),i>l&&(i=l),i})},[i,l]),p=(0,n.useCallback)(e=>{let t=window.innerHeight-24,r=t-l;i(t-Math.max(r,Math.min(t-180,e)))},[i,l]);return{timelineEditorHeight:t,timelineEditorMaxHeight:l,handleHeightChange:c,handleDragByClientY:p}}();return(0,r.jsxs)(o.Z,{tabIndex:0,sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",color:"white",gap:2,outline:"none",position:"relative"},children:[(0,r.jsxs)(o.Z,{sx:{flex:1,position:"relative",width:"100%",minHeight:0,flexDirection:"row",gap:2},children:[(0,r.jsx)(p.xr,{storyId:t,sx:{flex:0,flexBasis:h.Bx,flexGrow:0,flexShrink:0,maxHeight:"100%",height:"100%"}}),(0,r.jsx)(p.V4,{sx:{flex:1,flexBasis:"auto"},playerRef:j}),(0,r.jsx)(p.mG,{sx:{flex:0,flexBasis:h.Bx,flexGrow:0,flexShrink:0}})]}),(0,r.jsxs)(a.Z,{sx:{flex:0,flexShrink:0,flexBasis:`${_}px`,height:`${_}px`,minHeight:"180px",maxHeight:`${Z}px`,position:"relative",borderRadius:1,overflow:"hidden",bgcolor:"#1a1a1a"},children:[(0,r.jsx)(p.UE,{onDragY:A}),(0,r.jsx)(p.dR,{playerRef:j})]}),(0,r.jsx)(p.Dy,{}),(0,r.jsx)(s.Z,{open:k,sx:{position:"absolute",zIndex:e=>e.zIndex.drawer+1,color:"#fff",backgroundColor:"rgba(0, 0, 0, 0.7)"},children:(0,r.jsxs)(o.Z,{alignItems:"center",spacing:2,children:[(0,r.jsx)(l.Z,{color:"inherit"}),(0,r.jsx)(d.Z,{variant:"body1",children:"loading..."})]})}),I?(0,r.jsx)(s.Z,{open:!!I,sx:{position:"absolute",zIndex:e=>e.zIndex.drawer+2,backgroundColor:"rgba(0, 0, 0, 0.8)"},children:(0,r.jsx)(a.Z,{sx:{maxWidth:400,width:"90%"},children:(0,r.jsx)(c.Z,{severity:"error",sx:{backgroundColor:"rgba(211, 47, 47, 0.1)",border:"1px solid rgba(211, 47, 47, 0.3)","& .MuiAlert-message":{color:"#fff"},"& .MuiAlert-icon":{color:"#f44336"}},children:(0,r.jsx)(d.Z,{variant:"body2",children:I})})})}):null]})}},14719:function(e,t,i){i.d(t,{CX:function(){return D},hV:function(){return ed},ji:function(){return ez},t_:function(){return eW},os:function(){return eH},YH:function(){return eQ},xr:function(){return e0},Vc:function(){return e1},V4:function(){return e2},pS:function(){return e7},Mk:function(){return t$},mG:function(){return tK},Ws:function(){return tT},GI:function(){return tJ},mX:function(){return tQ},rP:function(){return t0},Tv:function(){return X},ap:function(){return t2},cP:function(){return iW},Hm:function(){return iO},dR:function(){return iq},UE:function(){return iX},ve:function(){return i0},R_:function(){return i2},rg:function(){return i8},tF:function(){return re},yx:function(){return rt},xy:function(){return rr},OB:function(){return rs},O3:function(){return rd},F4:function(){return rc},pg:function(){return rg},uH:function(){return rx},Gw:function(){return rf},vK:function(){return rv},Dy:function(){return rj}});var r=i(52676),n=i(75271),o=i(45162),a=i.n(o),s=i(56407),l=i(22988),d=i(80110),c=i(45138),u=i(57672),p=i(12853),h=i(13058),m=i(58684),x=i(35523),g=i(43807),f=i(43246),v=i(8496),b=i(96386),y=i(1188),w=i(75616),C=i(21964),j=i(46973),k=i(19005),F=i(25770),S=i(77913),I=i(27806),_=i(52934),Z=i(28989),A=i(95239);let E=[{value:"auto",label:"Auto"},{value:"en",label:"English"},{value:"zh",label:"中文 (Chinese)"},{value:"es",label:"Espa\xf1ol (Spanish)"},{value:"fr",label:"Fran\xe7ais (French)"},{value:"de",label:"Deutsch (German)"},{value:"ja",label:"日本語 (Japanese)"},{value:"ko",label:"한국어 (Korean)"},{value:"pt",label:"Portugu\xeas (Portuguese)"},{value:"ru",label:"Русский (Russian)"},{value:"ar",label:"العربية (Arabic)"},{value:"hi",label:"हिन्दी (Hindi)"},{value:"it",label:"Italiano (Italian)"},{value:"nl",label:"Nederlands (Dutch)"},{value:"sv",label:"Svenska (Swedish)"},{value:"da",label:"Dansk (Danish)"},{value:"nb",label:"Norsk bokm\xe5l (Norwegian)"},{value:"fi",label:"Suomi (Finnish)"},{value:"pl",label:"Polski (Polish)"},{value:"tr",label:"T\xfcrk\xe7e (Turkish)"},{value:"th",label:"ไทย (Thai)"},{value:"vi",label:"Tiếng Việt (Vietnamese)"},{value:"ms",label:"Bahasa Melayu (Malay)"},{value:"tl",label:"Filipino (Tagalog)"}];function M(e){var t;let{disabled:i=!1,sx:o}=e,a=(0,u.Z)(),c=(0,y.jU)(e=>e.story),p=F.wK.use.globalConfig(),M=F.wK.use.tracks(),T=F.wK.use.mediaAssets(),R=F.wK.use.setTracks(),D=F.wK.use.updateGlobalConfig(),{operations:z}=(0,h.ZY)(),[P,W]=(0,n.useState)("auto"),[L,B]=(0,n.useState)(!1),[H,$]=(0,n.useState)(0),O=n.useRef(null),U=function(){let e=(0,w.NL)();return(0,C.D)({mutationFn:async e=>(await j.ZP.post("/stories/generate_caption",e)).data,onSettled:async t=>{(null==t?void 0:t.success)&&await Promise.all([e.invalidateQueries([k.uE]),e.invalidateQueries([k.OK])])}})}(),G=(0,n.useMemo)(()=>null==M?void 0:M.some(e=>e.items.some(e=>"caption"===e.type)),[M]),N=(0,n.useMemo)(()=>i,[i]),V=(0,n.useMemo)(()=>{let e=M.find(e=>"audio"===e.type);return(null==e?void 0:e.items.length)>0&&(null==c?void 0:c.category_id)!=="character_vlog"},[null==c?void 0:c.category_id,M]),K=(0,n.useCallback)(e=>{W(e)},[]),q=(0,n.useMemo)(()=>(null==c?void 0:c.category_id)==="music_video"?"music":"voiceover",[null==c?void 0:c.category_id]),Y=(0,n.useMemo)(()=>{try{let e=(M||[]).filter(e=>A.wD.getTrackCategory(e,T)===q),t=(null==p?void 0:p.fps)||S.UG;if(0===e.length||!t)return 0;let i=e.reduce((e,t)=>{let i=(t.items||[]).filter(e=>"audio"===e.type).reduce((e,t)=>e+(t.durationInFrames||0),0);return e+i},0);if(i<=0)return 0;return i/t}catch{return 0}},[M,T,null==p?void 0:p.fps,q]);n.useEffect(()=>{if(L){$(0),O.current&&clearInterval(O.current);let e=95/Math.max(1,Math.floor(Math.max(50,Math.floor(1e3*Y/6))/50));return O.current=setInterval(()=>{$(t=>{let i=t+e;return i>=95?(O.current&&clearInterval(O.current),O.current=null,95):i})},50),()=>{O.current&&clearInterval(O.current),O.current=null}}return O.current&&clearInterval(O.current),O.current=null,$(0),()=>{O.current&&clearInterval(O.current),O.current=null}},[L,Y]);let X=_.v["story.caption_generation"].credit,J=(0,n.useMemo)(()=>Y<=0?0:Math.max(0,Math.ceil(Y/60)*X),[Y,X]),Q=(0,n.useCallback)(async()=>{try{B(!0);let e=(null==c?void 0:c.category_id)==="music_video"?"music":"voiceover",t=(M||[]).filter(t=>A.wD.getTrackCategory(t,T)===e);if(0===t.length)return;let i=t.map(e=>({id:e.id,type:e.type,name:e.name,subtype:e.subtype,items:(e.items||[]).filter(e=>"audio"===e.type)})),r=new Set;i.forEach(e=>{e.items.forEach(e=>{e.mediaAssetId&&r.add(e.mediaAssetId)})});let n=(T||[]).filter(e=>e.id&&r.has(e.id)),o={tracks:i,mediaAssets:n,globalConfig:{fps:null==p?void 0:p.fps},captionSegmentStrategy:void 0};P&&"auto"!==P&&(o.language=P);let a=await U.mutateAsync(o);if(!(null==a?void 0:a.success)){(0,Z.cB)((null==a?void 0:a.message)||(null==a?void 0:a.error)||"Failed to generate captions. Please try again.");return}let s=a.captions||{},l=(M||[]).filter(e=>"caption"!==e.subtype),d=[];l.forEach(t=>{if(d.push(t),A.wD.getTrackCategory(t,T)===e){let e=s[t.id];e&&Array.isArray(e.items)&&e.items.length>0&&d.push(e)}}),await z.batchOperation("Generate captions",async()=>{var e;R(d),d.some(e=>"caption"===e.subtype&&Array.isArray(e.items)&&e.items.length>0)&&(null==p?void 0:null===(e=p.captions)||void 0===e?void 0:e.enabled)===!1&&D({captions:{enabled:!0}})})}catch(e){(0,Z.cB)(e instanceof Error?e.message:"Failed to generate captions.")}finally{$(100),setTimeout(()=>{B(!1),$(0)},300)}},[M,T,null==p?void 0:p.fps,null==p?void 0:null===(t=p.captions)||void 0===t?void 0:t.enabled,P,R,D,null==c?void 0:c.category_id,z,U]);return V?(0,r.jsx)(v.b,{children:(0,r.jsxs)(l.Z,{sx:{width:264,display:"flex",flexDirection:"column",gap:1,p:"12px 8px",border:`1px solid ${a.palette.Colors.Gray["200"]}`,borderRadius:"6px",...o},children:[(0,r.jsxs)(s.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",gap:1,children:[(0,r.jsx)(d.Z,{variant:"body2",sx:{fontFamily:"Inter",fontWeight:600,fontSize:12,lineHeight:"1.125em",color:a.palette.Colors.Gray["600"]},children:"Select language"}),(0,r.jsx)(x.Z,{size:"small",sx:{minWidth:"auto"},children:(0,r.jsx)(g.Z,{value:P,onChange:e=>K(e.target.value),disabled:N,IconComponent:I.PhCaretDown,sx:{width:"auto",maxWidth:"100%",height:24,fontSize:10,fontWeight:600,fontFamily:"Inter",bgcolor:a.palette.Colors.Gray["200"],color:a.palette.Colors.Gray["500"],"& .MuiSelect-select":{py:.5,pl:.875,pr:2.5,display:"inline-flex",alignItems:"center"},"& .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.Colors.Gray["300"],borderWidth:"1px",borderRadius:"4px"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.Colors.Gray["300"],borderWidth:"1px"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.Colors.Gray["300"],borderWidth:"1px"},"& .MuiSvgIcon-root":{color:a.palette.Colors.Gray["900"],fontSize:12},"& .MuiSelect-icon":{top:"calc(50% - 1em) !important",right:6}},MenuProps:{PaperProps:{sx:{bgcolor:a.palette.Colors.Gray["200"],border:`1px solid ${a.palette.Colors.Gray["300"]}`,"& .MuiMenuItem-root":{fontSize:10,fontWeight:600,fontFamily:"Inter",color:a.palette.Colors.Gray["500"],"&:hover":{bgcolor:a.palette.Colors.Gray["300"]},"&.Mui-selected":{bgcolor:a.palette.Colors.Gray["300"],"&:hover":{bgcolor:a.palette.Colors.Gray["300"]}}}}}},children:E.map(e=>(0,r.jsx)(f.Z,{value:e.value,children:e.label},e.value))})})]}),(0,r.jsxs)(m.Z,{loading:L,onClick:Q,disabled:N||L,fullWidth:!0,sx:{height:32,bgcolor:a.palette.Colors.Blue["600"],color:a.palette.Colors.Gray["900"],borderRadius:"5px",gap:1,px:1,py:.5,fontSize:12,fontWeight:700,fontFamily:"Inter",lineHeight:"1.2102272510528564em",textTransform:"none",position:"relative",overflow:"hidden","&:hover":{bgcolor:a.palette.Colors.Blue["500"]},"&:disabled":{bgcolor:a.palette.Colors.Gray["300"],color:a.palette.Colors.Gray["500"]}},startIcon:(0,r.jsx)(I.PhSparkle,{sx:{fontSize:16,color:"inherit"}}),children:[!0===L&&(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,height:"100%",width:`${H}%`,borderRadius:"5px",background:"linear-gradient(90deg, #3e74dd 0%, #4a7ee8 100%)",transition:"width 0.1s ease",zIndex:0}}),(0,r.jsx)(l.Z,{sx:{position:"relative",zIndex:1,display:"flex",alignItems:"center",gap:1},children:L?H<95?"Detecting...":"Finalizing...":G?"Redetect Caption":"Detect Caption"})]}),(0,r.jsx)(b.A,{cost:J,disabled:N,sx:{height:"20px","& .MuiTypography-root":{fontSize:"10px !important"},"& svg":{transform:"scale(0.8)"}}})]})}):null}var T=i(15526),R=i(14360);let D=(0,n.memo)(e=>{let{sx:t}=e,i=(0,u.Z)(),o=T.wK.use.globalConfig(),c=T.wK.use.tracks(),m=T.wK.use.updateGlobalConfig(),x=T.wK.use.updateItemInTrack(),g=T.wK.use.currentTimeInFrames(),{operations:f}=(0,h.ZY)(),v=(0,n.useMemo)(()=>{let e=null==c?void 0:c.filter(e=>"file"===e.type&&"caption"===e.subtype);return(null==e?void 0:e.flatMap(e=>e.items.map(t=>({...t,trackId:e.id}))).sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames))||[]},[c]),b=(0,n.useMemo)(()=>null==c?void 0:c.some(e=>e.items.some(e=>"caption"===e.type)),[c]),y=(0,n.useCallback)(e=>{m({captions:{enabled:e}})},[m]),w=(0,n.useCallback)(e=>{let t=e.code||e.key;("Space"===t||" "===t||"Spacebar"===t)&&e.preventDefault()},[]),C=(0,n.useCallback)((e,t)=>{f.batchOperation("Update Caption Text",()=>{x(e,t)})},[x,f]);return(0,r.jsxs)(s.Z,{direction:"column",sx:{height:"100%",width:"100%",px:1,py:1.5,...t},children:[(0,r.jsx)(M,{}),(0,r.jsxs)(l.Z,{sx:{backgroundColor:i.palette.Colors.Gray["200"],borderRadius:.5,my:1,padding:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(d.Z,{variant:"body2",sx:{color:i.palette.Colors.Gray["900"],fontSize:12,fontWeight:600},children:"Display Caption"}),(0,r.jsx)(p.r,{disabled:!b,checked:o.captions.enabled,onChange:e=>y(e.target.checked),onKeyDown:w,onKeyUp:w,inputProps:{"aria-label":"Display Caption toggle",onKeyDown:w,onKeyUp:w}})]}),v.length>0?(0,r.jsx)(s.Z,{direction:"column",spacing:.5,sx:{flex:1,overflow:"auto",py:b?1.5:0,...R.ji,...(0,R.SZ)(4)},children:v.map(e=>(0,r.jsx)(z,{item:e,onUpdate:C,currentTimeInFrames:g},e.id))}):(0,r.jsxs)(l.Z,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,padding:3},children:[(0,r.jsx)(a(),{src:"https://cdn.openart.ai/story/editor/captionPlaceholder.png",alt:"Caption placeholder",width:117,height:80}),(0,r.jsx)(d.Z,{sx:{fontSize:12,fontWeight:500,color:i.palette.Colors.Gray["500"],textAlign:"center",width:180,lineHeight:"16px"},children:"No caption here"})]})]})});D.displayName="AllMediaAssetsContentCaption";let z=(0,n.memo)(e=>{var t,i,o,a,s,p,h,m;let{item:x,onUpdate:g,currentTimeInFrames:f}=e,[v,b]=(0,n.useState)(!1),[y,w]=(0,n.useState)((null===(i=x.caption)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.text)||""),C=(0,n.useRef)(null),j=T.wK.use.selectItem(),k=(0,u.Z)(),F=(0,n.useMemo)(()=>{let e=x.startTimeInFrames+(x.durationInFrames||0);return f>=x.startTimeInFrames&&f<e},[f,x.startTimeInFrames,x.durationInFrames]),S=(0,n.useCallback)(()=>{var e,t;b(!0),w((null===(t=x.caption)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.text)||""),j(x.id)},[null===(a=x.caption)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.text,j,x.id]),I=(0,n.useCallback)(e=>{var t;g(x.trackId,{id:x.id,caption:{...x.caption,data:{...null===(t=x.caption)||void 0===t?void 0:t.data,text:e}}})},[x,g]),_=(0,n.useCallback)(()=>{b(!1)},[]),Z=(0,n.useCallback)(e=>{if("Enter"!==e.key||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),_()),"Escape"===e.key){var t,i;w((null===(i=x.caption)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.text)||""),_()}},[_,null===(p=x.caption)||void 0===p?void 0:null===(s=p.data)||void 0===s?void 0:s.text]),A=(0,n.useCallback)(e=>{w(e),I(e)},[I]),E=(0,n.useCallback)(()=>{_()},[_]);return((0,n.useEffect)(()=>{v&&C.current&&C.current.focus()},[v]),v)?(0,r.jsx)(l.Z,{sx:{backgroundColor:F?k.palette.Colors.Blue["100"]:k.palette.Colors.Gray["100"],borderRadius:"6px",border:`1px solid ${F?k.palette.Colors.Blue["200"]:k.palette.Colors.Gray["200"]}`,width:"100%"},children:(0,r.jsx)(c.Z,{fullWidth:!0,multiline:!0,minRows:1,maxRows:1/0,value:y,onChange:e=>A(e.target.value),onKeyDown:Z,onBlur:E,inputRef:C,variant:"standard",InputProps:{disableUnderline:!0,sx:{fontSize:10,fontWeight:600,color:k.palette.Colors.Gray["600"],fontFamily:"'Inter', sans-serif",lineHeight:1.4,padding:"8px 12px","& .MuiInputBase-input":{padding:0}}}})}):(0,r.jsx)(l.Z,{onClick:S,sx:{backgroundColor:F?k.palette.Colors.Blue["100"]:k.palette.Colors.Gray["100"],borderRadius:"6px",padding:"8px 12px",width:"100%",cursor:"pointer",border:F?`1px solid ${k.palette.Colors.Blue["200"]}`:"1px solid transparent","&:hover":{backgroundColor:F?k.palette.Colors.Blue["200"]:k.palette.Colors.Gray["200"]}},children:(0,r.jsx)(d.Z,{sx:{fontSize:10,fontWeight:600,color:k.palette.Colors.Gray["600"],fontFamily:"'Inter', sans-serif",lineHeight:1.4,wordBreak:"break-word"},children:(null===(m=x.caption)||void 0===m?void 0:null===(h=m.data)||void 0===h?void 0:h.text)||"Empty caption"})})},(e,t)=>{var i,r,n,o;if((null===(r=e.item.caption)||void 0===r?void 0:null===(i=r.data)||void 0===i?void 0:i.text)!==(null===(o=t.item.caption)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.text)||e.item.startTimeInFrames!==t.item.startTimeInFrames||e.item.durationInFrames!==t.item.durationInFrames)return!1;let a=e.item.startTimeInFrames+(e.item.durationInFrames||0),s=e.currentTimeInFrames>=e.item.startTimeInFrames&&e.currentTimeInFrames<a,l=t.item.startTimeInFrames+(t.item.durationInFrames||0);return s===(t.currentTimeInFrames>=t.item.startTimeInFrames&&t.currentTimeInFrames<l)});z.displayName="CaptionItemComponent";var P=i(25485),W=i(90821),L=i(72755),B=i(19188),H=i(77379),$=i(64150),O=i(98939),U=i(16581),G=i(52961);let N={video:P.Z,image:W.Z,music:L.Z,audio:L.Z},V={video:"video",image:"image",music:"audio",audio:"audio"},K=e=>U.Yi[e]||null,q=e=>void 0!==U.Yi[e],Y=e=>e.startsWith("image/")?"image":e.startsWith("video/")?"video":e.startsWith("audio/")?"audio":null,X=(0,n.memo)(e=>{let{activeTab:t,changeTab:i,storyId:o,sx:a}=e,[s,c]=(0,n.useState)(!1),[u,p]=(0,n.useState)({isValid:!1,errors:[]}),[h,m]=(0,n.useState)({show:!1,message:""}),x=(0,n.useRef)(null),g=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),(0,O.nw)(e.dataTransfer)&&c(!0)},[]),f=(0,n.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),(0,O.nw)(e.dataTransfer)&&0===u.errors.length&&!u.detectedType){var i;let r=Array.from((null===(i=e.dataTransfer)||void 0===i?void 0:i.items)||[]).filter(e=>"file"===e.kind);if(r.length>1){p({isValid:!1,errors:["Only one file can be uploaded at a time"]});return}if(1===r.length){let e=r[0].type;if(!q(e)){let t=Y(e);p({isValid:!1,errors:[t?`${t} files are not supported yet`:"Only image, video, and audio files are supported"]});return}let i=K(e);p({isValid:!0,detectedType:Y(e)||void 0,targetTab:!("music"===i&&"voiceover"===t)&&i||void 0,errors:[]})}}},[u,t]),v=(0,n.useCallback)(e=>{var t;e.preventDefault(),e.stopPropagation();let i=null===(t=x.current)||void 0===t?void 0:t.parentElement;if(!i)return;let r=i.getBoundingClientRect();(e.clientX<=r.left||e.clientX>=r.right||e.clientY<=r.top||e.clientY>=r.bottom)&&(c(!1),p({isValid:!1,errors:[]}))},[]),{uploadAndSaveFileWithUploadingAsset:b}=(0,G.No)(o),y=(0,n.useCallback)(async e=>{var r;e.preventDefault(),e.stopPropagation(),c(!1),p({isValid:!1,errors:[]});let n=Array.from((null===(r=e.dataTransfer)||void 0===r?void 0:r.files)||[]);if(0===n.length)return;if(n.length>1){m({show:!0,message:"Only one file can be uploaded at a time. Please select a single file."});return}let o=n[0];if(!q(o.type)){let e=Y(o.type);m({show:!0,message:e?`${e} files are not supported yet. Please select a supported file type.`:"Only image, video, and audio files are supported. Please select a supported file type."});return}let{errors:a}=(0,O.L5)([o],U.y5);if(a.length>0){m({show:!0,message:a[0]});return}if(u.errors.length>0){m({show:!0,message:u.errors[0]});return}let s=K(o.type);s&&s!==t&&("music"===s&&"voiceover"===t||i(s));try{await b(o,t)}catch(e){console.error("Upload failed:",e)}},[t,i,u,b]),w=(0,n.useCallback)(()=>{c(!1),p({isValid:!1,errors:[]})},[]),C=(0,n.useCallback)(()=>{m({show:!1,message:""})},[]);return(0,n.useEffect)(()=>{var e;let t=null===(e=x.current)||void 0===e?void 0:e.parentElement;if(t)return t.addEventListener("dragenter",g),t.addEventListener("dragover",f),t.addEventListener("dragleave",v),t.addEventListener("drop",y),window.addEventListener("dragend",w),()=>{t.removeEventListener("dragenter",g),t.removeEventListener("dragover",f),t.removeEventListener("dragleave",v),t.removeEventListener("drop",y),window.removeEventListener("dragend",w)}},[g,f,v,y,w]),(0,r.jsxs)(l.Z,{ref:x,sx:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,pointerEvents:s||h.show?"all":"none",...a},children:[(0,r.jsx)($.Z,{in:s,timeout:{enter:200,exit:300},children:(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(8px)",borderRadius:"8px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2},children:(()=>{let{isValid:e,detectedType:i,errors:n,targetTab:o}=u;if(n.length>0&&!e)return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.Z,{sx:{fontSize:48,color:"#FF6B6B"}}),(0,r.jsx)(d.Z,{variant:"h6",sx:{color:"#FF6B6B",fontWeight:600,textAlign:"center"},children:"Invalid file"}),(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#FF6B6B",textAlign:"center",maxWidth:"300px"},children:n[0]})]});let a=i||"image",s=N[a],l=V[a];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{sx:{fontSize:48,color:"#6290FF"}}),(0,r.jsxs)(d.Z,{variant:"h6",sx:{color:"#6290FF",fontWeight:600},children:["Drop to upload ",l]}),o&&o!==t?(0,r.jsxs)(d.Z,{variant:"body2",sx:{color:"#6290FF",opacity:.8},children:["Will switch to ",o," tab"]}):null]})})()})}),(0,r.jsx)($.Z,{in:h.show,timeout:{enter:200,exit:300},children:(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",borderRadius:"8px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2},children:(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,px:4,py:3,maxWidth:"400px",width:"90%"},children:[(0,r.jsx)(B.Z,{sx:{fontSize:48,color:"#FF6B6B"}}),(0,r.jsx)(d.Z,{variant:"h6",sx:{color:"#FF6B6B",fontWeight:600,textAlign:"center"},children:"Upload Error"}),(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#FF6B6B",textAlign:"center",lineHeight:1.5},children:h.message}),(0,r.jsx)(H.Z,{variant:"contained",onClick:C,sx:{mt:2,backgroundColor:"#FF6B6B",color:"white","&:hover":{backgroundColor:"#FF5252"}},children:"Got it"})]})})})]})});X.displayName="MediaAssetsDropZone";var J=i(1299),Q=i(60588),ee=i(23187),et=i(78359),ei=i(87541);let er={image:"image/*",video:"video/*",audio:"audio/*"},en=e=>{let{type:t,subtype:i,storyId:o,sx:a={}}=e,[c,u]=(0,n.useState)(null),[p,h]=(0,n.useState)(),m=(0,n.useRef)(null),x=(0,n.useRef)(null),g=()=>{u(null)},f=e=>{null==e||e(),g()},v=(0,et.fH)(e=>e.setNeedCreateShot),b=()=>{v(!0,"all-shots")},y=()=>{x.current&&x.current.click()},{uploadAndSaveFileWithUploadingAsset:w,isUploading:C}=(0,G.No)(o),j=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){try{await w(r,i)}catch(e){console.error("Upload failed:",e)}x.current&&(x.current.value="")}},k=!!c;(0,n.useEffect)(()=>{let e=e=>{k&&m.current&&!m.current.contains(e.target)&&u(null)};if(k)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[k]);let{handleShowModal:F}=(0,ei.$)({type:"image"===t?"image":"video",storyId:o,maxSelectionCount:10});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{ref:x,type:"file",accept:er[t],style:{display:"none"},onChange:j,disabled:C}),(0,r.jsxs)(l.Z,{ref:m,onClick:e=>{c||h(e.currentTarget.offsetWidth),u(c?null:e.currentTarget)},sx:{height:"40px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",borderRadius:"2px",border:"1px dashed #666",background:"#1A1A1A",cursor:"pointer",opacity:C?.6:1,pointerEvents:C?"none":"auto","&:hover":{borderColor:"#ddd"},...a},children:[(0,r.jsx)(I.PhPlus,{sx:{color:"rgba(255,255,255,0.38)"}}),(0,r.jsx)(d.Z,{sx:{color:"#CCC",fontSize:12,fontWeight:500,lineHeight:"130%",letterSpacing:"-0.24px"},children:C?"Uploading...":"Add"})]}),(0,r.jsx)(Q.ZP,{open:k,anchorEl:c,onClose:g,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{"& .MuiPopover-paper":{backgroundColor:"#111111",border:"1px solid #2E2E2E",borderRadius:"8px",padding:"8px",width:p||"auto",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.3)"}},children:(0,r.jsxs)(s.Z,{spacing:"8px",children:[(0,r.jsxs)(l.Z,{onClick:()=>f(b),sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"8px",cursor:"pointer",borderRadius:"4px",width:"100%","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[(0,r.jsx)(l.Z,{sx:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(I.PhSparkle,{sx:{color:"#FFFFFF",fontSize:"20px"}})}),(0,r.jsx)(d.Z,{sx:{color:"#B3B3B3",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"22px",letterSpacing:"-2%",display:"flex",alignItems:"center"},children:"Create"})]}),(0,r.jsx)(ee.Z,{sx:{borderColor:"#292929",margin:"4px 0"}}),(0,r.jsxs)(l.Z,{onClick:()=>f(()=>{y()}),sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"8px",cursor:"pointer",borderRadius:"4px",width:"100%","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[(0,r.jsx)(l.Z,{sx:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(I.PhUploadSimple,{sx:{color:"#FFFFFF",fontSize:"20px"}})}),(0,r.jsx)(d.Z,{sx:{color:"#B3B3B3",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"22px",letterSpacing:"-2%",display:"flex",alignItems:"center"},children:"Upload"})]}),["image","video"].includes(t)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ee.Z,{sx:{borderColor:"#292929",margin:"4px 0"}}),(0,r.jsxs)(l.Z,{onClick:()=>f(F),sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"8px",cursor:"pointer",borderRadius:"4px",width:"100%","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[(0,r.jsx)(l.Z,{sx:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(I.SolarHistoryBroken,{sx:{color:"#FFFFFF",fontSize:"20px"}})}),(0,r.jsx)(d.Z,{sx:{color:"#B3B3B3",fontFamily:"Inter",fontWeight:600,fontSize:"16px",lineHeight:"22px",letterSpacing:"-2%",display:"flex",alignItems:"center"},children:"History"})]})]})]})})]})};var eo=i(64975);let ea={image:"image/*",video:"video/*",audio:"audio/*"};function es(e){let{type:t="image",subtype:i,storyId:o,hideActions:a=!1}=e,[c,u]=(0,n.useState)(null),p=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,et.fH)(e=>e.setNeedCreateShot),x=()=>{u(null)},g=e=>{null==e||e(),x()},f=()=>{h.current&&h.current.click()},v=()=>{g(f)},{uploadAndSaveFileWithUploadingAsset:b,isUploading:y}=(0,G.No)(o),w=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){try{await b(r,i)}catch(e){console.error("Upload failed:",e)}h.current&&(h.current.value="")}},{handleShowModal:C}=(0,ei.$)({type:"image"===t?"image":"video",storyId:o,maxSelectionCount:10}),j=!!c;(0,n.useEffect)(()=>{let e=e=>{j&&p.current&&!p.current.contains(e.target)&&u(null)};if(j)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[j]);let k=(0,n.useMemo)(()=>"image"===t?(0,r.jsx)(l.Z,{component:"img",src:"https://cdn.openart.ai/story/editor/emptyImage.png",alt:"video-card-illustration",sx:{width:48,height:51,objectFit:"cover",borderRadius:"2px"}}):"video"===t?(0,r.jsx)(l.Z,{component:"img",src:"https://cdn.openart.ai/story/editor/emptyVideo.png",sx:{width:54,height:40,objectFit:"cover",borderRadius:"2px"},alt:"video-card-illustration"}):"voiceover"===i?(0,r.jsx)(l.Z,{component:"img",src:"https://cdn.openart.ai/story/editor/emptyVoiceover.png",sx:{width:64,height:64,objectFit:"cover",borderRadius:"2px"},alt:"video-card-illustration"}):"music"===i?(0,r.jsx)(l.Z,{component:"img",src:"https://cdn.openart.ai/story/editor/emptyMusic.png",sx:{width:64,height:64,objectFit:"cover",borderRadius:"2px"},alt:"video-card-illustration"}):null,[t,i]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{ref:h,type:"file",accept:ea[t],style:{display:"none"},onChange:w,disabled:y}),(0,r.jsxs)(s.Z,{alignItems:"center",justifyContent:"center",spacing:1.5,sx:{width:256,height:216,backgroundColor:"#1A1A1A",borderRadius:"2px",py:2.75,opacity:y?.6:1,pointerEvents:y?"none":"auto"},children:[k,(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#888888",fontSize:12,fontWeight:500,letterSpacing:"-0.02em",textAlign:"center",width:228},children:y?"Uploading...":`No ${t} asset yet.`}),a||"audio"===t?null:(0,r.jsxs)(s.Z,{direction:"row",spacing:1.625,alignItems:"center",children:[(0,r.jsx)(H.Z,{variant:"contained",onClick:()=>{m(!0,"all-shots")},disabled:y,sx:{backgroundColor:"#2E2E2E",color:"#fff",height:28,fontSize:12,minWidth:78,fontWeight:600,letterSpacing:"-0.02em",textTransform:"none",borderRadius:"4px","&:hover":{backgroundColor:"#3E3E3E"},"&:disabled":{backgroundColor:"#2E2E2E",opacity:.6}},startIcon:(0,r.jsx)(I.PhSparkle,{size:12,color:"#2F66FF"}),children:"Create"}),(0,r.jsx)(H.Z,{variant:"contained",onClick:e=>{u(c?null:e.currentTarget)},ref:p,disabled:y,sx:{backgroundColor:"#2E2E2E",color:"#fff",height:28,fontSize:12,minWidth:78,fontWeight:600,letterSpacing:"-0.02em",textTransform:"none",borderRadius:"4px","&:hover":{backgroundColor:"#3E3E3E"},"&:disabled":{backgroundColor:"#2E2E2E",opacity:.6}},startIcon:(0,r.jsx)(l.Z,{sx:{width:12,height:12,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(eo.Z,{sx:{color:"#2F66FF",fontSize:"12px"}})}),children:y?"Uploading...":"Add"}),(0,r.jsx)(Q.ZP,{open:j,anchorEl:c,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{"& .MuiPopover-paper":{backgroundColor:"#111111",border:"1px solid #2E2E2E",borderRadius:"8px",padding:"8px",minWidth:"90px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.3)"}},children:(0,r.jsxs)(s.Z,{spacing:"6px",children:[(0,r.jsxs)(l.Z,{onClick:v,sx:{display:"flex",alignItems:"center",gap:"8px",padding:0,cursor:"pointer","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:"4px"}},children:[(0,r.jsx)(l.Z,{sx:{width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"flex-start"},children:(0,r.jsx)(I.PhUploadSimple,{sx:{color:"#FFFFFF",fontSize:"16px"}})}),(0,r.jsx)(d.Z,{sx:{color:"#B3B3B3",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"22px",letterSpacing:"-2%",height:"20px",display:"flex",alignItems:"center"},children:"Upload"})]}),(0,r.jsx)(ee.Z,{sx:{borderColor:"#292929",margin:0}}),(0,r.jsxs)(l.Z,{onClick:()=>g(C),sx:{display:"flex",alignItems:"center",gap:"8px",padding:0,cursor:"pointer","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:"4px"}},children:[(0,r.jsx)(l.Z,{sx:{width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(I.SolarHistoryBroken,{sx:{color:"#FFFFFF",fontSize:"16px"}})}),(0,r.jsx)(d.Z,{sx:{color:"#B3B3B3",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"22px",letterSpacing:"-2%",height:"20px",display:"flex",alignItems:"center"},children:"History"})]})]})})]}),"audio"===t&&!a&&(0,r.jsx)(H.Z,{variant:"contained",onClick:v,ref:p,disabled:y,sx:{backgroundColor:"#2E2E2E",color:"#fff",height:28,fontSize:12,minWidth:78,fontWeight:600,letterSpacing:"-0.02em",textTransform:"none",borderRadius:"4px"},startIcon:(0,r.jsx)(l.Z,{sx:{width:12,height:12,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(eo.Z,{sx:{color:"#2F66FF",fontSize:"12px"}})}),children:"Upload or drag"})]})]})}var el=i(73676);let ed=(0,n.memo)(e=>{let{storyId:t,sx:i}=e,o=(0,el.oK)({type:"image"}),a=J.wK.use.selectMediaAsset(),l=J.wK.use.setPreviewingMediaAsset(),d=J.wK.use.togglePlay(),c=(0,n.useCallback)(e=>{a(e.id),l(e),d(!1)},[a,l,d]),u=(0,n.useCallback)((e,t)=>(0,r.jsx)(tJ,{mediaAsset:e,onClick:()=>c(e)},e.id||t),[c]);return(0,r.jsx)(s.Z,{sx:{p:1,gap:1,height:"100%",...i},children:0===o.length?(0,r.jsx)(es,{type:"image",storyId:t}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(en,{type:"image",storyId:t}),(0,r.jsx)(t2,{items:o,layout:"grid",renderItem:u,emptyMessage:"No images found",sx:{flex:1}})]})})});ed.displayName="AllMediaAssetsContentImage";let ec=(0,n.memo)(e=>{let{type:t,storyId:i,onClick:o}=e,a="upload"===t,s=(0,n.useRef)(null),{uploadAndSaveFileWithUploadingAsset:c,isUploading:u}=(0,G.No)(i),p=()=>{s.current&&s.current.click()},h=async e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];if(i){try{await c(i,"music")}catch(e){console.error("Upload failed:",e)}s.current&&(s.current.value="")}};return(0,r.jsxs)(l.Z,{onClick:()=>{a&&p(),null==o||o()},sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"4px",padding:"22px 10px",flex:"1 1 50%",height:"45px",backgroundColor:a?"#2E2E2E":"#0C2F75",border:"1px dashed #666666",borderRadius:"2.34375px",cursor:"pointer",opacity:u?.6:1,pointerEvents:u?"none":"auto","&:hover":{opacity:u?.6:.8}},children:[a?(0,r.jsx)("input",{ref:s,type:"file",accept:"audio/*",style:{display:"none"},onChange:h,disabled:u}):null,(0,r.jsx)(l.Z,{sx:{width:"21px",height:"21px",display:"flex",alignItems:"center",justifyContent:"center"},children:a?(0,r.jsx)(I.PhUploadSimple,{sx:{color:"#FFFFFF",fontSize:"16px"}}):(0,r.jsx)(I.PhMagnifyingGlass,{sx:{color:"#FFFFFF",fontSize:"16px"}})}),(0,r.jsx)(d.Z,{sx:{color:"#E3E3E3",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"15.6px",letterSpacing:"-2%",textAlign:"center"},children:a?u?"Uploading...":"Upload":"Browse →"})]})});ec.displayName="ActionCard";let eu=(0,n.memo)(e=>{let{label:t,active:i=!1,onClick:n}=e;return(0,r.jsxs)(l.Z,{onClick:n,sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"3px",height:"20px",backgroundColor:i?"#9CBAFF20":"transparent",borderRadius:"4px",cursor:"pointer",border:i?"1px solid #9CBAFF":"1px solid transparent","&:hover":{opacity:.8,backgroundColor:i?"#9CBAFF30":"#9CBAFF10"}},children:[(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",gap:"4px"},children:(0,r.jsx)(d.Z,{sx:{color:i?"#9CBAFF":"#FFFFFF",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"20px",whiteSpace:"nowrap"},children:t})}),(0,r.jsx)(l.Z,{sx:{width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(I.PhCaretDown,{sx:{color:i?"#9CBAFF":"#808080",fontSize:"11px"}})})]})});eu.displayName="FilterButton";var ep=i(88823),eh=i(60465),em=i(29984),ex=i(82639),eg=i(17856);let ef=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{disabledDrag:t=!1}=e,[i,r]=(0,n.useState)(!1),o=(0,n.useCallback)((e,n)=>{if(i||!n||t)return;let o={source:"media-asset",mediaAssetId:n.id,mediaAssetType:n.resource_type};r(!0),(0,eg.tn)(e.dataTransfer,o),e.dataTransfer.effectAllowed="copy"},[i,t]);return{isDragging:i,handleDragStart:o,handleDragEnd:(0,n.useCallback)(()=>{r(!1)},[])}},ev=e=>`${Math.floor(e/60)}:${Math.round(e%60).toString().padStart(2,"0")}`,eb=(0,n.memo)(e=>{var t,i;let{musicAsset:o,isSelected:a=!1,isApplied:c=!1,isPlaying:u=!1,showAppliedBadge:p=!1,disabledDrag:h=!1,onPlay:m}=e,x=F.wK.use.storyId(),{removeMediaAsset:g,addMediaAsset:f,isDeleting:v,isCreating:b}=(0,el.PJ)(x),y=(0,n.useCallback)(()=>{a?g(o.id):f(o)},[a,g,o,f]),w=o.title||"Unknown Track",C=(null===(t=o.configs)||void 0===t?void 0:t.genre)||"",j=(null===(i=o.metadata)||void 0===i?void 0:i.duration)?ev(o.metadata.duration):"0:00",k=(0,n.useCallback)(()=>{c||g(o.id)},[c,o.id,g]),S=(0,n.useMemo)(()=>(0,r.jsx)(l.Z,{onClick:k,sx:{width:"18px",height:"18px",display:"flex",alignItems:"center",justifyContent:"center",cursor:c?"not-allowed":"pointer"},children:(0,r.jsx)(I.PhXCircle,{sx:{color:"#444444",fontSize:"18px"}})}),[k]),_=(0,n.useMemo)(()=>{if(v||b)return(0,r.jsx)(em.Z,{size:18});if(p)return c?(0,r.jsx)(ex.Z,{title:"You can’t delete this asset as it’s currently in used in the timeline.",placement:"bottom",children:S}):S;let e=(0,r.jsx)(I.PhPlusCircle,{sx:{color:"#00B85F",fontSize:"18px"}});return a&&(e=(0,r.jsx)(ep.Z,{sx:{color:"#1BEF61",fontSize:"18px"}})),(0,r.jsx)(l.Z,{onClick:y,sx:{width:"18px",height:"18px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.1s ease","&:hover":{transform:"scale(1.1)"}},children:e})},[v,b,p,a,y,c,S]),{handleDragStart:Z,handleDragEnd:A,isDragging:E}=ef({disabledDrag:h});return(0,r.jsxs)(l.Z,{draggable:!h,onDragStart:e=>Z(e,o),onDragEnd:A,sx:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"11px",padding:"10px",backgroundColor:u?"#2A2A3A":"#2E2E2E",border:u?"1px solid #9CBAFF":"1px solid #444444",borderRadius:"5px",width:"100%",opacity:E?.5:1,cursor:E?"grabbing":"grab",transition:"all 0.2s ease"},children:[(0,r.jsxs)(s.Z,{direction:"row",alignItems:"center",spacing:"10px",children:[(0,r.jsxs)(l.Z,{onClick:m,sx:{position:"relative",width:"25px",height:"25px",cursor:"pointer",transition:"transform 0.1s ease","&:hover":{transform:"scale(1.1)"}},children:[(0,r.jsx)(l.Z,{sx:{width:"25px",height:"25px",backgroundColor:u?"#9CBAFF":"#101010",borderRadius:"50%",transition:"background-color 0.2s ease"}}),(0,r.jsx)(l.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",alignItems:"center",justifyContent:"center"},children:u?(0,r.jsx)(eh.Z,{sx:{color:"#000000",fontSize:"14px"}}):(0,r.jsx)(I.PhPlayFill,{size:12,sx:{color:"#CCCCCC"}})})]}),(0,r.jsxs)(s.Z,{spacing:"3px",children:[(0,r.jsx)(d.Z,{sx:{color:u?"#9CBAFF":"#FFFFFF",fontFamily:"Inter",fontWeight:u?600:500,fontSize:"12px",lineHeight:"15.6px",letterSpacing:"-2%",transition:"color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"172px"},children:w}),(0,r.jsxs)(s.Z,{direction:"row",alignItems:"center",spacing:"3px",children:[(0,r.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"3px",padding:"0 4px"},children:(0,r.jsxs)(d.Z,{sx:{color:u?"#B8C8FF":"#E1E6FF",fontFamily:"Inter",fontWeight:500,fontSize:"11px",lineHeight:"13.5px",transition:"color 0.2s ease"},children:[C?`${C} • `:""," ",j]})}),u?(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",gap:"2px"},children:[1,2,3].map(e=>(0,r.jsx)(l.Z,{sx:{width:"2px",height:"8px",backgroundColor:"#9CBAFF",borderRadius:"1px",animation:`audioWave${e} 1.2s ease-in-out infinite`,"@keyframes audioWave1":{"0%, 100%":{height:"3px"},"50%":{height:"8px"}},"@keyframes audioWave2":{"0%, 100%":{height:"5px"},"50%":{height:"10px"}},"@keyframes audioWave3":{"0%, 100%":{height:"4px"},"50%":{height:"7px"}}}},e))}):null,p&&c?(0,r.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"16px",backgroundColor:"rgba(27, 239, 97, 0.19)",borderRadius:"4px",padding:"2px 4px"},children:(0,r.jsx)(d.Z,{sx:{color:"rgba(255, 255, 255, 0.43)",fontFamily:"Inter",fontWeight:500,fontSize:"11px",lineHeight:"16px",whiteSpace:"nowrap"},children:"In Use"})}):null]})]})]}),_]})});eb.displayName="MusicItem";var ey=i(46890),ew=i(89187),eC=i(79855);let ej={},ek=(0,n.memo)(e=>{let{mediaAsset:t,layout:i="grid",sx:o=ej,progress:a}=e,s=(0,eC.B)(e=>e.removeUploadingAsset),c=(0,n.useCallback)(()=>{s(t.id)},[t.id,s]);if(!("status"in t))return null;let u="error"===t.status,p="uploading"===t.status||"processing"===t.status;return"grid"===i?(0,r.jsx)(l.Z,{sx:{backgroundColor:u?"#4A2C2C":"#2E2E2E",borderRadius:.4,overflow:"hidden",cursor:"default",width:"100%",height:"100%",aspectRatio:"1/1",border:u?"1px solid #FF6B6B":"1px solid transparent",transition:"all 0.2s ease",opacity:1,position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,"&:hover":{backgroundColor:u?"#5A3232":"#3A3A3A",border:u?"1px solid #FF8A8A":"1px solid #555"},...o},children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.Z,{sx:{fontSize:32,color:"#FF6B6B"}}),(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#FF6B6B",textAlign:"center",fontSize:"0.75rem",fontWeight:600},children:"Upload Failed"}),(0,r.jsx)(ex.Z,{title:t.error||"Unknown error occurred",placement:"top",children:(0,r.jsx)(l.Z,{sx:{width:"100px",color:"#FF9999",textAlign:"center",fontSize:"0.65rem",lineHeight:1.2,overflow:"hidden",wordBreak:"break-all",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.error||"Unknown error occurred"})}),(0,r.jsx)(H.Z,{variant:"outlined",size:"small",onClick:c,sx:{fontSize:"0.65rem",padding:"2px 8px",minWidth:"auto",color:"#FF6B6B",borderColor:"#FF6B6B","&:hover":{backgroundColor:"rgba(255, 107, 107, 0.1)",borderColor:"#FF8A8A"}},children:"Got it"})]}):p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ew.p6,{text:"Uploading..."}),(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,width:`${a??0}%`,height:"100%",backgroundColor:"rgba(1, 63, 254, 0.1)",transition:"width 0.3s ease",zIndex:2,pointerEvents:"none"}})]}):(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#888",textAlign:"center",fontSize:"0.75rem"},children:"Processing..."})}):(0,r.jsxs)(l.Z,{sx:{backgroundColor:u?"#4A2C2C":"#2E2E2E",borderRadius:.4,overflow:"hidden",cursor:"default",width:"100%",height:"56px",border:u?"1px solid #FF6B6B":"1px solid transparent",transition:"all 0.2s ease",opacity:1,position:"relative",display:"flex",flexDirection:"row",alignItems:"center",px:2,py:1,gap:2,"&:hover":{backgroundColor:u?"#5A3232":"#3A3A3A",border:u?"1px solid #FF8A8A":"1px solid #555"},...o},children:[(0,r.jsx)(l.Z,{sx:{width:40,height:40,borderRadius:.4,backgroundColor:u?"#FF6B6B":"#4A4A4A",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:u?(0,r.jsx)(B.Z,{sx:{fontSize:20,color:"#FFFFFF"}}):(0,r.jsx)(L.Z,{sx:{fontSize:20,color:"#FFFFFF"}})}),(0,r.jsxs)(l.Z,{sx:{flex:1,display:"flex",flexDirection:"column",gap:.5,minWidth:0},children:[(0,r.jsx)(d.Z,{variant:"body2",sx:{color:u?"#FF6B6B":"#FFFFFF",fontWeight:500,fontSize:"0.85rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"fileName"in t?t.fileName:t.title}),u?(0,r.jsx)(ex.Z,{title:t.error||"Unknown error occurred",placement:"top",children:(0,r.jsx)(d.Z,{variant:"caption",sx:{color:"#FF9999",fontSize:"0.7rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.error||"Upload failed"})}):p?(0,r.jsx)(l.Z,{sx:{width:"100%"},children:(0,r.jsx)(ey.Z,{variant:void 0!==a?"determinate":"indeterminate",value:void 0!==a?a:void 0,sx:{height:3,borderRadius:1.5,backgroundColor:"rgba(255, 255, 255, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:"#6290FF"}}})}):(0,r.jsx)(d.Z,{variant:"caption",sx:{color:"#888",fontSize:"0.7rem"},children:"Processing..."})]}),u?(0,r.jsx)(H.Z,{variant:"outlined",size:"small",onClick:c,sx:{fontSize:"0.7rem",padding:"4px 12px",minWidth:"auto",color:"#FF6B6B",borderColor:"#FF6B6B",flexShrink:0,"&:hover":{backgroundColor:"rgba(255, 107, 107, 0.1)",borderColor:"#FF8A8A"}},children:"Got it"}):null]})});ek.displayName="MediaAssetItemUploading";var eF=i(72757),eS=i(88295);let eI=(0,n.memo)(e=>{let{storyId:t,onUpload:i,onBrowse:o}=e,a=(0,el.oK)({type:"audio",subtype:"music"}),{handlePlayAudio:l,currentPlayingId:d,isPlaying:c}=(0,eF.b)(),[u]=(0,eS.hH)(),p=(0,n.useMemo)(()=>u.flatMap(e=>e.items.map(e=>e.mediaAssetId)),[u]);return(0,r.jsxs)(s.Z,{spacing:"12px",sx:{alignItems:"center",padding:"0px 0 12px",width:"100%",backgroundColor:"#1A1A1A",borderRadius:"12px"},children:[(0,r.jsxs)(s.Z,{direction:"row",spacing:"5px",sx:{width:"100%"},children:[(0,r.jsx)(ec,{type:"upload",storyId:t,onClick:i}),(0,r.jsx)(ec,{type:"browse",onClick:o})]}),0===a.length?(0,r.jsx)(es,{type:"audio",subtype:"music",storyId:t,hideActions:!0}):a.map(e=>"uploading"===e.status||"error"===e.status?(0,r.jsx)(ek,{mediaAsset:e,layout:"list"},e.id):(0,r.jsx)(eb,{musicAsset:e,isApplied:p.includes(e.id),showAppliedBadge:!0,isPlaying:d===e.id&&c,onPlay:()=>l(e)},e.id))]})});eI.displayName="MusicHomeView";var e_=i(11685),eZ=i(53152),eA=i(59147);let eE=e=>({id:e.id.toString(),title:e.name,url:e.url,resource_type:"audio",subtype:"music",source:"generated",user_id:"",is_deleted:!1,created_at:Date.now(),metadata:{duration:e.duration},configs:{genre:e.genre,mood:e.mood,tempo:e.tempo,has_lyrics:e.has_lyrics}}),eM=()=>{let e=new Set,t=new Set,i=new Set;return S.WK.forEach(r=>{e.add(r.genre),i.add(r.tempo),r.mood.split(",").map(e=>e.trim()).forEach(e=>t.add(e))}),{genres:Array.from(e).sort(),moods:Array.from(t).sort(),tempos:Array.from(i).sort()}},eT=(0,n.memo)(e=>{let{searchQuery:t,onBack:i,onSearch:o,onGenreFilter:a,onMoodFilter:c,onTempoFilter:u}=e,[p,h]=(0,n.useState)([]),[m,x]=(0,n.useState)([]),[g,v]=(0,n.useState)([]),{handlePlayAudio:b,currentPlayingId:y,isPlaying:w}=(0,eF.b)(),[C,j]=(0,n.useState)({genre:null,mood:null,tempo:null}),k=(0,n.useMemo)(()=>eM(),[]),F=(0,n.useMemo)(()=>{let e=S.WK;if(t&&t.trim()){let i=t.toLowerCase().trim();e=e.filter(e=>e.name.toLowerCase().includes(i)||e.genre.toLowerCase().includes(i)||e.mood.toLowerCase().includes(i)||e.tempo.toLowerCase().includes(i))}return p.length>0&&(e=e.filter(e=>p.includes(e.genre))),m.length>0&&(e=e.filter(e=>{let t=new Set(e.mood.split(",").map(e=>e.trim()));return m.some(e=>t.has(e))})),g.length>0&&(e=e.filter(e=>g.includes(e.tempo))),e.map(eE)},[t,p,m,g]),I=(e,t)=>{j(i=>({...i,[e]:t.currentTarget}))},_=e=>{j(t=>({...t,[e]:null}))},Z=(e,t)=>{switch(e){case"genre":h(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);break;case"mood":x(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);break;case"tempo":v(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}},A=(0,T.hs)("audio","music"),E=(0,n.useMemo)(()=>A.map(e=>e.url),[A]),M=e=>{let t=k[`${e}s`],i="genre"===e?p:"mood"===e?m:g;return(0,r.jsx)(e_.Z,{anchorEl:C[e],open:!!C[e],onClose:()=>_(e),PaperProps:{sx:{backgroundColor:"#2A2A2A",color:"#FFFFFF",maxHeight:300,width:200,"& .MuiMenuItem-root":{fontSize:"14px",fontFamily:"Inter","&:hover":{backgroundColor:"#3A3A3A"}}}},children:t.map(t=>(0,r.jsxs)(f.Z,{onClick:()=>Z(e,t),sx:{padding:"6px 12px"},children:[(0,r.jsx)(eZ.Z,{checked:i.includes(t),sx:{color:"#9CBAFF","&.Mui-checked":{color:"#9CBAFF"},"& .MuiSvgIcon-root":{fontSize:18}}}),(0,r.jsx)(eA.Z,{primary:t,sx:{"& .MuiListItemText-primary":{fontSize:"14px",fontFamily:"Inter"}}})]},t))})};return(0,r.jsxs)(s.Z,{spacing:"12px",sx:{alignItems:"center",padding:"0px 8px 12px",width:"100%",backgroundColor:"#1A1A1A",borderRadius:"12px"},children:[(0,r.jsxs)(s.Z,{direction:"row",justifyContent:"space-between",spacing:"0",sx:{width:"100%"},children:[(0,r.jsx)(s.Z,{direction:"row",justifyContent:"space-between",sx:{width:"100%"},children:(0,r.jsx)(l.Z,{onClick:i,sx:{display:"flex",alignItems:"center",cursor:"pointer"},children:(0,r.jsx)(d.Z,{sx:{color:"#9CBAFF",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"16px",letterSpacing:"-2%"},children:"← Back"})})}),(0,r.jsxs)(s.Z,{direction:"row",alignItems:"center",spacing:"0px",children:[(0,r.jsx)(eu,{label:`Genre${p.length>0?` (${p.length})`:""}`,onClick:e=>I("genre",e),active:!!C.genre||p.length>0}),(0,r.jsx)(eu,{label:`Mood${m.length>0?` (${m.length})`:""}`,onClick:e=>I("mood",e),active:!!C.mood||m.length>0}),(0,r.jsx)(eu,{label:`Tempo${g.length>0?` (${g.length})`:""}`,onClick:e=>I("tempo",e),active:!!C.tempo||g.length>0})]}),M("genre"),M("mood"),M("tempo")]}),(0,r.jsx)(s.Z,{spacing:"12px",sx:{width:"100%",alignItems:"center"},children:F.map(e=>(0,r.jsx)(eb,{musicAsset:e,isSelected:E.includes(e.url),isPlaying:y===e.id&&w,disabledDrag:!0,onPlay:()=>b(e)},e.id))}),0===F.length&&(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100px"},children:(0,r.jsx)(d.Z,{sx:{color:"#666666",fontFamily:"Inter",fontWeight:400,fontSize:"14px"},children:"No music found"})})]})});eT.displayName="MusicSearchView";var eR=i(12180);let eD=(0,n.memo)(e=>{let{placeholder:t="Search 200+ songs in library",value:i="",variant:o="home",onSearch:a,onFocus:s,onBlur:d}=e,[c,u]=(0,n.useState)(i),p=(0,n.useCallback)(e=>{let t=e.target.value;u(t),null==a||a(t)},[a]),h=(0,n.useCallback)(e=>{"Enter"===e.key&&(null==a||a(c))},[c,a]),m="search"===o;return(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",gap:"7px"},children:(0,r.jsx)(l.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"100px",padding:"6px 11px 6px 8px",width:"100%",height:"28px",border:m?"1px solid #2E2E2E":"1px solid #444444",borderRadius:"5px","&:focus-within":{borderColor:m?"#444444":"#666666"}},children:(0,r.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:"8px",flex:1},children:[(0,r.jsx)(l.Z,{sx:{width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(I.PhMagnifyingGlass,{sx:{color:"#FFFFFF",fontSize:"13px"}})}),(0,r.jsx)(eR.ZP,{value:c,onChange:p,onKeyPress:h,onFocus:s,onBlur:d,placeholder:t,sx:{flex:1,color:m?"#818181":"#FFFFFF",fontFamily:"Inter",fontWeight:400,fontSize:"12px",lineHeight:"16px",letterSpacing:"-2%","& .MuiInputBase-input":{padding:0,color:"inherit","&::placeholder":{color:m?"#818181":"rgba(255, 255, 255, 0.45)",opacity:1}}}})]})})})});eD.displayName="SearchBar";let ez=(0,n.memo)(e=>{let{storyId:t,sx:i}=e,[o,a]=(0,n.useState)("home"),[l,d]=(0,n.useState)(""),c=(0,n.useCallback)(()=>{},[]),u=(0,n.useCallback)(()=>{a("search")},[]),p=(0,n.useCallback)(()=>{"home"===o&&a("search")},[o]),h=(0,n.useCallback)(()=>{a("home"),d("")},[]),m=(0,n.useCallback)(e=>{d(e),e&&"home"===o&&a("search")},[o]),x=(0,n.useCallback)(()=>{},[]),g=(0,n.useCallback)(()=>{},[]),f=(0,n.useCallback)(()=>{},[]);return(0,r.jsxs)(s.Z,{sx:{p:1,gap:1.5,height:"100%",...i},children:[(0,r.jsx)(eD,{value:l,variant:"home",placeholder:"Search 200+ songs in library",onSearch:m,onFocus:p}),"home"===o?(0,r.jsx)(eI,{storyId:t,onUpload:c,onBrowse:u}):(0,r.jsx)(eT,{searchQuery:l,onBack:h,onSearch:m,onGenreFilter:x,onMoodFilter:g,onTempoFilter:f})]})});ez.displayName="AllMediaAssetsContentMusic";var eP=i(90999);let eW=(0,n.memo)(e=>{let{storyId:t,sx:i}=e,o=(0,el.oK)({type:"video"}),a=T.wK.use.togglePlay(),l=T.wK.use.selectMediaAsset(),d=T.wK.use.selectedMediaAssetId(),c=T.wK.use.setPreviewingMediaAsset(),{removeMediaAsset:u}=(0,el.PJ)(t),p=(0,n.useCallback)(e=>{let t=eP.D.getState();if((0,T.CN)(t,e.id)){(0,Z.VW)("This video is in use and cannot be deleted.",{key:`video-in-use-${e.id}`});return}u(e.id)},[u]),h=(0,n.useCallback)(e=>{l(e.id),c(e),a(!1)},[l,c,a]),m=(0,n.useCallback)((e,t)=>(0,r.jsx)(tQ,{isSelected:d===e.id,mediaAsset:e,onClick:()=>h(e),onRemove:p},e.id||t),[h,d,p]);return(0,r.jsx)(s.Z,{sx:{p:1,gap:1,height:"100%",...i},children:0===o.length?(0,r.jsx)(es,{type:"video",storyId:t}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(en,{type:"video",storyId:t}),(0,r.jsx)(t2,{items:o,layout:"grid",renderItem:m,emptyMessage:"No videos found",sx:{flex:1}})]})})});eW.displayName="AllMediaAssetsContentVideo";let eL=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,eB=(0,n.memo)(e=>{var t;let{voiceoverAsset:i,isPlaying:o,onPlay:a,stopAudio:c}=e,u=i.title||`Voiceover ${i.id.slice(0,8)}`,p=(null===(t=i.metadata)||void 0===t?void 0:t.duration)?eL(i.metadata.duration):"0:00",[h]=(0,eS.Eh)(),m=(0,n.useRef)(null),[x,g]=(0,n.useState)(!1),f=(0,n.useMemo)(()=>h.some(e=>e.items.some(e=>e.mediaAssetId===i.id)),[h,i.id]);(0,n.useEffect)(()=>{let e=m.current;e&&g(e.scrollWidth>e.clientWidth)},[u]);let{isDragging:v,handleDragStart:b,handleDragEnd:y}=ef(),w=J.wK.use.storyId(),{removeMediaAsset:C,isDeleting:j,isCreating:k}=(0,el.PJ)(w),F=(0,n.useCallback)(()=>{f||(o&&c(),C(i.id))},[f,o,c,i.id,C]),S=(0,n.useMemo)(()=>(0,r.jsx)(l.Z,{onClick:F,sx:{width:"18px",height:"18px",cursor:f?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(I.PhXCircle,{sx:{color:"#444444",fontSize:"18px"}})}),[F,f]),_=(0,n.useMemo)(()=>j||k?(0,r.jsx)(em.Z,{size:18}):f?(0,r.jsx)(ex.Z,{title:"You can't delete this asset as it's currently in used in the timeline.",placement:"bottom",children:S}):S,[j,k,f,S]),Z=(0,r.jsx)(d.Z,{ref:m,sx:{fontFamily:"Inter",fontWeight:o?600:500,fontSize:"12px",lineHeight:1.3,letterSpacing:"-0.02em",color:o?"#9CBAFF":"#FFFFFF",textAlign:"center",transition:"color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:"1 1 auto"},children:u});return(0,r.jsxs)(l.Z,{component:"div",draggable:!0,onDragStart:e=>b(e,i),onDragEnd:y,sx:{display:"flex",alignItems:"center",alignSelf:"stretch",gap:"11px",padding:"10px",backgroundColor:o?"#2A2A3A":"#2E2E2E",border:o?"1px solid #9CBAFF":"1px solid #444444",borderRadius:"5px",cursor:v?"grabbing":"grab",transition:"all 0.2s ease",opacity:v?.5:1,"&:hover":{backgroundColor:o?"#2A2A3A":"#353535"}},children:[(0,r.jsxs)(l.Z,{onClick:a,sx:{position:"relative",width:"25px",height:"25px",cursor:"pointer",transition:"transform 0.1s ease","&:hover":{transform:"scale(1.1)"}},children:[(0,r.jsx)(l.Z,{sx:{width:"25px",height:"25px",backgroundColor:o?"#9CBAFF":"#101010",borderRadius:"50%",transition:"background-color 0.2s ease"}}),(0,r.jsx)(l.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",alignItems:"center",justifyContent:"center"},children:o?(0,r.jsx)(eh.Z,{sx:{color:"#000000",fontSize:"14px"}}):(0,r.jsx)(I.PhPlayFill,{size:12,sx:{color:"#CCCCCC"}})})]}),(0,r.jsxs)(s.Z,{direction:"row",alignItems:"center",gap:"8px",sx:{flex:"1 1 auto",overflow:"hidden"},children:[x?(0,r.jsx)(ex.Z,{title:u,placement:"top",children:Z}):Z,(0,r.jsxs)(s.Z,{direction:"row",alignItems:"center",gap:"3px",children:[(0,r.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"1.6875px",height:"18px",borderRadius:"2.8125px",padding:"0 4px"},children:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"11px",lineHeight:"13.5px",color:o?"#B8C8FF":"#888888",transition:"color 0.2s ease"},children:p})}),o?(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",gap:"2px"},children:[1,2,3].map(e=>(0,r.jsx)(l.Z,{sx:{width:"2px",height:"8px",backgroundColor:"#9CBAFF",borderRadius:"1px",animation:`audioWave${e} 1.2s ease-in-out infinite`,"@keyframes audioWave1":{"0%, 100%":{height:"3px"},"50%":{height:"8px"}},"@keyframes audioWave2":{"0%, 100%":{height:"5px"},"50%":{height:"10px"}},"@keyframes audioWave3":{"0%, 100%":{height:"4px"},"50%":{height:"7px"}}}},e))}):null,f?(0,r.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"2px 4px",height:"16px",backgroundColor:"rgba(27, 239, 97, 0.19)",borderRadius:"4px"},children:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"11px",lineHeight:"16px",textAlign:"center",color:"rgba(255, 255, 255, 0.43)"},children:"In Use"})}):null]})]}),_]})});eB.displayName="VoiceoverItem";let eH=(0,n.memo)(e=>{let{storyId:t,sx:i}=e,o=(0,el.oK)({type:"audio",subtype:"voiceover"}),{handlePlayAudio:a,stopAudio:l,currentPlayingId:d,isPlaying:c}=(0,eF.b)(),u=(0,n.useCallback)((e,t)=>"uploading"===e.status||"error"===e.status?(0,r.jsx)(ek,{mediaAsset:e,layout:"list",sx:{flex:"0 0 auto"}},e.id):(0,r.jsx)(eB,{voiceoverAsset:e,isPlaying:d===e.id&&c,onPlay:()=>a(e),stopAudio:l},e.id||t),[d,c,a,l]);return(0,r.jsx)(s.Z,{sx:{p:1,gap:"8px",height:"100%",...i},children:0===o.length?(0,r.jsx)(es,{type:"audio",subtype:"voiceover",storyId:t}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(en,{type:"audio",subtype:"voiceover",storyId:t,sx:{flex:"0 0 auto"}}),o.map(u)]})})});eH.displayName="AllMediaAssetsContentVoiceover";var e$=i(85021),eO=i(91365),eU=i(3689),eG=i(55802),eN=i(15398),eV=i(8928),eK=i(75962),eq=i(23638);let eY=[{value:"video",label:"Videos",icon:(0,r.jsx)(e$.Z,{}),activeIcon:(0,r.jsx)(eO.Z,{})},{value:"image",label:"Images",icon:(0,r.jsx)(eU.Z,{}),activeIcon:(0,r.jsx)(W.Z,{})},{value:"music",label:"Music",icon:(0,r.jsx)(I.PhMusicNotes,{}),activeIcon:(0,r.jsx)(I.PhMusicNotesFill,{})},{value:"voiceover",label:"Voiceover",icon:(0,r.jsx)(I.RiSpeakAiLine,{}),activeIcon:(0,r.jsx)(I.RiSpeakAiFill,{})},{value:"caption",label:"Captions",icon:(0,r.jsx)(I.PhTextT,{}),activeIcon:(0,r.jsx)(I.PhTextTBold,{})}],eX=(0,eV.ZP)(eG.Z)(e=>{let{theme:t}=e;return{position:"relative",backgroundColor:"#2E2E2E",borderRadius:"10px 10px 0 0",minHeight:45,"& .MuiTabs-flexContainer":{justifyContent:"space-between",alignItems:"center",height:45},"& .MuiTabs-indicator":{backgroundColor:"#6290FF",height:3,borderRadius:"10px 10px 0 0",bottom:0,transition:t.transitions.create(["left","width"],{duration:t.transitions.duration.standard,easing:t.transitions.easing.easeInOut})},"& .MuiTab-root":{minWidth:"0 !important",minHeight:"100% !important",margin:"0 !important",flexGrow:3,flexShrink:1,padding:"0 !important",color:"#AAAAAA",transition:t.transitions.create(["color"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeInOut}),"&:hover":{color:"#E0E0E0"},"&.Mui-selected":{color:"#FFFFFF",flex:7},"& .MuiSvgIcon-root":{fontSize:18,transition:t.transitions.create(["color"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeInOut})},"&:hover .MuiSvgIcon-root":{color:"#E0E0E0"},"&.Mui-selected .MuiTouchRipple-root":{borderRadius:0}}}}),eJ={hidden:{opacity:0,width:0,marginLeft:0},visible:{opacity:1,width:"auto",marginLeft:4,transition:{duration:.3,ease:[.43,.13,.23,.96]}},exit:{opacity:0,width:0,marginLeft:0,transition:{duration:.2,ease:[.43,.13,.23,.96]}}},eQ=(0,n.memo)(e=>{let{activeTab:t,onTabChange:i,sx:o}=e,[a,s]=(0,n.useState)(null),d=e=>{s(e)},c=()=>{s(null)},u=e=>{let i=t===e.value,n=a===e.value,o=i||n;return(0,r.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",overflow:"hidden"},children:[(0,r.jsx)(l.Z,{component:eK.m.div,animate:{scale:o?1.05:1},transition:{duration:.2,ease:[.43,.13,.23,.96]},sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:o?e.activeIcon:e.icon}),(0,r.jsx)(eq.M,{mode:"wait",children:i?(0,r.jsx)(l.Z,{component:eK.m.div,variants:eJ,initial:"hidden",animate:"visible",exit:"exit",sx:{fontSize:14,fontWeight:700,color:"#FFFFFF",whiteSpace:"nowrap",overflow:"hidden"},children:e.label},`label-${e.value}`):null})]})};return(0,r.jsx)(l.Z,{sx:{width:O.Bx,...o},children:(0,r.jsx)(eX,{value:t,onChange:(e,t)=>{i(t)},"aria-label":"media assets tabs",children:eY.map(e=>(0,r.jsx)(eN.Z,{value:e.value,title:e.label,onMouseEnter:()=>d(e.value),onMouseLeave:c,label:u(e),sx:{flex:1,maxWidth:"none"}},e.value))})})});eQ.displayName="AllMediaAssetsHeader";let e0=(0,n.memo)(e=>{let{storyId:t,sx:i}=e,{activeTab:o,setActiveTab:a}=(0,T.WL)(),d=(0,n.useCallback)(e=>{a(e)},[a]);return(0,r.jsx)(rv,{sx:i,title:(0,r.jsx)(eQ,{activeTab:o,onTabChange:d}),children:(0,r.jsx)(s.Z,{sx:{height:"100%",position:"relative"},children:(0,r.jsxs)(l.Z,{sx:{flex:1,position:"relative",overflowY:"auto",...R.ji},children:[(()=>{switch(o){case"video":default:return(0,r.jsx)(eW,{storyId:t});case"image":return(0,r.jsx)(ed,{storyId:t});case"music":return(0,r.jsx)(ez,{storyId:t});case"voiceover":return(0,r.jsx)(eH,{storyId:t});case"caption":return(0,r.jsx)(D,{})}})(),(0,r.jsx)(X,{activeTab:o,changeTab:d,storyId:t})]})})})});e0.displayName="AllMediaAssetsPane";let e1=(0,n.memo)(e=>{let{sx:t,children:i,textStyle:n}=e;return(0,r.jsx)(l.Z,{sx:{position:"absolute",display:"flex",alignItems:"center",padding:"0px 4px",height:"18px",backgroundColor:"rgba(13, 15, 31, 0.5)",backdropFilter:"blur(4px)",borderRadius:"3px",...t},children:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"11px",lineHeight:"13.5px",color:"#E1E6FF",...n},children:i})})});e1.displayName="BlurTile";let e2=(0,n.memo)(e=>{let{sx:t,playerRef:i}=e,o=T.wK.use.previewingMediaAsset(),a=T.wK.use.globalConfig(),d=T.wK.use.tracks(),c=T.wK.use.storyId(),u=T.wK.use.mediaAssets(),p=(0,n.useMemo)(()=>({id:c,video_editor_timeline:{tracks:d,mediaAssets:u,globalConfig:a}}),[d,u,a,c]),h=(0,n.useMemo)(()=>o&&("video"===o.resource_type||"image"===o.resource_type),[o]),m=(0,n.useMemo)(()=>0===(null==d?void 0:d.filter(e=>(null==e?void 0:e.items.length)>0)).length||!d,[d]);return(0,r.jsxs)(s.Z,{sx:{flexDirection:"column",borderRadius:1.5,overflow:"hidden",position:"relative",height:"100%",width:"100%",backgroundColor:m?"#101010":"#4C4C4C33",...t},children:[(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:h?1:0},children:(0,r.jsx)(t0,{mediaAsset:o})}),(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:h?0:1},children:(0,r.jsx)(iW,{playerRef:i,storyData:p})})]})});e2.displayName="CenterStage",(0,n.memo)(e=>{let{sx:t,prompt:i,type:n,onClickToJump:o}=e;return(0,r.jsxs)(s.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{backgroundColor:"#2E2E2E",gap:"10px",padding:"10px",width:"100%",height:U.ep,...t},children:[(0,r.jsx)(l.Z,{sx:{backgroundColor:"#1A1A1A",borderRadius:"5.5px",padding:"8px 10.5px",flex:1,display:"flex",alignItems:"center",height:"fit-content"},children:(0,r.jsx)(d.Z,{sx:{color:"#888888",fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:"1.5em",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:i})}),(0,r.jsxs)(H.Z,{onClick:o,sx:{backgroundColor:"#101010",borderRadius:"5px",height:"30px",display:"flex",px:1.5,py:.5,gap:1,alignItems:"center",justifyContent:"center","&:hover":{backgroundColor:"#202020"},"&:active":{backgroundColor:"#0A0A0A"}},children:[(0,r.jsxs)(d.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontWeight:600,fontSize:"14px",lineHeight:"1.21em",textTransform:"none"},children:["Retry ","video"===n?"Video":"Image"]}),(0,r.jsxs)(l.Z,{sx:{position:"relative",width:26,height:20,display:"flex",alignItems:"center"},children:[(0,r.jsx)(I.PhCurrencyEth,{}),(0,r.jsx)(d.Z,{sx:{color:"#FFFFFF",fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:"1.8em",letterSpacing:"-2%",width:14,height:20,display:"flex",alignItems:"center"},children:"20"})]})]})]})}).displayName="CenterStageFooter",i(35301);var e5=i(75132),e6=i(89363),e4=i(33681),e3=i(98626),e8=(i(19509),i(67936));let e9=(0,n.memo)(e=>{let{icon:t,title:i,value:o,min:a,max:u,step:p,formatDisplay:h,formatInput:m,parseInput:x,validateInput:g,onChange:f,direction:v="column",labelAreaSx:b,labelTextSx:y}=e,[w,C]=(0,n.useState)(""),[j,k]=(0,n.useState)(!1),F=(0,n.useCallback)(e=>{f(Array.isArray(e)?e[0]:e)},[f]),S=(0,n.useCallback)(()=>{k(!0),C(m(o))},[o,m]),I=(0,n.useCallback)(e=>{C(e.target.value)},[]),_=(0,n.useCallback)(()=>{let e=x(w);!Number.isNaN(e)&&g(e)&&f(e),k(!1),C("")},[w,x,g,f]),Z=(0,n.useCallback)(e=>{"Enter"===e.key?_():"Escape"===e.key&&(k(!1),C(""))},[_]),A=(0,n.useCallback)(()=>{_()},[_]),E=(0,r.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1,mb:"column"===v?.5:0,width:"row"===v?"50%":"100%",...b},children:[t?(0,r.jsx)(t,{sx:{fontSize:18,color:"#ffffff"}}):null,(0,r.jsx)(d.Z,{variant:"body2",sx:{fontSize:12,fontWeight:600,color:"#ffffff",...y},children:i})]}),M=(0,r.jsxs)(s.Z,{sx:{position:"relative",alignItems:"center",flexDirection:"row",gap:1,mb:"column"===v?1:0},children:[(0,r.jsx)(e8.ZP,{value:o,onChange:(e,t)=>F(t),min:a,max:u,step:p,sx:{color:"#6643FF",height:3,flex:1,"& .MuiSlider-track":{border:"none",background:"white"},"& .MuiSlider-rail":{color:"#494949",height:3},"& .MuiSlider-thumb":{height:12,width:12,backgroundColor:"#ffffff",border:"2px solid #0929F7",filter:"drop-shadow(0px 1px 1.6px rgba(0, 0, 0, 1))","&:focus, &:hover, &.Mui-active, &.Mui-focusVisible":{boxShadow:"inherit"},"&::before":{display:"none"}},"& .MuiSlider-markLabel":{display:"none"}}}),j?(0,r.jsx)(c.Z,{value:w,onChange:I,onKeyDown:Z,onBlur:A,size:"small",type:"number",inputProps:{min:m(a),max:m(u),step:m(p),style:{textAlign:"center"}},sx:{width:60,"& .MuiOutlinedInput-root":{bgcolor:"#454545",borderRadius:.5,height:24,"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"1px solid #6643FF"}},"& .MuiOutlinedInput-input":{fontSize:12,color:"#ffffff",letterSpacing:"-0.24px",fontFamily:"Inter, sans-serif",fontWeight:400,padding:"4px 8px",textAlign:"center"}}}):(0,r.jsx)(l.Z,{onClick:S,sx:{bgcolor:"#454545",borderRadius:.5,px:1,py:.5,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",minWidth:60,"&:hover":{bgcolor:"#505050"}},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{fontSize:12,color:"#ffffff",letterSpacing:"-0.24px",lineHeight:"12px",fontFamily:"Inter, sans-serif",fontWeight:400,whiteSpace:"nowrap"},children:h(o)})})]});return(0,r.jsx)(l.Z,{sx:{display:"flex",flexDirection:"row"===v?"row":"column",alignItems:"row"===v?"center":"stretch",gap:"row"===v?1:0,width:"100%"},children:"row"===v?(0,r.jsxs)(r.Fragment,{children:[E,(0,r.jsx)(l.Z,{sx:{flex:1,width:"100%"},children:M})]}):(0,r.jsxs)(r.Fragment,{children:[E,M]})})});e9.displayName="EditPropertySliderInput";let e7=(0,n.memo)(e=>{let{item:t}=e,i=(0,F.D)(e=>e.updateItemInTrack),o=(0,F.D)(e=>e.updateItemSpeed),a=(0,F.D)(e=>e.tracks),s=(0,F.D)(e=>e.mediaAssets),d=(0,F.D)(e=>e.globalConfig),{operations:c}=(0,h.ZY)(),u=a.find(e=>e.items.some(e=>e.id===t.id)),p=(0,n.useMemo)(()=>s.find(e=>e.id===t.mediaAssetId),[s,t.mediaAssetId]),m=t.durationInFrames/O.UG/2,x=(0,n.useMemo)(()=>({startFrame:t.startTimeInFrames,endFrame:t.startTimeInFrames+t.durationInFrames}),[t.startTimeInFrames,t.durationInFrames]),g=((0,n.useMemo)(()=>({startTime:(0,O.DG)(x.startFrame,d.fps),endTime:(0,O.DG)(x.endFrame,d.fps)}),[x,d.fps]),(0,n.useCallback)(e=>{if(!e)return 0;let t=e.find(e=>"fade-in"===e.type);return t?t.durationInFrames/O.UG:0},[])),f=(0,n.useCallback)(e=>{if(!e)return 0;let t=e.find(e=>"fade-out"===e.type);return t?t.durationInFrames/O.UG:0},[]),v=(0,n.useCallback)(e=>{u&&c.batchOperation("Update audio volume",()=>{i(u.id,{id:t.id,volume:e})})},[t.id,c,u,i]),b=(0,n.useCallback)(e=>{c.batchOperation("Update audio speed",()=>{o(t.id,e)})},[t.id,c,o]),y=(0,n.useCallback)(e=>{if(!u)return;let r=e*O.UG,n=(t.effects||[]).filter(e=>"fade-in"!==e.type),o=r>0?[...n,{type:"fade-in",durationInFrames:r}]:n;c.batchOperation("Update audio fade-in",()=>{i(u.id,{id:t.id,effects:o})})},[u,t.effects,t.id,c,i]),w=(0,n.useCallback)(e=>{if(!u)return;let r=e*O.UG,n=(t.effects||[]).filter(e=>"fade-out"!==e.type),o=r>0?[...n,{type:"fade-out",durationInFrames:r}]:n;c.batchOperation("Update audio fade-out",()=>{i(u.id,{id:t.id,effects:o})})},[u,t.effects,t.id,c,i]),[C,j]=((0,n.useCallback)(e=>{u&&c.batchOperation("Update Audio Start Time",()=>{i(u.id,{id:t.id,startTimeInFrames:e})})},[t.id,c,u,i]),(0,n.useCallback)(e=>{u&&c.batchOperation("Update Audio Duration",()=>{i(u.id,{id:t.id,durationInFrames:e})})},[t.id,c,u,i]),(0,n.useCallback)(e=>{u&&c.batchOperation("Update Audio Source Trim Start",()=>{i(u.id,{id:t.id,sourceTrimStartFrames:e})})},[t.id,c,u,i]),(0,n.useCallback)(e=>{u&&c.batchOperation("Update Audio Source Trim End",()=>{i(u.id,{id:t.id,sourceTrimEndFrames:e})})},[t.id,c,u,i]),(0,n.useState)(null)),k=((0,n.useCallback)((e,t)=>{if(!u||!Array.isArray(t))return;let[i,r]=t;j([i,r])},[u]),(0,n.useCallback)((e,r)=>{if(!u||!Array.isArray(r))return;let[n,o]=r;c.batchOperation("Update Audio Source Trim Range",()=>{i(u.id,{id:t.id,sourceTrimStartFrames:n,sourceTrimEndFrames:o})}),j(null)},[t.id,c,u,i]),(0,n.useMemo)(()=>(null==p?void 0:p.metadata)&&p.metadata.duration*O.UG||t.durationInFrames,[t.durationInFrames,p.metadata]));return(0,n.useMemo)(()=>C||[t.sourceTrimStartFrames??0,t.sourceTrimEndFrames??k],[t.sourceTrimStartFrames,t.sourceTrimEndFrames,k,C]),C?C[0]:t.sourceTrimStartFrames,C?C[1]:t.sourceTrimEndFrames,(0,r.jsx)(l.Z,{sx:{overflowY:"auto",bgcolor:"#1a1a1a",...R.ji,...(0,R.SZ)(4)},children:(0,r.jsxs)(l.Z,{sx:{p:1.5},children:[(0,r.jsx)(e9,{icon:e3.Z,title:"Audio Volume",value:t.volume??1,min:0,max:1,step:.05,formatDisplay:e=>`${Math.round(100*e)}%`,formatInput:e=>(100*e).toString(),parseInput:e=>Number.parseFloat(e)/100,validateInput:e=>e>=0&&e<=1,onChange:v}),(0,r.jsx)(l.Z,{sx:{mt:2.5},children:(0,r.jsx)(e9,{icon:e5.Z,title:"Audio Speed",value:t.speed??1,min:.5,max:2,step:.25,formatDisplay:e=>`${e.toFixed(2)}x`,formatInput:e=>e.toString(),parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=.5&&e<=2,onChange:b})}),(0,r.jsx)(l.Z,{sx:{mt:2.5},children:(0,r.jsx)(e9,{icon:e4.Z,title:"Fade In",value:g(t.effects),min:0,max:m,step:.05,formatDisplay:e=>`${e.toFixed(2)}s`,formatInput:e=>e.toString(),parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=0&&e<=m,onChange:y})}),(0,r.jsx)(l.Z,{sx:{mt:2.5},children:(0,r.jsx)(e9,{icon:e6.Z,title:"Fade Out",value:f(t.effects),min:0,max:m,step:.05,formatDisplay:e=>`${e.toFixed(2)}s`,formatInput:e=>e.toString(),parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=0&&e<=m,onChange:w})}),null]})})});e7.displayName="EditPropertyForAudio";var te=i(31495),tt=i(7642),ti=i(85629),tr=i(56261);let tn={fontSize:12,fontWeight:600,color:"#ffffff"},to={width:"45%"},ta=[{value:"Inter",label:"Inter",googleFont:"Inter"},{value:"Roboto",label:"Roboto",googleFont:"Roboto"},{value:"Open Sans",label:"Open Sans",googleFont:"OpenSans"},{value:"Montserrat",label:"Montserrat",googleFont:"Montserrat"},{value:"Poppins",label:"Poppins",googleFont:"Poppins"},{value:"Lato",label:"Lato",googleFont:"Lato"},{value:"Nunito",label:"Nunito",googleFont:"Nunito"},{value:"Work Sans",label:"Work Sans",googleFont:"WorkSans"},{value:"Raleway",label:"Raleway",googleFont:"Raleway"},{value:"Oswald",label:"Oswald",googleFont:"Oswald"}],ts=[{id:"default",name:"Default",style:null,isDefault:!0},{id:"white_shadow",name:"White Shadow",style:{color:"#ffffff",fontWeight:"700",textShadow:"rgba(0, 0, 0, 0.17) 0px 4px 6.9px",WebkitTextStroke:"none",backgroundColor:"transparent"}},{id:"white_gray_shadow",name:"White Gray Shadow",style:{color:"#ffffff",fontWeight:"700",textShadow:"#848484 1px 1px 0px",WebkitTextStroke:"none",backgroundColor:"transparent"}},{id:"white_black_shadow",name:"White Black Shadow",style:{color:"#ffffff",fontWeight:"700",textShadow:"#000000 1px 1px 0px",WebkitTextStroke:"none",backgroundColor:"transparent"}},{id:"black_text",name:"Black Text",style:{color:"#000000",fontWeight:"700",textShadow:"none",WebkitTextStroke:"none",backgroundColor:"transparent"}},{id:"yellow_black_shadow",name:"Yellow Black Shadow",style:{color:"#ffde00",fontWeight:"700",textShadow:"#000000 1px 1px 0px",WebkitTextStroke:"none",backgroundColor:"transparent"}},{id:"black_green_shadow",name:"Black Green Shadow",style:{color:"#000000",fontWeight:"700",textShadow:"#00c04d 1px 1px 0px",WebkitTextStroke:"none",backgroundColor:"transparent"}},{id:"orange_red_shadow",name:"Orange Red Shadow",style:{color:"#ffbf17",fontWeight:"700",textShadow:"#b71c1c 1px 1px 0px",WebkitTextStroke:"none",backgroundColor:"transparent"}},{id:"black_yellow_bg",name:"Black on Yellow",style:{color:"#000000",fontWeight:"700",textShadow:"none",WebkitTextStroke:"none",backgroundColor:"#ffde00",padding:"2px 4px",borderRadius:"4px"}},{id:"white_blue_bg",name:"White on Blue",style:{color:"#ffffff",fontWeight:"700",textShadow:"none",WebkitTextStroke:"none",backgroundColor:"#9cbaff",padding:"2px 4px",borderRadius:"4px"}},{id:"white_dark_blue_bg",name:"White on Dark Blue",style:{color:"#ffffff",fontWeight:"700",textShadow:"none",WebkitTextStroke:"none",backgroundColor:"#013ffe",padding:"2px 4px",borderRadius:"4px"}},{id:"white_centered_blue_bg",name:"White Centered Blue",style:{color:"#ffffff",fontWeight:"700",textShadow:"none",WebkitTextStroke:"none",backgroundColor:"#013ffe",padding:"2px 4px",borderRadius:"0px",textAlign:"center"}}],tl=(0,n.memo)(e=>{var t,i,o;let{item:a}=e,{operations:u}=(0,h.ZY)(),p=(0,F.D)(e=>e.updateItemInTrack),m=(0,F.D)(e=>e.updateGlobalConfig),v=(0,F.D)(e=>e.globalConfig),b=(0,F.D)(e=>e.tracks),y=(0,F.D)(e=>e.outputSettings),w=(0,n.useMemo)(()=>({...(0,eg.sy)(y),height:(0,eg.bM)(y.width,y.height).bottomPercentage}),[y]),C=(0,n.useMemo)(()=>b.find(e=>e.items.some(e=>e.id===a.id)),[b,a.id]),[j,k]=(0,n.useState)(!0),S=(0,n.useMemo)(()=>{var e;let t={...w,...null===(e=a.caption)||void 0===e?void 0:e.style};return{fontFamily:t.fontFamily||w.fontFamily,fontSize:tu(t.fontSize,tu(w.fontSize,22)),color:t.color||w.color,backgroundColor:t.backgroundColor||w.backgroundColor,fontWeight:function(e,t){if("number"==typeof e)return e;if("string"==typeof e){let t=e.toLowerCase();if("normal"===t)return 400;if("bold"===t)return 700;let i=Number.parseInt(e,10);return Number.isNaN(i)?700:i}return 700}(t.fontWeight??w.fontWeight,700),borderRadius:tu(t.borderRadius,tu(w.borderRadius,0)),letterSpacing:tu(t.letterSpacing,tu(w.letterSpacing,0)),lineHeight:tu(t.lineHeight,tu(w.lineHeight,1.3)),maxWidth:t.maxWidth||w.maxWidth||"70%",height:tu(t.height,tu(w.height,24))}},[w,null===(t=a.caption)||void 0===t?void 0:t.style]),I=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!C)return;let i=t?e:{...S,...e};u.batchOperation("Update Caption Style",()=>{j&&m({captions:{...v.captions,style:i}}),p(C.id,{id:a.id,caption:{...a.caption,style:i}})})},[C,S,j,u,m,p,v,a]),_=(0,n.useCallback)(e=>{C&&u.batchOperation("Update Caption Text",()=>{var t;p(C.id,{id:a.id,caption:{...a.caption,data:{...null===(t=a.caption)||void 0===t?void 0:t.data,text:e}}})})},[C,u,p,a]),Z=(0,n.useCallback)(e=>{_(e)},[_]),A=((0,n.useCallback)(e=>{if(!C)return;let t=Math.max(0,Math.floor(e));u.batchOperation("Update Caption Start Frame",()=>{p(C.id,{id:a.id,startTimeInFrames:t},!1)})},[C,u,p,a.id]),(0,n.useCallback)(e=>{if(!C)return;let t=a.startTimeInFrames,i=Math.max(t+1,Math.floor(e))-t;u.batchOperation("Update Caption End Frame",()=>{p(C.id,{id:a.id,durationInFrames:i},!1)})},[C,a.startTimeInFrames,u,p,a.id]),(0,n.useCallback)(e=>{k(e),e?m({captions:{...v.captions,style:S}}):m({captions:{...v.captions,style:null}})},[m,v.captions,S])),E=(0,n.useCallback)(e=>{I({fontFamily:e.target.value})},[I]),M=(0,n.useCallback)(e=>{I({fontSize:`${e}px`})},[I]),T=(0,n.useCallback)(e=>{I({fontWeight:e})},[I]),D=(0,n.useCallback)(e=>{I({borderRadius:e})},[I]),z=(0,n.useCallback)(e=>{I({letterSpacing:`${e}px`})},[I]),P=(0,n.useCallback)(e=>{I({lineHeight:e.toString()})},[I]),W=(0,n.useCallback)(e=>{I({height:e})},[I]),L=(0,n.useCallback)(e=>{I({maxWidth:`${Math.max(10,Math.min(100,Math.round(e)))}%`})},[I]),B=(0,n.useCallback)(e=>{null===e?I(w,!0):I(e,!0)},[I,w]),H=(0,n.useMemo)(()=>{let e=(S.backgroundColor||"").toString().trim().toLowerCase();if(!e||"transparent"===e)return!1;if(e.startsWith("rgba(")&&e.endsWith(")")){let t=e.slice(5,-1).split(",").map(e=>e.trim());if(4===t.length){let e=Number.parseFloat(t[3]);return Number.isFinite(e)&&e>0}}return!0},[S.backgroundColor]);return(0,r.jsxs)(l.Z,{sx:{px:1,py:1,backgroundColor:(0,tr.L)("Gray/100"),height:"100%",overflowY:"auto",...R.ji,...(0,R.SZ)(4)},children:[(0,r.jsx)(l.Z,{sx:{mb:1},children:(0,r.jsx)(c.Z,{fullWidth:!0,multiline:!0,value:(null===(o=a.caption)||void 0===o?void 0:null===(i=o.data)||void 0===i?void 0:i.text)||"",onChange:e=>Z(e.target.value),placeholder:"Enter caption text...",variant:"outlined",sx:{"& .MuiOutlinedInput-root":{backgroundColor:(0,tr.L)("Gray/50"),borderRadius:1,fontSize:12,padding:0,color:(0,tr.L)("Gray/400"),"& fieldset":{border:`1px solid ${(0,tr.L)("Gray/200")}`},"&:hover fieldset":{border:`1px solid ${(0,tr.L)("Gray/200")}`},"&.Mui-focused fieldset":{border:`1px solid ${(0,tr.L)("Blue/500")}`}},"& .MuiInputBase-input":{padding:"10px",fontSize:12,lineHeight:1.67,fontFamily:"'Inter', sans-serif",fontWeight:500,color:"white",letterSpacing:"-0.01em"},"& .MuiInputBase-input::placeholder":{color:(0,tr.L)("Gray/400"),opacity:1}}})}),null,(0,r.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[(0,r.jsx)(ti.O,{realitySize:14,checked:j,onChange:e=>A(e.target.checked),sx:{"& .MuiSvgIcon-root":{border:`0.875px solid ${(0,tr.L)("Gray/500")}`,borderRadius:"2.8px",width:14,height:14}}}),(0,r.jsx)(d.Z,{variant:"body2",sx:{fontSize:12,fontWeight:500,lineHeight:1.3,color:(0,tr.L)("Gray/600"),whiteSpace:"nowrap"},children:"Apply to all captions"})]}),(0,r.jsxs)(s.Z,{spacing:1,children:[(0,r.jsx)(td,{label:"Font Family",labelStyle:to,children:(0,r.jsx)(x.Z,{fullWidth:!0,size:"small",children:(0,r.jsx)(g.Z,{value:S.fontFamily,onChange:E,sx:{backgroundColor:(0,tr.L)("Gray/200"),height:28,fontSize:11,color:(0,tr.L)("Gray/900"),"& .MuiOutlinedInput-notchedOutline":{border:"none"},"& .MuiSelect-icon":{color:(0,tr.L)("Gray/500")},borderRadius:1},children:ta.map(e=>(0,r.jsx)(f.Z,{value:e.value,children:(0,r.jsx)(d.Z,{sx:{fontSize:11,fontWeight:500},children:e.label})},e.value))})})}),(0,r.jsx)(e9,{labelAreaSx:to,labelTextSx:tn,direction:"row",title:"Font size",value:S.fontSize,min:8,max:120,step:1,formatDisplay:e=>`${Math.round(e)}px`,formatInput:e=>`${e}`,parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=8&&e<=120,onChange:M}),(0,r.jsx)(e9,{labelAreaSx:to,labelTextSx:tn,direction:"row",title:"Font weight",value:S.fontWeight,min:100,max:900,step:100,formatDisplay:e=>`${e}`,formatInput:e=>`${e}`,parseInput:e=>Number.parseInt(e,10),validateInput:e=>e%100==0&&e>=100&&e<=900,onChange:T}),(0,r.jsx)(td,{label:"Font color",labelStyle:to,children:(0,r.jsx)(tc,{color:S.color,onChange:e=>I({color:e})})}),(0,r.jsx)(td,{label:"Background color",labelStyle:to,children:(0,r.jsx)(tc,{color:S.backgroundColor,onChange:e=>I({backgroundColor:e})})}),H?(0,r.jsx)(e9,{labelAreaSx:to,labelTextSx:tn,direction:"row",title:"Border radius",value:S.borderRadius,min:0,max:100,step:1,formatDisplay:e=>`${e}px`,formatInput:e=>`${e}`,parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=0&&e<=100,onChange:D}):null,(0,r.jsx)(e9,{labelAreaSx:to,labelTextSx:tn,direction:"row",title:"Letter spacing",value:S.letterSpacing,min:-5,max:20,step:1,formatDisplay:e=>`${e}px`,formatInput:e=>`${e}`,parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=-5&&e<=20,onChange:z}),(0,r.jsx)(e9,{labelAreaSx:to,labelTextSx:tn,direction:"row",title:"Line height",value:S.lineHeight,min:.5,max:3,step:.1,formatDisplay:e=>`${e.toFixed(1)}x`,formatInput:e=>`${e}`,parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=.5&&e<=3,onChange:P}),(0,r.jsx)(e9,{labelAreaSx:to,labelTextSx:tn,direction:"row",title:"Offset",value:S.height,min:0,max:99,step:.5,formatDisplay:e=>`${e.toFixed(1)}%`,formatInput:e=>`${e}`,parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=0&&e<=99,onChange:W}),(0,r.jsx)(e9,{labelAreaSx:to,labelTextSx:tn,direction:"row",title:"Width",value:function(e,t){if("number"==typeof e)return e;if("string"==typeof e){let t=Number.parseFloat(e.replace("%",""));return Number.isNaN(t)?70:t}return 70}(S.maxWidth,70),min:30,max:100,step:1,formatDisplay:e=>`${Math.round(e)}%`,formatInput:e=>`${e}`,parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=10&&e<=100,onChange:L}),(0,r.jsxs)(l.Z,{sx:{width:"100%"},children:[(0,r.jsx)(d.Z,{variant:"body2",sx:{...tn,mb:1},children:"Font Style"}),(0,r.jsx)(l.Z,{sx:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:1,width:"100%"},children:ts.map(e=>(0,r.jsx)(l.Z,{onClick:()=>B(e.style),sx:{height:42,backgroundColor:(0,tr.L)("Gray/400"),borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",overflow:"hidden","&:hover":{backgroundColor:(0,tr.L)("Gray/500")}},children:e.isDefault?(0,r.jsx)(te.Z,{}):(0,r.jsx)(d.Z,{sx:{fontSize:18,fontFamily:"'Inter', sans-serif",fontWeight:700,lineHeight:"13.5px",...e.style},children:"Abc"})},e.id))})]})]})]})});function td(e){let{label:t,children:i,labelStyle:n}=e;return(0,r.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1,width:to.width,...n},children:(0,r.jsx)(d.Z,{variant:"body2",sx:tn,children:t})}),(0,r.jsx)(l.Z,{sx:{flex:1,width:"100%"},children:i})]})}function tc(e){let{color:t,onChange:i}=e,[o,a]=(0,n.useState)(null),s=(0,n.useCallback)(e=>{let t=null==e?void 0:e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?|\.\d+))?\)/);if(!t)return{r:0,g:0,b:0,a:1};let[,i,r,n,o="1"]=t;return{r:Number(i),g:Number(r),b:Number(n),a:Number(o)}},[]),d=(0,n.useCallback)(e=>{let{r:t,g:i,b:r,a:n}=e;return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(r)},${n.toFixed(2)})`},[]),c=s(t);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{onClick:e=>a(e.currentTarget),sx:{width:"100%",height:24,borderRadius:.5,border:`1px solid ${(0,tr.L)("Gray/300")}`,backgroundColor:t,cursor:"pointer"}}),(0,r.jsx)(Q.ZP,{open:!!o,anchorEl:o,onClose:()=>a(null),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{p:1,bgcolor:(0,tr.L)("Gray/200"),borderRadius:1,boxShadow:"0px 8px 24px rgba(0,0,0,0.5)"}}},children:(0,r.jsx)(l.Z,{sx:{width:240,".react-colorful":{width:"100%"},".react-colorful__saturation":{width:"100%",height:150,borderRadius:1},".react-colorful__hue, .react-colorful__alpha":{width:"100%",height:16,borderRadius:1,mt:1},".react-colorful__pointer":{"--pointer-size":"16px",width:"var(--pointer-size)",height:"var(--pointer-size)",boxShadow:"0 1px 2px rgba(0,0,0,0.6), 0 0 0 2px #fff inset"},".react-colorful__alpha-pointer, .react-colorful__hue-pointer":{"--small-pointer-size":"14px",width:"var(--small-pointer-size)",height:"var(--small-pointer-size)"}},children:(0,r.jsx)(tt.Jg,{color:c,onChange:e=>i(d(e))})})})]})}function tu(e,t){if("number"==typeof e)return e;if("string"==typeof e){let i=Number.parseFloat(e.replace("px",""));return Number.isNaN(i)?t:i}return t}tl.displayName="EditPropertyForCaption";var tp=i(81032);let th=(0,n.memo)(e=>{let{item:t}=e,i=(0,F.D)(e=>e.updateItemInTrack),o=(0,F.D)(e=>e.tracks),a=(0,F.D)(e=>e.mediaAssets),s=(0,F.D)(e=>e.globalConfig),{operations:d}=(0,h.ZY)(),c=o.find(e=>e.items.some(e=>e.id===t.id)),u=((0,n.useMemo)(()=>a.find(e=>e.id===t.mediaAssetId),[a,t.mediaAssetId]),(0,n.useMemo)(()=>({startFrame:t.startTimeInFrames,endFrame:t.startTimeInFrames+t.durationInFrames}),[t.startTimeInFrames,t.durationInFrames])),p=((0,n.useMemo)(()=>({startTime:(0,O.DG)(u.startFrame,s.fps),endTime:(0,O.DG)(u.endFrame,s.fps)}),[u,s.fps]),(0,n.useCallback)(e=>{if(!c)return;let r=e*O.UG;d.batchOperation("Update Image Duration",()=>{i(c.id,{id:t.id,durationInFrames:r})})},[t.id,d,c,i])),m=((0,n.useCallback)(e=>{c&&d.batchOperation("Update Image Start Time",()=>{i(c.id,{id:t.id,startTimeInFrames:e})})},[t.id,d,c,i]),(0,n.useCallback)(e=>{c&&d.batchOperation("Update Image Duration (Frames)",()=>{i(c.id,{id:t.id,durationInFrames:e})})},[t.id,d,c,i]),(0,n.useMemo)(()=>t.durationInFrames/O.UG,[t.durationInFrames]));return(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(e9,{icon:tp.Z,title:"Display Duration",value:m,min:.1,max:10,step:.1,formatDisplay:e=>`${e.toFixed(1)}s`,formatInput:e=>e.toFixed(1),parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=.1&&e<=10,onChange:p}),null]})});th.displayName="EditPropertyForImage";var tm=i(70811),tx=i(32964),tg=i(67431);let tf=(0,eV.ZP)(H.Z,{shouldForwardProp:e=>"highlighted"!==e})(e=>{let{theme:t,highlighted:i}=e;return{padding:"5px 18px",color:t.palette.Colors.Gray["900"],backgroundColor:i?t.palette.Colors.Blue["500"]:t.palette.Colors.Gray["200"],borderRadius:"4px",fontFamily:"Inter",fontSize:"12px",fontWeight:600,lineHeight:"normal","@media (hover: hover)":{"&:hover":{backgroundColor:i?t.palette.Colors.Blue["400"]:t.palette.Colors.Gray["300"]}}}});var tv=i(52954),tb=i(45040),ty=i(79334),tw=i(23156),tC=i(91022),tj=i(24181),tk=i(6721);let tF=()=>{let e=(0,F.D)(F.df),t=(0,n.useMemo)(()=>e?e.shotId:null,[e]),i=(0,y.jU)(e=>e.story),r=(0,n.useMemo)(()=>{var e;return t?null==i?void 0:null===(e=i.storyboard)||void 0===e?void 0:e.shots_map[t]:null},[t,i]);return{selectedShotId:t,selectedShot:r,resourceType:null==e?void 0:e.type}};var tS=i(3935);let tI=e=>{let{type:t}=e,{selectedShotId:i,selectedShot:o}=tF(),a=F.wK.use.togglePlay(),s=(0,y.jU)(e=>{var t;return null===(t=e.story)||void 0===t?void 0:t.id}),d=(0,et.fH)(e=>e.addExistingMediaResources),c=(0,et.fH)(e=>e.updateGenerationStatus),u=(0,et.fH)(e=>e.completeGeneration),p=(0,y.jU)(e=>e.syncData),m=(0,et.hd)(i,"image"===t?"image":"video"),x=(0,F.D)(e=>e.addMediaAsset),g=(0,et.FT)(i,t),{data:f,isLoading:v}=(0,ty.ZP)(s,i,{enabled:!0});(0,n.useEffect)(()=>{f&&d(i,(null==f?void 0:f.images)||[],(null==f?void 0:f.videos)||[],(null==f?void 0:f.audio)||[],{init:!0,activeImageId:(null==o?void 0:o.active_image_id)||"",activeVideoId:(null==o?void 0:o.active_video_id)||"",activeVoiceoverAudioId:(null==o?void 0:o.active_voice_over_audio_id)||""})},[f,i,d]);let b=(0,n.useMemo)(()=>g.filter(e=>"generating"===e.generationStatus||"pending"===e.generationStatus).map(e=>e.workflowId),[g]);(0,tS.i)(b,b.length>0,(e,t)=>{t.results.forEach(t=>{c(i,e,t),"completed"===t.status&&(u(i,e,t),x(t))})});let w=(0,F.D)(e=>e.setPreviewingMediaAsset),C=(0,F.D)(e=>e.mediaAssets),j=(0,et.fH)(e=>e.setIsCurrentImageRetried),{operations:k}=(0,h.ZY)(),S=(0,n.useCallback)(e=>{if(!["generating","pending","failed"].includes(e.generationStatus)){if("image"===t&&(null==o?void 0:o.active_image_id)!==e.resource.id)k.updateShotWithSnapshot(i,{active_image_id:e.resource.id,active_image_url:e.resource.url},{rebuildTimeline:!0}),j(i,!1);else if("video"===t&&(null==o?void 0:o.active_video_id)!==e.resource.id){k.updateShotWithSnapshot(i,{active_video_id:e.resource.id,active_video_url:e.resource.url},{rebuildTimeline:!0});let t=C.find(t=>t.id===e.resource.id),r=(null==t?void 0:t.end_frame_reference_image)||"";et.fH.getState().setEndFrameReferenceImage(i,r)}w(C.find(t=>t.id===e.resource.id)),a(!1),p([i])}},[t,null==o?void 0:o.active_image_id,null==o?void 0:o.active_video_id,w,C,a,p,i,k,j]);return(0,r.jsx)(l.Z,{sx:{mt:"5px",display:"flex",gap:"5px",overflowX:"auto","&::-webkit-scrollbar":{height:"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"#444444",borderRadius:"2px"},"&::-webkit-scrollbar-thumb:hover":{background:"#666666"}},children:v?Array.from({length:3}).map((e,t)=>(0,r.jsx)(tj.Z,{variant:"rectangular",width:48,height:48,sx:{flexShrink:0,borderRadius:"4px",bgcolor:"#2A2A2A","&::after":{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent)"}}},t)):g.map(e=>(0,r.jsxs)(l.Z,{onClick:()=>null==S?void 0:S(e),sx:{position:"relative",flexShrink:0,width:"48px",height:"48px",borderRadius:"4px",overflow:"hidden",cursor:"pointer",transition:"all 0.2s ease",opacity:1},children:[m===e.resource.id&&(0,r.jsx)(l.Z,{sx:{zIndex:1e3,position:"absolute",bottom:"4px",right:"4px",display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"#013FFE"},children:(0,r.jsx)(tw.Z,{sx:{color:"#FFFFFF",fontSize:"12px"}})}),"generating"===e.generationStatus?(0,r.jsx)(ew.p6,{logoSize:30}):(0,r.jsx)(ew.wY,{src:"image"===t?e.resource.url:e.resource.thumbnail_url,errorState:"failed"===e.generationStatus}),"video"===t&&(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.3)"},children:(0,r.jsx)(tk.Z,{size:"small",sx:{color:"#FFFFFF",padding:"2px","& .MuiSvgIcon-root":{fontSize:"16px"}},children:(0,r.jsx)(tC.Z,{})})})]},e.resource.id))})};var t_=i(6966),tZ=i(35600),tA=i(16585);let tE=(0,n.memo)(e=>{var t,i;let{tab:o}=e,a=(0,y.jU)(e=>{var t;return null===(t=e.story)||void 0===t?void 0:t.id}),{selectedShot:s,selectedShotId:l}=tF(),d=(0,n.useMemo)(()=>"video"===o?"video_prompt":"image_prompt",[o]),c=(0,et.fH)(e=>e.refreshCredits),u=(0,et.fH)(e=>e.addImageGenerationPlaceholder),p=(0,et.fH)(e=>e.addVideoGenerationPlaceholder),h=(0,y.jU)(e=>e.syncData),m=(0,et.fH)(e=>e.setIsCurrentImageRetried),{updateShot:x}=(0,t_.Q)(),{mutateAsync:g,isLoading:f}=(0,ty.EL)(a),{generationCreditsImage:v,generationCreditsVideo:b}=(0,tb.U)(),w=(0,et.fH)(e=>e.shotStates),C=et.fH.use.referenceImages(),j=(0,n.useCallback)(()=>{if(!l)return;let e={imagePrompt:null==s?void 0:s.image_prompt,videoPrompt:null==s?void 0:s.video_prompt},t=l?w[l]:void 0,i="reference"===((null==t?void 0:t.videoIngredientMode)??"keyframe"),r=i?(0,tv.e)(null==s?void 0:s.active_image_url,null==C?void 0:C[l]):void 0,n=i?void 0:(null==t?void 0:t.endFrameReferenceImage)||void 0;g({shotId:l,mediaTypesArray:["script"===o?"audio-voice-over":o],...e,end_frame_image_url:n,reference_image_urls:r}).then(e=>{(0,tA.B)("shot_regenerate_clicked",{story_id:a,shot_id:l,media_type:o,credits_num:"image"===o?v:b}),"image"===o?u(l,e.workflowRunId,null==s?void 0:s.image_prompt,!0):(p(l,e.workflowRunId,null==s?void 0:s.video_prompt,void 0,!0,null==s?void 0:s.active_image_id),m(l,!0)),h([l]),c()})},[s,l,g,o,c,u,p,h,a,v,b,m,w,C]),k=(0,n.useMemo)(()=>"image"===o?null==s?void 0:s.active_image_id:null==s?void 0:s.active_video_id,[s,o]),F=(0,n.useMemo)(()=>"image"===o?v:b,[o,v,b]),S=(0,et.PR)(l,null==s?void 0:s.active_image_id,null==s?void 0:s.image_prompt),_=(0,n.useMemo)(()=>!k||S&&"video"===o,[k,S,o]),{video_model_config:Z}=(0,et.k3)(),[A]=(0,tZ.f)("normal",{model:null==Z?void 0:Z.value.model,duration:"duration"in(null==Z?void 0:Z.value.parameters)?null==Z?void 0:null===(t=Z.value.parameters)||void 0===t?void 0:t.duration:5,resolution:"resolution"in(null==Z?void 0:Z.value.parameters)?null==Z?void 0:null===(i=Z.value.parameters)||void 0===i?void 0:i.resolution:"360p"},{disabled:"video"!==o,oldUI:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I.PhCurrencyEth,{size:12}),F]}),newUI:(e,t,i)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I.PhCurrencyEth,{size:12}),(0,r.jsx)("span",{style:{textDecoration:"line-through"},children:F}),(0,r.jsxs)("span",{style:{marginLeft:"4px"},children:["(",t,"/",i,")"]})]}),upgradeDailyNewUI:null});return(0,r.jsx)(tx.Z,{children:(null==s?void 0:s.shot_type)==="uploaded_image"&&"image"===o?(0,r.jsx)(ew.wY,{src:null==s?void 0:s.active_image_url,enableFullscreen:!0}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(tm.Z,{direction:"column",justifyContent:"space-between",alignItems:"flex-start",sx:{height:"174px",padding:"10px",borderRadius:"8px",border:"1px solid #2E2E2E",background:"#101010"},children:[(0,r.jsx)(tx.Z,{sx:{flex:"1 1 auto",overflowY:"auto"},children:(0,r.jsx)(tg.E,{disabled:"script"===o,isHovered:!0,value:(null==s?void 0:s[d])||"",onChange:e=>{l&&x(l,{[d]:e},{rebuildTimeline:!1})}})}),"script"===o?null:(0,r.jsxs)(tm.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mt:1,width:"100%"},children:[(0,r.jsx)(tx.Z,{children:" "}),(0,r.jsxs)(tf,{highlighted:_,onClick:j,disabled:f,children:[f?(0,r.jsx)(em.Z,{size:12,sx:{mr:1}}):null,k?"Retry":"Create"," ",o," \xa0",A]})]})]}),"script"===o?null:(0,r.jsx)(tI,{type:o})]})})});tE.displayName="EditPropertyForShotData";var tM=i(42021);let tT=(0,n.memo)(e=>{let{sx:t,children:i,text:n="Edit Property"}=e;return(0,r.jsx)(s.Z,{sx:{backgroundColor:"#2e2e2e",flexDirection:"row",alignItems:"center",height:U.sq,px:1,gap:1.5,flex:"0 0 auto",...i?{justifyContent:"stretch"}:{justifyContent:"center"},...t},children:i||(0,r.jsx)(d.Z,{variant:"h6",sx:{color:"text.primary",fontWeight:500,fontSize:"16px",width:"100%",textAlign:"center"},children:n})})});tT.displayName="EditPropertyPaneHead";let tR=(0,n.memo)(e=>{let{sx:t,tag:i,tab:o,onTabChange:a}=e,s=(0,eC.B)(e=>e.story),d=(0,n.useCallback)((e,t)=>{a(t)},[a]),c=(0,n.useMemo)(()=>(null==s?void 0:s.category_id)==="script_to_video",[null==s?void 0:s.category_id]),{selectedShotId:u,selectedShot:p}=tF(),h=(0,et.PR)(u,(null==p?void 0:p.active_image_id)||"",(null==p?void 0:p.active_video_id)||"");return(0,r.jsx)(tT,{sx:t,children:(0,r.jsxs)(eG.Z,{value:o,onChange:d,"aria-label":"preview tab",sx:{overflowX:"auto","& .MuiTabs-flexContainer":{alignItems:"center"},"& .MuiTab-root:not(.vertical-tab):not(:last-of-type)":{marginRight:0},"& .MuiTab-root:not(.vertical-tab)":{color:"#888",transition:"all 0.2s ease"},"& .MuiTab-root:not(.vertical-tab).Mui-selected":{color:"#fff"},"& .MuiTabs-indicator":{backgroundColor:"#fff"}},children:[c?(0,r.jsx)(eN.Z,{label:(0,r.jsxs)(l.Z,{children:["Script",(0,r.jsx)(tM.Z,{sx:{color:"#ccc",mx:1,fontSize:10}})]}),value:"script",icon:(0,r.jsx)(I.PhNotebook,{sx:{width:20,height:20,mr:"4px !important"}}),"aria-label":"script"}):null,(0,r.jsx)(eN.Z,{label:(0,r.jsxs)(l.Z,{children:["Still Image",(0,r.jsx)(tM.Z,{sx:{color:"#ccc",mx:1,fontSize:10}})]}),value:"image",icon:(0,r.jsx)(I.PhImage,{sx:{width:20,height:20,mr:"4px !important"}}),"aria-label":"image"}),(0,r.jsx)(eN.Z,{label:(0,r.jsxs)(l.Z,{sx:{position:"relative"},children:["Video",h?(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,right:-7,width:6,height:6,backgroundColor:"#2F66FF",borderRadius:"50%"}}):null]}),value:"video",icon:(0,r.jsx)(I.PhVideoCamera,{sx:{width:20,height:20,mr:"4px !important"}}),"aria-label":"video"})]})})});tR.displayName="EditPropertyForShotTab";let tD=(e,t,i)=>{if("video"!==e.type&&"overlay"!==e.type)return{startFrom:0,endAt:0};let r=null==t?void 0:t.metadata;return r?(0,O.Xq)(e,r,i):{startFrom:0,endAt:0}},tz=(0,n.memo)(e=>{var t;let{item:i}=e,o=(0,F.D)(e=>e.updateItemSpeed),a=(0,F.D)(e=>e.updateItemInTrack),s=(0,F.D)(e=>e.tracks),d=(0,F.D)(e=>e.mediaAssets),c=(0,F.D)(e=>e.globalConfig),{operations:u}=(0,h.ZY)(),p=s.find(e=>e.items.some(e=>e.id===i.id)),m=(0,n.useMemo)(()=>d.find(e=>e.id===i.mediaAssetId),[d,i.mediaAssetId]),{startFrom:x,endAt:g}=(0,n.useMemo)(()=>m?tD(i,m,O.UG):{startFrom:0,endAt:0},[i,m]),f=((0,n.useMemo)(()=>({startFrame:i.startTimeInFrames,endFrame:i.startTimeInFrames+i.durationInFrames}),[i.startTimeInFrames,i.durationInFrames]),t=c.fps,(0,n.useMemo)(()=>{let e=Math.floor(i.startTimeInFrames||0),r=1;if(i.durationInFrames&&i.durationInFrames>0)r=Math.max(1,i.durationInFrames);else{let e=null==m?void 0:m.metadata,n=(null==e?void 0:e.fps)||30,o=null==e?void 0:e.frames;r=!o||o<=0?Math.max(1,(void 0!==i.sourceTrimEndFrames&&void 0!==i.sourceTrimStartFrames?i.sourceTrimEndFrames-i.sourceTrimStartFrames:3*n)*t/n/Math.max(.1,i.speed||1)):"image"===i.type?2*t:o/n/Math.max(.1,i.speed||1)*t}let n=Math.floor(r+i.startTimeInFrames)-e;return{finalStartFrame:e,finalDurationFrames:n}},[t,i.durationInFrames,i.sourceTrimEndFrames,i.sourceTrimStartFrames,i.speed,i.startTimeInFrames,i.type,m])),v=((0,n.useMemo)(()=>({startTime:(0,O.DG)(f.finalStartFrame,c.fps),endTime:(0,O.DG)(f.finalDurationFrames+f.finalStartFrame,c.fps)}),[f,c.fps]),(0,n.useCallback)(e=>{u.batchOperation("Update Video Speed",()=>{o(i.id,e)})},[i.id,o,u])),b=(0,n.useCallback)(e=>{p&&u.batchOperation("Update Video Volume",()=>{a(p.id,{id:i.id,volume:e})})},[i.id,u,p,a]),[y,w]=((0,n.useCallback)(e=>{p&&u.batchOperation("Update Video Start Time",()=>{a(p.id,{id:i.id,startTimeInFrames:e})})},[i.id,u,p,a]),(0,n.useCallback)(e=>{p&&u.batchOperation("Update Video Duration",()=>{a(p.id,{id:i.id,durationInFrames:e})})},[i.id,u,p,a]),(0,n.useCallback)(e=>{p&&u.batchOperation("Update Video Source Trim Start",()=>{a(p.id,{id:i.id,sourceTrimStartFrames:e})})},[i.id,u,p,a]),(0,n.useCallback)(e=>{p&&u.batchOperation("Update Video Source Trim End",()=>{a(p.id,{id:i.id,sourceTrimEndFrames:e})})},[i.id,u,p,a]),(0,n.useState)(null)),C=((0,n.useCallback)((e,t)=>{if(!p||!Array.isArray(t))return;let[i,r]=t;w([i,r])},[p]),(0,n.useCallback)((e,t)=>{if(!p||!Array.isArray(t))return;let[r,n]=t;u.batchOperation("Update Video Source Trim Range",()=>{a(p.id,{id:i.id,sourceTrimStartFrames:r,sourceTrimEndFrames:n})}),w(null)},[i.id,u,p,a]),(0,n.useMemo)(()=>(null==m?void 0:m.metadata)&&m.metadata.frames||3600,[m]));return(0,n.useMemo)(()=>y||[i.sourceTrimStartFrames??0,i.sourceTrimEndFrames??C],[i.sourceTrimStartFrames,i.sourceTrimEndFrames,C,y]),y?y[0]:i.sourceTrimStartFrames,y?y[1]:i.sourceTrimEndFrames,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{sx:{mt:2.5},children:(0,r.jsx)(e9,{icon:e3.Z,title:"Video Volume",value:i.volume??1,min:0,max:1,step:.05,formatDisplay:e=>`${Math.round(100*e)}%`,formatInput:e=>(100*e).toString(),parseInput:e=>Number.parseFloat(e)/100,validateInput:e=>e>=0&&e<=1,onChange:b})}),(0,r.jsx)(e9,{icon:e5.Z,title:"Video Speed",value:i.speed??1,min:.5,max:2,step:.25,formatDisplay:e=>`${e.toFixed(2)}x`,formatInput:e=>e.toString(),parseInput:e=>Number.parseFloat(e),validateInput:e=>e>=.5&&e<=2,onChange:v}),null]})});tz.displayName="EditPropertyForVideo";var tP=i(49752),tW=i(95826),tL=i(17727);let tB=(0,n.memo)(e=>{var t;let{shotId:i}=e,o=y.jU.use.story(),a=y.jU.use.syncData(),{updateShot:d}=(0,t_.Q)(),{startOperation:c,endOperation:u,operations:p}=(0,h.ZY)(),m=(0,y.rM)(),x=(0,et.l)(i||""),{generationCreditsImage:g,generationCreditsVideo:f}=(0,tb.U)(),{image_model_config:v,video_model_config:b}=(0,et.k3)(),w=i&&(null==o?void 0:null===(t=o.storyboard)||void 0===t?void 0:t.shots_map)&&o.storyboard.shots_map[i]||null,C=(null==o?void 0:o.id)??null,j=(0,et.fH)((0,n.useCallback)(e=>i?e.shotRegenerating[i]:void 0,[i])),k=et.fH.use.addVoiceoverGenerationPlaceholder(),F=et.fH.use.addWorkflowRun(),S=et.fH.use.refreshCredits(),I=et.fH.use.setShotRegenerating(),_=et.fH.use.setHoveredMediaId(),{mutateAsync:Z}=(0,ty.EL)(C),[A,E]=(0,n.useState)(!1),[M,T]=(0,n.useState)(!1),R=(null==w?void 0:w.voice_over)||"",D=null==w?void 0:w.active_voice_over_audio_id,z=(null==j?void 0:j.voiceover)??!1,P=(null==j?void 0:j["audio-voice-over"])??!1,W=(0,n.useMemo)(()=>x.some(e=>"generating"===e.generationStatus),[x]),L=(0,n.useCallback)(e=>{i&&d(i,{voice_over:e},{rebuildTimeline:!1})},[i,d]),B=(0,n.useCallback)(async()=>{if(i&&w&&C){I(i,"voiceover",!0);try{let e=await Z({shotId:i,mediaTypesArray:["voiceover"],voiceOver:w.voice_over||"",advancedSettings:{...(null==v?void 0:v.value)?{image_model_config:v.value}:{},...(null==b?void 0:b.value)?{video_model_config:b.value}:{}}});F([{id:e.workflowRunId,shot_id:i}]),k(i,e.workflowRunId,w.voice_over||""),S()}catch(e){console.error("Failed to regenerate voiceover",e)}finally{I(i,"voiceover",!1)}}},[k,F,null==v?void 0:v.value,Z,S,I,w,i,C,null==b?void 0:b.value]),$=(0,n.useCallback)(async()=>{if(i&&w&&C){I(i,"audio-voice-over",!0);try{await a([i],{forceSync:!0});let e=await Z({shotId:i,mediaTypesArray:["audio-voice-over"],imagePrompt:w.image_prompt,videoPrompt:w.video_prompt,voiceOver:w.voice_over||"",advancedSettings:{...(null==v?void 0:v.value)?{image_model_config:v.value}:{},...(null==b?void 0:b.value)?{video_model_config:b.value}:{}}});F([{id:e.workflowRunId,shot_id:i}]),await d(i,{workflow_run_id:e.workflowRunId,shot_type:w.shot_type??"manual"},{rebuildTimeline:!1}),await a([i]),S()}catch(e){console.error("Failed to regenerate full audio assets",e)}}},[F,null==v?void 0:v.value,S,Z,I,w,i,C,a,d,null==b?void 0:b.value]),O=(0,n.useCallback)(async e=>{i&&w&&(_(i,"audio",e.resource.id||""),"generating"!==e.generationStatus&&"failed"!==e.generationStatus&&"audio"===e.resource.resource_type&&"voiceover"===e.resource.subtype&&e.resource.id!==w.active_voice_over_audio_id&&(await p.updateShotWithSnapshot(i,{active_voice_over_audio_id:e.resource.id,active_voice_over_audio_url:e.resource.url},{rebuildTimeline:!0}),a([i])))},[p,_,w,i,a]),U=(0,n.useCallback)(()=>{T(!0)},[]),G=(0,n.useCallback)(()=>{T(!1)},[]);return i&&w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{sx:{width:"100%",maxWidth:300,pb:2.5,borderBottom:"1px solid var(--Gray-200)",backgroundColor:"var(--Gray-100)"},children:(0,r.jsxs)(s.Z,{spacing:1.5,children:[(0,r.jsx)(l.Z,{sx:{borderRadius:"8px",border:`1px solid ${A?"var(--Blue-600)":"var(--Gray-200)"}`,backgroundColor:"var(--Gray-50)",padding:"8px",minHeight:120,transition:"border-color 0.2s ease"},children:(0,r.jsx)(tg.E,{isHovered:!0,disabled:m,value:R,onChange:L,placeholder:"Write your script here…",onFocus:()=>{E(!0),c("Update shot voice over")},onBlur:()=>{E(!1),u()&&a([i])}})}),(0,r.jsxs)(s.Z,{direction:"row",justifyContent:"space-between",children:[(0,r.jsx)(H.Z,{onClick:U,startIcon:W?(0,r.jsx)(em.Z,{size:14,thickness:5,sx:{color:"var(--Gray-600)"}}):(0,r.jsx)(tP.Z,{sx:{fontSize:"16px"}}),sx:{minWidth:"auto",height:28,borderRadius:"6px",border:"1px solid var(--Gray-200)",color:W?"var(--Gray-600)":"var(--Gray-500)",textTransform:"none",fontFamily:"Inter",fontWeight:600,fontSize:"11px",lineHeight:1.2,padding:"0 8px",backgroundColor:"transparent","& .MuiButton-startIcon":{margin:0},"&:hover:not(.Mui-disabled)":{borderColor:"var(--Gray-300)",color:"var(--Gray-700)",backgroundColor:"color-mix(in srgb, var(--Gray-300) 30%, transparent)"},"&.Mui-disabled":{borderColor:"var(--Gray-200)",color:"var(--Gray-600)"}},children:"History"}),(0,r.jsx)(tW.d,{show:!0,onRegenerateVoice:B,onRegenerateShot:$,isRegeneratingVoice:z,isRegeneratingShot:P,disabled:m||!C,voiceoverCredits:5,allContentCredits:g+f})]})]})}),(0,r.jsx)(tL.Y,{open:M,onClose:G,shotId:i,genHistory:x||[],activeAudioId:D,onSelect:O})]}):(0,r.jsx)(l.Z,{sx:{width:"100%",maxWidth:300,border:"1px dashed var(--Gray-300)",borderRadius:"8px",padding:"12px",color:"var(--Gray-500)",fontSize:"13px",lineHeight:1.4},children:"Select a shot to edit its voiceover script."})});tB.displayName="VoiceoverEditor";let tH=e=>{let{item:t}=e;return(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,r.jsx)(tB,{shotId:t.shotId}),(0,r.jsx)(e7,{item:t})]})},t$=(0,n.memo)(e=>{let{item:t,shot:i,mediaType:o}=e,[a,d]=(0,n.useState)("video"),c=(0,F.D)(F.df);(0,n.useEffect)(()=>{"image"===t.type?d("image"):"video"===t.type?d("video"):"voiceover"===o&&d("script")},[t,o]);let u=(0,n.useCallback)(e=>{d(e)},[]),p=()=>{switch(o){case"video":return(0,r.jsx)(tz,{item:c});case"image":return(0,r.jsx)(th,{item:c});case"voiceover":return(0,r.jsx)(tH,{item:c})}return null},{selectedShotId:h,selectedShot:m}=tF(),x=(0,et.PR)(h,(null==m?void 0:m.active_image_id)||"",(null==m?void 0:m.active_video_id)||"");return(0,r.jsx)(s.Z,{direction:"column",sx:{height:"100%",bgcolor:"#1a1a1a"},children:(null==m?void 0:m.shot_type)==="uploaded_video"?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{sx:{flex:0},children:(0,r.jsx)(tO,{icon:(0,r.jsx)(I.PhVideoCamera,{sx:{color:"#888"}}),title:"Video"})}),(0,r.jsxs)(l.Z,{sx:{flex:1,p:1.5,overflowY:"auto"},children:[(0,r.jsx)(l.Z,{sx:{height:"280px"},children:(0,r.jsx)(ew.$P,{videoUrl:null==m?void 0:m.active_video_url})}),(0,r.jsx)(l.Z,{sx:{mt:3},children:p()})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{sx:{flex:0},children:(0,r.jsx)(tR,{tag:"Auto",tab:a,onTabChange:u,sx:{flex:0}})}),(0,r.jsxs)(l.Z,{sx:{flex:1,p:1.5,overflowY:"auto",...R.ji,...(0,R.SZ)(4)},children:["script"===a?null:(0,r.jsxs)(l.Z,{sx:{mb:2},children:[x&&"video"===a?(0,r.jsx)(l.Z,{sx:{mb:1.5,p:"10px",borderRadius:"5px",background:"rgba(255, 170, 0, 0.20)",color:"#FFF",fontFamily:"Inter",fontSize:"12px",fontStyle:"normal",fontWeight:400,lineHeight:"normal"},children:"Image Updated. Create matching clip?"}):null,(0,r.jsx)(tE,{tab:a})]}),p()]})]})})});t$.displayName="EditPropertyForShot";let tO=e=>{let{icon:t,title:i}=e;return(0,r.jsx)(l.Z,{sx:{flex:0},children:(0,r.jsxs)(s.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",gap:1,sx:{p:1,height:"45px",background:"rgba(255, 255, 255, 0.06)"},children:[(0,r.jsx)(d.Z,{variant:"body2",sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"24px",padding:"1px 4px",borderRadius:"5px",background:"#2A2100",color:"#FFEF66",fontFamily:"Inter",fontSize:"12px",fontStyle:"normal",fontWeight:500,lineHeight:"19.2px"},children:"Uploaded"}),t,(0,r.jsx)(d.Z,{variant:"body2",sx:{color:"#888",fontFamily:"Inter",fontSize:"14px",fontStyle:"normal",fontWeight:600,lineHeight:"normal"},children:i})]})})};var tU=i(65805),tG=i(57497);let tN=()=>(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:200,p:2},children:(0,r.jsx)(d.Z,{variant:"body2",color:"text.primary",sx:{fontSize:"14px",fontWeight:700,textAlign:"center"},children:"Select item to edit"})}),tV=()=>{let{story:e}=(0,eC.B)(),t=(0,tG.q)(null==e?void 0:e.category_id);return(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,r.jsx)(tT,{text:"Story Detail",sx:{justifyContent:"flex-start"}}),(0,r.jsx)(l.Z,{sx:{flex:"1 1 auto",overflow:"auto",p:1.5,...R.ji,...(0,R.SZ)(4)},children:t?(0,r.jsx)(t,{story:e,titleSx:{color:"#CCC",fontFamily:"Inter",fontSize:"12px",fontWeight:600,lineHeight:"20px"},spacing:1}):(0,r.jsx)(tN,{})})]})};(0,n.memo)(()=>(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(tT,{}),(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:200,p:2,color:"text.disabled"},children:[(0,r.jsx)(tU.Z,{sx:{fontSize:48,mb:1,opacity:.5}}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:"Select an item to edit"})]})]})).displayName="EmptyState";let tK=(0,n.memo)(e=>{let{sx:t}=e,i=(0,F.D)(F.df),{selectedShot:n}=tF(),o=(0,el.AC)();return(0,r.jsx)(rv,{sx:{...t},children:(()=>{if(!i)return(0,r.jsx)(tV,{});switch(o){case"image":case"video":case"voiceover":return(0,r.jsx)(t$,{item:i,mediaType:o,shot:n});case"music":return(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:1,height:"100%"},children:[(0,r.jsx)(tT,{text:"Audio Editor"}),(0,r.jsx)(e7,{item:i})]});case"caption":return(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:1,height:"100%"},children:[(0,r.jsx)(tT,{text:"Caption Editor"}),(0,r.jsx)(tl,{item:i})]});default:return(0,r.jsx)(tV,{})}})()})});tK.displayName="EditPropertyPane";var tq=i(90145);let tY=()=>(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:(0,r.jsx)("path",{d:"M9 1.6875C7.55372 1.6875 6.13993 2.11637 4.93739 2.91988C3.73486 3.72339 2.7976 4.86544 2.24413 6.20163C1.69067 7.53781 1.54585 9.00811 1.82801 10.4266C2.11016 11.8451 2.80661 13.148 3.82928 14.1707C4.85195 15.1934 6.15492 15.8898 7.5734 16.172C8.99189 16.4541 10.4622 16.3093 11.7984 15.7559C13.1346 15.2024 14.2766 14.2651 15.0801 13.0626C15.8836 11.8601 16.3125 10.4463 16.3125 9C16.3105 7.06123 15.5394 5.20246 14.1685 3.83154C12.7975 2.46063 10.9388 1.68955 9 1.6875ZM9 15.1875C7.77623 15.1875 6.57994 14.8246 5.56241 14.1447C4.54488 13.4648 3.75181 12.4985 3.2835 11.3679C2.81518 10.2372 2.69265 8.99314 2.93139 7.79288C3.17014 6.59262 3.75944 5.49011 4.62478 4.62478C5.49011 3.75944 6.59262 3.17014 7.79288 2.93139C8.99314 2.69265 10.2372 2.81518 11.3679 3.2835C12.4985 3.75181 13.4648 4.54488 14.1447 5.56241C14.8246 6.57994 15.1875 7.77623 15.1875 9C15.1856 10.6405 14.5331 12.2132 13.3732 13.3732C12.2132 14.5331 10.6405 15.1856 9 15.1875ZM12.375 9C12.375 9.14918 12.3157 9.29226 12.2102 9.39775C12.1048 9.50324 11.9617 9.5625 11.8125 9.5625H9.5625V11.8125C9.5625 11.9617 9.50324 12.1048 9.39775 12.2102C9.29226 12.3157 9.14918 12.375 9 12.375C8.85082 12.375 8.70774 12.3157 8.60225 12.2102C8.49676 12.1048 8.4375 11.9617 8.4375 11.8125V9.5625H6.1875C6.03832 9.5625 5.89524 9.50324 5.78975 9.39775C5.68426 9.29226 5.625 9.14918 5.625 9C5.625 8.85082 5.68426 8.70774 5.78975 8.60225C5.89524 8.49676 6.03832 8.4375 6.1875 8.4375H8.4375V6.1875C8.4375 6.03832 8.49676 5.89524 8.60225 5.78975C8.70774 5.68426 8.85082 5.625 9 5.625C9.14918 5.625 9.29226 5.68426 9.39775 5.78975C9.50324 5.89524 9.5625 6.03832 9.5625 6.1875V8.4375H11.8125C11.9617 8.4375 12.1048 8.49676 12.2102 8.60225C12.3157 8.70774 12.375 8.85082 12.375 9Z",fill:"#00B85F"})});(0,n.memo)(e=>{var t,i;let{mediaAsset:o,isAdded:a,onAdd:c,onRemove:u,onClickCheck:p,sx:h}=e,[m,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),[v,b]=(0,n.useState)(!1),y=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(o.url&&!y.current){let e=new Audio;e.src=o.url,e.preload="metadata",e.volume=.5;let t=()=>f(!0),i=()=>f(!1),r=()=>{f(!1),x(!1),console.error("Audio load error for:",o.url)},n=()=>x(!1),a=()=>x(!1),s=()=>x(!0);return e.addEventListener("loadstart",t),e.addEventListener("canplay",i),e.addEventListener("error",r),e.addEventListener("ended",n),e.addEventListener("pause",a),e.addEventListener("play",s),y.current=e,()=>{e.removeEventListener("loadstart",t),e.removeEventListener("canplay",i),e.removeEventListener("error",r),e.removeEventListener("ended",n),e.removeEventListener("pause",a),e.removeEventListener("play",s),e.pause(),e.src="",y.current=null}}},[o.url]),(0,n.useEffect)(()=>()=>{y.current&&(y.current.pause(),y.current.src="",y.current=null)},[]);let w=async e=>{if(e.stopPropagation(),y.current)try{m?y.current.pause():(f(!0),await y.current.play(),f(!1))}catch(e){console.error("Audio playback error:",e),f(!1),x(!1)}},C=(0,n.useCallback)(e=>{if(v)return;let t={source:"media-asset",mediaAssetId:o.id,mediaAssetType:o.resource_type};b(!0),(0,eg.tn)(e.dataTransfer,t),e.dataTransfer.effectAllowed="copy"},[v,o.id,o.resource_type]),j=(0,n.useCallback)(()=>{b(!1)},[]);return(0,r.jsxs)(l.Z,{sx:{backgroundColor:"#2E2E2E",border:"1px solid #444444",borderRadius:"5px",padding:"10px",cursor:v?"grabbing":"grab",width:250,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"11px",opacity:v?.5:1,transition:"all 0.2s ease","&:hover":{backgroundColor:"#353535"},...h},draggable:!0,onDragStart:C,onDragEnd:j,children:[(0,r.jsxs)(s.Z,{direction:"row",alignItems:"center",spacing:"10px",sx:{flex:1,minWidth:0},children:[(0,r.jsxs)(l.Z,{sx:{position:"relative",flexShrink:0},children:[(0,r.jsx)(l.Z,{sx:{width:25,height:25,borderRadius:"50%",backgroundColor:"#101010",display:"flex",alignItems:"center",justifyContent:"center"}}),(0,r.jsx)(tk.Z,{size:"small",onClick:w,disabled:g,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:16,height:16,minHeight:16,minWidth:16,padding:0,color:"#CCCCCC","&:hover":{backgroundColor:"transparent",color:"#FFFFFF"},"&:disabled":{color:"#666666"}},children:g?(0,r.jsx)(tC.Z,{sx:{fontSize:16,marginLeft:"1px",opacity:.5}}):m?(0,r.jsx)(eh.Z,{sx:{fontSize:16}}):(0,r.jsx)(tC.Z,{sx:{fontSize:16,marginLeft:"1px"}})})]}),(0,r.jsxs)(s.Z,{direction:"column",spacing:"3px",sx:{flex:1,minWidth:0},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"12px",lineHeight:1.3,letterSpacing:"-0.24px",color:"#FFFFFF",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.title||`Music ${o.id.slice(0,8)}`}),(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:"1.688px",height:18,paddingX:0},children:(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:500,fontSize:"11px",lineHeight:"13.5px",color:"#E1E6FF",whiteSpace:"nowrap"},children:`${(null===(t=o.metadata)||void 0===t?void 0:t.duration)?`${null===(i=o.metadata)||void 0===i?void 0:i.duration.toFixed(2)}s`:"N/A"}`})})]})]}),(0,r.jsx)(tk.Z,{onClick:e=>{switch(e.stopPropagation(),a){case!0:null==p||p(o);break;case!1:null==c||c(o);break;case void 0:null==u||u(o)}},sx:(()=>{let e={width:18,height:18,minHeight:18,minWidth:18,padding:0};return!0===a?{...e,cursor:p?"pointer":"default","&:hover":{backgroundColor:p?"rgba(27, 239, 97, 0.1)":"transparent"}}:!1===a?{...e,cursor:c?"pointer":"default","&:hover":{backgroundColor:c?"rgba(0, 184, 95, 0.1)":"transparent"}}:{...e,cursor:u?"pointer":"default","&:hover":{backgroundColor:u?"rgba(68, 68, 68, 0.1)":"transparent"}}})(),children:!0===a?(0,r.jsx)(tw.Z,{sx:{fontSize:14,color:"#1BEF61"}}):!1===a?(0,r.jsx)(tY,{}):(0,r.jsx)(tq.Z,{sx:{fontSize:14,color:"#444444"}})})]})}).displayName="MediaAssetItemAudio";var tX=i(66645);let tJ=(0,n.memo)(e=>{let{mediaAsset:t,isSelected:i=!1,onClick:o,sx:a}=e,s=F.wK.use.storyId(),{removeMediaAsset:c}=(0,el.PJ)(s),[u,p]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!0),[x,g]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),b=(0,n.useCallback)(e=>{if(f)return;let i={source:"media-asset",mediaAssetId:t.id,mediaAssetType:t.resource_type};(0,eg.tn)(e.dataTransfer,i),e.dataTransfer.effectAllowed="copy",v(!0)},[f,t.id,t.resource_type]),y=(0,n.useCallback)(()=>{v(!1)},[]),w=(0,el.IL)(t.id,["video"]);return(0,r.jsx)(l.Z,{sx:{backgroundColor:i?"#3A3A3A":"#2E2E2E",borderRadius:.4,overflow:"hidden",cursor:f?"grabbing":"grab",width:"100%",aspectRatio:"1/1",border:i?"1px solid #4A9EFF":"1px solid transparent",transition:"all 0.2s ease",opacity:f?.5:1,position:"relative","&:hover":{backgroundColor:"#3A3A3A",border:i?"1px solid #4A9EFF":"1px solid #555"},...a},onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:()=>{null==o||o()},draggable:!0,onDragStart:b,onDragEnd:y,children:(0,r.jsxs)(l.Z,{sx:{position:"relative",width:"100%",height:"100%",backgroundColor:"#1A1A1A",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[(0,r.jsx)("img",{src:t.url,alt:t.title||"Image",style:{width:"100%",height:"100%",objectFit:"cover",display:h||x?"none":"block"},onLoad:()=>{m(!1),g(!1)},onError:()=>{m(!1),g(!0)}}),h?(0,r.jsx)(ew.p6,{}):null,x?(0,r.jsxs)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#1A1A1A",gap:1},children:[(0,r.jsx)(W.Z,{sx:{fontSize:32,color:"grey.500"}}),(0,r.jsx)(d.Z,{variant:"caption",sx:{color:"grey.500",fontSize:"10px"},children:"Failed to load"})]}):null,!!(u||i)&&(0,r.jsx)(l.Z,{sx:{position:"absolute",top:4,right:4},children:(0,r.jsx)(ex.Z,{title:w?"This image is in use and cannot be deleted.":"Remove image",children:(0,r.jsx)(tk.Z,{size:"small",onClick:e=>{w||(e.stopPropagation(),c(t.id))},sx:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"#ff6b6b",width:20,height:20,cursor:w?"not-allowed":"pointer","&:hover":{backgroundColor:"rgba(255, 107, 107, 0.2)"}},children:(0,r.jsx)(tX.Z,{sx:{fontSize:14}})})})}),i?(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,border:"2px solid #4A9EFF",borderRadius:"2.34375px",pointerEvents:"none",backgroundColor:"rgba(74, 158, 255, 0.1)"}}):null]})})});tJ.displayName="MediaAssetItemImage";let tQ=(0,n.memo)(e=>{var t;let{mediaAsset:i,isSelected:n=!1,onClick:o,onRemove:a,sx:s}=e,{isDragging:d,handleDragStart:c,handleDragEnd:u}=ef(),p=(0,el.IL)(i.id,["video"]);return(0,r.jsx)(l.Z,{sx:{backgroundColor:n?"#3A3A3A":"#2E2E2E",borderRadius:.4,overflow:"hidden",cursor:d?"grabbing":"grab",width:"100%",aspectRatio:"1/1",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#4A9EFF":"transparent",transition:"all 0.2s ease",position:"relative",opacity:d?.5:1,"&:hover":{backgroundColor:"#3A3A3A",borderColor:n?"#4A9EFF":"#555","& .delete-button":{opacity:1}},"& .delete-button":{opacity:n?1:0,transition:"opacity 0.2s ease"},...n&&{boxShadow:"inset 0 0 0 2px rgba(74, 158, 255, 0.1)"},...s},onClick:()=>{null==o||o()},draggable:!0,onDragStart:e=>c(e,i),onDragEnd:u,children:(0,r.jsxs)(l.Z,{sx:{position:"relative",width:"100%",height:"100%",backgroundColor:"#1A1A1A",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[i.thumbnail_url?(0,r.jsx)("img",{src:i.thumbnail_url,alt:i.title||"Video thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,r.jsx)(tC.Z,{sx:{fontSize:32,color:"grey.500"}}),(0,r.jsx)(e1,{sx:{top:"4.69px",left:"4.69px"},children:(null===(t=i.metadata)||void 0===t?void 0:t.duration)?`${i.metadata.duration.toFixed(2)}s`:"N/A"}),a?(0,r.jsx)(l.Z,{className:"delete-button",sx:{position:"absolute",top:4,right:4},children:(0,r.jsx)(ex.Z,{title:p?"This video is in use and cannot be deleted.":"Remove video",children:(0,r.jsx)(tk.Z,{size:"small",onClick:e=>{p||(e.stopPropagation(),null==a||a(i))},sx:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"#ff6b6b",width:20,height:20,cursor:p?"not-allowed":"pointer","&:hover":{backgroundColor:"rgba(255, 107, 107, 0.2)"}},children:(0,r.jsx)(tX.Z,{sx:{fontSize:14}})})})}):null]})})});tQ.displayName="MediaAssetItemVideo",(0,n.memo)(e=>{let{sx:t}=e;return(0,r.jsx)(ex.Z,{title:"This video is in use and cannot be deleted.",children:(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",...t},children:(0,r.jsx)(d.Z,{variant:"caption",sx:{color:"grey.500",fontSize:"10px"},children:"In use"})})})}).displayName="InUseBadge";let t0=(0,n.memo)(e=>{let{mediaAsset:t,sx:i}=e,o=(0,n.useRef)(null);return(0,n.useEffect)(()=>{(null==t?void 0:t.resource_type)==="video"&&o.current&&(null==t?void 0:t.url)&&(o.current.src=t.url,o.current.play().catch(()=>{}))},[null==t?void 0:t.url,null==t?void 0:t.resource_type]),(0,r.jsx)(s.Z,{sx:{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",...i},children:(0,r.jsx)(l.Z,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:(null==t?void 0:t.resource_type)==="video"&&(null==t?void 0:t.url)?(0,r.jsx)("video",{ref:o,autoPlay:!0,loop:!0,muted:!0,controls:!0,playsInline:!0,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}):(0,r.jsx)("img",{src:null==t?void 0:t.url,alt:"Media preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",opacity:(null==t?void 0:t.url)?1:0}})})})});t0.displayName="MediaAssetPreview";var t1=i(41926);let t2=(0,n.memo)(e=>{let{items:t,layout:i,renderItem:n,emptyMessage:o="No items found",loading:a=!1,sx:s}=e;if(a)return(0,r.jsx)(t1.Z,{loading:!0});let c=(e,t)=>"uploading"===e.status||"error"===e.status?(0,r.jsx)(ek,{mediaAsset:e,layout:i,progress:e.progress},e.id):n(e,t);return 0===t.length?(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,color:"text.secondary",...s},children:(0,r.jsx)(d.Z,{variant:"body2",children:o})}):"grid"===i?(0,r.jsx)(l.Z,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gridAutoRows:"min-content",alignItems:"start",gap:1,overflowY:"auto",...R.ji,...s},children:t.map((e,t)=>(0,r.jsx)(l.Z,{sx:{width:"100%"},children:c(e,t)},e.id))}):(0,r.jsx)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:1,p:1,overflowY:"auto",...R.ji,...s},children:t.map((e,t)=>(0,r.jsx)(l.Z,{children:c(e,t)},e.id))})});t2.displayName="MediaAssetsList";var t5=i(4102),t6=i(328);(0,n.memo)(e=>{let{placeholder:t="Search...",value:i="",onChange:o,onSearch:a,sx:s,disabled:l=!1}=e,d=(0,n.useCallback)(e=>{e.preventDefault(),null==a||a(i)},[a,i]);return(0,r.jsx)(c.Z,{fullWidth:!0,size:"small",placeholder:t,value:i,onChange:e=>{null==o||o(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(null==a||a(i))},disabled:l,InputProps:{startAdornment:(0,r.jsx)(t5.Z,{position:"start",children:(0,r.jsx)(t6.Z,{icon:"ph:magnifying-glass-bold",width:16,height:16,onClick:d,sx:{color:"#FFFFFF"}})}),sx:{height:28,paddingX:"8px",paddingY:"6px",fontSize:12,fontFamily:"Inter",color:"#FFFFFF",backgroundColor:"transparent",borderRadius:"5px","& .MuiOutlinedInput-notchedOutline":{borderColor:"#2E2E2E",borderWidth:"1.2px"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#2E2E2E",borderWidth:"1.2px"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#2E2E2E",borderWidth:"1.2px"},"& .MuiInputBase-input":{padding:0,paddingLeft:"8px",fontSize:12,fontFamily:"Inter",color:"#FFFFFF","&::placeholder":{color:"rgba(255, 255, 255, 0.45)",opacity:1}},"& .MuiInputAdornment-root":{marginLeft:0,marginRight:0}}},sx:{width:"100%","& .MuiInputBase-root":{height:28},...s}})}).displayName="PaneSearchInput",(0,n.memo)(e=>{let{tabs:t,activeTabId:i,onTabChange:o,sx:a}=e,s=(0,n.useCallback)((e,i)=>{let r=t.find(e=>e.id===i);r&&!r.disabled&&o(r.id)},[o,t]);return(0,r.jsx)(l.Z,{sx:{width:"100%",height:25,...a},children:(0,r.jsx)(eG.Z,{value:i,onChange:s,variant:"fullWidth",sx:{minHeight:25,height:25,"& .MuiTabs-flexContainer":{height:25,gap:1},"& .MuiTabs-indicator":{display:"none"},"& .MuiTabs-scroller":{overflow:"visible !important"}},children:t.map(e=>(0,r.jsx)(eN.Z,{label:e.label,value:e.id,disabled:e.disabled,sx:{minHeight:25,height:25,padding:"5px 10px",minWidth:"fit-content",borderRadius:"5px",backgroundColor:i===e.id?"#2E2E2E":"#1A1A1A",color:i===e.id?"#FFFFFF":"#888888",fontFamily:"Inter",fontWeight:i===e.id?500:400,fontSize:12,lineHeight:1.21,textTransform:"none",m:"0 !important",transition:"all 0.2s ease-in-out",flex:t.length>=3?"1 1 0":"0 0 auto",opacity:e.disabled?.5:1,"&:hover":e.disabled?{}:{backgroundColor:i===e.id?"#2E2E2E":"#252525"},"&.Mui-selected":{backgroundColor:"#2E2E2E",color:"#FFFFFF",fontWeight:500},"&.Mui-disabled":{opacity:.5,cursor:"not-allowed"},"&.MuiTab-root":{minWidth:"fit-content",padding:"5px 10px"},"&.MuiButtonBase-root":{borderRadius:"5px"}}},e.id))})})}).displayName="PaneTabs";var t4=i(88651);(0,n.memo)(e=>{let{onClick:t}=e;return(0,r.jsxs)(l.Z,{sx:{flex:0,display:"flex",alignItems:"center",backgroundColor:"#061A3F",border:"1px solid #0C2F75",borderRadius:"5px",height:28,padding:"5px",gap:"5px"},children:[(0,r.jsx)(l.Z,{sx:{width:15,height:15,borderRadius:"2px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(t4.Z,{sx:{fontSize:14}})}),(0,r.jsxs)(d.Z,{variant:"body2",sx:{fontSize:12,fontWeight:400,lineHeight:1.21,color:"#CFE0FF",userSelect:"none"},children:["See full controls in",(0,r.jsx)(d.Z,{component:"span",sx:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",color:"inherit",cursor:"pointer",fontWeight:600,marginLeft:.5,transition:"opacity 0.2s ease-in-out","&:hover":{opacity:.8}},onClick:t,children:"All Shots →"})]})]})}).displayName="ShotEditTip";var t3=i(29799);let t8=e=>{let{item:t,mediaAsset:i}=e,o=(0,n.useCallback)(e=>{let i=t.volume??1;if(0===i)return 0;let r=i,n=t.effects||[],o=n.find(e=>"fade-in"===e.type);o&&o.durationInFrames>0&&(r*=(0,eg.aD)(e,o.durationInFrames));let a=n.find(e=>"fade-out"===e.type);return a&&a.durationInFrames>0&&(r*=(0,eg.Xm)(e,a.durationInFrames,t.durationInFrames)),Math.max(0,Math.min(1,r))},[t.volume,t.effects,t.durationInFrames]);return(0,r.jsx)(t3.Bb,{src:i.url,startFrom:Math.floor(Math.max(0,t.sourceTrimStartFrames)),endAt:Math.floor(Math.max(1,t.sourceTrimEndFrames)),volume:o,playbackRate:t.speed||1,muted:0===t.volume,pauseWhenBuffering:!0})};var t9=i(25814),t7=i(35324),ie=i(14649),it=i(16662),ii=i(56546),ir=i(41550),io=i(24262),ia=i(74277),is=i(72732),il=i(30493);let{fontFamily:id}=(0,t9.mx)("normal",{weights:["400","500","600","700"],subsets:["latin"]}),{fontFamily:ic}=(0,is.mx)("normal",{weights:["400","500","700"],subsets:["latin"]}),{fontFamily:iu}=(0,ii.mx)("normal",{weights:["400","600","700"],subsets:["latin"]}),{fontFamily:ip}=(0,ie.mx)("normal",{weights:["400","600","700"],subsets:["latin"]}),{fontFamily:ih}=(0,io.mx)("normal",{weights:["400","600","700"],subsets:["latin"]}),{fontFamily:im}=(0,t7.mx)("normal",{weights:["400","700"],subsets:["latin"]}),{fontFamily:ix}=(0,it.mx)("normal",{weights:["400","600","700"],subsets:["latin"]}),{fontFamily:ig}=(0,il.mx)("normal",{weights:["400","600","700"],subsets:["latin"]}),{fontFamily:iv}=(0,ia.mx)("normal",{weights:["400","600","700"],subsets:["latin"]}),{fontFamily:ib}=(0,ir.mx)("normal",{weights:["400","600","700"],subsets:["latin"]}),iy={Inter:id,Roboto:ic,"Open Sans":iu,Montserrat:ip,Poppins:ih,Lato:im,Nunito:ix,"Work Sans":ig,Raleway:iv,Oswald:ib},iw=e=>{let t=e.split(",")[0].trim();return iy[t]||`${t}, Arial, sans-serif`},iC=e=>{var t,i,n;let{item:o,globalStyles:a}=e,s=(0,t3.ND)(),{width:l,height:d}=(0,t3.rf)();if(!(s>=0&&s<o.durationInFrames)||!(null===(i=o.caption)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.text))return null;let c=o.caption.data.text,{fontSize:u,captionWidth:p,bottomPercentage:h}=(0,eg.bM)(l,d),m=(0,eg.WM)(u,p),{height:x,...g}=(null===(n=o.caption)||void 0===n?void 0:n.style)||{},{height:f,...v}=a||{},b=iw(((null==a?void 0:a.fontFamily)??(null==g?void 0:g.fontFamily)??(null==m?void 0:m.fontFamily))||"Inter"),y={...m,...g,...v,fontFamily:b,whiteSpace:"pre-line"},w=Number.parseFloat((null==f?void 0:f.toString())??"")||Number.parseFloat((null==x?void 0:x.toString())??"")||h;return(0,r.jsx)(t3.hU,{style:{position:"absolute",bottom:`${w}%`,top:"auto",left:0,right:0,justifyContent:"flex-end",alignItems:"center",height:"auto",pointerEvents:"none",zIndex:1e3,userSelect:"none"},children:(0,r.jsx)("div",{style:y,children:c})})},{fontFamily:ij}=(0,io.mx)("normal",{weights:["700"],subsets:["latin"]}),ik=e=>{let{style:t}=e;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"417",height:"68",viewBox:"0 0 417 68",fill:"none",style:t,children:(0,r.jsx)("path",{d:"M86.3169 0.232434C95.2817 0.238815 103.881 3.76453 110.235 10.0381C116.589 16.3118 120.185 24.8245 120.235 33.7181C120.211 40.2431 118.277 46.6222 114.666 52.076C111.055 57.53 105.922 61.8231 99.8956 64.4368C93.8695 67.0501 87.2083 67.8719 80.7213 66.7977C74.2338 65.7233 68.2002 62.8004 63.3562 58.3866C57.3971 53.4532 51.408 48.591 45.391 43.7973L54.0051 36.9748C62.4096 43.6598 69.6986 49.5702 72.5705 51.8642C76.5185 54.7922 81.317 56.377 86.2463 56.3787C98.5661 56.3776 109.48 46.1747 109.269 33.7181C109.227 29.5132 108.013 25.4031 105.765 21.8383C103.517 18.2735 100.322 15.3922 96.5285 13.5155C92.7353 11.639 88.4921 10.8396 84.2693 11.2031C80.0459 11.5668 76.0035 13.0792 72.5926 15.5763C54.317 30.6236 35.468 45.1779 16.8568 59.7811C9.32349 65.0458 0.397833 59.8676 0.396373 51.1493C0.296912 39.5552 0.296912 27.9659 0.396373 16.3883C0.42233 7.6322 9.33721 2.39136 16.8832 7.63299L37.1873 23.9522L28.7938 30.6863L11.3008 16.9929C11.2097 28.1589 11.2097 39.31 11.3008 50.4432C28.8427 36.8762 46.2856 23.1495 63.4048 9.08927C69.6498 3.3877 77.8299 0.22527 86.3169 0.232434ZM215.895 20.36C219.014 20.3603 221.804 21.0734 224.266 22.5003C226.77 23.8868 228.739 25.8459 230.175 28.374C231.653 30.9024 232.391 33.8801 232.391 37.3058C232.391 40.7724 231.653 43.771 230.175 46.2994C228.739 48.8274 226.77 50.7867 224.266 52.1731C221.804 53.5593 219.014 54.2514 215.895 54.2516C213.104 54.2516 210.658 53.6393 208.565 52.4158C207.582 51.8411 206.706 51.1203 205.922 50.2667V65.6283H196.315V20.8498H205.489V24.6582C206.318 23.6633 207.282 22.8401 208.384 22.1958C210.477 20.9729 212.982 20.36 215.895 20.36ZM165.918 10.2057C169.323 10.2058 172.442 10.7556 175.274 11.8562C178.147 12.9572 180.63 14.5094 182.723 16.5075C184.857 18.5057 186.52 20.8504 187.709 23.5417C188.899 26.1924 189.496 29.1285 189.497 32.35C189.497 35.5311 188.899 38.4876 187.709 41.2201C186.52 43.9118 184.857 46.256 182.723 48.2544C180.629 50.2119 178.147 51.7428 175.274 52.8439C172.442 53.9446 169.345 54.4942 165.98 54.4943C162.574 54.4943 159.41 53.945 156.496 52.8439C153.624 51.7428 151.119 50.195 148.986 48.197C146.892 46.1986 145.251 43.85 144.061 41.1583C142.912 38.4671 142.34 35.5305 142.34 32.35C142.34 29.1694 142.912 26.2331 144.061 23.5417C145.251 20.8504 146.913 18.5057 149.047 16.5075C151.181 14.5092 153.685 12.9573 156.558 11.8562C159.432 10.7551 162.552 10.2057 165.918 10.2057ZM254.027 20.36C257.27 20.36 260.184 21.0525 262.77 22.4385C265.396 23.7841 267.47 25.7436 268.987 28.3122C270.507 30.8407 271.269 33.8813 271.269 37.4294C271.269 37.7962 271.249 38.2246 271.207 38.7135C271.167 39.1619 271.125 39.59 271.084 39.9977H246.027C246.22 40.8729 246.525 41.688 246.949 42.4425C247.771 43.7879 248.898 44.8284 250.334 45.5625C251.811 46.2557 253.536 46.6039 255.506 46.6039C257.27 46.6039 258.809 46.3394 260.122 45.8096C261.476 45.2795 262.707 44.4822 263.815 43.4222L268.926 48.9296C267.408 50.6419 265.501 51.9679 263.202 52.9057C260.904 53.8029 258.255 54.2516 255.259 54.2516C251.484 54.2514 248.159 53.5176 245.285 52.0495C242.454 50.5814 240.257 48.5807 238.697 46.0523C237.138 43.4835 236.358 40.5675 236.358 37.3058C236.358 34.0033 237.118 31.0873 238.635 28.5593C240.195 25.9904 242.31 23.9894 244.976 22.5621C247.645 21.0941 250.663 20.3602 254.027 20.36ZM405.556 21.5824H413.803V28.9256H405.556V42.3234C405.556 43.7091 405.925 44.7878 406.663 45.5625C407.402 46.2962 408.407 46.6654 409.677 46.6657C411.196 46.6657 412.49 46.2581 413.556 45.4433L416.142 52.1731C415.158 52.8658 413.967 53.3949 412.572 53.7618C411.219 54.0877 409.804 54.2514 408.327 54.2516C404.429 54.2516 401.39 53.2735 399.214 51.317C397.039 49.3186 395.949 46.3577 395.949 42.4425V28.9256H390.838V21.5824H395.949V13.5684H405.556V21.5824ZM297.795 20.36C300.421 20.3601 302.759 20.8929 304.812 21.9531C306.905 22.9727 308.546 24.5621 309.737 26.7235C310.926 28.8439 311.524 31.575 311.524 34.9184V53.7618H301.917V36.3879C301.917 33.7373 301.324 31.7785 300.134 30.5142C298.985 29.2504 297.342 28.6213 295.209 28.6211C293.69 28.6211 292.314 28.9439 291.083 29.5963C289.892 30.2081 288.947 31.1686 288.25 32.4736C287.593 33.7785 287.266 35.4525 287.266 37.4911V53.7618H277.663V20.8498H286.833V24.7686C287.785 23.7137 288.913 22.8328 290.223 22.134C292.439 20.9518 294.964 20.36 297.795 20.36ZM363.571 53.7618H353.103L349.277 44.5872H329.299L325.46 53.7618H315.24L334.449 10.9383H344.299L363.571 53.7618ZM387.93 29.1683C387.519 29.1275 387.146 29.1065 386.818 29.1065C386.489 29.0658 386.141 29.0491 385.772 29.0491C383.145 29.0493 381.01 29.8042 379.369 31.313C377.77 32.7812 376.968 35.0846 376.968 38.2237V53.7618H367.366V20.8498H376.54V25.1745C377.445 23.948 378.592 22.9535 379.987 22.1958C382.162 20.9726 384.811 20.36 387.93 20.36V29.1683ZM214.231 28.193C212.631 28.193 211.193 28.5578 209.92 29.2918C208.648 30.0258 207.644 31.0667 206.906 32.4118C206.167 33.7576 205.798 35.3891 205.798 37.3058C205.798 39.1819 206.167 40.8131 206.906 42.1998C207.644 43.545 208.648 44.5858 209.92 45.3198C211.193 46.0539 212.631 46.423 214.231 46.423C215.832 46.423 217.25 46.0538 218.481 45.3198C219.753 44.5858 220.757 43.545 221.495 42.1998C222.275 40.8131 222.664 39.1819 222.664 37.3058C222.664 35.3891 222.275 33.7576 221.495 32.4118C220.757 31.0667 219.753 30.0258 218.481 29.2918C217.25 28.5578 215.832 28.1931 214.231 28.193ZM165.918 18.6478C163.99 18.6478 162.203 18.9749 160.561 19.6274C158.96 20.28 157.542 21.2152 156.311 22.4385C155.08 23.662 154.118 25.1132 153.421 26.7853C152.764 28.4569 152.437 30.3116 152.436 32.35C152.436 34.3484 152.764 36.2063 153.421 37.9192C154.118 39.5902 155.06 41.0387 156.249 42.2616C157.481 43.4851 158.918 44.4245 160.561 45.077C162.203 45.7295 163.99 46.0523 165.918 46.0523C167.846 46.0522 169.613 45.7295 171.214 45.077C172.855 44.4246 174.29 43.4845 175.521 42.2616C176.752 41.0384 177.697 39.5907 178.354 37.9192C179.051 36.2472 179.4 34.3891 179.4 32.35C179.4 30.3118 179.051 28.4568 178.354 26.7853C177.697 25.1132 176.752 23.662 175.521 22.4385C174.332 21.2162 172.916 20.2797 171.275 19.6274C169.633 18.975 167.846 18.6479 165.918 18.6478ZM332.45 37.0631H346.144L339.308 20.6689L332.45 37.0631ZM254.089 27.5796C252.45 27.5798 250.993 27.9452 249.72 28.6784C248.489 29.3717 247.524 30.3743 246.825 31.6793C246.376 32.4953 246.072 33.4131 245.912 34.433H262.218C262.062 33.3955 261.755 32.4571 261.291 31.6175C260.594 30.3533 259.632 29.3716 258.401 28.6784C257.169 27.9444 255.731 27.5796 254.089 27.5796Z",fill:"white"})})},iF=()=>(0,r.jsxs)("svg",{width:"40",height:"39",viewBox:"0 0 40 39",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsxs)("g",{id:"Group 1000011525",children:[(0,r.jsx)("g",{id:"Star 1",filter:"url(#filter0_d_4926_16277)",children:(0,r.jsx)("path",{d:"M13.9407 10.1885L14.2448 12.4098C14.8107 16.5436 17.8341 19.9176 21.8813 20.9318V20.9318V20.9318C17.8341 21.9459 14.8107 25.3199 14.2448 29.4537L13.9407 31.675L13.6366 29.4537C13.0707 25.3199 10.0473 21.9459 6.00004 20.9318V20.9318V20.9318C10.0473 19.9176 13.0707 16.5436 13.6366 12.4098L13.9407 10.1885Z",fill:"url(#paint0_linear_4926_16277)"})}),(0,r.jsx)("g",{id:"Star 2",filter:"url(#filter1_d_4926_16277)",children:(0,r.jsx)("path",{d:"M31.2235 19.0361L31.4024 20.3427C31.7352 22.7744 33.5137 24.7591 35.8944 25.3556V25.3556V25.3556C33.5137 25.9522 31.7352 27.9369 31.4024 30.3685L31.2235 31.6752L31.0446 30.3685C30.7117 27.9369 28.9332 25.9522 26.5525 25.3556V25.3556V25.3556C28.9332 24.7591 30.7117 22.7744 31.0446 20.3427L31.2235 19.0361Z",fill:"url(#paint1_linear_4926_16277)"})}),(0,r.jsx)("g",{id:"Star 3",filter:"url(#filter2_d_4926_16277)",children:(0,r.jsx)("path",{d:"M26.3189 1.99987L26.4351 2.84919C26.6515 4.42976 27.8075 5.7198 29.355 6.10757V6.10757V6.10757C27.8075 6.49534 26.6515 7.78539 26.4351 9.36596L26.3189 10.2153L26.2026 9.36596C25.9862 7.78539 24.8302 6.49534 23.2827 6.10757V6.10757V6.10757C24.8302 5.7198 25.9862 4.42976 26.2026 2.84919L26.3189 1.99987Z",fill:"url(#paint2_linear_4926_16277)",fillOpacity:"0.4",shapeRendering:"crispEdges"})})]}),(0,r.jsxs)("defs",{children:[(0,r.jsxs)("filter",{id:"filter0_d_4926_16277",x:"0.535",y:"6.59189",width:"26.8114",height:"32.4165",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,r.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,r.jsx)("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),(0,r.jsx)("feOffset",{dy:"1.86839"}),(0,r.jsx)("feGaussianBlur",{stdDeviation:"2.73252"}),(0,r.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,r.jsx)("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.390325 0 0 0 0 1 0 0 0 0 0.898387 0 0 0 0.47 0"}),(0,r.jsx)("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4926_16277"}),(0,r.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4926_16277",result:"shape"})]}),(0,r.jsxs)("filter",{id:"filter1_d_4926_16277",x:"23.3378",y:"16.9204",width:"15.7714",height:"19.0686",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,r.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,r.jsx)("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),(0,r.jsx)("feOffset",{dy:"1.09905"}),(0,r.jsx)("feGaussianBlur",{stdDeviation:"1.60736"}),(0,r.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,r.jsx)("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.390325 0 0 0 0 1 0 0 0 0 0.898387 0 0 0 0.47 0"}),(0,r.jsx)("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4926_16277"}),(0,r.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4926_16277",result:"shape"})]}),(0,r.jsxs)("filter",{id:"filter2_d_4926_16277",x:"21.1932",y:"0.624678",width:"10.2514",height:"12.3946",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,r.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,r.jsx)("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),(0,r.jsx)("feOffset",{dy:"0.714384"}),(0,r.jsx)("feGaussianBlur",{stdDeviation:"1.04479"}),(0,r.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,r.jsx)("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.390325 0 0 0 0 1 0 0 0 0 0.898387 0 0 0 0.47 0"}),(0,r.jsx)("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4926_16277"}),(0,r.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4926_16277",result:"shape"})]}),(0,r.jsxs)("linearGradient",{id:"paint0_linear_4926_16277",x1:"6.00004",y1:"20.9318",x2:"21.8813",y2:"20.9318",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#2FFF9E"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#0022FF"})]}),(0,r.jsxs)("linearGradient",{id:"paint1_linear_4926_16277",x1:"26.5525",y1:"25.3556",x2:"35.8944",y2:"25.3556",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#2FFF9E"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#0022FF"})]}),(0,r.jsxs)("linearGradient",{id:"paint2_linear_4926_16277",x1:"23.2827",y1:"6.10757",x2:"29.355",y2:"6.10757",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#2FFF9E"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#C6A3FF"})]})]})]}),iS=()=>(0,r.jsxs)("svg",{width:"30",height:"23",viewBox:"0 0 30 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsxs)("g",{id:"Group 1000011526",children:[(0,r.jsx)("g",{id:"Star 2",filter:"url(#filter0_d_4926_16271)",children:(0,r.jsx)("path",{d:"M8.67102 2.99982L8.84989 4.30647C9.18278 6.73812 10.9613 8.7228 13.342 9.31937V9.31937V9.31937C10.9613 9.91594 9.18278 11.9006 8.8499 14.3323L8.67102 15.6389L8.49214 14.3323C8.15926 11.9006 6.38077 9.91594 4.00005 9.31937V9.31937V9.31937C6.38077 8.7228 8.15926 6.73812 8.49214 4.30647L8.67102 2.99982Z",fill:"url(#paint0_linear_4926_16271)"})}),(0,r.jsx)("g",{id:"Star 3",filter:"url(#filter1_d_4926_16271)",children:(0,r.jsx)("path",{d:"M24.7858 11.4073L24.9021 12.2567C25.1185 13.8372 26.2745 15.1273 27.8219 15.5151V15.5151V15.5151C26.2745 15.9028 25.1185 17.1929 24.9021 18.7734L24.7858 19.6228L24.6695 18.7734C24.4532 17.1929 23.2971 15.9028 21.7497 15.5151V15.5151V15.5151C23.2971 15.1273 24.4532 13.8372 24.6695 12.2567L24.7858 11.4073Z",fill:"url(#paint1_linear_4926_16271)",fillOpacity:"0.4",shapeRendering:"crispEdges"})})]}),(0,r.jsxs)("defs",{children:[(0,r.jsxs)("filter",{id:"filter0_d_4926_16271",x:"0.785319",y:"0.884145",width:"15.7714",height:"19.0686",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,r.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,r.jsx)("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),(0,r.jsx)("feOffset",{dy:"1.09905"}),(0,r.jsx)("feGaussianBlur",{stdDeviation:"1.60736"}),(0,r.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,r.jsx)("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.390325 0 0 0 0 1 0 0 0 0 0.898387 0 0 0 0.47 0"}),(0,r.jsx)("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4926_16271"}),(0,r.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4926_16271",result:"shape"})]}),(0,r.jsxs)("filter",{id:"filter1_d_4926_16271",x:"19.6601",y:"10.0322",width:"10.2514",height:"12.3946",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,r.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,r.jsx)("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),(0,r.jsx)("feOffset",{dy:"0.714384"}),(0,r.jsx)("feGaussianBlur",{stdDeviation:"1.04479"}),(0,r.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,r.jsx)("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.390325 0 0 0 0 1 0 0 0 0 0.898387 0 0 0 0.47 0"}),(0,r.jsx)("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4926_16271"}),(0,r.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4926_16271",result:"shape"})]}),(0,r.jsxs)("linearGradient",{id:"paint0_linear_4926_16271",x1:"-8.22814",y1:"10.3165",x2:"13.342",y2:"9.31937",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#2FFF9E"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#C6A3FF"})]}),(0,r.jsxs)("linearGradient",{id:"paint1_linear_4926_16271",x1:"13.9249",y1:"15.6006",x2:"27.8219",y2:"15.5151",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#2FFF9E"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#C6A3FF"})]})]})]}),iI=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,r=document.createElement("canvas"),n=r.getContext("2d");if(!n)return"";r.width=e,r.height=t;let o=n.createImageData(e,t),a=o.data;for(let e=0;e<a.length;e+=4){let t=Math.random(),r=Math.random()*i*255,n=t>.5?255:0;a[e]=Math.floor(.7*n+100*t),a[e+1]=Math.floor(.9*n+80*t),a[e+2]=Math.floor(1.2*n+60*t),a[e+3]=r}return n.putImageData(o,0,0),r.toDataURL()},i_=n.memo(()=>{let e=(0,n.useMemo)(()=>iI(200,200,.4),[]),t=`radial-gradient(ellipse 60% 40% at center, 
            rgba(0,0,0,1) 0%, 
            rgba(0,0,0,0.95) 45%, 
            rgba(0,0,0,0.85) 60%, 
            rgba(0,0,0,0.7) 70%, 
            rgba(0,0,0,0.5) 80%, 
            rgba(0,0,0,0.25) 88%, 
            rgba(0,0,0,0.1) 94%, 
            rgba(0,0,0,0) 100%)`;return(0,r.jsx)("div",{style:{position:"relative",width:"100%",height:"100%"},children:(0,r.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%",transform:"rotate(20deg) skewX(0deg)",transformOrigin:"center",mask:t,WebkitMask:t},children:[(0,r.jsx)("div",{style:{transform:"skewX(0deg) rotate(-20deg)",transformOrigin:"center"},children:(0,r.jsx)(iZ,{})}),e?(0,r.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundImage:`url(${e})`,backgroundRepeat:"repeat",backgroundSize:"100px 100px",opacity:.7,mixBlendMode:"soft-light",pointerEvents:"none",transform:"skewX(0deg) rotate(-20deg)",transformOrigin:"center"}}):null]})})});i_.displayName="GalaxyBackgroundWithParticles";let iZ=()=>(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"347",height:"187",viewBox:"0 0 347 187",fill:"none",children:[(0,r.jsxs)("g",{filter:"url(#filter0_f_4912_33995)",children:[(0,r.jsx)("ellipse",{cx:"122.927",cy:"26.421",rx:"122.927",ry:"26.421",transform:"matrix(0.894467 0.447135 -0.592435 0.805618 63.8125 15)",fill:"#D9D9D9"}),(0,r.jsx)("g",{clipPath:"url(#paint0_diamond_4912_33995_clip_path)","data-figma-skip-parse":"true",children:(0,r.jsxs)("g",{transform:"matrix(0.119974 0.0536471 0.0151559 0.45581 162.79 91.7662)",children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"1181.92",height:"122.407",fill:"url(#paint0_diamond_4912_33995)",opacity:"1",shapeRendering:"crispEdges"}),(0,r.jsx)("rect",{x:"0",y:"0",width:"1181.92",height:"122.407",transform:"scale(1 -1)",fill:"url(#paint0_diamond_4912_33995)",opacity:"1",shapeRendering:"crispEdges"}),(0,r.jsx)("rect",{x:"0",y:"0",width:"1181.92",height:"122.407",transform:"scale(-1 1)",fill:"url(#paint0_diamond_4912_33995)",opacity:"1",shapeRendering:"crispEdges"}),(0,r.jsx)("rect",{x:"0",y:"0",width:"1181.92",height:"122.407",transform:"scale(-1)",fill:"url(#paint0_diamond_4912_33995)",opacity:"1",shapeRendering:"crispEdges"})]})}),(0,r.jsx)("ellipse",{cx:"122.927",cy:"26.421",rx:"122.927",ry:"26.421",transform:"matrix(0.894467 0.447135 -0.592435 0.805618 63.8125 15)","data-figma-gradient-fill":'{"type":"GRADIENT_DIAMOND","stops":[{"color":{"r":0.94639581441879272,"g":0.98422473669052124,"b":0.85812836885452271,"a":0.80000001192092896},"position":0.0},{"color":{"r":0.013623046688735485,"g":0.19445882737636566,"b":1.0,"a":1.0},"position":0.33653846383094788},{"color":{"r":0.77795690298080444,"g":0.63993012905120850,"b":1.0,"a":1.0},"position":1.0}],"stopsVar":[{"color":{"r":0.94639581441879272,"g":0.98422473669052124,"b":0.85812836885452271,"a":0.80000001192092896},"position":0.0},{"color":{"r":0.013623046688735485,"g":0.19445882737636566,"b":1.0,"a":1.0},"position":0.33653846383094788},{"color":{"r":0.77795690298080444,"g":0.63993012905120850,"b":1.0,"a":1.0},"position":1.0}],"transform":{"m00":239.94859313964844,"m01":30.311830520629883,"m02":27.659652709960938,"m10":107.29411315917969,"m11":911.6191406250,"m12":-417.69039916992188},"opacity":1.0,"blendMode":"NORMAL","visible":true}'})]}),(0,r.jsxs)("defs",{children:[(0,r.jsxs)("filter",{id:"filter0_f_4912_33995",x:"-1.62599",y:"0.861313",width:"347.791",height:"185.647",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,r.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,r.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,r.jsx)("feGaussianBlur",{stdDeviation:"27.1123",result:"effect1_foregroundBlur_4912_33995"})]}),(0,r.jsx)("clipPath",{id:"paint0_diamond_4912_33995_clip_path",children:(0,r.jsx)("ellipse",{cx:"122.927",cy:"26.421",rx:"122.927",ry:"26.421",transform:"matrix(0.894467 0.447135 -0.592435 0.805618 63.8125 16)"})}),(0,r.jsxs)("linearGradient",{id:"paint0_diamond_4912_33995",x1:"0",y1:"0",x2:"500",y2:"500",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#F1FBDB",stopOpacity:"0.8"}),(0,r.jsx)("stop",{offset:"0.336538",stopColor:"#0332FF"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#C6A3FF"})]})]})]}),iA=417/68,iE=(0,n.memo)(e=>{let{useParticles:t=!1}=e,i=(0,t3.ND)(),{fps:n,width:o,height:a}=(0,t3.rf)(),{isPortrait:s}=(0,eg.n3)(o,a),l=s?.6*o:.42*o,d=l/310,c=.1*n,u=.3*n,p=(0,t3.sX)(i,[0,c],[.4,1.15],{extrapolateRight:"clamp"}),h=(0,t3.sX)(i,[0,c],[0,1],{extrapolateRight:"clamp"}),m=(0,t3.sX)(i,[c,u],[1.3,1.4],{extrapolateRight:"clamp"}),x=(0,t3.sX)(i,[c,u],[0,1],{extrapolateRight:"clamp"}),g=s?20:0,f=(0,t3.sX)(i,[c,u],[6+g,g],{extrapolateRight:"clamp"}),v=(0,t3.sX)(i,[c,u],[0,1],{extrapolateRight:"clamp"});return(0,r.jsxs)(t3.hU,{style:{backgroundColor:"black",justifyContent:"center",alignItems:"center",position:"relative"},children:[(0,r.jsx)("div",{style:{position:"absolute",top:s?"40%":"50%",left:"50%",transform:`translate(-50%, -60%) scale(${d})`,opacity:h},children:(0,r.jsx)("div",{style:{transform:`scale(${p})`,transformOrigin:"center"},children:t?(0,r.jsx)(i_,{}):(0,r.jsx)(iZ,{})})}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",position:"relative",zIndex:2,bottom:s?"10%":"0%",transform:`scale(${d})`},children:[(0,r.jsxs)("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,r.jsx)("div",{style:{position:"absolute",left:"-13%",top:"70%",transform:`translateY(-50%) scale(${m})`,transformOrigin:"center",opacity:x},children:(0,r.jsx)(iF,{})}),(0,r.jsx)("div",{style:{transformOrigin:"center",opacity:x},children:(0,r.jsx)("div",{style:{fontFamily:ij,fontSize:"44.3742px",fontWeight:"bold",textAlign:"center",letterSpacing:"-3.1062px",lineHeight:"normal",backgroundImage:"linear-gradient(90deg, rgb(191, 255, 191) 0%, rgb(239, 229, 255) 100%)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",color:"transparent",whiteSpace:"nowrap",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",position:"relative",width:"310px"},children:"Make Wonders"})}),(0,r.jsx)("div",{style:{position:"absolute",right:"-4.5%",top:"16%",transform:`translateY(-50%) scale(${m})`,transformOrigin:"center",opacity:x},children:(0,r.jsx)(iS,{})})]}),(0,r.jsx)("div",{style:{position:"absolute",top:"100%",opacity:v,width:`${(s?.35*l:.3*l)/d}px`,aspectRatio:iA,transform:`translateY(${f}px)`,transformOrigin:"center top"},children:(0,r.jsx)(ik,{style:{width:"100%",height:"100%"}})})]})]})});function iM(e){let{config:t}=e,{width:i,height:n}=(0,t3.rf)();if(!t.enabled)return null;let{isLandscape:o}=(0,eg.n3)(i,n),a=o?i/1920*200:.38*i,s={display:"flex",justifyContent:"flex-end",pointerEvents:"none",zIndex:1e3,width:"100%",height:"100%",...o?{alignItems:"flex-end",paddingRight:`${38/1920*i}px`,paddingBottom:`${38/1080*n}px`}:{alignItems:"center",paddingBottom:`${30/1080*n}px`}},l={transform:`scale(${a/417})`,opacity:.6,filter:"drop-shadow(0 1px 3px rgba(0, 0, 0, 0.5))",width:"417px",...o?{transformOrigin:"right bottom"}:{transformOrigin:"center"}};return(0,r.jsx)(t3.hU,{style:s,children:(0,r.jsx)("div",{style:l,children:(0,r.jsx)(ik,{})})})}iE.displayName="TimelineItemTemplateLogo";let iT={width:"100%",height:"100%",objectFit:"contain"},iR={enabled:!0,type:"openart"};function iD(e){let{item:t,mediaAsset:i,watermarkConfig:o}=e,{fps:a,height:s}=(0,t3.rf)(),l=o||iR,d=(0,n.useCallback)(e=>{console.error("[VideoWithOverlay] Video loading/playback error:",{error:e.message,stack:e.stack,mediaAsset:{id:i.id,url:i.url,type:i.resource_type,subtype:i.subtype,metadata:i.metadata},item:{id:t.id,type:t.type,durationInFrames:t.durationInFrames,speed:t.speed,volume:t.volume}})},[t,i]);if("video"!==t.type&&"overlay"!==t.type)return(0,r.jsxs)(t3.hU,{children:[(0,r.jsx)(t3.Ei,{src:i.url,style:iT,pauseWhenLoading:!0}),(0,r.jsx)(iM,{config:l})]});{let e=t.speed||1,n=null==i?void 0:i.metadata,{startFrom:o,endAt:h}=(0,eg.Xq)(t,n,a),m=(0,r.jsx)(t3.EB,{src:`${i.url}#disable`,startFrom:o,endAt:h,playbackRate:e,volume:t.volume||1,style:iT,muted:0===t.volume,delayRenderRetries:3,pauseWhenBuffering:!0,onError:d});if("overlay"===t.type){var c,u,p;let e=(null===(c=t.overlayConfig)||void 0===c?void 0:c.message)??((null===(u=t.overlayConfig)||void 0===u?void 0:u.type)==="error"?"Oops, our spell slipped! Credits refunded —you can regenerate this shot in the editor.":null===(p=t.overlayConfig)||void 0===p?void 0:p.type),i=s/720;return(0,r.jsxs)(t3.hU,{children:[m,(0,r.jsx)(t3.hU,{style:{background:"linear-gradient(179deg, rgba(184, 67, 151, 0.00) -120.17%, rgba(184, 67, 151, 0.38) -6.47%, rgba(184, 67, 151, 0.00) 98.8%)",top:"0",width:"100%",height:"80%",padding:"80px 15%"},children:(0,r.jsx)("p",{style:{color:"#642c54",fontSize:`${60*i}px`,textAlign:"center",fontFamily:"Inter, sans-serif",fontWeight:"600",lineHeight:`${60*i}px`,width:"100%",margin:0,padding:`${32*i}px ${22*i}px`},children:e})}),(0,r.jsx)(iM,{config:l})]})}return(0,r.jsxs)(t3.hU,{children:[m,(0,r.jsx)(iM,{config:l})]})}}let iz=e=>{var t;let{tracks:i,mediaAssets:o,globalConfig:a=U.Kz,config:s}=e,{fps:l}=(0,t3.rf)(),d=(null==a?void 0:null===(t=a.captions)||void 0===t?void 0:t.enabled)??U.Kz.captions.enabled,c=(0,n.useMemo)(()=>new Map(o.map(e=>[e.id,e])),[o]),u=(0,n.useMemo)(()=>{let e=[];return i.forEach(t=>{t.items.filter(e=>((null==e?void 0:e.durationInFrames)??0)>=1).forEach(t=>{"caption"===t.type&&e.push(t)})}),e},[i]),p=(0,n.useMemo)(()=>[...i.map(e=>({...e,items:e.items.filter(e=>((null==e?void 0:e.durationInFrames)??0)>=1)}))].reverse(),[i]),h=(0,n.useCallback)((e,t,i)=>(function(e,t,i){if(e.durationInFrames&&e.durationInFrames>0)return Math.max(1,e.durationInFrames);let r=null==t?void 0:t.metadata,n=(null==r?void 0:r.fps)||30,o=null==r?void 0:r.frames;if(!o||o<=0){let t=Math.max(1,(void 0!==e.sourceTrimEndFrames&&void 0!==e.sourceTrimStartFrames?e.sourceTrimEndFrames-e.sourceTrimStartFrames:3*n)*i/n/Math.max(.1,e.speed||1));return console.warn(`Using fallback duration calculation for item ${e.id}: ${t} frames`),t}return"image"===e.type?2*i:Math.max(1,o/n/Math.max(.1,e.speed||1)*i)})(e,t,i),[]);return i&&0!==i.length?(0,r.jsxs)(t3.hU,{style:{backgroundColor:"black"},children:[p.map(e=>e.items.map(t=>{if("caption"===t.type)return null;if("logo"===t.type){let e=Math.floor(t.durationInFrames||1.5*l);return(0,r.jsx)(t3.T9,{from:Math.floor(t.startTimeInFrames||0),durationInFrames:e,name:t.title||`Logo ${t.id}`,children:(0,r.jsx)(iE,{})},`${t.id}-${t.speed}`)}let i=c.get(t.mediaAssetId);if(!i)return console.warn(`Media asset not found for item ${t.id}`),null;let n=h(t,i,l),o=Math.floor(t.startTimeInFrames||0),d=Math.floor(n+t.startTimeInFrames)-o;return"video"===e.type?(0,r.jsx)(t3.T9,{from:o,durationInFrames:d,name:t.title||`Item ${t.id}`,premountFor:3*l,children:(0,r.jsx)(iD,{item:t,mediaAsset:i,watermarkConfig:(null==a?void 0:a.watermark)||(null==s?void 0:s.watermarkConfig)})},t.id):(0,r.jsx)(t3.T9,{from:o,durationInFrames:d,name:t.title||`Audio ${t.id}`,premountFor:3*l,children:(0,r.jsx)(t8,{item:t,mediaAsset:i})},t.id)})),d?u.map(e=>{var t;return(0,r.jsx)(t3.T9,{from:Math.floor(e.startTimeInFrames),durationInFrames:Math.floor(e.durationInFrames),name:e.title||`Caption ${e.id}`,children:(0,r.jsx)(iC,{item:e,globalStyles:null==a?void 0:null===(t=a.captions)||void 0===t?void 0:t.style})},e.id)}):null]}):(0,r.jsx)(t3.hU,{style:{backgroundColor:"#101010",justifyContent:"center",alignItems:"center"}})};var iP=i(18303);function iW(e){var t,i,o,a,s;let{sx:c,playerRef:u,storyData:p,fps:h,...m}=e,x=(0,n.useRef)(null),g=u||x,f=(0,n.useMemo)(()=>{var e;return Array.isArray(null===(e=p.video_editor_timeline)||void 0===e?void 0:e.tracks)?p.video_editor_timeline.tracks:[]},[null===(t=p.video_editor_timeline)||void 0===t?void 0:t.tracks]),v=(0,n.useMemo)(()=>{var e;return Array.isArray(null===(e=p.video_editor_timeline)||void 0===e?void 0:e.mediaAssets)?p.video_editor_timeline.mediaAssets:[]},[null===(i=p.video_editor_timeline)||void 0===i?void 0:i.mediaAssets]),b=(0,n.useMemo)(()=>{var e;return(null===(e=p.video_editor_timeline)||void 0===e?void 0:e.globalConfig)||U.Kz},[null===(o=p.video_editor_timeline)||void 0===o?void 0:o.globalConfig]),{width:y,height:w,totalDurationInFrames:C}=(0,n.useMemo)(()=>(0,eg.GQ)(f,v,b),[v,f,b]),j=(0,n.useRef)(null);(0,G.JA)({playerRef:g,containerRef:j,tracks:f,debug:!1});let k=(0,n.useMemo)(()=>({tracks:f,mediaAssets:v,globalConfig:{...b,watermark:{...b.watermark,enabled:!1}}}),[f,v,b]),F=`remotion-player-${p.id||"unknown"}`,S=(0,n.useCallback)(e=>{let{height:t,width:i,isBuffering:n}=e;return n?(0,r.jsx)(t3.hU,{style:{background:"transparent",minHeight:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},children:(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",borderRadius:2,padding:"12px 20px",gap:2,background:"rgba(0, 0, 0, 0.5)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",backdropFilter:"blur(8px)"},children:[(0,r.jsx)(em.Z,{size:20,thickness:4,sx:{color:"white","& .MuiCircularProgress-circle":{strokeLinecap:"round"}}}),(0,r.jsx)(d.Z,{variant:"subtitle1",sx:{color:"white",fontWeight:500},children:"Loading video..."})]})}):(0,r.jsx)(t3.hU,{style:{background:"transparent"}})},[]);return(0,r.jsx)(l.Z,{ref:j,sx:{width:"100%",height:"100%",position:"relative",...c},children:(0,r.jsx)(iP.J5,{ref:g,component:iz,numberOfSharedAudioTags:0,showPosterWhenBuffering:!0,showPosterWhenUnplayed:!0,showPosterWhenPaused:!0,showPosterWhenBufferingAndPaused:!0,acknowledgeRemotionLicense:!0,renderPoster:S,inputProps:k,durationInFrames:C,compositionWidth:y,compositionHeight:w,fps:h||(null===(a=p.video_editor_timeline.globalConfig)||void 0===a?void 0:a.fps)||(null==p?void 0:null===(s=p.metadata)||void 0===s?void 0:s.fps)||U.UG,style:{width:"100%",height:"100%"},clickToPlay:!0,...m},F)})}var iL=i(24053),iB=i(85884),iH=i(96966),i$=i(99067);let iO=e=>{let{zoomLevel:t,onZoomChange:i,zoomMin:o,zoomMax:a,playerRef:c,sx:u}=e,p=F.wK.use.isPlaying(),h=F.wK.use.togglePlay(),m=F.wK.use.outputSettings(),x=F.wK.use.globalConfig(),g=F.wK.use.tracks(),f=F.wK.use.mediaAssets(),v=F.wK.use.setPreviewingMediaAsset(),b=(0,iH.d)(c),y=F.wK.use.currentTimeInFrames(),w=(0,n.useMemo)(()=>g.length>0,[g]),C=(0,n.useMemo)(()=>(null==c?void 0:c.current)?b:y,[c,b,y]);(0,i$.a)({playerRef:c,enabled:!0,zoomLevel:t,onZoomChange:i,zoomMin:o,zoomMax:a});let j=(0,n.useCallback)(e=>{(null==c?void 0:c.current)&&(p?c.current.pause():(v(void 0),c.current.play(e))),h()},[p,c,v,h]),k=(0,n.useCallback)(()=>{i(Math.min(a,t+.25))},[t,a,i]),S=(0,n.useCallback)(()=>{i(Math.max(o,t-.25))},[t,o,i]),_=(0,n.useMemo)(()=>w?(0,O.DG)(C,x.fps):"00:00:00",[C,x.fps,w]),Z=(0,n.useMemo)(()=>w?(0,O.DG)(Math.max(0,m.totalDurationInFrames-1),x.fps):"00:00:00",[w,m.totalDurationInFrames,x.fps]),A=(0,n.useCallback)(()=>{},[g,f]);return(0,r.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:{px:2,py:1,width:"100%",position:"relative",justifyContent:"space-between",...u},children:[(0,r.jsxs)(l.Z,{onClick:A,sx:{borderRadius:"10px",display:"flex",alignItems:"center"},children:[(0,r.jsx)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"12px",lineHeight:1.21,color:"#9CBAFF",pr:.4,width:"58px"},children:_}),(0,r.jsxs)(d.Z,{sx:{fontFamily:"Inter",fontWeight:600,fontSize:"12px",lineHeight:1.21,color:"#FFFFFF",width:"60px",whiteSpace:"nowrap"},children:["/ ",Z]})]}),(0,r.jsx)(tk.Z,{size:"small",onClickCapture:j,disabled:!w,sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:24,height:24,color:"#fff"},children:p?(0,r.jsx)(iL.Z,{sx:{width:24,height:24}}):(0,r.jsx)(iB.Z,{sx:{width:24,height:24}})}),(0,r.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(tk.Z,{size:"small",onClick:S,disabled:t<=o,sx:{width:16,height:16,minWidth:16,padding:0,color:t<=o?"#666666":"#FFF","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"},"&:disabled":{color:"#666666"}},children:(0,r.jsx)(I.LucideZoomOut,{size:16})}),(0,r.jsx)(l.Z,{sx:{width:112,mx:.5},children:(0,r.jsx)(e8.ZP,{value:t,min:o,max:a,step:.1,onChange:(e,t)=>{i(t)},"aria-labelledby":"timeline-zoom-slider",sx:{height:10,padding:0,"& .MuiSlider-track":{height:2,backgroundColor:"#FFF",border:"none"},"& .MuiSlider-rail":{height:2,backgroundColor:"rgba(255, 255, 255, 0.2)",opacity:1},"& .MuiSlider-thumb":{width:12,height:12,backgroundColor:"#FFF",border:"none","&:hover, &.Mui-focusVisible":{boxShadow:"0 0 0 4px rgba(255, 255, 255, 0.16)"},"&.Mui-active":{boxShadow:"0 0 0 4px rgba(255, 255, 255, 0.16)"}}}})}),(0,r.jsx)(tk.Z,{size:"small",onClick:k,disabled:t>=a,sx:{width:16,height:16,minWidth:16,padding:0,color:t>=a?"#666666":"#FFF","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"},"&:disabled":{color:"#666666"}},children:(0,r.jsx)(I.LucideZoomIn,{size:16})}),null]})]})};var iU=i(76918);let iG=(0,n.createContext)(void 0);function iN(){let e=(0,n.useContext)(iG);if(!e)throw Error("useTimelineVOContext must be used within TimelineEditor");return e}var iV=i(61845),iK=i(35713);function iq(e){let{playerRef:t}=e,i=T.wK.use.tracks(),o=T.wK.use.mediaAssets(),a=(0,n.useMemo)(()=>i.map(e=>({...e,items:e.items.filter(e=>((null==e?void 0:e.durationInFrames)??0)>=1)})),[i]),d=(0,T.wK)(e=>e.outputSettings.totalDurationInFrames),c=(0,T.wK)(e=>e.globalConfig.fps),u=(0,T.wK)(e=>e.globalConfig.captions.enabled),p=function(){let e=(0,n.useRef)(new Map),t=(0,n.useRef)(new Map),i=(0,n.useCallback)((t,i)=>{i?e.current.set(t,i):e.current.delete(t)},[]),r=(0,n.useCallback)((i,r,n)=>{let o=e.current.get(i);if(!o){console.warn("Cannot start resize: element not found for item",i);return}t.current.set(i,{initialLeft:n.left,initialWidth:n.width,currentLeft:n.left,currentWidth:n.width,element:o,edge:r,itemVO:n})},[]),o=(0,n.useCallback)((i,n,o,a,s)=>{var l,d;let c=t.current.get(i);if(!c){r(i,o,a);let d=t.current.get(i);if(!d)return;if("left"===o){let e=d.currentLeft+n,t=Math.max(a.resize.left.min,Math.min(a.resize.left.max,e)),i=t-d.currentLeft,r=d.currentWidth-i;d.currentLeft=t,d.currentWidth=r,d.element.style.transform=`translateX(${t+U.p_/2}px)`,d.element.style.width=`${r-U.p_}px`}else{let i=d.currentWidth+n,r=d.currentLeft+i,o=Math.max(a.resize.right.min,Math.min(a.resize.right.max,r))-d.currentLeft;for(let i of(d.currentWidth=o,d.element.style.width=`${o-U.p_}px`,a.subsequentItemIds)){let r=e.current.get(i);if(!r)continue;let n=t.current.get(i),a=o-d.initialWidth;if(n)n.currentLeft=n.initialLeft+a;else{let e=null==s?void 0:s(i);if(!e)continue;t.current.set(i,{initialLeft:e.left,initialWidth:e.width,currentLeft:e.left+a,currentWidth:e.width,element:r,edge:"right",itemVO:e})}let c=(null===(l=t.current.get(i))||void 0===l?void 0:l.currentLeft)??0;r.style.transform=`translateX(${c+U.p_/2}px)`}}return}if("left"===o){let e=c.initialLeft+n,t=Math.max(a.resize.left.min,Math.min(a.resize.left.max,e)),i=t-c.initialLeft,r=c.initialWidth-i;c.currentLeft=t,c.currentWidth=r,c.element.style.transform=`translateX(${t+U.p_/2}px)`,c.element.style.width=`${r-U.p_}px`}else{let i=c.initialWidth+n,r=c.currentLeft+i,o=Math.max(a.resize.right.min,Math.min(a.resize.right.max,r))-c.currentLeft;for(let i of(c.currentWidth=o,c.element.style.width=`${o-U.p_}px`,a.subsequentItemIds)){let r=e.current.get(i);if(!r)continue;let n=t.current.get(i),a=o-c.initialWidth;if(n)n.currentLeft=n.initialLeft+a;else{let e=null==s?void 0:s(i);if(!e)continue;t.current.set(i,{initialLeft:e.left,initialWidth:e.width,currentLeft:e.left+a,currentWidth:e.width,element:r,edge:"right",itemVO:e})}let l=(null===(d=t.current.get(i))||void 0===d?void 0:d.currentLeft)??0;r.style.transform=`translateX(${l+U.p_/2}px)`}}},[r]),a=(0,n.useCallback)(e=>{let i=t.current.get(e);if(!i)return null;let{initialLeft:r,initialWidth:n,currentLeft:o,currentWidth:a,element:s,edge:l}=i;return t.current.delete(e),s.style.transform="",s.style.width="",{deltaPixels:"left"===l?o-r:a-n,edge:l,subsequentItemIds:i.itemVO.subsequentItemIds}},[]);return{registerElement:i,startResize:r,updateResize:o,commitResize:a,cleanupSubsequentItems:(0,n.useCallback)(i=>{for(let r of i){let i=e.current.get(r);i&&(i.style.transform=""),t.current.delete(r)}},[]),cancelResize:(0,n.useCallback)(i=>{let r=t.current.get(i);if(r){for(let i of(r.element.style.transform="",r.element.style.width="",r.itemVO.subsequentItemIds)){let r=e.current.get(i);r&&(r.style.transform=""),t.current.delete(i)}t.current.delete(i)}},[]),getTransientWidth:(0,n.useCallback)(e=>{let i=t.current.get(e);return null==i?void 0:i.currentWidth},[])}}(),h=(0,n.useRef)(new Map),m=(0,G.d2)(t),x=T.wK.use.currentTimeInFrames(),g=(0,n.useMemo)(()=>(null==t?void 0:t.current)?m:x,[t,m,x]),f=T.wK.use.selectedItemIds(),v=T.wK.use.selectItem(),b=T.wK.use.toggleSelectItem(),y=(0,n.useRef)(null),w=(0,n.useRef)(null),C=(0,n.useMemo)(()=>0!==a.length&&a.some(e=>e.items.length>0),[a]),{zoomLevel:j,zoomMin:k,zoomMax:F,handleZoomChange:S,trackLengthInPixel:I,framePerPixel:_,containerWidth:Z}=function(e){let{tracks:t,hasTracks:i,totalDurationInFrames:r,scrollContainerRef:o}=e,[a,s]=(0,n.useState)(1),{zoomMin:l,zoomMax:d}=(0,n.useMemo)(()=>{if(!i)return{zoomMin:.25,zoomMax:2.5};let e=1/0;return(t.forEach(t=>{t.items.forEach(t=>{"logo"!==t.type&&t.durationInFrames>0&&t.durationInFrames<e&&(e=t.durationInFrames)})}),Number.isFinite(e)&&e!==1/0)?{zoomMin:.25,zoomMax:Math.min(Math.max(1,r/e/2),10)}:{zoomMin:.25,zoomMax:2.5}},[t,r,i]),c=(0,n.useRef)(null),u=(0,n.useRef)(!1);(0,n.useLayoutEffect)(()=>{if(!u.current){u.current=!0;return}let e=c.current;if(null!==e&&e>0&&r>0&&e!==r){let t=Math.max(l,Math.min(d,r/e*a));Number.isFinite(t)&&!Number.isNaN(t)&&t!==a&&s(t)}c.current=r},[r,l,d,a]);let p=(0,n.useCallback)(e=>{s(Math.max(l,Math.min(d,e)))},[l,d]),{trackLengthInPixel:h,framePerPixel:m,containerWidth:x}=(0,n.useMemo)(()=>{let e;let t=(e=o.current?o.current.clientWidth-U.BY-U.q:window.innerWidth-90-U.BY-U.q)*a,i=r/t;return{containerWidth:e,trackLengthInPixel:t,framePerPixel:i}},[o,a,r]);return{zoomLevel:a,zoomMin:l,zoomMax:d,handleZoomChange:p,trackLengthInPixel:h,framePerPixel:m,containerWidth:x}}({tracks:a,hasTracks:C,totalDurationInFrames:d,scrollContainerRef:y});(0,G.rr)({containerWidth:Z,contentWidth:I,scrollContainerRef:y,currentTimeInFrames:g});let E=(0,iV.t)(y);(0,iK.C)({trackLengthInPixel:I,currentTimeInFrames:g,totalDurationInFrames:d,scrollContainerRef:y,playheadRef:w}),(0,n.useLayoutEffect)(()=>{h.current.clear()},[i,o,_,c,d]);let M=(0,n.useCallback)(e=>{let t=h.current.get(e);if(t)return t;for(let t of i){let i=t.items.find(t=>t.id===e);if(i){let r=o.find(e=>e.id===i.mediaAssetId),n=(0,eg.E9)({item:i,trackId:t.id,track:t,mediaAsset:r,framePerPixel:_,fps:c});return h.current.set(e,n),n}}},[i,o,_,c]),D=(0,n.useCallback)(e=>{for(let t of e)h.current.delete(t)},[]),z=(0,n.useMemo)(()=>({getItemVO:M,invalidateItemVOCache:D,transientState:p}),[M,D,p]),{flatList:P,singleTracks:W}=(0,n.useMemo)(()=>(0,eg.NN)(a),[a]),{shouldShowMusicEmptyTrack:L}=(0,n.useMemo)(()=>{let e=i.some(e=>"video"===e.type&&e.items.length>0),t=i.some(e=>"audio"===e.type&&e.items.length>0),r=i.some(e=>"music"===A.wD.getTrackCategory(e,o));return{hasVideoTracks:e,hasAudioTracks:t,hasMusicTracks:r,shouldShowMusicEmptyTrack:e&&!r}},[o,i]),B=(0,n.useCallback)((e,t)=>{let i=A.wD.getTrackCategory(e,o),a=null;switch(i){case"image":case"video":a=(0,r.jsx)(rf,{trackLengthInPixel:I,track:e,fps:c,zoomLevel:j,framePerPixel:_,selectedItemIds:f,onSelectItem:(e,t)=>t?b(e):v(e)});break;case"music":a=(0,r.jsx)(re,{trackLengthInPixel:I,track:e,fps:c,zoomLevel:j,framePerPixel:_,selectedItemIds:f,onSelectItem:(e,t)=>t?b(e):v(e),audioType:"music"});break;case"voiceover":a=(0,r.jsx)(re,{trackLengthInPixel:I,track:e,fps:c,zoomLevel:j,framePerPixel:_,selectedItemIds:f,onSelectItem:(e,t)=>t?b(e):v(e),audioType:"voiceover"});break;case"caption":a=u?(0,r.jsx)(rt,{trackLengthInPixel:I,track:e,fps:c,zoomLevel:j,framePerPixel:_,selectedItemIds:f,onSelectItem:(e,t)=>t?b(e):v(e)}):null;break;default:a=null}return(0,r.jsxs)(n.Fragment,{children:[a,null!==a?(0,r.jsx)(rr,{insertIndex:t+1,totalDurationInFrames:d,fps:c,zoomLevel:j},`placeholder-g-${t}`):null]},e.id)},[o,d,c,u,j,I,_,f,b,v]);return(0,r.jsx)(iG.Provider,{value:z,children:(0,r.jsxs)(l.Z,{sx:{width:"100%",height:"100%",bgcolor:"grey.800",display:"flex",flexDirection:"column",position:"relative"},children:[(0,r.jsx)(iO,{zoomLevel:j,onZoomChange:S,zoomMin:k,zoomMax:F,playerRef:t,sx:{zIndex:2,bgcolor:"grey.800",height:`${U.d1}px`}}),(0,r.jsxs)(l.Z,{className:"timeline-editor-content-container",sx:{overflow:"hidden",zIndex:1,height:`calc(100% - ${U.d1}px)`},children:[(0,r.jsx)(l.Z,{sx:{pt:`${U.gI}px`,width:U.BY,display:"flex",flexDirection:"column",flexShrink:0,position:"absolute",left:0,top:`${U.d1}px`,bottom:0,flexGrow:0,zIndex:2,bgcolor:"grey.800"},className:"timeline-editor-button-panel",children:(0,r.jsx)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:`${U.ew}px`,justifyContent:"flex-start",alignItems:"center",transform:`translateY(${-E}px)`},children:C?(0,r.jsxs)(r.Fragment,{children:[P.map(e=>(0,r.jsx)(iY,{track:e,mediaAssets:o},e.id)),L?(0,r.jsx)(l.Z,{sx:{width:24,height:`${U.ZR}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(iU.Z,{})}):null]}):(0,r.jsx)(l.Z,{sx:{width:24,height:`${U.gd}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(eO.Z,{})})})}),(0,r.jsx)(l.Z,{ref:y,sx:{width:"100%",zIndex:1,height:"100%",position:"relative",overflow:"auto",...(0,R.ap)({scrollbarWidth:6})},className:"timeline-editor-scrollable-content-container",children:(0,r.jsx)(l.Z,{sx:{width:"auto",height:C?"auto":"100%",position:"relative",pl:`${U.Fp}px`},className:"timeline-editor-scrollable-content-inner",children:(0,r.jsxs)(l.Z,{sx:{position:"relative",width:C?`${I*(1+U.tj)}px`:`${I}px`,backgroundColor:"transparent",overflowX:"visible",cursor:"text",height:"100%"},className:"timeline-editor-scrollable-content-inner-inner",children:[(0,r.jsx)(i8,{visible:!0,fps:c,durationInFrames:d,framePerPixel:_},"timeline-ruler"),(0,r.jsx)(i2,{ref:w,visible:!0,disabled:!C,top:E,currentTimeInFrames:g,durationInFrames:d,playerRef:t,trackLengthInPixel:I},"timeline-playhead"),(0,r.jsx)(l.Z,{className:"timeline-editor-scrollable-content-tracks",sx:{height:`calc(100% - ${U.gI}px)`,width:"100%",overflowY:"auto",overflowX:"hidden",...(0,R.ap)({scrollbarWidth:6})},children:C?(0,r.jsx)(r.Fragment,{children:W.map(B)}):(0,r.jsx)(i0,{zoomLevel:j,trackType:"video",sx:{width:"100%"}})})]})})})]})]})})}let iY=n.memo(e=>{let{track:t,mediaAssets:i}=e,o=(0,T.wK)(e=>e.globalConfig.captions.enabled),a=(0,n.useMemo)(()=>A.wD.getTrackCategory(t,i),[t,i]),s=(0,n.useMemo)(()=>{switch(a){case"video":return(0,r.jsx)(e$.Z,{sx:{color:"#6290FF",width:20,height:20}});case"voiceover":return(0,r.jsx)(I.RiSpeakAiLine,{sx:{color:"#28BED2",width:18,height:18}});case"music":return(0,r.jsx)(I.PhMusicNotes,{sx:{color:"#831AC9",width:18,height:18}});case"caption":if(o)return(0,r.jsx)(I.PhTextTBold,{sx:{color:"var(--Green-300, #008A4C)",width:18,height:18}});return null;default:return null}},[a,o]);return s?(0,r.jsx)(l.Z,{sx:{width:24,height:`${{video:U.gd,caption:U.Zk,voiceover:U.ZR,music:U.ZR}[a]??U.ZR}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:s}):null});function iX(e){let{onDragY:t}=e,i=(0,n.useRef)(null),o=(0,n.useRef)(null),[a,s]=(0,n.useState)(!1),d=(0,n.useCallback)(e=>{function r(e){o.current=e.clientY,null==i.current&&(i.current=window.requestAnimationFrame(()=>{null!=o.current&&t(o.current),i.current=null}))}o.current=e.clientY,s(!0),window.addEventListener("mousemove",r),window.addEventListener("mouseup",function e(){null!=i.current&&(cancelAnimationFrame(i.current),i.current=null),null!=o.current&&t(o.current),o.current=null,s(!1),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",e)})},[t]);return(0,r.jsx)(l.Z,{sx:{width:"100%",position:"absolute",top:0,left:0,right:0,height:"4px",cursor:"ns-resize",backgroundColor:a?"var(--Blue-600)":"transparent",transition:"background-color 0.1s ease",zIndex:10,borderRadius:1,userSelect:"none","&:after":{content:'""',position:"absolute",left:0,right:0,top:"-6px",height:"16px"}},onMouseDown:d})}function iJ(){var e,t;let i=T.wK.use.storyId(),r=T.wK.use.setMediaAssetsActiveTab();T.wK.use.addMediaAssetToTrack(),null===(e=(t=T.wK.use).updateTotalDurationInFrames)||void 0===e||e.call(t);let{uploadAndSaveFileWithUploadingAsset:o}=(0,el.No)(i),a=(0,n.useCallback)(e=>e.startsWith("image/")?"image":e.startsWith("video/")?"video":e.startsWith("audio/")?"audio":null,[]),s=(0,n.useCallback)(e=>{let t=(e||"").toLowerCase();return/\.(?:jpg|jpeg|png|gif|webp)$/i.test(t)?"image":/\.(?:mp4|webm|mov|avi)$/i.test(t)?"video":/\.(?:mp3|wav|aac|ogg|mpeg)$/i.test(t)?"audio":null},[]),l=(0,n.useCallback)(e=>{let t=a((null==e?void 0:e.type)||"")||s((null==e?void 0:e.name)||"");if(!t)return{isValid:!1,mediaType:null};let i=U.y5[t];return!i||0===i.acceptedTypes.length||"number"==typeof(null==e?void 0:e.size)&&e.size>i.maxFileSize||(null==e?void 0:e.type)&&!i.acceptedTypes.some(t=>t.endsWith("/*")?e.type.startsWith(t.replace("/*","/")):e.type===t)?{isValid:!1,mediaType:t}:{isValid:!0,mediaType:t}},[a,s]),d=(0,n.useCallback)(e=>{if(!e||!(0,O.nw)(e))return null;let t=Array.from(e.files||[]);if(t.length>0){let e=l(t[0]);return e.isValid?e.mediaType:null}let i=Array.from(e.items||[]).find(e=>"file"===e.kind),r=(null==i?void 0:i.type)||"",n=a(r);if(!n)return null;let o=U.y5[n];return o&&0!==o.acceptedTypes.length&&o.acceptedTypes.some(e=>e.endsWith("/*")?r.startsWith(e.replace("/*","/")):r===e)?n:null},[a,l]),c=(0,n.useCallback)((e,t)=>{if(!e)return;let i=e.closest("[data-track-id]"),r=null==i?void 0:i.getAttribute("data-audio-type");return"audio"===t?"voiceover"===r?"voiceover":"music":"image"===t?"image":"video"===t?"video":void 0},[]),u=(0,n.useCallback)((e,t)=>"audio"===t?"music":"image"===t?"image":"video"===t?"video":void 0,[]),p=(0,n.useCallback)(async(e,t)=>{let i=await o(e,t);return null==i?void 0:i.id},[o]),h=(0,n.useCallback)(async e=>{let{event:t,resolveTargetTab:i,onUploadingChange:n,onUploaded:o,onFinally:a}=e,s=t.dataTransfer;try{if(!(0,O.nw)(s))return;let e=Array.from((null==s?void 0:s.files)||[]);if(1!==e.length)return;let a=e[0],l=d(s);if(!l)return;null==n||n(!0);let c=i(l)||"video";r(c);let u=await p(a,c);if(!u)return;await o({mediaAssetId:u,mediaType:l,targetTab:c,file:a,event:t})}finally{null==a||a(),null==n||n(!1)}},[d,r,p]);return{getOsDragMediaType:d,resolveTargetTabFromWrapper:c,resolveTargetTabFromTrackType:u,uploadAndGetMediaAssetId:p,handleOsFileDrop:h}}iY.displayName="TrackIcon";var iQ=i(42238);function i0(e){let{zoomLevel:t,trackType:i,sx:o}=e,a=T.wK.use.setTracks(),s=T.wK.use.addMediaAssetToTrack(),c=T.wK.use.tracks(),{operations:u}=(0,h.ZY)(),p=(0,iQ.K)(),{getOsDragMediaType:m,resolveTargetTabFromTrackType:x,handleOsFileDrop:g}=iJ(),[f,v]=(0,n.useState)({isDragOver:!1,isCompatible:!1,isUploading:!1}),[b,y]=(0,n.useState)(null),w=(0,n.useCallback)(()=>{let e=c.find(e=>"video"===i?"video"===e.type&&0===e.items.length:"audio"===i&&"audio"===e.type&&0===e.items.length);if(e)return e;let t="video"===i?"Video Track 1":"Music Track 1",r={id:`${i}-track-${Date.now()}`,type:i,name:t,items:[],..."audio"===i&&{subtype:"music"}};return a([...c,r]),r},[c,i,a]),C=(0,n.useCallback)(e=>{let t;e.preventDefault(),e.stopPropagation();let r=(0,eg.MH)(e.dataTransfer),n=null==r?void 0:r.mediaAssetType;if(!n&&(0,O.nw)(e.dataTransfer)&&(n=m(e.dataTransfer)),!n)return;let o=(0,eg.JO)(n,i);o||(t="video"===i?"Only video and image files are allowed":"Only audio files are allowed"),y({source:"media-asset",mediaAssetType:n}),v({isDragOver:!0,isCompatible:o,errorMessage:t})},[i,m]),j=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f.isDragOver&&b&&(e.dataTransfer.dropEffect=f.isCompatible?"copy":"none")},[f.isDragOver,f.isCompatible,b]),k=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=e.relatedTarget;e.currentTarget.contains(t)||(v({isDragOver:!1,isCompatible:!1,isUploading:!1}),y(null))},[]),F=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=()=>{v({isDragOver:!1,isCompatible:!1,isUploading:!1}),y(null)};if((0,O.nw)(e.dataTransfer)){(async()=>{let r=m(e.dataTransfer);if(!r||!(0,eg.JO)(r,i)||!f.isCompatible){t();return}await g({event:e,resolveTargetTab:e=>x(i,e),onUploadingChange:e=>v(t=>({...t,isUploading:e})),onUploaded:e=>{let{mediaAssetId:t}=e;u.batchOperation("Add media asset to track",()=>{s(w().id,t,0)}),p()},onFinally:t})})();return}let r=(0,eg.Tp)(e.dataTransfer);t(),(null==r?void 0:r.source)==="media-asset"&&f.isCompatible&&r.mediaAssetId&&(0,eg.JO)(r.mediaAssetType,i)&&(u.batchOperation("Add media asset to track",()=>{s(w().id,r.mediaAssetId,0)}),p())},[f.isCompatible,i,m,g,x,u,p,w,s]),S="video"===i?U.gd:U.ZR;return(0,r.jsx)(l.Z,{className:"timeline-empty-track",sx:{width:"100%",height:`${S}px`,bgcolor:"grey.800",border:f.isDragOver||f.isUploading?"2px dashed":"2px dashed #444",borderColor:f.isUploading?"#4A9EFF":f.isDragOver?f.isCompatible?"#4A9EFF":"#ff6b6b":"#444",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"start",transition:"all 0.2s ease",cursor:"default",backgroundColor:f.isUploading?"rgba(74, 158, 255, 0.08)":f.isDragOver?f.isCompatible?"rgba(74, 158, 255, 0.1)":"rgba(255, 107, 107, 0.1)":"grey.800",...f.isUploading&&{backgroundImage:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 75%)",backgroundSize:"200% 100%",animation:"emptytrack-shimmer 1.2s ease-in-out infinite","@keyframes emptytrack-shimmer":{"0%":{backgroundPosition:"-200% 0"},"100%":{backgroundPosition:"200% 0"}}},"&:hover":{bgcolor:"grey.750"},...o},onDragEnter:C,onDragOver:j,onDragLeave:k,onDrop:F,children:(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,opacity:f.isDragOver&&f.isCompatible||f.isUploading?.8:.6},children:[(0,r.jsx)(d.Z,{variant:"body2",sx:{textAlign:"center",color:f.isUploading?"#4A9EFF":f.isDragOver?f.isCompatible?"#4A9EFF":"#ff6b6b":"text.disabled",fontWeight:f.isDragOver?500:400,px:2},children:f.isDragOver?f.isCompatible?f.isUploading?"Loading…":"video"===i?"Drop to create video track":"Drop to create music track":f.errorMessage||"Not allowed":"Drag video/image/audio to create a new track"}),!!f.isUploading&&(0,r.jsx)(l.Z,{sx:{ml:2,width:"80px",height:"12px",borderRadius:"6px",backgroundImage:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 75%)",backgroundSize:"200% 100%",animation:"emptytrack-shimmer 1.2s ease-in-out infinite"}})]})})}let i1=(O.hn-2)/2,i2=n.memo((0,n.forwardRef)((e,t)=>{let{currentTimeInFrames:i,durationInFrames:o,playerRef:a,visible:s,top:d=0,disabled:c=!1,trackLengthInPixel:u}=e,[p,h]=(0,n.useState)({dragging:!1,wasPlaying:!1}),[m,x]=(0,n.useState)(null),g=(0,n.useRef)(null),f=(0,n.useRef)(null),v=(0,n.useRef)(null),b=(0,n.useRef)(null),y=(0,n.useRef)(-1),w=(0,n.useRef)(null),C=F.wK.use.setCurrentTimeInFrames(),j=F.wK.use.selectItem(),k=F.wK.use.setPreviewingMediaAsset(),S=(0,n.useCallback)(e=>{var t;let i=u||(null===(t=g.current)||void 0===t?void 0:t.getBoundingClientRect().width)||0;if(0===i)return;let r=e/o*i,n=`translateX(${r-i1}px)`,a=`translateX(${r}px)`;f.current&&(f.current.style.transform=n),v.current&&(v.current.style.transform=a),b.current&&(b.current.style.transform=a)},[o,u]);(0,n.useImperativeHandle)(t,()=>({updateVisualPosition:S}),[S]);let I=(0,n.useCallback)(e=>{null!==w.current&&(w.current(),w.current=null),w.current=(0,eg.f8)(()=>{let t=Math.min(e,o);(null==a?void 0:a.current)&&a.current.seekTo(t),C(t),w.current=null},{timeout:50})},[o,a,C]);(0,n.useEffect)(()=>{p.dragging||null!==m||(S(i),y.current=i)},[i,p.dragging,m,S]),(0,n.useEffect)(()=>()=>{null!==w.current&&(w.current(),w.current=null)},[]);let _=(0,n.useCallback)(e=>{var t;if(c||!g.current)return;let i=(null==a?void 0:null===(t=a.current)||void 0===t?void 0:t.isPlaying())??!1;i&&(null==a?void 0:a.current)&&a.current.pause();let r=i5(e.clientX,g.current),n=i6(r,o);S(n),x(r/(1+O.tj)),I(n),h({dragging:!0,wasPlaying:i}),e.currentTarget.setPointerCapture(e.pointerId),j(null),k(void 0)},[a,j,k,o,c,S,I]),Z=(0,n.useCallback)(e=>{if(c||!p.dragging||!g.current)return;let t=i5(e.clientX,g.current),i=i6(t,o);S(i),x(t/(1+O.tj)),I(i)},[p.dragging,o,c,S,I]),A=(0,n.useCallback)(e=>{if(!c&&p.dragging){if(g.current){let t=i6(i5(e.clientX,g.current),o);S(t),(null==a?void 0:a.current)&&a.current.seekTo(Math.min(t,o)),C(Math.min(t,o))}x(null),null!==w.current&&(w.current(),w.current=null),p.wasPlaying&&(null==a?void 0:a.current)&&a.current.play(),h({dragging:!1,wasPlaying:!1}),e.currentTarget.releasePointerCapture(e.pointerId)}},[p,a,o,C,c,S]),E=(0,n.useMemo)(()=>({position:"absolute",top:0,left:0,transform:"translateX(0px)",width:O.hn,height:"10px",borderRadius:"1px",backgroundColor:"white",cursor:p.dragging?"grabbing":"grab",zIndex:15,willChange:"transform",transition:"transform 0 linear",pointerEvents:c?"none":"auto","&::after":{content:'""',position:"absolute",top:"9.6px",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"4px solid white"}}),[p.dragging,c]);return s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.Z,{ref:g,onPointerDown:_,onPointerMove:Z,onPointerUp:A,sx:{position:"absolute",top:d,left:0,width:"100%",height:`${O.gI}px`,zIndex:4,cursor:"text",opacity:c?.12:1,pointerEvents:c?"none":"auto"},children:[(0,r.jsx)(l.Z,{ref:f,sx:E}),(0,r.jsx)(l.Z,{ref:v,sx:{position:"absolute",left:0,top:0,bottom:0,width:2,backgroundColor:"white",pointerEvents:"none",zIndex:10,transform:"translateX(0px)",willChange:"transform"}})]}),(0,r.jsx)(l.Z,{ref:b,sx:{position:"absolute",left:0,top:"30px",bottom:0,width:2,backgroundColor:"white",pointerEvents:"none",zIndex:20,opacity:c?.12:1,transform:"translateX(0px)",willChange:"transform"}})]}):null}),(e,t)=>!(Math.abs(e.currentTimeInFrames-t.currentTimeInFrames)>=1)&&e.durationInFrames===t.durationInFrames&&e.visible===t.visible&&e.top===t.top&&e.disabled===t.disabled&&e.playerRef===t.playerRef&&e.trackLengthInPixel===t.trackLengthInPixel);function i5(e,t){let i=t.getBoundingClientRect(),r=i.width/(1+O.tj);return Math.max(0,Math.min(r,e-i.left))/r*100}function i6(e,t){return Math.floor(e/100*t)}i2.displayName="TimelinePlayhead";let i4={VERY_SPARSE:.1,SPARSE:.06,NORMAL:.03,DENSE:.02,VERY_DENSE:.01},i3={VERY_SPARSE:{major:30,minor:5},SPARSE:{major:20,minor:5},NORMAL:{major:10,minor:2},DENSE:{major:5,minor:1},VERY_DENSE:{major:2,minor:.5},ULTRA_DENSE:{major:1,minor:.2}},i8=e=>{let{fps:t,durationInFrames:i,framePerPixel:o,visible:a}=e,s=(0,n.useMemo)(()=>i*(1+O.tj),[i]),{majorTicks:c,minorTicks:u}=(0,n.useMemo)(()=>{let e,i;let r=Math.ceil(s/t),n=o/t;n>i4.VERY_SPARSE?{major:e,minor:i}=i3.VERY_SPARSE:n>i4.SPARSE?{major:e,minor:i}=i3.SPARSE:n>i4.NORMAL?{major:e,minor:i}=i3.NORMAL:n>i4.DENSE?{major:e,minor:i}=i3.DENSE:n>i4.VERY_DENSE?{major:e,minor:i}=i3.VERY_DENSE:{major:e,minor:i}=i3.ULTRA_DENSE;let a=[],l=[];for(let t=0;t<=r;t+=e)a.push({time:t,label:`${t}s`});let d=i;for(let e=d;e<=r;e+=d)a.some(t=>.01>Math.abs(t.time-e))||l.push({time:e});return{majorTicks:a,minorTicks:l}},[t,s,o]);return a?(0,r.jsxs)(l.Z,{sx:{height:`${O.gI}px`,width:"100%",overflow:"hidden",borderTop:"1px solid rgba(255, 255, 255, 0.1)",userSelect:"none",position:"sticky",top:0,bgcolor:"grey.800",zIndex:2,pointerEvents:"none"},className:"timeline-ruler",children:[c.map(e=>{let i=0===e.time;return(0,r.jsx)(l.Z,{sx:{position:"absolute",left:`${e.time*t*100/s}%`,height:"100%",transform:i?"translateX(10%)":"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",pt:.75},children:(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:"9px",color:"rgba(255, 255, 255, 0.2)",textAlign:"center",fontFamily:"Inter",fontWeight:600,lineHeight:"12px",fontStyle:"normal"},children:i?"0":e.label})},`major-${e.time}`)}),u.map(e=>(0,r.jsx)(l.Z,{sx:{position:"absolute",left:`${e.time*t*100/s}%`,height:"100%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center"},children:(0,r.jsx)(l.Z,{sx:{width:"2px",height:"2px",top:"10px",position:"relative",borderRadius:"50%",bgcolor:"rgba(255, 255, 255, 0.2)"}})},`minor-${e.time}`))]}):null};var i9=i(44006);function i7(e){let{trackId:t,trackItems:i,trackKind:r,isMediaAssetAllowed:o,labels:a}=e,{operations:s}=(0,h.ZY)(),l=(0,iQ.K)(),{fps:d=i9.UG}=F.wK.use.globalConfig(),c=F.wK.use.tracks(),u=F.wK.use.addMediaAssetToTrack(),p=F.wK.use.replaceTimelineItemWithMediaAsset(),m=F.wK.use.reorderItemsInTrack(),x=(0,n.useCallback)(e=>"video"===r?"video"===e||"image"===e:"audio"===r&&"audio"===e,[r]),g=(0,n.useMemo)(()=>({replace:`Replace ${r} timeline item with media asset`,insertBefore:`Insert media asset before ${r} timeline item`,insertAfter:`Insert media asset after ${r} timeline item`,reorder:`Reorder ${r} timeline items`,moveBlock:"Move selected items as a block",...a}),[r,a]),f=(0,n.useCallback)(e=>{let t=F.wK.getState();if("timeline-item"===e.source){if(e.timelineItemId){let i=t.tracks.flatMap(e=>e.items).find(t=>t.id===e.timelineItemId);return(null==i?void 0:i.durationInFrames)||0}if(e.selectedItemIds&&e.selectedItemIds.length>1){let i=t.tracks.flatMap(e=>e.items).filter(t=>{var i;return null===(i=e.selectedItemIds)||void 0===i?void 0:i.includes(t.id)});if(i.length>0){let e=i.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),t=e[0].startTimeInFrames;return e.at(-1).startTimeInFrames+e.at(-1).durationInFrames-t}}}else if("media-asset"===e.source&&e.mediaAssetId){var i;let r=t.mediaAssets.find(t=>t.id===e.mediaAssetId);return(null==r?void 0:null===(i=r.metadata)||void 0===i?void 0:i.duration)&&r.metadata.duration>0?Math.round(r.metadata.duration*t.globalConfig.fps):30}return 0},[]);return(0,n.useCallback)((e,r,n,a)=>{switch(r){case"replace":"timeline-item"===e.source||"media-asset"===e.source&&e.mediaAssetId&&(o??x)(e.mediaAssetType)&&s.batchOperation(g.replace,()=>{p(t,a.id,e.mediaAssetId)});break;case"insert-before":if("timeline-item"===e.source&&e.timelineItemId){if(e.trackId===t){let r=F.wK.getState(),n=r.tracks.find(e=>e.id===t);if(n&&(0,eg.yZ)(n)){let i=e.trackId;if((0,eg.R$)(e,i,t,a,"before",r,s,l,g,d,c))return}if(e.selectedItemIds&&e.selectedItemIds.length>1)s.batchOperation(g.moveBlock,()=>{(0,F.wK.getState().applyMultiSelectBlockMove)(t,a.id,"insert-before",e.selectedItemIds)});else{let r=i.findIndex(e=>e.id===a.id),n=i.findIndex(t=>t.id===e.timelineItemId);if(-1!==r&&-1!==n&&r!==n){let o=i.map(e=>e.id);o.splice(n,1),o.splice(n<r?r-1:r,0,e.timelineItemId),s.batchOperation(g.reorder,()=>{m(t,o)})}}}else if(e.trackId){let i=F.wK.getState(),r=e.trackId,n=i.tracks.find(e=>e.id===r),o=i.tracks.find(e=>e.id===t);if(!n||!o||n.type!==o.type||(0,eg.R$)(e,r,t,a,"before",i,s,l,g,d,c))return;s.batchOperation(g.reorder,()=>{if(-1===o.items.findIndex(e=>e.id===a.id))return;let s=e.selectedItemIds&&e.selectedItemIds.length>1?e.selectedItemIds:[e.timelineItemId];s.forEach(e=>i.removeItemFromTrack(r,e,!0)),s.forEach((e,r)=>{let o=n.items.find(t=>t.id===e)||i.tracks.flatMap(e=>e.items).find(t=>t.id===e);o&&i.addItemToTrack(t,{...o,id:o.id})})}),l()}}else if("media-asset"===e.source&&e.mediaAssetId&&(o??x)(e.mediaAssetType)){let r=F.wK.getState().tracks.find(e=>e.id===t);if(r&&(0,eg.yZ)(r)){let t=f(e);if(!(0,eg.BU)(r.items,t,"before",a.id)){let e=(0,eg.eN)(r.items,"before",a.id);console.warn(`[Timeline] Cannot insert before: insufficient space. Required: ${t} frames, Available: ${e} frames`);return}}let n=i.findIndex(e=>e.id===a.id);-1!==n&&(s.batchOperation(g.insertBefore,()=>{u(t,e.mediaAssetId,n)}),l())}break;case"insert-after":if("timeline-item"===e.source&&e.timelineItemId){if(e.trackId===t){let r=F.wK.getState(),n=r.tracks.find(e=>e.id===t);if(n&&(0,eg.yZ)(n)){let i=e.trackId;if((0,eg.R$)(e,i,t,a,"after",r,s,l,g,d,c))return}if(e.selectedItemIds&&e.selectedItemIds.length>1)s.batchOperation(g.moveBlock,()=>{(0,F.wK.getState().applyMultiSelectBlockMove)(t,a.id,"insert-after",e.selectedItemIds)});else{let r=i.findIndex(e=>e.id===a.id),n=i.findIndex(t=>t.id===e.timelineItemId);if(-1!==r&&-1!==n&&r!==n){let o=i.map(e=>e.id);o.splice(n,1),o.splice(n<r?r:r+1,0,e.timelineItemId),s.batchOperation(g.reorder,()=>{m(t,o)})}}}else if(e.trackId){let i=F.wK.getState(),r=e.trackId,n=i.tracks.find(e=>e.id===r),o=i.tracks.find(e=>e.id===t);if(!n||!o||n.type!==o.type||(0,eg.R$)(e,r,t,a,"after",i,s,l,g,d,c))return;s.batchOperation(g.reorder,()=>{if(-1===o.items.findIndex(e=>e.id===a.id))return;let s=e.selectedItemIds&&e.selectedItemIds.length>1?e.selectedItemIds:[e.timelineItemId];s.forEach(e=>i.removeItemFromTrack(r,e,!0)),s.forEach(e=>{let r=n.items.find(t=>t.id===e)||i.tracks.flatMap(e=>e.items).find(t=>t.id===e);r&&i.addItemToTrack(t,{...r,id:r.id})})}),l()}}else if("media-asset"===e.source&&e.mediaAssetId&&(o??x)(e.mediaAssetType)){let r=F.wK.getState().tracks.find(e=>e.id===t);if(r&&(0,eg.yZ)(r)){let t=f(e);if(!(0,eg.BU)(r.items,t,"after",a.id)){let e=(0,eg.eN)(r.items,"after",a.id);console.warn(`[Timeline] Cannot insert after: insufficient space. Required: ${t} frames, Available: ${e} frames`);return}}let n=i.findIndex(e=>e.id===a.id);-1!==n&&(s.batchOperation(g.insertAfter,()=>{u(t,e.mediaAssetId,n+1)}),l())}}},[o,x,s,g,p,t,l,d,c,i,m,f,u])}let re=n.memo(e=>{let{track:t,fps:i,zoomLevel:o=1,selectedItemIds:a,onSelectItem:c,audioType:u="music",trackLengthInPixel:p,framePerPixel:h}=e,m=(0,F.wK)(e=>e.outputSettings.totalDurationInFrames),x=F.wK.use.mediaAssets(),g=F.wK.use.tracks(),f=i7({trackId:t.id,trackItems:t.items,trackKind:"audio"}),v=(0,eg._3)(t.items,m,i),b=(0,n.useCallback)((e,t)=>{c&&c(e,t)},[c]),y=t.items.filter(e=>"audio"===e.type);return(0,r.jsx)(s.Z,{direction:"row",sx:{height:`${O.ZR}px`,width:"100%",position:"relative"},children:(0,r.jsxs)(l.Z,{sx:{position:"relative",height:"100%",flexGrow:1,width:"100%",overflow:"visible"},"data-track-id":t.id,"data-track-type":"audio","data-audio-type":u,children:[0===y.length&&(0,r.jsx)(d.Z,{variant:"caption",sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",color:"text.disabled"},children:"Empty audio track. Drag audio items from Media Library."}),y.map(e=>{let n=x.find(t=>t.id===e.mediaAssetId);return(0,r.jsx)(rs,{item:e,fps:i,trackType:u,framePerPixel:h,onSelect:t=>b(e.id,t.shiftKey),isSelected:(null==a?void 0:a.includes(e.id))??!1,dragData:{source:"timeline-item",timelineItemId:e.id,trackId:t.id,mediaAssetId:e.mediaAssetId,mediaAssetType:null==n?void 0:n.resource_type},onDrop:(t,i,r)=>f(t,i,r,e),isDropCompatible:e=>{let{source:i,mediaAssetType:r,trackId:n}=e;if("timeline-item"===i){if(!n)return!1;let e=g.find(e=>e.id.toLowerCase()===n.toLowerCase());return!!e&&e.type===t.type}return"media-asset"===i&&"audio"===r}},e.id)}),v.map(e=>(0,r.jsx)(rc,{trackLengthInPixel:p,gap:e,trackType:t.type,trackId:t.id,totalDurationInFrames:m,isPrimaryTrack:t.isPrimary,allowFreePositioning:(0,eg.yZ)(t)},e.id))]})})});re.displayName="TimelineTrackAudio";let rt=e=>{let{track:t,fps:i,zoomLevel:o=1,selectedItemIds:a,onSelectItem:d,trackLengthInPixel:c,framePerPixel:u}=e,p=F.wK.use.outputSettings(),h=(0,eg._3)(t.items,p.totalDurationInFrames,i),m=(0,n.useCallback)((e,t)=>{d&&d(e,t)},[d]),x=t.items.filter(e=>"caption"===e.type),g=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=e.currentTarget.getBoundingClientRect();e.clientX,t.left,t.width,p.totalDurationInFrames},[p.totalDurationInFrames]),f=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]);return(0,r.jsx)(s.Z,{sx:{position:"relative",height:`${O.Zk}px`,width:"100%"},children:(0,r.jsxs)(l.Z,{sx:{position:"relative",width:"100%",height:`${O.Zk}px`,backgroundColor:"transparent",borderRadius:"4px",overflow:"visible"},"data-track-id":t.id,"data-track-type":"caption",onDrop:g,onDragOver:f,children:[h.map((e,i)=>(0,r.jsx)(rc,{trackLengthInPixel:c,gap:e,trackType:"file",trackId:t.id,totalDurationInFrames:p.totalDurationInFrames,isPrimaryTrack:t.isPrimary,allowFreePositioning:(0,eg.yZ)(t)},`gap-${i}`)),x.map(e=>(0,r.jsx)(rd,{item:e,fps:i,isSelected:(null==a?void 0:a.includes(e.id))??!1,onSelect:t=>m(e.id,t.shiftKey),trackLengthInPixel:c,framePerPixel:u},e.id))]})})};var ri=i(1516);let rr=e=>{let{insertIndex:t,totalDurationInFrames:i,fps:o,zoomLevel:a,sx:s}=e,{operations:c}=(0,h.ZY)(),u=F.wK.use.addTrack(),p=F.wK.use.tracks(),m=F.wK.use.addItemToTrack(),x=F.wK.use.removeItemFromTrack(),g=(0,iQ.K)(),[f,v]=(0,n.useState)({isDragOver:!1,isCompatible:!1,isUploading:!1}),[b,y]=(0,n.useState)(null),{getOsDragMediaType:w,resolveTargetTabFromTrackType:C,handleOsFileDrop:j}=iJ(),k=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=(0,eg.Tp)(e.dataTransfer),i=(0,eg.MH)(e.dataTransfer),r=null==i?void 0:i.mediaAssetType;if((null==i?void 0:i.source)==="timeline-item"&&i.trackId){let e=p.find(e=>e.id.toLowerCase()===i.trackId.toLowerCase());if(e){r=e.type,y({...t,trackId:e.id}),v({isDragOver:!0,isCompatible:!0});return}console.warn("[TimelineTrackInsertionPlaceholder] Source track not found for timeline item drag",{dragTrackId:i.trackId,availableTracks:p.map(e=>({id:e.id,type:e.type}))})}!r&&(0,O.nw)(e.dataTransfer)&&(r=w(e.dataTransfer)),r&&(y({source:"media-asset",mediaAssetType:r}),v({isDragOver:!0,isCompatible:!0}))},[w,p]),S=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f.isDragOver&&b&&(e.dataTransfer.dropEffect="copy")},[f.isDragOver,b]),I=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=e.relatedTarget;e.currentTarget.contains(t)||setTimeout(()=>{v(e=>(null==e?void 0:e.isUploading)?{...e,isDragOver:!1}:{isDragOver:!1,isCompatible:!1,isUploading:!1}),y(null)},0)},[]),_=(0,n.useCallback)(e=>{let t=e.currentTarget.getBoundingClientRect();return Math.max(0,Math.min(Math.round((e.clientX-t.left)/t.width*i),i))},[i]),Z=(0,n.useCallback)(e=>{let i=(0,ri.Z)();return u({id:i,name:`${e.charAt(0).toUpperCase()}${e.slice(1)} Track`,type:e,items:[],isPrimary:!1},t),i},[u,t]),A=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=_(e),i=()=>{v({isDragOver:!1,isCompatible:!1,isUploading:!1}),y(null)};if((0,O.nw)(e.dataTransfer)){(async()=>{await j({event:e,resolveTargetTab:e=>C(e,e),onUploadingChange:e=>v(t=>({...t,isUploading:e})),onUploaded:e=>{let{mediaAssetId:i,mediaType:r}=e;c.batchOperation("Create new track and add media asset",()=>{let e=Z(r),n=F.wK.getState().mediaAssets.find(e=>e.id===i);n&&m(e,(0,eg.YI)(n,t))}),g()},onFinally:i})})();return}let r=(0,eg.Tp)(e.dataTransfer);if(i(),(null==r?void 0:r.source)==="media-asset"&&r.mediaAssetId&&r.mediaAssetType)c.batchOperation("Create new track and add media asset",()=>{let e=Z(r.mediaAssetType),i=F.wK.getState().mediaAssets,n=i.find(e=>e.id===r.mediaAssetId);n?m(e,(0,eg.YI)(n,t)):console.warn("[TimelineTrackInsertionPlaceholder] Media asset not found",{mediaAssetId:r.mediaAssetId,availableAssets:i.map(e=>({id:e.id,type:e.resource_type}))})}),g();else if((null==r?void 0:r.source)==="timeline-item"&&r.trackId){let e=p.find(e=>e.id.toLowerCase()===r.trackId.toLowerCase());if(!e){console.warn("Source track not found for timeline item drag");return}if(r.selectedItemIds&&r.selectedItemIds.length>0){let i=e.items.filter(e=>{var t;return null===(t=r.selectedItemIds)||void 0===t?void 0:t.includes(e.id)});i.length>0&&(c.batchOperation("Create new track and move selected items",()=>{let n=Z(e.type),o=t-Math.min(...i.map(e=>e.startTimeInFrames));i.forEach(e=>{m(n,{...e,startTimeInFrames:e.startTimeInFrames+o})}),i.forEach(e=>{x(r.trackId,e.id)})}),g())}else if(r.timelineItemId){let i=e.items.find(e=>e.id===r.timelineItemId);i?(c.batchOperation("Create new track and move timeline item",()=>{m(Z(e.type),{...i,startTimeInFrames:t}),x(r.trackId,i.id)}),g()):console.warn("Source item not found for timeline item drag")}}},[j,C,c,Z,m,x,g,_,p]);return(0,r.jsx)(l.Z,{sx:{width:"100%",position:"relative",height:`${O.ew}px`,borderRadius:`${O.yy}px`,pointerEvents:"auto",overflow:"hidden",zIndex:10,backgroundColor:"transparent",transition:"background-color 0.2s ease, box-shadow 0.2s ease",...f.isDragOver&&{backgroundColor:"rgba(74, 158, 255, 0.15)",boxShadow:"inset 0 0 0 2px #4A9EFF"},...f.isUploading&&{backgroundColor:"rgba(74, 158, 255, 0.2)",backgroundImage:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 75%)",backgroundSize:"200% 100%",animation:"insertion-shimmer 1.2s ease-in-out infinite","@keyframes insertion-shimmer":{"0%":{backgroundPosition:"-200% 0"},"100%":{backgroundPosition:"200% 0"}}},...s},onDragEnter:k,onDragOver:S,onDragLeave:I,onDrop:A,children:f.isDragOver||f.isUploading?(0,r.jsxs)(l.Z,{sx:{position:"absolute",top:"0",bottom:"0",left:"50%",transform:"translate(-50%, 0%)",pointerEvents:"none",textAlign:"center",display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:"8px !important",fontWeight:600,lineHeight:"1",color:"#4A9EFF",whiteSpace:"nowrap",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:f.isDragOver?f.isUploading?"Creating track and uploading…":"+":""}),f.isUploading?(0,r.jsx)(l.Z,{sx:{ml:1,width:"100px",height:"12px",borderRadius:"6px",backgroundColor:"rgba(74, 158, 255, 0.3)",backgroundImage:"linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%)",backgroundSize:"200% 100%",animation:"insertion-shimmer 1.2s ease-in-out infinite"}}):null]}):null})};rr.displayName="TimelineTrackInsertionPlaceholder";var rn=i(85963);function ro(e){let{itemId:t,isSelected:i,getItemVO:r,componentName:o="TimelineItem"}=e,a=n.useRef(null);(0,n.useEffect)(()=>{if(!i){a.current=null;return}if(a.current===t)return;a.current=t;let e=r(t);if(e&&e.subsequentItemIds.length>0)return(0,eg.f8)(()=>{e.subsequentItemIds.forEach(e=>{r(e)})},{timeout:500})},[i,t,r])}function ra(e){let{item:t,itemVO:i,transientState:r,getItemVO:o,invalidateItemVOCache:a,operations:s,onResize:l}=e,d=T.wK.use.adjustSourceTrim(),c=T.wK.use.resizeCaptionItem(),u=T.wK.use.shiftItemsFromIndex(),p=T.wK.use.updateTotalDurationInFrames(),h=T.wK.use.tracks(),m=(0,n.useRef)(!1),x=(0,n.useRef)(),g=(0,n.useRef)(),f=(0,n.useRef)(0),v=(0,n.useRef)("right"),b=(0,n.useRef)(null),y=(0,n.useCallback)(()=>{if(!t.groupId)return[];let e=[];return h.forEach(i=>{i.items.forEach((r,n)=>{r.groupId===t.groupId&&r.id!==t.id&&e.push({item:r,trackId:i.id,itemIndex:n})})}),e},[t.groupId,t.id,h]);return{handleResize:(0,n.useCallback)((e,t,n,a,s)=>{if(!i){console.warn("[Resize] Cannot resize: itemVO not found");return}m.current||(m.current=!0,x.current=i.startTimeInFrames,v.current=n,f.current=0),"left"===n?f.current+=t:f.current+=e,g.current&&cancelAnimationFrame(g.current),g.current=requestAnimationFrame(()=>{null==l||l();let e=f.current;r.updateResize(s,e,n,i,o),g.current=void 0})},[i,l,r,o]),handleResizeEnd:(0,n.useCallback)((e,n,o,l)=>{if(g.current&&(cancelAnimationFrame(g.current),g.current=void 0),!m.current)return;if(!i){console.warn("[Resize] Cannot end resize: itemVO not found");return}let h=r.commitResize(o);if(h){let{deltaPixels:m,subsequentItemIds:g}=h,f=i.durationInFrames/i.width*m;Math.abs(f)>.01&&s.batchOperation("Resize item",()=>{"caption"===t.type?c(n,o,e,f):(d(n,o,e,f),t.groupId&&y().forEach(t=>{let{item:i,trackId:r}=t;d(r,i.id,e,f)}),"left"===e&&void 0!==x.current&&(u(n,l,x.current,o),t.groupId&&y().forEach(e=>{let{item:t,trackId:i,itemIndex:r}=e;u(i,r,x.current,t.id)}))),p()}),a([o,...g]),requestAnimationFrame(()=>{requestAnimationFrame(()=>{r.cleanupSubsequentItems(g)})})}m.current=!1,x.current=void 0,f.current=0},[t.type,t.groupId,i,r,c,d,y,u,p,a,s]),containerRef:b}}let rs=(0,n.memo)(e=>{let{item:t,fps:i,trackType:o,isSelected:a,containerSx:s,onResize:c,framePerPixel:u,...p}=e,m=(0,F.D)(e=>(0,F.Z_)(e,t.mediaAssetId)),x=F.wK.use.removeItemFromTrack(),g=F.wK.use.selectItem(),f=F.wK.use.tracks(),{operations:v}=(0,h.ZY)(),b=(0,iQ.K)(),{getItemVO:y,invalidateItemVOCache:w,transientState:C}=iN(),j=(0,n.useMemo)(()=>y(t.id),[y,t.id]),{track:k,itemIndex:S}=(0,n.useMemo)(()=>{let e=f.find(e=>e.items.some(e=>e.id===t.id));return e?{track:e,itemIndex:e.items.findIndex(e=>e.id===t.id)}:{track:void 0,itemIndex:void 0}},[f,t.id]),{handleResize:I,handleResizeEnd:_,containerRef:Z}=ra({item:t,itemVO:j,transientState:C,getItemVO:y,invalidateItemVOCache:w,operations:v,onResize:c});(0,n.useEffect)(()=>(Z.current&&C.registerElement(t.id,Z.current),()=>{C.registerElement(t.id,null)}),[t.id,C,Z]);let A=(0,n.useCallback)(()=>{v.batchOperation("Delete audio",()=>{x(null==k?void 0:k.id,t.id,!0)}),g(null),b()},[null==k?void 0:k.id,t.id,x,g,v,b]);ro({itemId:t.id,isSelected:a,getItemVO:y,componentName:"TimelineTrackItemAudio"});let E=(0,n.useMemo)(()=>"music"===o?"#653597":"#1142A2",[o]);return(0,r.jsx)(l.Z,{ref:Z,"data-timeline-item-id":t.id,sx:{position:"absolute",left:0,transform:j?`translateX(${j.left+O.p_/2}px)`:"none",width:j?`${Math.max(1,j.width-O.p_)}px`:0,height:`${O.ZR}px`,top:0,bottom:0,...s},children:(0,r.jsx)(rx,{...p,isSelected:a,onResize:(e,i,r)=>{(null==k?void 0:k.id)&&I(e,i,r,k.id,t.id)},onResizeEnd:e=>{(null==k?void 0:k.id)&&void 0!==S&&(_(e,k.id,t.id,S),b())},onDelete:A,children:(0,r.jsxs)(l.Z,{sx:{position:"relative",width:"100%",height:"100%",borderRadius:`${O.yy}px`,overflow:"hidden","&:hover":{"&>.audio-title":{opacity:1}}},className:"audio-track-item",children:[(0,r.jsx)(rl,{item:t,baseColor:E}),(0,r.jsx)(rn.z,{audioUrl:null==m?void 0:m.url,sx:{height:"100%",py:"2px"},barColor:"music"===o?"#A386C1":"#9CBAFF"}),(0,r.jsx)(d.Z,{variant:"caption",display:"block",noWrap:!0,className:"audio-title",sx:{flex:1,display:"flex",alignItems:"center",position:"absolute",opacity:0,transition:"opacity 0.3s ease-in-out",bottom:0,left:0,pl:"10px",pr:"6px",top:0,backgroundColor:E,color:"white",textAlign:"center",fontFamily:"Inter",fontSize:"12px",fontWeight:400,lineHeight:"21.53px",borderRadius:`${O.yy}px`},children:t.title||t.id})]})})})});function rl(e){let{item:t,baseColor:i}=e,n=t.effects||[],o=n.find(e=>"fade-in"===e.type),a=n.find(e=>"fade-out"===e.type),s=(null==o?void 0:o.durationInFrames)||0,l=(null==a?void 0:a.durationInFrames)||0,d=t.durationInFrames,c=100*s/d,u=100*l/d,p=100-c-u;return(0,r.jsxs)("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",preserveAspectRatio:"none",style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[s>0&&(0,r.jsx)("path",{d:(()=>{if(0===s)return"";let e=[],t=Math.max(20,Math.floor(c));e.push("M 0 100");for(let i=0;i<=t;i++){let r=i/t*s,n=(0,O.aD)(r,s),o=i/t*c,a=100-100*n;e.push(`L ${o} ${a}`)}return e.push(`L ${c} 100`),e.push("Z"),e.join(" ")})(),fill:i}),p>0&&(0,r.jsx)("path",{d:(()=>{if(p<=0)return"";let e=Math.max(0,c-.1),t=Math.min(100,100-u+.1);return`M ${e} 0 L ${t} 0 L ${t} 100 L ${e} 100 Z`})(),fill:i}),l>0&&(0,r.jsx)("path",{d:(()=>{if(0===l)return"";let e=[],t=100-u,i=Math.max(20,Math.floor(u));e.push(`M ${t} 0`);for(let r=0;r<=i;r++){let n=r/i*l,o=d-l+n,a=(0,O.Xm)(o,l,d),s=t+r/i*u,c=100-100*a;e.push(`L ${s} ${c}`)}return e.push("L 100 100"),e.push(`L ${t} 100`),e.push("Z"),e.join(" ")})(),fill:i})]})}rs.displayName="TimelineTrackItemAudio";let rd=(0,n.memo)(e=>{var t,i;let{item:o,fps:a,isSelected:s,containerSx:c,onResize:u,trackLengthInPixel:p,framePerPixel:m,...x}=e,g=F.wK.use.tracks(),f=F.wK.use.removeItemFromTrack(),v=F.wK.use.selectItem(),{operations:b}=(0,h.ZY)(),y=(0,iQ.K)(),{getItemVO:w,invalidateItemVOCache:C,transientState:j}=iN(),k=(0,n.useMemo)(()=>w(o.id),[w,o.id]),{track:S,itemIndex:I}=(0,n.useMemo)(()=>{let e=g.find(e=>e.items.some(e=>e.id===o.id));return e?{track:e,itemIndex:e.items.findIndex(e=>e.id===o.id)}:{track:void 0,itemIndex:void 0}},[g,o.id]),{handleResize:_,handleResizeEnd:Z,containerRef:A}=ra({item:o,itemVO:k,transientState:j,getItemVO:w,invalidateItemVOCache:C,operations:b,onResize:u});(0,n.useEffect)(()=>(A.current&&j.registerElement(o.id,A.current),()=>{j.registerElement(o.id,null)}),[o.id,j,A]);let E=F.wK.use.setTracks(),M=(0,n.useCallback)(()=>{if(S&&void 0!==I){b.batchOperation("Delete caption",()=>{f(S.id,o.id)}),y();try{let e=eP.D.getState().tracks,t=e.filter(e=>!("caption"===e.subtype&&0===e.items.length));t.length!==e.length&&E(t)}catch(e){console.warn("Failed to prune empty caption tracks after context delete:",e)}}},[S,I,b,f,o.id,E,y]);ro({itemId:o.id,isSelected:s,getItemVO:w,componentName:"TimelineTrackItemCaption"});let T=F.wK.use.toggleSelectItem(),R=(0,n.useCallback)(e=>{e.shiftKey?T(o.id):v(o.id)},[v,T,o.id]),D=(null===(i=o.caption)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.text)||"Caption";return(0,r.jsx)(l.Z,{ref:A,"data-timeline-item-id":o.id,sx:{position:"absolute",left:0,transform:k?`translateX(${k.left+O.p_/2}px)`:"none",width:k?`${Math.max(1,k.width-O.p_)}px`:0,height:`${O.Zk}px`,minWidth:0},children:(0,r.jsx)(rx,{isSelected:s,draggable:!1,droppable:!0,isDropCompatible:()=>!1,onDelete:M,onSelect:R,onResize:(e,t,i)=>{(null==S?void 0:S.id)&&_(e,t,i,S.id,o.id)},onResizeEnd:e=>{(null==S?void 0:S.id)&&void 0!==I&&(Z(e,S.id,o.id,I),y())},...x,children:(0,r.jsx)(l.Z,{sx:{width:"100%",height:"100%",borderRadius:`${O.yy}px`,backgroundColor:"var(--Green-300, #008A4C)",display:"flex",alignItems:"center",justifyContent:"flex-start",minWidth:0,overflow:"hidden",cursor:"pointer","&:hover":{backgroundColor:"var(--Green-300, #008A4C)"}},children:(0,r.jsx)(d.Z,{variant:"body2",sx:{px:1.5,color:"#c9ffe3",fontSize:"10px",fontWeight:600,lineHeight:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flexGrow:1},children:D})})})})});rd.displayName="TimelineTrackItemCaption";let rc=e=>{let{gap:t,trackType:i,trackId:o,totalDurationInFrames:a,trackLengthInPixel:s,isPrimaryTrack:c=!1,allowFreePositioning:u=!1,sx:p}=e,{operations:m}=(0,h.ZY)(),x=F.wK.use.addMediaAssetToTrack(),g=F.wK.use.addMediaAssetToTrackAtTime(),f=F.wK.use.moveItemToPosition(),v=F.wK.use.tracks(),b=(0,iQ.K)(),y=(0,n.useMemo)(()=>100*t.durationInFrames/a,[t.durationInFrames,a]),w=(0,n.useMemo)(()=>100*t.startTimeInFrames/a,[t.startTimeInFrames,a]),[C,j]=(0,n.useState)({isDragOver:!1,isCompatible:!1,isUploading:!1}),[k,S]=(0,n.useState)(null),[I,_]=(0,n.useState)(null),{getOsDragMediaType:Z,resolveTargetTabFromTrackType:A,handleOsFileDrop:E}=iJ(),M=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=(0,eg.MH)(e.dataTransfer);if((null==t?void 0:t.source)==="timeline-item"){let{dragData:e,dropState:r}=function(e,t,i){let r=!1,n=F.wK.getState(),o=n.tracks.find(e=>e.id===t),a=n.tracks.find(t=>{var i;return t.id.toLowerCase()===(null===(i=e.trackId)||void 0===i?void 0:i.toLowerCase())}),s=(null==a?void 0:a.type)||void 0,l=(null==o?void 0:o.type)||i;r=!!s&&(0,eg.JO)(s,l);let d={source:"timeline-item",trackId:e.trackId},c={isDragOver:!0,isCompatible:r,errorMessage:r?void 0:"Not supported"};return{isCompatible:r,dragData:d,dropState:c}}(t,o,i);S(e),j(r);return}let r=null==t?void 0:t.mediaAssetType;if(!r&&(0,O.nw)(e.dataTransfer)){let t=Z(e.dataTransfer),i=function(e){try{if(!e||!e.items)return null;let t=Array.from(e.items||[]).find(e=>"file"===e.kind),i=(null==t?void 0:t.type)||"";if(i.startsWith("image/"))return"image";if(i.startsWith("video/"))return"video";if(i.startsWith("audio/"))return"audio";return null}catch{return null}}(e.dataTransfer);r=t??i??void 0}if(!r){j({isDragOver:!0,isCompatible:!1,errorMessage:"Not allowed"});return}let n=(0,eg.JO)(r,i);S({source:"media-asset",mediaAssetType:r}),j({isDragOver:!0,isCompatible:n,errorMessage:n?void 0:"Not allowed"})},[Z,i,o]),T=(0,n.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),C.isDragOver&&k&&(e.dataTransfer.dropEffect=C.isCompatible?"copy":"none",u)){let t=e.currentTarget.getBoundingClientRect();_(Math.max(0,Math.min(100,(e.clientX-t.left)/t.width*100)))}},[C.isDragOver,C.isCompatible,k,u]),R=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=e.relatedTarget;e.currentTarget.contains(t)||setTimeout(()=>{j(e=>(null==e?void 0:e.isUploading)?{...e,isDragOver:!1}:{isDragOver:!1,isCompatible:!1,isUploading:!1}),S(null),_(null)},0)},[]),D=(0,n.useCallback)(e=>{var r,n,a;e.preventDefault(),e.stopPropagation();let s=()=>{j({isDragOver:!1,isCompatible:!1,isUploading:!1}),S(null),_(null)};if((0,O.nw)(e.dataTransfer)){let a=null;try{let t=null===(n=e.currentTarget)||void 0===n?void 0:null===(r=n.getBoundingClientRect)||void 0===r?void 0:r.call(n);if(t&&t.width>0){let i=Math.max(0,Math.min(t.width,e.clientX-t.left))/t.width*100;a=(I??i)/100}}catch{}(async()=>{let r=Z(e.dataTransfer);if(!r||!(0,eg.JO)(r,i)){s();return}await E({event:e,resolveTargetTab:e=>A(i,e),onUploadingChange:e=>j(t=>({...t,isUploading:e})),onUploaded:e=>{let{mediaAssetId:i}=e,r=F.wK.getState().tracks.find(e=>e.id===o),n=!!(r&&0===r.items.length);m.batchOperation("Add media asset to track",()=>{if(r){if(r.isPrimary)x(o,i,n?0:t.insertIndex,"end"===t.type?void 0:t.durationInFrames);else{var e;let r=a??(I??0)/100,n=t.startTimeInFrames+Math.floor(t.durationInFrames*r),s=F.wK.getState(),l=s.mediaAssets.find(e=>e.id===i),d=(null===(e=s.globalConfig)||void 0===e?void 0:e.fps)||30,c=l?(0,eg.YI)(l,0,void 0,d).durationInFrames:0;if(c>t.durationInFrames)return;g(o,i,ru(n,t.startTimeInFrames,t.startTimeInFrames+t.durationInFrames-c),t.insertIndex)}}}),b()},onFinally:s})})();return}let l=(0,eg.Tp)(e.dataTransfer);if(s(),(null==l?void 0:l.source)==="media-asset"&&C.isCompatible&&l.mediaAssetId){let i=F.wK.getState(),r=i.tracks.find(e=>e.id===o),n=!!(r&&0===r.items.length);if(!r)return;m.batchOperation("Add media asset to track",()=>{if(r.isPrimary){let e=n?0:t.insertIndex;x(o,l.mediaAssetId,e,"end"===t.type?void 0:t.durationInFrames)}else{var a;let r=e.currentTarget.getBoundingClientRect(),n=Math.max(0,Math.min(r.width,e.clientX-r.left))/r.width*100,s=(I??n)/100,d=t.startTimeInFrames+Math.floor(t.durationInFrames*s),c=(null===(a=i.globalConfig)||void 0===a?void 0:a.fps)||30,u=i.mediaAssets.find(e=>e.id===l.mediaAssetId),p=u?(0,eg.YI)(u,0,void 0,c).durationInFrames:0;if(p>t.durationInFrames)return;let h=ru(d,t.startTimeInFrames,t.startTimeInFrames+t.durationInFrames-p);g(o,l.mediaAssetId,h,t.insertIndex)}}),b()}else if((null==l?void 0:l.source)==="timeline-item"&&l.timelineItemId){let r=F.wK.getState(),n=r.tracks.find(e=>e.id===o);if(!n)return;let s=r.tracks.flatMap(e=>e.items.map(t=>({item:t,trackId:e.id}))).find(e=>{let{item:t}=e;return t.id===l.timelineItemId});if(!s)return;let d="video"===(a=s.item.type)?"video":"image"===a||"logo"===a||"overlay"===a?"image":"audio"===a?"audio":void 0;if(!d||!(0,eg.JO)(d,i))return;let c=0===n.items.length;if(n.isPrimary)m.batchOperation("Move item to primary track gap start",()=>{r.removeItemFromTrack(s.trackId,s.item.id,!0);let e={...s.item,startTimeInFrames:c?0:t.startTimeInFrames};r.addItemToTrack(o,e)}),b();else{let i=e.currentTarget.getBoundingClientRect(),n=Math.max(0,Math.min(i.width,e.clientX-i.left))/i.width*100,a=(I??n)/100,l=t.startTimeInFrames+Math.floor(t.durationInFrames*a),d=s.item.durationInFrames,c=t.durationInFrames,u=t.startTimeInFrames,p=t.startTimeInFrames+t.durationInFrames-d;if(s.trackId===o){let e=s.item.startTimeInFrames,i=e+s.item.durationInFrames,r=t.startTimeInFrames,n=t.endTimeInFrames??t.startTimeInFrames+t.durationInFrames,o=i===r,a=e===n;(o||a)&&(c+=s.item.durationInFrames,o&&(u=r-d),a&&(p=n))}if(d>c)return;let h=ru(s.trackId===o&&l>=s.item.startTimeInFrames+s.item.durationInFrames?l-d:l,u,p);m.batchOperation("Place item on free track",()=>{if(s.trackId===o)f(o,s.item.id,h);else{r.removeItemFromTrack(s.trackId,s.item.id,!0);let e={...s.item,startTimeInFrames:h};r.addItemToTrack(o,e)}}),b()}}},[o,i,t,I,C.isCompatible,Z,E,A,m,b,g,x,f]);return(0,r.jsxs)(l.Z,{sx:{position:"absolute",left:`${w/100*s}px`,width:`${y/100*s}px`,height:"100%",top:0,bottom:0,borderRadius:1,pointerEvents:"auto",overflow:"hidden",border:C.isDragOver||C.isUploading?void 0:"none",backgroundColor:"transparent",transition:"all 0.2s ease",...C.isDragOver&&{border:`2px dashed ${C.isCompatible?"#4A9EFF":"#ff6b6b"}`,backgroundColor:C.isCompatible?"rgba(74, 158, 255, 0.2)":"rgba(255, 107, 107, 0.2)"},...C.isUploading&&{border:"2px dashed",borderColor:"#4A9EFF",backgroundColor:"rgba(74, 158, 255, 0.2)",backgroundImage:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 75%)",backgroundSize:"200% 100%",animation:"placeholder-shimmer 1.2s ease-in-out infinite","@keyframes placeholder-shimmer":{"0%":{backgroundPosition:"-200% 0"},"100%":{backgroundPosition:"200% 0"}}},"&:hover":{},...p},onDragEnter:M,onDragOver:T,onDragLeave:R,onDrop:D,children:[(!!(y/100*s>=84&&C.isDragOver)||!!C.isUploading)&&(0,r.jsxs)(l.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none",textAlign:"center",display:"flex",flexDirection:"row",alignItems:"center",gap:1,px:1},children:[(0,r.jsx)(d.Z,{variant:"caption",sx:{fontSize:"11px",fontWeight:500,color:C.isUploading?"#4A9EFF":C.isCompatible?"#4A9EFF":"#ff6b6b",whiteSpace:"nowrap",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:C.isUploading?"Uploading…":C.isCompatible?(()=>{var e;let t=v.find(e=>e.id===o),r=0===((null==t?void 0:null===(e=t.items)||void 0===e?void 0:e.length)||0),n=!0;if((null==k?void 0:k.source)==="timeline-item"){let e=v.find(e=>e.id===(null==k?void 0:k.trackId)),t=(null==e?void 0:e.type)||void 0;n=!t||(0,eg.JO)(t,i)}let a=(u||c&&r)&&n;return C.isDragOver&&C.isCompatible?(null==k?void 0:k.source)==="timeline-item"?a?"Move here":"Not supported":"Insert here":""})():C.errorMessage}),!!C.isUploading&&(0,r.jsx)(l.Z,{sx:{ml:1,width:"72px",height:"10px",borderRadius:"6px",backgroundImage:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 75%)",backgroundSize:"200% 100%",animation:"placeholder-shimmer 1.2s ease-in-out infinite"}})]}),u&&C.isDragOver&&C.isCompatible&&null!==I?(0,r.jsx)(l.Z,{sx:{position:"absolute",left:`${I}%`,top:0,bottom:0,width:"2px",backgroundColor:"#4A9EFF",pointerEvents:"none",zIndex:1}}):null]})};function ru(e,t,i){return Number.isNaN(e)?t:Math.max(t,Math.min(i,e))}rc.displayName="TimelineTrackItemPlaceholder";var rp=i(14113),rh=i(30159);let rm=n.forwardRef((e,t)=>{let{anchorEl:i,anchorPosition:n,open:o,onClose:a,onDelete:s}=e;return(0,r.jsx)(rh.Z,{open:o,anchorEl:n?void 0:i,placement:"bottom-start",modifiers:[{name:"offset",options:{offset:[0,8]}}],sx:{zIndex:1300},...n&&{anchorEl:{getBoundingClientRect:()=>({top:n.top,left:n.left,right:n.left,bottom:n.top,width:0,height:0})}},children:(0,r.jsx)(l.Z,{ref:t,sx:{backgroundColor:"#1A1A1A",border:"1px solid #333",borderRadius:"8px",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.4)",overflow:"hidden",width:"100px"},children:(0,r.jsx)(H.Z,{onClick:()=>{s(),a()},sx:{width:"100%",justifyContent:"center",alignItems:"center",color:"#888",backgroundColor:"transparent",borderRadius:0,padding:.5,fontSize:"14px",fontWeight:500,textTransform:"none","&:hover":{backgroundColor:"#2E2E2E"}},startIcon:(0,r.jsx)(rp.Z,{sx:{fontSize:"16px",color:"#888"}}),children:"Delete"})})})});rm.displayName="TimelineItemContextMenu";let rx=e=>{let{draggable:t=!0,droppable:i=!0,isGroupWrapper:o=!1,onSelect:a,isSelected:s,allowResize:d=!0,onDragEnd:c,onDragOver:u,onDrop:p,onResize:h,onResizeEnd:m,isDropCompatible:x,dragData:g,onDelete:f,sx:v,children:b}=e,{getOsDragMediaType:y,handleOsFileDrop:w,resolveTargetTabFromWrapper:C}=iJ(),j=(0,F.D)(e=>e.selectedItemIds),k=(0,F.D)(e=>e.tracks),S=(0,F.D)(e=>e.draggingSelectionItemIds),I=(0,F.D)(e=>e.setDraggingSelectionItemIds),_=(0,F.D)(e=>e.clearDraggingSelection),[Z,A]=(0,n.useState)(!1),[E,M]=(0,n.useState)(!1),[T,R]=(0,n.useState)(!1),[D,z]=(0,n.useState)("none"),[P,W]=(0,n.useState)(!1),[L,B]=(0,n.useState)(),[H,$]=(0,n.useState)(null),[O,G]=(0,n.useState)(null),N=!!O,V=(0,n.useRef)(null),K=(0,n.useRef)(null),q=(0,n.useMemo)(()=>{switch(D){case"replace":return"Replace";case"insert-before":return"Insert before";case"insert-after":return"Insert after";default:return""}},[D]),Y=(0,n.useCallback)(e=>{e.stopPropagation(),null==a||a(e)},[a]),X=(0,n.useCallback)((e,t)=>{if(e.stopPropagation(),e.preventDefault(),!s&&a&&a(e),!h||!d)return;A(!0);let i=e.clientX,r=e=>{let r=e.clientX,n=r-i;i=r,Math.abs(n)>0&&("left"===t?h(0,n,t):h(n,0,t))},n=()=>{A(!1),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",n),null==m||m(t)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",n)},[d,s,h,m,a]),J=(0,n.useCallback)(e=>{let t=document.createElement("div");t.style.position="fixed",t.style.pointerEvents="none",t.style.zIndex="9999",t.style.display="flex",t.style.flexDirection="row",t.style.gap="0",t.style.padding="0",t.style.backgroundColor="rgba(0, 0, 0, 0.9)",t.style.borderRadius="8px",t.style.border="2px solid #6290FF",t.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.6)",t.style.maxWidth="600px";let i=0;for(let r of e){if(i>=5)break;let e=document.querySelector(`[data-timeline-item-id="${r}"]`);if(e||(e=document.querySelector(`.timeline-item-wrapper[data-item-id="${r}"]`)),e){let r=e.cloneNode(!0);r.style.position="relative",r.style.left="0",r.style.top="0",r.style.width="120px",r.style.height="70px",r.style.flexShrink="0",r.style.opacity="0.95",r.style.transform="scale(0.85)",r.style.transformOrigin="center",r.style.cursor="grabbing",r.querySelectorAll('[style*="position: absolute"], [style*="position:absolute"]').forEach(e=>{e.style.position="relative",e.style.left="0",e.style.top="0",e.style.right="auto",e.style.bottom="auto"}),r.querySelectorAll(".resize-handle").forEach(e=>e.remove()),r.querySelectorAll(".drop-hint-overlay").forEach(e=>e.remove()),t.append(r),i++}}if(0===i)for(let i=0;i<Math.min(e.length,5);i++){let e=document.createElement("div");e.style.width="80px",e.style.height="50px",e.style.backgroundColor="#6290FF",e.style.borderRadius="4px",e.style.opacity="0.8",t.append(e)}if(e.length>5){let i=document.createElement("div");i.style.width="50px",i.style.height="60px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.color="rgba(255, 255, 255, 0.9)",i.style.fontSize="14px",i.style.fontWeight="bold",i.style.backgroundColor="rgba(255, 255, 255, 0.1)",i.style.borderRadius="4px",i.textContent=`+${e.length-5}`,t.append(i)}let r=document.createElement("div");return r.style.position="absolute",r.style.top="-10px",r.style.right="-10px",r.style.backgroundColor="#FF5B5B",r.style.color="white",r.style.borderRadius="50%",r.style.minWidth="28px",r.style.height="28px",r.style.padding="0 6px",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.fontSize="13px",r.style.fontWeight="bold",r.style.boxShadow="0 2px 6px rgba(0, 0, 0, 0.4)",r.style.zIndex="1",r.textContent=e.length.toString(),t.append(r),t},[]),Q=(0,n.useCallback)(e=>{if(!t)return;if(e.stopPropagation(),!g){console.warn("TimelineTrackItemWrapper: No drag data available"),e.preventDefault();return}let i=j.length>1&&j.includes(g.timelineItemId||""),r=g;if(i){if((0,eg.mM)(j,k).isValid){r={...g,selectedItemIds:j},I(j);let t=J(j);t&&(document.body.append(t),e.dataTransfer.setDragImage(t,80,20),setTimeout(()=>{t.remove()},0))}else console.warn("Multi-select drag validation failed, falling back to single item")}M(!0),(0,eg.tn)(e.dataTransfer,r),e.dataTransfer.effectAllowed="copy"},[g,t,j,k,I,J]),ee=(0,n.useCallback)(e=>{if(!i||(e.preventDefault(),e.stopPropagation(),E||(null==g?void 0:g.timelineItemId)&&S.includes(g.timelineItemId)))return;W(!0);let t=null,r=(0,eg.MH)(e.dataTransfer);if(r&&(t={source:r.source,...r.mediaAssetType&&{mediaAssetType:r.mediaAssetType},..."media-asset"===r.source&&{mediaAssetId:"unknown"},..."timeline-item"===r.source&&{timelineItemId:"unknown",trackId:r.trackId},..."timeline-group"===r.source&&{groupId:r.groupId}}),!t){let i=y(e.dataTransfer);i&&(t={source:"media-asset",mediaAssetType:i})}if(!t||!x){B(!1);return}let n=x(t);B(n),n&&$(t)},[i,E,null==g?void 0:g.timelineItemId,S,x,y]),et=(0,n.useCallback)(e=>{if(!i||(e.preventDefault(),e.stopPropagation(),!H||!K.current||!L))return;W(!0);let t=K.current.getBoundingClientRect(),r=(0,eg.Ru)(e.clientX,t,0).type;("timeline-item"===H.source||"timeline-group"===H.source||"media-asset"===H.source&&o)&&(r=(e.clientX-t.left)/t.width<.5?"insert-before":"insert-after"),H.selectedItemIds&&H.selectedItemIds.length>1&&(r=(e.clientX-t.left)/t.width<.5?"insert-before":"insert-after"),z(r),e.dataTransfer.dropEffect="copy",null==u||u(e)},[H,i,L,o,u]),ei=(0,n.useCallback)(e=>{var t;if(!i)return;e.preventDefault(),e.stopPropagation();let r=e.relatedTarget;(null===(t=K.current)||void 0===t?void 0:t.contains(r))||(W(!1),z("none"),$(null))},[i]),er=(0,n.useCallback)(async e=>{if(!i)return;if(e.preventDefault(),e.stopPropagation(),(0,eg.nw)(e.dataTransfer)&&"none"!==D){await w({event:e,resolveTargetTab:e=>C(K.current,e),onUploadingChange:e=>{R(e),e&&W(!0)},onUploaded:t=>{let{mediaAssetId:i,mediaType:r}=t;null==p||p({source:"media-asset",mediaAssetId:i,mediaAssetType:r},D,e)},onFinally:()=>{R(!1),W(!1),z("none"),$(null)}});return}let t=(0,eg.Tp)(e.dataTransfer);p&&t&&"none"!==D&&p(t,D,e),W(!1),z("none"),$(null)},[i,p,D,w,C]),en=(0,n.useCallback)(e=>{t&&(M(!1),_(),null==c||c(e))},[t,c,_]),eo=(0,n.useCallback)(e=>{Y(e),f&&(e.preventDefault(),e.stopPropagation(),G({top:e.clientY,left:e.clientX}))},[Y,f]),ea=(0,n.useCallback)(()=>{G(null)},[]),es=(0,n.useCallback)(()=>{null==f||f()},[f]);(0,n.useEffect)(()=>{let e=e=>{if(N){var t;(null===(t=V.current)||void 0===t?void 0:t.contains(e.target))||G(null)}};if(N)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[N]);let el=(0,n.useMemo)(()=>(P||T)&&("none"!==D&&q||!L||T),[P,T,D,q,L]),ed=(0,n.useMemo)(()=>E||(null==g?void 0:g.timelineItemId)&&S.includes(g.timelineItemId)?.2:P||T?.6:1,[P,T,E,null==g?void 0:g.timelineItemId,S]),ec=(0,n.useMemo)(()=>el&&("insert-before"===D||"insert-after"===D)?1:0,[el,D]);return(0,r.jsxs)(l.Z,{ref:K,"data-timeline-item-id":null==g?void 0:g.timelineItemId,className:"timeline-item-wrapper",sx:{userSelect:"none",position:"relative",width:"100%",height:"100%",opacity:ed,cursor:Z?"ew-resize":E?"grabbing":"grab",boxShadow:s?"inset 0 0 0 2px #6290FF":"none",borderRadius:`${U.yy}px`,transition:"all 0.1s ease",transform:E?"scale(0.98)":"scale(1)","&::before":s?{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,border:"2px solid #6290FF",borderRadius:`${U.yy}px`,pointerEvents:"none",zIndex:1e3}:{},...v},onClick:Y,onContextMenu:eo,draggable:!Z&&!!g&&t,onDragStart:Q,onDragEnd:en,onDragEnter:ee,onDragOver:et,onDragLeave:ei,onDrop:er,"data-droppable":i?!((null==g?void 0:g.timelineItemId)&&S.includes(g.timelineItemId)):null,children:[b,f?(0,r.jsx)(rm,{ref:V,anchorPosition:O,open:N,onClose:ea,onDelete:es}):null,el?(0,r.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:T?"transparent":"rgba(0, 0, 0, 0.6)",border:"2px dashed #6290FF",borderRadius:`${U.yy}px`,display:"flex",alignItems:"center",overflow:"hidden",justifyContent:"center",pointerEvents:"none",zIndex:1001,...T&&{backgroundImage:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.2s ease-in-out infinite","@keyframes shimmer":{"0%":{backgroundPosition:"-200% 0"},"100%":{backgroundPosition:"200% 0"}}}},className:"drop-hint-overlay",children:T?(0,r.jsx)(l.Z,{sx:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"4px 8px",borderRadius:`${U.yy}px`,fontSize:"16px",fontWeight:800},children:"Uploading…"}):L?(0,r.jsx)(l.Z,{sx:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"4px 8px",borderRadius:`${U.yy}px`,fontSize:"16px",fontWeight:800},children:q}):(0,r.jsx)(l.Z,{sx:{width:"24px",height:"24px",borderRadius:"50%",backgroundColor:"rgba(255, 107, 107, 0.9)",display:"flex",alignItems:"center",flexShrink:0,justifyContent:"center",position:"relative","&::before":{content:'""',position:"absolute",width:"20px",height:"2px",backgroundColor:"white"}}})}):null,ec?(0,r.jsx)(l.Z,{sx:{position:"absolute",left:"insert-before"===D?-6:"auto",right:"insert-after"===D?-6:"auto",top:"-5px",width:"6px",height:"calc(100% + 10px)",backgroundColor:"#6290FF",pointerEvents:"none",zIndex:1002,"&::before":{content:'""',position:"absolute",left:"50%",top:0,transform:"translateX(-50%)",width:0,height:0,borderLeft:"12px solid transparent",borderRight:"12px solid transparent",borderTop:"12px solid #6290FF"},"&::after":{content:'""',position:"absolute",left:"50%",bottom:0,transform:"translateX(-50%)",width:0,height:0,borderLeft:"12px solid transparent",borderRight:"12px solid transparent",borderBottom:"12px solid #6290FF"}}}):null,(0,r.jsx)(l.Z,{className:"resize-handle",role:"button",tabIndex:0,"aria-label":"Resize left edge",sx:{position:"absolute",left:-3,top:"50%",transform:"translateY(-50%)",width:"5px",backgroundColor:"#6290FF",cursor:s&&d?"ew-resize":"unset",borderRadius:"2px",height:"50%",minHeight:"20px",opacity:s&&"none"===D&&d?1:0,transition:"opacity 0.2s",zIndex:10},onMouseDown:e=>X(e,"left")}),(0,r.jsx)(l.Z,{className:"resize-handle",role:"button",tabIndex:0,"aria-label":"Resize right edge",sx:{position:"absolute",right:-3,top:"50%",transform:"translateY(-50%)",width:"5px",backgroundColor:"#6290FF",cursor:s&&d?"ew-resize":"unset",borderRadius:"2px",height:"50%",minHeight:"20px",opacity:s&&"none"===D&&d?1:0,transition:"opacity 0.2s",zIndex:10},onMouseDown:e=>X(e,"right")})]})},rg=n.memo(e=>{let{item:t,fps:i,framePerPixel:o,isSelected:a,containerSx:s,onResize:d,...c}=e,u=F.wK.use.mediaAssets(),p=F.wK.use.tracks(),m=F.wK.use.removeItemFromTrack(),x=F.wK.use.selectItem(),{operations:g}=(0,h.ZY)(),f=(0,iQ.K)(),{getItemVO:v,invalidateItemVOCache:b,transientState:y}=iN(),w=(0,n.useMemo)(()=>u.find(e=>e.id===t.mediaAssetId),[u,t.mediaAssetId]),C=(0,n.useMemo)(()=>v(t.id),[v,t.id]),{track:j,itemIndex:k}=(0,n.useMemo)(()=>{let e=p.find(e=>e.items.some(e=>e.id===t.id));return e?{track:e,itemIndex:e.items.findIndex(e=>e.id===t.id)}:{track:void 0,itemIndex:void 0}},[p,t.id]),[S,I]=(0,n.useState)(null),_=S??(t.durationInFrames/i).toFixed(1),Z=(0,n.useCallback)(()=>{if(!C)return;let e=y.getTransientWidth(t.id);void 0!==e&&I((C.durationInFrames/C.width*e/i).toFixed(1)),null==d||d()},[C,y,t.id,i,d]),{handleResize:A,handleResizeEnd:E,containerRef:M}=ra({item:t,itemVO:C,transientState:y,getItemVO:v,invalidateItemVOCache:b,operations:g,onResize:Z}),T=(0,n.useCallback)((e,t,i,r)=>{E(e,t,i,r),I(null)},[E]);(0,n.useEffect)(()=>(M.current&&y.registerElement(t.id,M.current),()=>{y.registerElement(t.id,null)}),[t.id,y,M]);let R=(0,n.useCallback)(()=>{g.batchOperation("Delete video",()=>{m(null==j?void 0:j.id,t.id,!0)}),x(null),f()},[null==j?void 0:j.id,t.id,m,x,g,f]);ro({itemId:t.id,isSelected:a,getItemVO:v,componentName:"TimelineTrackItemVideo"});let D=(0,n.useMemo)(()=>{switch(t.type){case"overlay":return(0,r.jsxs)(l.Z,{className:"overlay-placeholder",sx:{width:"100%",height:"100%",bgcolor:"#2e2e2e",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",padding:"4px"},children:[(0,r.jsx)(l.Z,{sx:{width:"36px",height:"20.7px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"37",height:"21",viewBox:"0 0 37 21",fill:"none",children:(0,r.jsx)("path",{d:"M28.7363 0C29.4479 0 30.0573 0.253699 30.5645 0.760742C31.0717 1.26796 31.3251 1.8771 31.3242 2.58789V8.41016L35.4004 4.33496C35.616 4.11931 35.8535 4.06503 36.1123 4.17285C36.3707 4.28067 36.4999 4.48553 36.5 4.78711V15.915C36.5 16.2168 36.3707 16.4214 36.1123 16.5293C35.8536 16.6371 35.616 16.5837 35.4004 16.3682L31.3242 12.292V18.1152C31.3241 18.8267 31.0707 19.4363 30.5645 19.9434C30.0582 20.4503 29.4487 20.703 28.7363 20.7021H3.08789C2.37629 20.7021 1.76707 20.4496 1.26074 19.9434C0.754506 19.4371 0.500976 18.8275 0.5 18.1152V2.58789C0.5 1.87624 0.75353 1.26709 1.26074 0.760742C1.76796 0.254392 2.3771 0.000862607 3.08789 0H12.9082L12.0068 3.30371L15.3105 6.60742L14.0508 9.30957L15.6113 13.5146L16.6729 9.61035L18.4746 6.60742L16.5117 3.9043L18.0137 0H28.7363Z",fill:"#888888"})})}),(0,r.jsx)(l.Z,{component:"p",sx:{color:"#aaaaaa",fontSize:"11px",fontWeight:500,fontFamily:"Inter, sans-serif",textAlign:"center",lineHeight:"normal",margin:0,minWidth:"min-content",maxHeight:"2.4em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical","&:hover":{overflow:"visible",whiteSpace:"normal",height:"auto",maxHeight:"none"}},children:"Generation failed. No credit used."})]});case"video":return(null==w?void 0:w.thumbnail_url)?(0,r.jsx)("img",{src:w.thumbnail_url,alt:"video thumbnail",style:{height:"100%",width:"100%",objectFit:"cover"}}):(0,r.jsx)(l.Z,{className:"video-placeholder",sx:{width:"100%",height:"100%",bgcolor:"primary.dark"}});case"image":return(null==w?void 0:w.url)?(0,r.jsx)("img",{src:w.url,alt:"preview",style:{height:"100%",width:"100%",objectFit:"contain"}}):(0,r.jsx)(l.Z,{className:"image-placeholder",sx:{width:"100%",height:"100%",bgcolor:"purple.dark"}});case"logo":return(0,r.jsx)(l.Z,{className:"logo-placeholder",sx:{width:"100%",height:"100%",bgcolor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:500,textAlign:"center",padding:"4px"},children:(0,r.jsx)("svg",{width:"40",height:"26",viewBox:"0 0 40 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M26.8739 4.94336C28.9767 4.94486 30.9938 5.77188 32.4843 7.24345C33.9748 8.71508 34.8183 10.7119 34.83 12.798C34.8244 14.3286 34.3706 15.8249 33.5236 17.1042C32.6766 18.3835 31.4726 19.3906 30.059 20.0036C28.6454 20.6167 27.083 20.8094 25.5613 20.5574C24.0395 20.3054 22.6243 19.6198 21.488 18.5845C20.0902 17.4273 18.6853 16.2867 17.2739 15.1623L19.2945 13.562C21.266 15.13 22.9757 16.5164 23.6494 17.0545C24.5755 17.7413 25.701 18.1131 26.8573 18.1135C29.7471 18.1132 32.3072 15.7199 32.2576 12.798C32.2477 11.8117 31.963 10.8476 31.4357 10.0114C30.9084 9.17523 30.1589 8.49936 29.2692 8.05914C28.3794 7.61897 27.3841 7.43147 26.3935 7.51672C25.4029 7.60204 24.4547 7.9568 23.6546 8.54255C19.3677 12.0722 14.9463 15.4861 10.5807 18.9116C8.81366 20.1465 6.71999 18.9319 6.71965 16.8868C6.69632 14.1672 6.69632 11.4487 6.71965 8.73302C6.72573 6.67911 8.81688 5.44978 10.5869 6.6793L15.3496 10.5072L13.3808 12.0869L9.27748 8.87483C9.2561 11.494 9.2561 14.1097 9.27748 16.7212C13.3922 13.5388 17.4838 10.319 21.4994 7.02089C22.9643 5.68349 24.8831 4.94168 26.8739 4.94336Z",fill:"white"})})});default:return(0,r.jsx)(l.Z,{className:"default-placeholder",sx:{width:"100%",height:"100%",bgcolor:"primary.dark"}})}},[t.type,null==w?void 0:w.thumbnail_url,null==w?void 0:w.url]);return(0,r.jsx)(l.Z,{ref:M,"data-timeline-item-id":t.id,sx:{position:"absolute",left:0,transform:C?`translateX(${C.left+O.p_/2}px)`:"none",width:C?`${Math.max(1,C.width-O.p_)}px`:0,height:`${O.gd}px`,top:0,bottom:0,"&:hover .video-overlay":{opacity:1},...s},className:"timeline-item-video",children:(0,r.jsx)(rx,{...c,isSelected:a,onResize:(e,i,r)=>{(null==j?void 0:j.id)?A(e,i,r,j.id,t.id):console.error("Cannot resize: track not found for item",t.id)},onResizeEnd:e=>{(null==j?void 0:j.id)&&void 0!==k?(T(e,j.id,t.id,k),f()):console.error("Cannot end resize: track not found for item",t.id)},onDelete:R,children:(0,r.jsxs)(l.Z,{sx:{position:"relative",width:"100%",height:"100%",overflow:"hidden",borderRadius:`${O.yy}px`,border:"none",backgroundColor:"#2e2e2e"},children:[D,"overlay"!==t.type&&"logo"!==t.type&&(0,r.jsxs)(l.Z,{className:"video-overlay",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:0,transition:"opacity 0.2s ease",...a&&{opacity:1}},children:[(0,r.jsx)(e1,{sx:{top:"4.69px",left:"4.69px",display:"none"},children:t.title||"Video"}),(0,r.jsxs)(e1,{sx:{bottom:"4.69px",right:"4.69px"},children:[_,"s"]})]})]})})})},(e,t)=>{var i,r,n,o;return e.item.id===t.item.id&&e.item.durationInFrames===t.item.durationInFrames&&e.item.startTimeInFrames===t.item.startTimeInFrames&&(null===(i=e.item)||void 0===i?void 0:i.sourceTrimStartFrames)===t.item.sourceTrimStartFrames&&(null===(r=e.item)||void 0===r?void 0:r.sourceTrimEndFrames)===t.item.sourceTrimEndFrames&&(null===(n=e.item)||void 0===n?void 0:n.mediaAssetId)===t.item.mediaAssetId&&(null===(o=e.item)||void 0===o?void 0:o.title)===t.item.title&&e.fps===t.fps&&e.containerSx===t.containerSx&&e.framePerPixel===t.framePerPixel&&e.isSelected===t.isSelected&&e.onResize===t.onResize});rg.displayName="TimelineTrackItemVideo";let rf=n.memo(e=>{let{track:t,fps:i,zoomLevel:o=1,framePerPixel:a,selectedItemIds:c,onSelectItem:u,trackLengthInPixel:p}=e,h=(0,F.wK)(e=>e.outputSettings.totalDurationInFrames),m=F.wK.use.mediaAssets(),x=F.wK.use.tracks(),g=i7({trackId:t.id,trackItems:t.items,trackKind:"video"}),f=(0,n.useMemo)(()=>(0,eg._3)(t.items,h,i),[t.items,h,i]),v=(0,n.useCallback)((e,t)=>{u&&u(e,t)},[u]),b=(0,n.useMemo)(()=>t.items.filter(e=>"video"===e.type||"image"===e.type||"overlay"===e.type||"logo"===e.type),[t.items]);return(0,r.jsx)(s.Z,{direction:"row",sx:{height:`${O.gd}px`,width:"100%"},children:(0,r.jsxs)(l.Z,{sx:{position:"relative",height:"100%",flexGrow:1,bgcolor:"grey.800","&:hover":{bgcolor:"grey.750"},width:"100%",overflow:"visible"},"data-track-id":t.id,"data-track-type":"video",children:[0===b.length&&(0,r.jsx)(d.Z,{variant:"caption",sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",color:"text.disabled",opacity:.4},children:"Empty video track. Drag video or image items from Media Library."}),b.map(e=>{let n=m.find(t=>t.id===e.mediaAssetId);return(0,r.jsx)(rg,{item:e,fps:i,framePerPixel:a,onSelect:t=>v(e.id,t.shiftKey),isSelected:(null==c?void 0:c.includes(e.id))??!1,allowResize:!0,dragData:{source:"timeline-item",timelineItemId:e.id,trackId:t.id,mediaAssetId:e.mediaAssetId,mediaAssetType:null==n?void 0:n.resource_type},onDrop:(t,i,r)=>g(t,i,r,e),isDropCompatible:e=>{let{source:i,mediaAssetType:r,trackId:n}=e;if("timeline-item"===i){if(!n)return!1;let e=x.find(e=>e.id.toLowerCase()===n.toLowerCase());return!!e&&e.type===t.type}return"media-asset"===i&&("video"===r||"image"===r)}},e.id)}),f.map(e=>(0,r.jsx)(rc,{gap:e,trackType:t.type,trackId:t.id,totalDurationInFrames:h,trackLengthInPixel:p,isPrimaryTrack:t.isPrimary,allowFreePositioning:(0,eg.yZ)(t)},e.id))]})})});rf.displayName="TimelineTrackVideo";let rv=(0,n.memo)(e=>{let{sx:t,title:i,children:n,width:o,height:a="auto"}=e;return(0,r.jsxs)(s.Z,{sx:{width:o,height:a,position:"relative",borderRadius:"12px",backgroundColor:"#1A1A1A",overflow:"hidden",...t},children:[i?(0,r.jsx)(l.Z,{sx:{backgroundColor:"#2E2E2E",borderRadius:"8px 8px 0 0",height:U.sq,display:"flex",alignItems:"center",justifyContent:"center",marginTop:0},children:i}):null,(0,r.jsx)(l.Z,{sx:{flex:1,position:"relative",height:`calc(100% - ${U.sq}px)`,overflow:"hidden"},children:n})]})});rv.displayName="TitlePane";var rb=i(85933),ry=i.n(rb);i(99916),i(16301),i(58069);var rw=i(40728),rC=i(62573);ry()(()=>i.e(8895).then(i.t.bind(i,38895,23)),{loadableGenerated:{webpack:()=>[38895]},ssr:!1});function rj(){let[e,t]=(0,n.useState)(!1),{data:i}=(0,k.$_)(),{renderVideo:r}=(0,G.z6)({userId:null==i?void 0:i.id}),[o,a]=((0,T.wK)((0,rw.N)(e=>({isLoading:e.isLoading,error:e.error,mediaAssets:e.mediaAssets,tracks:e.tracks,globalConfig:e.globalConfig,outputSettings:e.outputSettings,selectedItemIds:e.selectedItemIds,selectedMediaAssetId:e.selectedMediaAssetId,selectedGroupId:e.selectedGroupId,currentTimeInFrames:e.currentTimeInFrames,isPlaying:e.isPlaying,previewingMediaAsset:e.previewingMediaAsset,mediaAssetTab:e.mediaAssetTab}))),(0,n.useState)(0)),[s,l]=(0,n.useState)(()=>{{let e=localStorage.getItem("video-editor-devtools-position");return e?JSON.parse(e):{right:50,top:50}}}),d=(0,n.useRef)(null),[c,u]=(0,n.useState)(!1),[p,h]=(0,n.useState)(!1);return(0,n.useDeferredValue)(c),(0,n.useEffect)(()=>{let e=e=>{e.ctrlKey&&"d"===e.key&&(e.preventDefault(),t(e=>!e))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,n.useEffect)(()=>{let e=e=>{if(!c||!d.current)return;let t=e.clientX-d.current.x,i=e.clientY-d.current.y;Math.hypot(t,i)>5&&h(!0),l(e=>{let r=window.innerWidth,n=window.innerHeight;return{right:Math.min(Math.max(e.right-t,0),r-50),top:Math.min(Math.max(e.top+i,0),n-50)}}),d.current={x:e.clientX,y:e.clientY}},t=()=>{c&&(u(!1),d.current=null,localStorage.setItem("video-editor-devtools-position",JSON.stringify(s)))};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[s,c]),(0,n.useEffect)(()=>{let e=()=>{l(e=>{let t=window.innerWidth,i=window.innerHeight;return{right:Math.min(e.right,t-50),top:Math.min(e.top,i-50)}})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),null}},16581:function(e,t,i){i.d(t,{BY:function(){return h},Bx:function(){return b},Fp:function(){return x},H6:function(){return j},Kz:function(){return C},UG:function(){return y},Yi:function(){return F},ZR:function(){return s},Zk:function(){return l},d1:function(){return c},ep:function(){return o},ew:function(){return u},gI:function(){return d},gd:function(){return a},hn:function(){return p},p_:function(){return g},q:function(){return m},sG:function(){return k},sq:function(){return n},tj:function(){return v},wf:function(){return w},y5:function(){return S},yy:function(){return f}});var r=i(77913);let n=45,o=67,a=80,s=30,l=30,d=40,c=40,u=12,p=10,h=42,m=12,x=54,g=6,f=4,v=.2,b=290;r.UG;let y=r.UG,w=r.wf,C={...r.Kz,fps:r.Oq},j=3,k=2,F={"image/jpeg":"image","image/jpg":"image","image/png":"image","image/gif":"image","image/webp":"image","video/mp4":"video","video/webm":"video","video/mov":"video","video/quicktime":"video","video/avi":"video","audio/mp3":"music","audio/wav":"music","audio/aac":"music","audio/ogg":"music","audio/mpeg":"music"},S={video:{acceptedTypes:["video/mp4","video/webm","video/mov","video/avi","video/quicktime"],maxFileSize:209715200},image:{acceptedTypes:["image/jpeg","image/jpg","image/png","image/gif","image/webp"],maxFileSize:10485760},audio:{acceptedTypes:["audio/mp3","audio/wav","audio/aac","audio/ogg","audio/mpeg"],maxFileSize:10485760},file:{acceptedTypes:[],maxFileSize:0}}},98939:function(e,t,i){i.d(t,{Bx:function(){return r.Bx},DG:function(){return n.DG},Fp:function(){return r.Fp},H6:function(){return r.H6},L5:function(){return n.L5},UG:function(){return r.UG},Xm:function(){return n.Xm},Xq:function(){return n.Xq},ZR:function(){return r.ZR},Zk:function(){return r.Zk},aD:function(){return n.aD},ew:function(){return r.ew},gI:function(){return r.gI},gd:function(){return r.gd},hn:function(){return r.hn},nw:function(){return n.nw},p_:function(){return r.p_},tj:function(){return r.tj},y5:function(){return r.y5},yy:function(){return r.yy}});var r=i(16581);i(94372);var n=i(17856)},83918:function(e,t,i){i.d(t,{O:function(){return a}});var r=i(53778),n=i(77913),o=i(95239);class a{get mediaAssets(){return this._timelineData.mediaAssets}get mediaAssetMap(){return new Map(this.mediaAssets.map(e=>[e.id,e]))}get tracks(){return this._timelineData.tracks}get data(){return this._timelineData}get mediaAssetInUse(){let e=new Set(this.tracks.flatMap(e=>e.items.map(e=>e.mediaAssetId)));return this.mediaAssets.filter(t=>e.has(t.id))}get totalDurationInFrames(){let e=0;return this.tracks.forEach(t=>{t.items.forEach(t=>{let i=t.startTimeInFrames+t.durationInFrames;i>e&&(e=i)})}),e}get totalDurationInSeconds(){return this.totalDurationInFrames/a.FPS}get groupInfoMap(){let e=new Map;return this.tracks.forEach(t=>{t.items.forEach(i=>{if(i.groupId){if(e.has(i.groupId)){let r=e.get(i.groupId);r&&(r.groupItems.push(i),r.trackIds.push(t.id),r.startTimeInFrames=Math.min(r.startTimeInFrames,i.startTimeInFrames),r.endTimeInFrames=Math.max(r.endTimeInFrames,i.startTimeInFrames+i.durationInFrames),r.indexInTrack.push(t.items.indexOf(i)),r.isOrphaned=!1)}else e.set(i.groupId,{groupId:i.groupId,groupItems:[i],trackIds:[t.id],startTimeInFrames:i.startTimeInFrames,endTimeInFrames:i.startTimeInFrames+i.durationInFrames,indexInTrack:[t.items.indexOf(i)],isOrphaned:!0})}})}),e}get validGroupInfoMap(){return new Map(Array.from(this.groupInfoMap.values()).filter(e=>e.groupItems.length>1).map(e=>[e.groupId,e]))}get hasGroups(){return this.validGroupInfoMap.size>0}get hasVoiceoverTrack(){return this.tracks.some(e=>"audio"===e.type&&"voiceover"===e.subtype)}get dimensions(){let e=this.mediaAssetMap,t=1280,i=720,r=null,n=null;return this.tracks.filter(e=>"video"===e.type).forEach(t=>{t.items.filter(e=>"video"===e.type||"logo"===e.type).forEach(t=>{let i=e.get((null==t?void 0:t.mediaAssetId)||"");if((null==t?void 0:t.mediaAssetId)&&i&&i.metadata){let e=i.metadata;e.width&&e.height&&((null===r||e.width<r)&&(r=e.width),(null===n||e.height<n)&&(n=e.height))}})}),r&&n&&(t=r,i=n),{width:t,height:i}}get aspectRatio(){let{width:e,height:t}=this.dimensions,i=(e,t)=>0===t?e:i(t,e%t),r=i(e,t),n=e/r,o=t/r;return`${n}:${o}`}getTrackCategory(e){return o.wD.getTrackCategory(e,this.mediaAssets)}findGroupsInFrameRange(e,t){let i=e??0,r=t??this.totalDurationInFrames;return Array.from(this.validGroupInfoMap.values()).filter(e=>e.startTimeInFrames>=i&&e.startTimeInFrames<=r)}updateFromShotMap(e){return this}isSimpleScenario(e){if(!this.hasVoiceoverTrack)return!0;if(!e)return!1;let t=this.tracks.find(t=>t.id===e);return t?"audio"===t.type&&"music"===t.subtype:(this._log("isSimpleScenario: track not found",{trackId:e}),!0)}isComplexScenario(e){return!this.isSimpleScenario(e)}_log(e,t){this._debug&&void 0!==t&&Array.isArray(t)}_findGroupById(e,t){return this.groupInfoMap.get(e)||(this._log(`${t}: group not found`,{groupId:e}),null)}_findTrack(e,t){return this.tracks.find(t=>t.id===e)||(this._log(`${t}: track not found`,{trackId:e}),null)}_findItemIndex(e,t,i){let r=e.items.findIndex(e=>e.id===t);return -1===r&&this._log(`${i}: item not found`,{trackId:e.id,itemId:t}),r}_validateIndexRange(e,t,i,r){return!(e<0)&&!(e>=t)||(this._log(`${r}: ${i} out of range`,{[i]:e,length:t}),!1)}_validateFramePosition(e,t){return!(e<0)||(this._log(`${t}: negative target position`,{targetFramePosition:e}),!1)}_validateFrameRange(e,t,i){return!(e>t)||(this._log(`${i}: invalid frame range`,{frameRangeStart:e,frameRangeEnd:t}),!1)}_updateTracksTypeAndSubtype(){this._timelineData.tracks.forEach(e=>{if("video"!==e.type){if("audio"===e.type){let t=e.items[0];if(!t){e.subtype="music";return}let i=this.mediaAssets.find(e=>e.id===t.mediaAssetId);if(!i){e.subtype="music";return}"voiceover"===i.subtype?e.subtype="voiceover":(i.subtype,e.subtype="music");return}"file"!==e.type&&(e.type="video")}}),this._log("_updateTracksTypeAndSubtype: tracks updated",{tracks:this._timelineData.tracks.map(e=>({id:e.id,type:e.type,subtype:e.subtype,itemCount:e.items.length}))})}shiftItemsInTimeRange(e,t,i,r){let n=Array.isArray(r)?r:[r];if(!this._validateFrameRange(e,t,"shiftItemsInTimeRange"))return this;if(0===i)return this._log("shiftItemsInTimeRange: no shift needed",{shiftFrames:i}),this;let o=0;return n.forEach(r=>{let n=this._findTrack(r,"shiftItemsInTimeRange");if(!n)return;let a=0;n.items.forEach(r=>{if(r.startTimeInFrames>=e&&r.startTimeInFrames<=t){let e=r.startTimeInFrames;r.startTimeInFrames+=i,r.startTimeInFrames<0&&(this._log("shiftItemsInTimeRange: preventing negative start time",{itemId:r.id,oldStartTime:e,newStartTime:r.startTimeInFrames}),r.startTimeInFrames=0),a++,o++}}),this._log("shiftItemsInTimeRange: track processed",{trackId:r,affectedItems:a})}),this._log("shiftItemsInTimeRange: completed",{frameRangeStart:e,frameRangeEnd:t,shiftFrames:i,trackIds:n,totalAffectedItems:o}),this}filterTracksByType(e){let t=this._timelineData.tracks.filter(t=>t.type===e);return new a({...this._timelineData,tracks:t},this._debug)}updateSubsequentItemStartTimes(e,t){let i=this._findTrack(e,"updateSubsequentItemStartTimes");if(!i||!this._validateIndexRange(t,i.items.length,"fromIndex","updateSubsequentItemStartTimes"))return this;for(let e=t;e<i.items.length;e++)if(0===e)i.items[e].startTimeInFrames=0;else{let t=i.items[e-1];i.items[e].startTimeInFrames=t.startTimeInFrames+t.durationInFrames}return this._log("updateSubsequentItemStartTimes: success",{trackId:e,fromIndex:t}),this}moveItemInTrackByIndex(e,t,i){let r=this._findTrack(e,"moveItemInTrackByIndex");if(!r)return this;let n=this._findItemIndex(r,t,"moveItemInTrackByIndex");if(-1===n||!this._validateIndexRange(i,r.items.length,"targetIndex","moveItemInTrackByIndex"))return this;if(i===n)return this._log("moveItemInTrackByIndex: target index same as current index",{trackId:e,itemId:t,targetIndex:i,currentIndex:n}),this;let[o]=r.items.splice(n,1);r.items.splice(i,0,o);let a=Math.min(n,i);return this.updateSubsequentItemStartTimes(e,a),this._log("moveItemInTrackByIndex: success",{trackId:e,itemId:t,currentIndex:n,targetIndex:i,startIndex:a}),this}moveItemInTrackByFramePosition(e,t,i){let r;let n=this._findTrack(e,"moveItemInTrackByFramePosition");if(!n)return this;let o=this._findItemIndex(n,t,"moveItemInTrackByFramePosition");if(-1===o||!this._validateFramePosition(i,"moveItemInTrackByFramePosition"))return this;let a=n.items[o],s=a.startTimeInFrames,l=s+a.durationInFrames;if(i>=s-10&&i<=l+10)return this._log("moveItemInTrackByFramePosition: target position within current item range",{trackId:e,itemId:t,targetFramePosition:i,originalStartFrame:s,originalEndFrame:l,errorMargin:10}),this;let d=this.isComplexScenario(e)?this.tracks.filter(e=>"video"===e.type||"audio"===e.type):this.tracks,c=[0];d.forEach(e=>{e.items.forEach(e=>{c.push(e.startTimeInFrames),c.push(e.startTimeInFrames+e.durationInFrames)})});let u=[...new Set(c)].sort((e,t)=>e-t);if(!u.includes(i))return this._log("moveItemInTrackByFramePosition: invalid target position",{trackId:e,itemId:t,targetFramePosition:i,validPositions:u,relevantTracksCount:d.length}),this;let p=i<s;if(r=p?i:i-a.durationInFrames,p){let t=s-1;r<=t&&this.shiftItemsInTimeRange(r,t,a.durationInFrames,e)}else{let t=i-1;l<=t&&this.shiftItemsInTimeRange(l,t,-a.durationInFrames,e)}return a.startTimeInFrames=r,n.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),this._log("moveItemInTrackByFramePosition: completed",{trackId:e,itemId:t,targetFramePosition:i,originalStartFrame:s,originalEndFrame:l,movingLeft:p,newStartFrame:r}),this}reorderByMoveItem(e,t,i){let r=this._findTrack(e,"reorderByMoveItem");if(!r)return this;let n=this._findItemIndex(r,t,"reorderByMoveItem");if(-1===n||!this._validateIndexRange(i,r.items.length,"targetIndex","reorderByMoveItem"))return this;if(i===n)return this._log("reorderByMoveItem: target index same as current index",{trackId:e,itemId:t,targetIndex:i,itemIndex:n}),this;let o=r.items[n];if(this.isSimpleScenario(e))return this._log("reorderByMoveItem: simple scenario",{trackId:e}),this.moveItemInTrackByIndex(e,t,i);this._log("reorderByMoveItem: complex scenario",{trackId:e});let a=null;if("video"===r.type?a=this.tracks.find(e=>"audio"===e.type&&"voiceover"===e.subtype)||null:"audio"===r.type&&"voiceover"===r.subtype&&(a=this.tracks.find(e=>"video"===e.type)||null),!a)return this._log("reorderByMoveItem: corresponding track not found",{trackId:e,trackType:r.type}),this.moveItemInTrackByIndex(e,t,i);let s=0;if(i>0){let e=r.items[i-1];s=e.startTimeInFrames+e.durationInFrames}let l=null;if(o.groupId&&(l=a.items.find(e=>e.groupId===o.groupId)||null),l||(l=a.items.find(e=>{let t=Math.abs(e.startTimeInFrames-o.startTimeInFrames),i=Math.abs(e.durationInFrames-o.durationInFrames);return t<=10&&i<=10})||null),l)this._log("reorderByMoveItem: found corresponding item, moving both",{itemId:t,correspondingItemId:l.id,targetFramePosition:s}),this.moveItemInTrackByFramePosition(e,t,s),this.moveItemInTrackByFramePosition(a.id,l.id,s);else{let i,r,n;this._log("reorderByMoveItem: no corresponding item found, syncing tracks",{itemId:t,targetFramePosition:s});let l=o.startTimeInFrames,d=l+o.durationInFrames;this.moveItemInTrackByFramePosition(e,t,s),s<l?(i=s,r=l-1,n=o.durationInFrames):(i=d,r=s-1,n=-o.durationInFrames),i<=r&&this.shiftItemsInTimeRange(i,r,n,a.id)}return this._log("reorderByMoveItem: completed",{trackId:e,itemId:t,targetIndex:i,targetFramePosition:s,hasCorrespondingItem:!!l}),this}reorderByMoveItemGroup(e,t){if(!e)return this._log("reorderByMoveItemGroup: invalid groupId",{groupId:e}),this;if(!this._validateFramePosition(t,"reorderByMoveItemGroup"))return this;let i=this._findGroupById(e,"reorderByMoveItemGroup");if(!i)return this;if(i.isOrphaned)return this._log("reorderByMoveItemGroup: group is orphaned, skipping",{groupId:e}),this;if(t===i.startTimeInFrames)return this._log("reorderByMoveItemGroup: target position same as current",{groupId:e,targetFramePosition:t,currentStartFrame:i.startTimeInFrames}),this;let r=[0];return(this.tracks.forEach(t=>{t.items.forEach(t=>{t.groupId!==e&&r.push(t.startTimeInFrames+t.durationInFrames)})}),r.includes(t))?(i.groupItems.forEach(i=>{let r=this.tracks.find(e=>e.items.some(e=>e.id===i.id));r&&(this._log("reorderByMoveItemGroup: moving item in group",{groupId:e,itemId:i.id,trackId:r.id,targetFramePosition:t}),this.moveItemInTrackByFramePosition(r.id,i.id,t))}),this._log("reorderByMoveItemGroup: completed",{groupId:e,targetFramePosition:t,groupItemsCount:i.groupItems.length,trackIds:i.trackIds})):this._log("reorderByMoveItemGroup: invalid target position",{groupId:e,targetFramePosition:t,validTargetPositions:r}),this}constructor(e,t=!0){this._debug=!1,this._timelineData=(0,r.Z)(e),this._debug=t,this._updateTracksTypeAndSubtype()}}a.FPS=n.UG},94372:function(e,t,i){i.d(t,{N:function(){return m}});var r=i(68836),n=i.n(r),o=i(98939),a=i(52846),s=i(75635);let l=null,d=null,c=async()=>{if(l)return l;if(!d){let e=new a.FFmpeg;d=e.load().then(()=>{l=e}).catch(e=>{throw l=null,d=null,e})}if(await d,!l)throw Error("Failed to initialize FFmpeg.");return l},u=e=>{let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)},p=async e=>{if(!e.type.startsWith("video/")||"video/mp4"===e.type)return e;let t=await c(),i=`input_${Date.now()}`,r=`output_${Date.now()}.mp4`;try{await t.writeFile(i,await (0,s.fetchFile)(e));let n=["-i",i,"-c:v","libx264","-preset","fast","-profile:v","main","-pix_fmt","yuv420p","-c:a","aac","-movflags","+faststart","-y",r];await t.exec(n);let o=await t.readFile(r),a=new Blob([o],{type:"video/mp4"}),l=`${u(e.name)||"video"}.mp4`;return new File([a],l,{type:"video/mp4"})}catch(e){throw Error(e instanceof Error?e.message:"Video transcode failed, please try again.")}finally{try{await t.deleteFile(i)}catch{}try{await t.deleteFile(r)}catch{}}};async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{onProgress:i}=t,{uploadUrl:r,url:o}=(await n().post("/api/media/resumable_upload_file",{mimetype:e.type,originalname:e.name,contentType:e.type,fileSize:e.size})).data;return await new Promise((t,n)=>{let o=new XMLHttpRequest;o.upload.addEventListener("progress",e=>{if(e.lengthComputable){let t=Math.round(100*e.loaded/e.total);null==i||i(t)}}),o.addEventListener("load",()=>{o.status>=200&&o.status<300?t():n(Error(`Upload failed: ${o.statusText}`))}),o.addEventListener("error",()=>{n(Error("Upload failed due to network error"))}),o.open("PUT",r),o.setRequestHeader("Content-Type",e.type||"application/octet-stream"),o.send(e)}),{success:!0,url:o,fileSize:e.size,mimeType:e.type,fileName:e.name}}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{onProgress:i}=t,{validFiles:r,errors:n}=(0,o.L5)(e,o.y5),a=e.filter(e=>!r.includes(e)),s=[];for(let[e,t]of a.entries()){let r=n[e]||"Invalid file type";s.push({file:t,success:!1,error:r}),null==i||i({fileName:t.name,progress:100,completed:!0,error:r})}if(0===r.length)return{totalFiles:e.length,successCount:0,failureCount:s.length,results:s,shouldSwitchTab:!1,targetTab:void 0};let l=[],d=[],c=[],u=o.y5.video.maxFileSize;for(let e of r){if(e.type.startsWith("video/")&&"video/mp4"!==e.type){try{let t=await p(e);if(t.size>u){let t=`Converted video exceeds ${Math.round(u/1048576)}MB limit.`;null==i||i({fileName:e.name,progress:100,completed:!0,error:t}),c.push({file:e,success:!1,error:t})}else l.push({original:e,processed:t})}catch(r){let t=r instanceof Error?r.message:"Failed to convert video to MP4";null==i||i({fileName:e.name,progress:100,completed:!0,error:t}),d.push({file:e,success:!1,error:t})}continue}if(e.type.startsWith("video/")&&e.size>u){let t=`Video exceeds ${Math.round(u/1048576)}MB limit.`;null==i||i({fileName:e.name,progress:100,completed:!0,error:t}),c.push({file:e,success:!1,error:t})}else l.push({original:e,processed:e})}if(0===l.length)return{totalFiles:e.length,successCount:0,failureCount:s.length+d.length+c.length,results:[...s,...d,...c],shouldSwitchTab:!1,targetTab:void 0};r.forEach(e=>{null==i||i({fileName:e.name,progress:0,completed:!1})});let m=l.map(async e=>{let{original:t,processed:r}=e;try{let e=await h(r,{onProgress:e=>{null==i||i({fileName:t.name,progress:e,completed:!1})}});return null==i||i({fileName:t.name,progress:100,completed:!0,url:e.url}),{file:t,success:!0,url:e.url}}catch(r){let e=r instanceof Error?r.message:"Upload failed";return null==i||i({fileName:t.name,progress:100,completed:!0,error:e}),{file:t,success:!1,error:e}}}),x=[...s,...d,...c,...await Promise.all(m)],g=x.filter(e=>e.success).length,f=x.length-g;return{totalFiles:e.length,successCount:g,failureCount:f,results:x,shouldSwitchTab:!1,targetTab:void 0}}},17856:function(e,t,i){i.d(t,{AO:function(){return I},BU:function(){return l},DG:function(){return g},E9:function(){return W},GQ:function(){return y},H7:function(){return s},JO:function(){return w},L5:function(){return b},MH:function(){return A},NN:function(){return Z},R$:function(){return d},Ru:function(){return C},Tp:function(){return S},WM:function(){return h},Xm:function(){return D},Xq:function(){return x},YI:function(){return k},_3:function(){return _},aD:function(){return R},bM:function(){return p},eN:function(){return c},f8:function(){return L},fu:function(){return P},hb:function(){return j},mM:function(){return z},n3:function(){return u},nw:function(){return f},sy:function(){return m},tn:function(){return E},yZ:function(){return a}});var r=i(67197),n=i(29799),o=i(16581);let a=e=>!e.isPrimary&&"caption"!==e.subtype,s=(e,t,i,r)=>{let n=e.filter(e=>e.id!==r).sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),o=t,a=o+i;for(let e of n){let t=e.startTimeInFrames,i=t+e.durationInFrames;if(t>=a)break;i<=o||(o=Math.max(o,i))}return o},l=(e,t,i,r,n)=>{let o,a;let s=e.find(e=>e.id===r);return!!s&&("before"===i?o=(a=s.startTimeInFrames)-t:a=(o=s.startTimeInFrames+s.durationInFrames)+t,!(o<0)&&!e.some(e=>{if(e.id===r||n&&e.id===n)return!1;let t=e.startTimeInFrames+e.durationInFrames;return!(a<=e.startTimeInFrames||o>=t)}))},d=(e,t,i,r,n,o,s,d,c,u,p)=>{let h=o.tracks.find(e=>e.id===t),m=o.tracks.find(e=>e.id===i);if(!h||!m||h.type!==m.type||!a(m)||!e.timelineItemId)return!1;let x=function(e,t,i){var r;let n=Math.max(1,Math.floor(t)),o=(null===(r=e.selectedItemIds)||void 0===r?void 0:r.length)??1;if(!i||!Array.isArray(i))return n*o;if(e.timelineItemId){let t=i.flatMap(e=>e.items).find(t=>t.id===e.timelineItemId);return(null==t?void 0:t.durationInFrames)??n}if(e.selectedItemIds&&e.selectedItemIds.length>1){let t=i.flatMap(e=>e.items).filter(t=>{var i;return null===(i=e.selectedItemIds)||void 0===i?void 0:i.includes(t.id)});if(0===t.length)return n*e.selectedItemIds.length;let r=t.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),o=r[0].startTimeInFrames,a=r.at(-1);return Math.max(Math.max(0,a.startTimeInFrames+a.durationInFrames-o),n*t.length)}return n}(e,u,p),g="before"===n?r.startTimeInFrames-x:r.startTimeInFrames+r.durationInFrames,f=e.timelineItemId&&t===i?e.timelineItemId:void 0;return!!(g>=0&&l(m.items,x,n,r.id,f))&&("before"!==n||!(g<0))&&(s.batchOperation(c.reorder,()=>{let r=e.selectedItemIds&&e.selectedItemIds.length>1?e.selectedItemIds:[e.timelineItemId];r.forEach(e=>o.removeItemFromTrack(t,e,!0)),r.forEach(e=>{let t=h.items.find(t=>t.id===e)||o.tracks.flatMap(e=>e.items).find(t=>t.id===e);if(!t)return;let r={...t,startTimeInFrames:g};o.addItemToTrack(i,r)})}),d(),!0)},c=(e,t,i)=>{let r=e.find(e=>e.id===i);if(!r)return 0;let n=[...e].sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),o=n.findIndex(e=>e.id===i);if("before"===t){if(0===o)return r.startTimeInFrames;{let e=n[o-1],t=e.startTimeInFrames+e.durationInFrames;return Math.max(0,r.startTimeInFrames-t)}}{let e=r.startTimeInFrames+r.durationInFrames;return o===n.length-1?Number.MAX_SAFE_INTEGER:Math.max(0,n[o+1].startTimeInFrames-e)}};function u(e,t){let i=e/t;return{aspectRatio:i,isPortrait:i<1,isLandscape:i>=1}}function p(e,t){let i,r,n;let{isLandscape:o}=u(e,t);return o?(i=Math.max(24,Math.min(e/1920*54,72)),r="70%",n=4):(i=Math.max(16,Math.min(e/416*22,48)),r="74%",n=12),{fontSize:i,captionWidth:r,bottomPercentage:n}}function h(e,t){let i=e/22;return{color:"#ffffff",fontSize:`${e}px`,fontFamily:"Inter",fontWeight:"800",textAlign:"center",maxWidth:t,borderRadius:"4px",lineHeight:"1.3",textShadow:`rgba(0, 0, 0, 0.17) ${0*i}px ${0*i}px ${4*i}px`,WebkitTextStroke:"1px rgba(0, 0, 0, 0.15)",whiteSpace:"pre-wrap",wordBreak:"break-word"}}function m(e){let{width:t,height:i}=e,{fontSize:r,captionWidth:n}=p(t,i);return h(r,n)}function x(e,t,i){let r=i/t.fps,n=e.durationInFrames*e.speed/Math.max(1,e.sourceTrimEndFrames-e.sourceTrimStartFrames),o=t.fps?r:n,a=Math.max(0,e.sourceTrimStartFrames*o||0);return{startFrom:a,endAt:a+e.durationInFrames}}let g=(e,t)=>{let i=Math.floor(e/t);return`${Math.floor(i/60).toString().padStart(2,"0")}:${(i%60).toString().padStart(2,"0")}:${Math.floor(e%t).toString().padStart(2,"0")}`},f=e=>!!e&&e.types.includes("Files"),v=e=>e.type.startsWith("video/")?"video":e.type.startsWith("image/")?"image":e.type.startsWith("audio/")?"audio":null,b=(e,t)=>{let i;let r=[],n=[];for(let o of e){let e=v(o);if(!e){n.push(`Unsupported file type: ${o.name}`);continue}i||(i=e);let a=t[e];if(!a||0===a.acceptedTypes.length){n.push(`${e} uploads not supported yet`);continue}if(o.size>a.maxFileSize){let e=Math.round(a.maxFileSize/1048576);n.push(`${o.name} is too large (max ${e}MB)`);continue}if(!a.acceptedTypes.some(e=>e.endsWith("/*")?o.type.startsWith(e.replace("/*","/")):o.type===e)){n.push(`${o.name} type not supported for ${e}`);continue}r.push(o)}return{validFiles:r,errors:n,detectedType:i,hasValidFiles:r.length>0}};function y(e,t,i){let r=Array.isArray(e)?e:[],n=Array.isArray(t)?t:[],a=e=>e%2==0?e:e-1,s=new Map(n.map(e=>[e.id,e])),l=0;r.forEach(e=>{e.items.forEach(e=>{let t=e.startTimeInFrames+e.durationInFrames;t>l&&(l=t)})});let d=Math.max(Math.ceil(l),o.sG*o.UG),c=null==i?void 0:i.aspectRatio;if(c){let e=0,t=0;for(let i of r)for(let r of i.items){if(!["video","image","logo"].includes(r.type)||"status"in r&&"failed"===r.status||!r.mediaAssetId)continue;let i=s.get(r.mediaAssetId);if(!i)continue;let n=i.metadata,o=Math.floor(((null==n?void 0:n.width)??i.width)||0),a=Math.floor(((null==n?void 0:n.height)??i.height)||0);o&&a&&(o>e&&(e=o),a>t&&(t=a))}e<=0&&t<=0&&(e=1280,t=720);let i=function(e){let t=e.trim().match(/^(\d+)\s*[:x/]\s*(\d+)$/i);if(!t)return null;let i=Number(t[1]),r=Number(t[2]);return!Number.isFinite(i)||!Number.isFinite(r)||i<=0||r<=0?null:{w:i,h:r}}(c);if(i){let r=i.w,n=i.h,o=Math.max(2,e),s=Math.ceil(o*n/r);return s<Math.max(2,t)&&(o=Math.ceil((s=Math.max(2,t))*r/n)),{width:a(o),height:a(s),aspectRatio:c,totalDurationInFrames:d}}}let u=1280,p=720,h=r.find(e=>"video"===e.type);if(h){let e=h.items.filter(e=>"failed"!==e.status&&["video","image","logo"].includes(e.type)&&!!e.mediaAssetId),t=null;for(let i of e){let e=i.mediaAssetId?s.get(i.mediaAssetId):void 0;if(!e)continue;let r=e.metadata,n=Math.floor(((null==r?void 0:r.width)??e.width)||0),o=Math.floor(((null==r?void 0:r.height)??e.height)||0);n&&o&&(!t||n*o>t.width*t.height)&&(t={width:n,height:o})}t&&(u=t.width,p=t.height)}let m=Math.max(2,a(u)),x=Math.max(2,a(p)),g=((e,t)=>{let i=(e,t)=>0===t?e:i(t,e%t),r=i(e,t),n=e/r,o=t/r;return`${n}:${o}`})(m,x);return{width:m,height:x,aspectRatio:g,totalDurationInFrames:d}}let w=(e,t)=>{switch(t){case"video":return"video"===e||"image"===e;case"audio":return"audio"===e;default:return!1}},C=(e,t,i)=>{let r=(e-t.left)/t.width;return r<.25?{type:"insert-before",itemId:"",insertIndex:i}:r>.75?{type:"insert-after",itemId:"",insertIndex:i+1}:{type:"replace",itemId:"",insertIndex:i}},j=(e,t)=>{if(0===e)return 0;if(e>=t.length){if(0===t.length)return 0;let e=t.at(-1);return e.startTimeInFrames+e.durationInFrames}let i=t[e-1];return i.startTimeInFrames+i.durationInFrames},k=function(e,t,i){var n;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.UG,s="video"===e.resource_type?"video":"audio"===e.resource_type?"audio":"image",l="image"===s?a*o.H6:Math.floor(((null===(n=e.metadata)||void 0===n?void 0:n.duration)||0)*a),d=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.UG;switch(t){case"image":return i||r*o.H6;case"audio":var n;return i||Math.floor(((null===(n=e.metadata)||void 0===n?void 0:n.duration)||0)*r);case"video":let a=F(e),s=a/e.metadata.fps*r/1;if(void 0!==i&&i<s)return a/s*i;return a;default:return 0}}(e,s,i,a);return{id:(0,r.x0)(),mediaAssetId:e.id,shotId:e.shot_id,type:s,title:e.title||e.id,startTimeInFrames:t,durationInFrames:i||l,sourceTrimStartFrames:0,sourceTrimEndFrames:d,speed:1,volume:1}};function F(e){let t=null==e?void 0:e.metadata;return t&&t?(null==t?void 0:t.frames)??(null==t?void 0:t.duration)*(null==t?void 0:t.fps):0}let S=e=>{try{let t=e.getData("application/json");if(!t)return null;let i=JSON.parse(t);if(!i.source||"media-asset"===i.source&&(!i.mediaAssetId||!i.mediaAssetType)||"timeline-item"===i.source&&!i.timelineItemId)return null;return i}catch{return null}},I=(e,t)=>{for(let i=t;i<e.length;i++)if(0===i)e[i].startTimeInFrames=0;else{let t=e[i-1];e[i].startTimeInFrames=t.startTimeInFrames+t.durationInFrames}},_=function(e,t){let i,n;arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UG;let a=[],s=[...e].sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames);if(s.length>0){let e=s[0];e.startTimeInFrames>0&&a.push({id:(0,r.x0)(),startTimeInFrames:0,endTimeInFrames:e.startTimeInFrames,durationInFrames:e.startTimeInFrames,type:"middle",insertIndex:0})}for(let e=0;e<s.length;e++){let t=s[e],i=s[e+1];if(i){let n=t.startTimeInFrames+t.durationInFrames,o=i.startTimeInFrames;o>n&&a.push({id:(0,r.x0)(),startTimeInFrames:n,endTimeInFrames:o,durationInFrames:o-n,type:"middle",insertIndex:e+1})}}if(0===s.length)i=0,n=t*(1+o.tj);else{let e=s.at(-1);i=e.startTimeInFrames+e.durationInFrames,n=t*(1+o.tj)-i}return a.push({id:(0,r.x0)(),startTimeInFrames:i,endTimeInFrames:i+n,durationInFrames:n,type:"end",insertIndex:s.length}),a};function Z(e){let t=new Map;e.forEach(e=>{let i;for(let t of e.items)if(t.groupId){i=t.groupId;break}i&&t.set(e.id,i)});let i=new Map,r=[];e.forEach(e=>{let n=t.get(e.id);n?(i.has(n)||i.set(n,[]),i.get(n).push(e)):r.push(e)});let n=(e,t)=>e.isPrimary&&!t.isPrimary?-1:!e.isPrimary&&t.isPrimary?1:0,o=[],a=[];i.forEach(e=>{e.sort(n),e.length>1?o.push(e):a.push(...e)});let s=[...r,...a];s.sort(n);let l=[];return o.forEach(e=>{l.push(...e)}),l.push(...s),{flatList:l,groupedTracks:o,singleTracks:s}}let A=e=>{try{let t=Array.from(e.types).filter(e=>e.startsWith("type/"));if(0===t.length)return null;let i=t[0].split("/");if(i.length<2)return null;let r=i[1];if("video"===r||"audio"===r||"image"===r)return{source:"media-asset",mediaAssetType:r};if("timeline-item"===r){let e=i[2];if(!e)return null;return{source:"timeline-item",trackId:e}}if("timeline-group"===r){let e=i[2];if(!e)return null;return{source:"timeline-group",groupId:e}}return null}catch{return null}},E=(e,t)=>{let i;if(e.setData("application/json",JSON.stringify(t)),"media-asset"===t.source&&t.mediaAssetType)i=`type/${t.mediaAssetType}`;else if("timeline-item"===t.source&&t.trackId)i=`type/timeline-item/${t.trackId}`;else if("timeline-group"===t.source&&t.groupId)i=`type/timeline-group/${t.groupId}`;else{console.warn("⚠️ [setDragDataWithType] Invalid drag data or missing required fields:",{source:t.source,mediaAssetType:t.mediaAssetType,trackId:t.trackId,groupId:t.groupId});return}e.setData(i,"")},M=n.oY.bezier(.3,.83,1,1),T=n.oY.bezier(.83,.3,1,1);function R(e,t){return t<=0?1:(0,n.sX)(e,[0,t],[0,1],{extrapolateLeft:"clamp",extrapolateRight:"clamp",easing:M})}function D(e,t,i){return t<=0?1:(0,n.sX)(e,[i-t,i],[1,0],{extrapolateLeft:"clamp",extrapolateRight:"clamp",easing:T})}function z(e,t){if(e.length<2)return{isValid:!1};let i=[];for(let r of t)for(let t of r.items)e.includes(t.id)&&i.push({item:t,track:r});if(i.length!==e.length)return{isValid:!1};let r=i[0].track.id;if(!i.every(e=>{let{track:t}=e;return t.id===r}))return{isValid:!1};let n=[...i[0].track.items].sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),o=-1,a=-1;for(let[t,i]of n.entries())e.includes(i.id)&&(-1===o&&(o=t),a=t);for(let t=o;t<=a;t++)if(!e.includes(n[t].id))return{isValid:!1};return{isValid:!0,trackId:r}}function P(e,t,i,r){let n=[...e];if(-1===n.findIndex(e=>e.id===i))return console.warn(`Target item not found for reorder: targetItemId=${i}`),e;let o=[],a=[];for(let e of n)t.includes(e.id)?o.push(e):a.push(e);if(t.includes(i))return e;let s=a.findIndex(e=>e.id===i),l="insert-before"===r?s:s+1,d=[...a.slice(0,l),...o,...a.slice(l)],c=0;for(let e of d)e.startTimeInFrames=c,c+=e.durationInFrames;return d}function W(e){let t,i,r,n;let{item:a,trackId:s,track:l,mediaAsset:d,framePerPixel:c,fps:u=o.UG}=e,p=a.durationInFrames/c,h=a.startTimeInFrames/c,m=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UG;return t?"image"===e.type?1:"audio"===e.type?t.metadata.duration*i:"video"===e.type?F(t):0:0}(a,d,u),x=function(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UG,t&&"image"!==e.type&&"audio"!==e.type&&"video"===e.type)?e.sourceTrimEndFrames-e.sourceTrimStartFrames>0?e.sourceTrimEndFrames-e.sourceTrimStartFrames:Number.isNaN(Number(e.sourceTrimEndFrames))||Number.isNaN(Number(e.sourceTrimStartFrames))?F(t):1:e.durationInFrames}(a,d,u),g=Math.max(1,x),f=a.sourceTrimStartFrames||0,v=a.sourceTrimEndFrames||m;x!==g&&console.warn("[calculateItemVO] durationInSourceFrames !== safeDurationInSourceFrames, using safeDurationInSourceFrames",{item:a,mediaAsset:d,fps:u,durationInSourceFrames:x,safeDurationInSourceFrames:g});let b="image"===a.type||"caption"===a.type;if(b)t=0,i=(a.startTimeInFrames+a.durationInFrames-1)/c;else{let e=f*a.durationInFrames/g;t=(a.startTimeInFrames-e)/c,i=(a.startTimeInFrames+a.durationInFrames-1)/c}if(b)r=(a.startTimeInFrames+1)/c,n=1/0;else{r=(a.startTimeInFrames+1)/c;let e=(m-v)*a.durationInFrames/g;n=(a.startTimeInFrames+a.durationInFrames+e)/c}let y="caption"===a.type?[]:(()=>{let e=l.items.findIndex(e=>e.id===a.id);return -1!==e?l.items.slice(e+1).map(e=>e.id):[]})();return{...a,trackId:s,left:h,width:p,resize:{left:{min:t,max:i},right:{min:r,max:n}},subsequentItemIds:y}}function L(e,t){if("undefined"!=typeof requestIdleCallback){let i=requestIdleCallback(e,t);return()=>{cancelIdleCallback(i)}}{let t=setTimeout(e,0);return()=>{clearTimeout(t)}}}},52961:function(e,t,i){i.d(t,{rr:function(){return s},d2:function(){return l.d},PJ:function(){return d.PJ},z6:function(){return x},_b:function(){return d._b},No:function(){return d.No},Lv:function(){return v},JA:function(){return b}});var r=i(75271),n=i(72301),o=i(98939),a=i(25770);let s=e=>{let{disabled:t=!1,containerWidth:i,contentWidth:s,scrollContainerRef:l,currentTimeInFrames:d}=e,c=a.wK.use.isPlaying(),{totalDurationInFrames:u}=a.wK.use.outputSettings(),p=(0,r.useRef)(!1),h=(0,r.useCallback)(e=>{if(!l.current||t||p.current||!c)return;let r=l.current.scrollLeft,n=s*e/u+o.Fp,a=r+i/5;if(n>r+4*i/5)p.current=!0,l.current.scrollTo({left:n-i/5,behavior:"smooth"}),setTimeout(()=>{p.current=!1},600);else{if(!(n<a)||!(r>n))return;p.current=!0,l.current.scrollTo({left:Math.max(0,n-i/5),behavior:"smooth"}),setTimeout(()=>{p.current=!1},600)}},[l,c,t,u,s,i]),m=(0,r.useMemo)(()=>(0,n.Z)(h,200),[h]);(0,r.useEffect)(()=>{m(d),0===d&&l.current.scrollTo({left:0,behavior:"smooth"})},[d,l,m]),(0,r.useEffect)(()=>()=>{m.cancel()},[m])};var l=i(96966);i(99067);var d=i(73676);i(69260),i(76029);var c=i(21964),u=i(16581),p=i(28989),h=i(28e3);let m={enabled:!1,type:"openart"};function x(){let{tracks:e=[],mediaAssets:t=[],onSuccess:i,onProgress:n,maxRetries:o=3,downloadBehavior:s="download",watermarkConfig:l=m,configFromStory:d=u.Kz,userId:x}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[g,f]=(0,r.useState)({status:"idle"}),v=(0,r.useRef)(null),b=(0,r.useRef)(null),y=(0,r.useRef)(0),w=()=>{v.current&&(clearInterval(v.current),v.current=null)};(0,r.useEffect)(()=>w,[]);let C=(0,c.D)({mutationFn:async e=>{w(),y.current=Date.now();let t={status:"waiting"};f(t),null==n||n(t);let i=await fetch("/api/internal/storybuilder/render_video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw Error(`Failed to start render process: ${i.statusText}`);let r=await i.json();if(!r.renderId)throw Error("Invalid response: missing renderId");return b.current=r.renderId,new Promise((e,t)=>{let i=async()=>{try{if(Date.now()-y.current>6e5){w(),t(Error("Render timeout exceeded"));return}if(!b.current)return;let i=await fetch(`/api/internal/storybuilder/render_video?id=${b.current}`);if(!i.ok){console.error("Failed to fetch render progress");return}let r=await i.json();f(r),null==n||n(r),"success"===r.status&&r.url?(w(),e({url:r.url})):"error"===r.status&&(w(),t(Error(r.error||"Unknown render error")))}catch(e){console.error("Error polling render progress:",e)}};i(),v.current=setInterval(i,2e3)})},retry:o,retryDelay:1e3,onSuccess:e=>{if(!e.url)throw Error("Invalid response format, no video URL returned");i?i(e.url):(0,h.M)(e.url,"download.mp4"),(0,p.t5)("Export completed! Download will start soon.")},onError:e=>{console.error("Video rendering error:",e),w(),(0,p.cB)("Error during export. Check console for details.")}});return{renderVideo:async()=>{try{let i;if(e.length>0&&t.length>0)i={tracks:e,mediaAssets:t,downloadBehavior:s,watermarkConfig:l,globalConfig:d,userId:x};else{let{tracks:e,mediaAssets:t,globalConfig:r}=a.D.getState();i={tracks:e,mediaAssets:t,downloadBehavior:s,watermarkConfig:l,globalConfig:r,userId:x}}await C.mutateAsync(i)}catch(e){console.error("Failed to render video:",e)}},isRendering:C.isLoading,progress:g,error:C.error}}i(53659);var g=i(79855),f=i(15526);function v(){let e=f.wK.use.setShotSyncCallbacks();(0,r.useEffect)(()=>(e({onShotAdd:(e,t)=>{g.B.getState().addShot(e,t,{rebuildTimeline:!1})},onShotRemove:e=>{g.B.getState().removeShot(e,{rebuildTimeline:!1})},onShotsReorder:(e,t)=>{g.B.getState().reorderShots(e,t,{rebuildTimeline:!1})},onShotUpdate:(e,t)=>{g.B.getState().updateShot(e,t,{rebuildTimeline:!1})},onGlobalConfigUpdate:e=>{g.B.getState().updateEditorGlobalConfig(e)}}),()=>{e({})}),[e])}i(90999),i(42238),i(61845);let b=function(){let{playerRef:e,containerRef:t,debug:i=!1,tracks:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,r.useRef)([]),a=(0,r.useMemo)(()=>{let e=function(e){if(!e)return[];let t=[];for(let i of e){if("video"!==i.type)continue;let e=0;for(let r of i.items){if("video"!==r.type&&"overlay"!==r.type)continue;let i=e+(r.durationInFrames||0);t.push({item:r,startFrame:e,endFrame:i,speed:r.speed||1}),e=i}}return t.sort((e,t)=>e.startFrame-t.startFrame)}(n);return o.current=e,e},[n,i]);(0,r.useEffect)(()=>{if(!(null==e?void 0:e.current)){i&&console.warn("[VideoSpeedSync] No player ref available");return}let r=e.current;if("function"!=typeof r.addEventListener){console.error("[VideoSpeedSync] Player does not support addEventListener");return}let n=()=>{if(!(null==e?void 0:e.current))return;let r=e.current.getCurrentFrame(),n=y(o.current,r),a=(null==n?void 0:n.speed)??1;w(()=>{C(a,null==t?void 0:t.current,i)},1)},a=r=>{let n=r.detail.frame;if(!(null==e?void 0:e.current))return;let a=y(o.current,n),s=(null==a?void 0:a.speed)??1;w(()=>{C(s,null==t?void 0:t.current,i)},1)},s=()=>{},l=()=>{},d=i=>{if(!(null==e?void 0:e.current))return;let r=i.detail.frame,n=y(o.current,r),a=(null==n?void 0:n.speed)??1,s=null==t?void 0:t.current;s&&s.querySelectorAll("video").forEach((e,t)=>{if(!e.paused&&!e.ended&&Math.abs(e.playbackRate-a)>.01)try{e.playbackRate=a}catch(e){console.error(`[VideoSpeedSync] Failed to set speed for video ${t}:`,e)}})};return r.addEventListener("play",n),r.addEventListener("seeked",a),r.addEventListener("pause",s),r.addEventListener("ended",l),r.addEventListener("frameupdate",d),()=>{r.removeEventListener&&(r.removeEventListener("play",n),r.removeEventListener("seeked",a),r.removeEventListener("pause",s),r.removeEventListener("ended",l),r.removeEventListener("frameupdate",d))}},[e,i,t,a])};function y(e,t){for(let i of e)if(t>=i.startFrame&&t<i.endFrame)return i;return null}function w(e,t){let i=t,r=()=>{--i<=0?e():requestAnimationFrame(r)};requestAnimationFrame(r)}function C(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t?t.querySelectorAll("video"):document.querySelectorAll("video");if(0===r.length)return i&&console.warn("[VideoSpeedSync] No video elements found"),!1;let n=0;return r.forEach((t,i)=>{if(!t.paused&&!t.ended&&Math.abs(t.playbackRate-e)>.01)try{t.playbackRate=e,n++}catch(e){console.error(`[VideoSpeedSync] Failed to set playbackRate for video ${i}:`,e)}}),n>0}i(35713)},96966:function(e,t,i){i.d(t,{d:function(){return n}});var r=i(75271);let n=e=>{let t=(0,r.useCallback)(t=>{if(!(null==e?void 0:e.current))return()=>{};let{current:i}=e,r=e=>{let{detail:i}=e;if(!i){console.warn("useCurrentPlayerFrame updater: frame update detail is null");return}t()};return i.addEventListener("frameupdate",r),()=>{null==i||i.removeEventListener("frameupdate",r)}},[null==e?void 0:e.current]),i=(0,r.useCallback)(()=>{if(!(null==e?void 0:e.current))return 0;let t=e.current.getCurrentFrame();return void 0===t?(console.warn("useCurrentPlayerFrame: getCurrentFrame returned undefined"),0):t},[null==e?void 0:e.current]);return(0,r.useSyncExternalStore)(t,i,()=>0)}},87541:function(e,t,i){i.d(t,{$:function(){return s}});var r=i(8765),n=i(48913),o=i(73676);let a=e=>{let{onClose:t,type:i="image",hiddenTabList:o=[],maxSelectionCount:a=1}=e,{showModal:s}=(0,r.dd)();return{handleShowModal:()=>{s(n.S,{historyFilter:{resource_type:i},maxSelectionCount:a,showTabList:["generation","albums","storyAsset"],hiddenTabList:o,onClose:e=>{null==t||t(e)}})}}},s=e=>{let{storyId:t,type:i="image",subtype:r,shotId:n,maxSelectionCount:s=1,onUploadSuccess:l}=e,{saveFileWithUploadingAsset:d,isAddingMediaAsset:c}=(0,o.No)(t),{handleShowModal:u}=a({type:i,hiddenTabList:"video"===i?["albums"]:[],onClose:e=>{e.length>0&&e.forEach(e=>{d({url:e,type:i,subtype:r,shotId:n}).then(e=>{null==l||l(e)})})},maxSelectionCount:s});return{handleShowModal:u,isAddingMediaAsset:c}}},99067:function(e,t,i){i.d(t,{a:function(){return l}});var r=i(75271),n=i(13058),o=i(42238),a=i(15526),s=i(90999);function l(){let{playerRef:e,enabled:t=!0,zoomLevel:i,onZoomChange:l,zoomMin:d=.5,zoomMax:c=5}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=a.wK.use.currentTimeInFrames(),p=a.wK.use.outputSettings(),h=a.wK.use.isPlaying(),m=a.wK.use.selectItem(),x=a.wK.use.selectGroup(),g=a.wK.use.setCurrentTimeInFrames(),f=a.wK.use.togglePlay(),v=a.wK.use.removeItemFromTrack(),b=a.wK.use.updateItemInTrack(),y=a.wK.use.clearAllSelections(),w=a.wK.use.selectedItemIds(),C=a.wK.use.tracks(),j=a.wK.use.selectedGroupId(),k=a.wK.use.setPreviewingMediaAsset(),F=a.wK.use.setTracks(),{operations:S}=(0,n.ZY)(),I=(0,o.K)(),_=(0,r.useMemo)(()=>{if(!w||1!==w.length)return;let e=w[0];for(let t of C){let i=t.items.find(t=>t.id===e);if(i)return i}},[w,C]),Z=(0,r.useMemo)(()=>j?C.flatMap(e=>e.items.filter(e=>e.groupId===j).map(t=>({trackId:e.id,itemId:t.id,item:t}))):[],[j,C]),A=(0,r.useMemo)(()=>{if(!w||1!==w.length)return;let e=w[0];return C.find(t=>t.items.some(t=>t.id===e))},[w,C]),E=(0,r.useRef)({key:null,intervalId:null,direction:1,wasPlayingBeforeFrameAdjustment:!1}),M=(0,r.useCallback)(()=>{let e=document.activeElement;if(!e)return!1;let t=e.tagName.toLowerCase();if("true"===e.getAttribute("contenteditable")||"textarea"===t)return!0;if("input"===t){let t=(e.type||"").toLowerCase(),i=(e.getAttribute("role")||"").toLowerCase(),r=new Set(["text","search","email","url","tel","password","number","date","datetime-local","month","time","week"]);return"switch"!==i&&r.has(t)}return!1},[]),T=(0,r.useCallback)(t=>{let i=Math.max(0,Math.min(p.totalDurationInFrames-1,u+t));g(i),(null==e?void 0:e.current)&&e.current.seekTo(i)},[u,p.totalDurationInFrames,g,e]),R=(0,r.useCallback)(e=>{if(!_||!A||"video"!==_.type&&"audio"!==_.type)return;let t=Math.max(0,Math.min(1,(_.volume??1)+.05*e));S.batchOperation("Adjust volume through keyboard",()=>{b(A.id,{id:_.id,volume:t})})},[_,A,b,S]),D=(0,r.useCallback)(e=>{l&&void 0!==i&&l(Math.max(d,Math.min(c,i+.25*e)))},[i,l,d,c]),z=(0,r.useCallback)((t,i)=>{E.current.wasPlayingBeforeFrameAdjustment=h,h&&((null==e?void 0:e.current)&&e.current.pause(),h&&f()),E.current.intervalId&&clearInterval(E.current.intervalId),E.current.key=i,E.current.direction=t,E.current.intervalId=setInterval(()=>{T(t)},8)},[h,e,f,T]),P=(0,r.useCallback)(()=>{if(E.current.intervalId&&(clearInterval(E.current.intervalId),E.current.intervalId=null),E.current.wasPlayingBeforeFrameAdjustment){if(null==e?void 0:e.current)try{e.current.play()}catch(e){console.warn("Autoplay restricted during frame adjustment resume:",e)}h||f()}E.current.key=null,E.current.wasPlayingBeforeFrameAdjustment=!1},[e,h,f]),W=(0,r.useCallback)((e,t)=>{E.current.intervalId&&clearInterval(E.current.intervalId),E.current.key=e,E.current.direction=t,E.current.intervalId=setInterval(()=>{R(t)},150)},[R]),L=(0,r.useCallback)(()=>{E.current.intervalId&&(clearInterval(E.current.intervalId),E.current.intervalId=null),E.current.key=null},[]),B=(0,r.useCallback)(()=>{try{let e=s.D.getState().tracks,t=e.filter(e=>!("caption"===e.subtype&&0===e.items.length));t.length!==e.length&&F(t)}catch(e){console.warn("Failed to prune empty caption tracks:",e)}},[F]),H=(0,r.useCallback)(i=>{if(!t||M())return;let{key:r}=i;switch(r){case"Escape":i.preventDefault(),y();break;case"Delete":case"Backspace":if(i.preventDefault(),!_&&0===Z.length&&(!w||0===w.length))return;if((null==_?void 0:_.type)==="audio"&&Z.length>0){S.batchOperation("Delete audio in group though keyboard",()=>{v(A.id,_.id,!1)}),m(null);return}0===Z.length?w&&w.length>1?(S.batchOperation("Delete items though keyboard (multi-select)",()=>{let e={};for(let t of C)for(let i of t.items)w.includes(i.id)&&(e[i.id]=t.id);for(let t of w){let i=e[t];i&&v(i,t)}}),I(),B(),m(null)):_&&A&&(S.batchOperation("Delete item though keyboard",()=>{v(A.id,_.id)}),I(),B(),m(null)):(S.batchOperation("Delete items in group though keyboard",()=>{Z.forEach(e=>{v(e.trackId,e.itemId)})}),I(),B(),x(null));break;case" ":if(i.preventDefault(),f(),null==e?void 0:e.current){if(h)e.current.pause();else try{k(void 0),e.current.play()}catch(e){console.warn("Autoplay restricted:",e)}}break;case"ArrowLeft":i.preventDefault(),"ArrowLeft"!==E.current.key&&(T(-1),z(-1,"ArrowLeft"));break;case"ArrowRight":i.preventDefault(),"ArrowRight"!==E.current.key&&(T(1),z(1,"ArrowRight"));break;case"ArrowUp":i.preventDefault(),"ArrowUp"!==E.current.key&&(R(1),W("ArrowUp",1));break;case"ArrowDown":i.preventDefault(),"ArrowDown"!==E.current.key&&(R(-1),W("ArrowDown",-1))}},[t,M,y,_,w,Z,S,m,v,A,x,f,e,h,k,T,z,R,W,C,B,I]),$=(0,r.useCallback)(e=>{if(!t)return;let{key:i}=e;["ArrowLeft","ArrowRight"].includes(i)?E.current.key===i&&P():["ArrowUp","ArrowDown"].includes(i)&&E.current.key===i&&L()},[t,P,L]),O=(0,r.useCallback)(e=>{t&&l&&void 0!==i&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),D(e.deltaY>0?-1:1))},[t,l,i,D]);(0,r.useEffect)(()=>{if(t)return document.addEventListener("keydown",H,!0),document.addEventListener("keyup",$,!0),document.addEventListener("wheel",O,{passive:!1}),()=>{document.removeEventListener("keydown",H,!0),document.removeEventListener("keyup",$,!0),document.removeEventListener("wheel",O),P(),L()}},[t,H,$,O,P,L]),(0,r.useEffect)(()=>()=>{P(),L()},[P,L])}},73676:function(e,t,i){i.d(t,{AC:function(){return y},oK:function(){return w},PJ:function(){return v},IL:function(){return C},_b:function(){return f},No:function(){return g}});var r=i(75271),n=i(79855),o=i(67197);let a=e=>e.startsWith("image/")?"image":e.startsWith("video/")?"video":e.startsWith("audio/")?"audio":null,s=(e,t)=>e.startsWith("audio/")?"voiceover"===t?"voiceover":"music":null,l=(e,t,i)=>({id:(0,o.x0)(),fileName:(null==i?void 0:i.fileName)||(null==e?void 0:e.name),type:(null==i?void 0:i.type)||a(null==e?void 0:e.type),subtype:(null==i?void 0:i.subtype)||(e?s(null==e?void 0:e.type,t):null),progress:0,status:"uploading",fileSize:null==e?void 0:e.size,created_at:{_seconds:Date.now(),_nanoseconds:0}});var d=i(69260),c=i(53659),u=i(88295),p=i(15526),h=i(90999),m=i(16585);function x(){return`media_${Date.now()}_${Math.random().toString(36).slice(2,9)}`}function g(e){let{uploadAndSaveFile:t,isUploading:i,error:o,progress:a,reset:s}=f(e),d=(0,n.B)(e=>e.addUploadingAsset),c=(0,n.B)(e=>e.updateUploadingAsset),u=(0,n.B)(e=>e.removeUploadingAsset),{addMediaAsset:p,isCreating:h}=v(e),m=(0,r.useRef)(null),g=(0,r.useCallback)(async(e,i)=>{let r=l(e,i);d(r),m.current=r.id;try{let n=await t(e,i);return c(r.id,{status:"completed",progress:100}),u(r.id),n}catch(e){throw c(r.id,{status:"error",error:e instanceof Error?e.message:"Upload failed"}),e}finally{m.current=null}},[t,d,c,u]);return(0,r.useEffect)(()=>{let e=m.current;if(!e||!a)return;let t="number"==typeof a.progress?a.progress:a.completed?100:0;if(a.error){c(e,{status:"error",error:a.error,progress:t});return}c(e,{progress:t,status:a.completed?"processing":"uploading"})},[a,c]),{uploadAndSaveFileWithUploadingAsset:g,saveFileWithUploadingAsset:(0,r.useCallback)(async e=>{let{url:t,type:i,subtype:r,shotId:n}=e,o={id:x(),resource_type:i,url:t,source:"generated",configs:{}};n&&(o.shot_id=n),"audio"===i&&r&&(o.subtype=r);let a=l(void 0,r,{type:i,subtype:r,fileName:t});d(a);try{let e=await p(o);return u(a.id),e}catch(e){throw c(a.id,{status:"error",error:e instanceof Error?e.message:"Upload failed"}),e}},[p,d,c,u]),isUploading:i,isAddingMediaAsset:h,error:o,progress:a,reset:s}}function f(e){let{uploadFile:t,isUploading:i,error:n,progress:o,reset:a}=(0,d.q)(),{addMediaAsset:s,isCreating:l}=v(e),[c,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null);return{uploadAndSaveFile:(0,r.useCallback)(async(i,r,n)=>{try{var o;h(null),u(!0);let a=await t(i);if(!a.success||!a.url)throw Error(a.error||"File upload failed");let{type:l}=(o=i.type).startsWith("image/")?{type:"image"}:o.startsWith("video/")?{type:"video"}:o.startsWith("audio/")?{type:"audio",subtype:"music"}:{type:"file"};(0,m.B)("asset_uploaded",{story_id:e,asset_type:l,asset_sub_type:r});let d={id:x(),resource_type:l,url:a.url,title:i.name,source:"user_upload",user_id:"",is_deleted:!1,created_at:Date.now(),updated_at:Date.now(),configs:{}};return(null==n?void 0:n.shotId)&&(d.shot_id=n.shotId),"audio"===l&&r&&(d.subtype="voiceover"===r?"voiceover":"music"),await s(d)}catch(t){let e=Error(t instanceof Error?t.message:"Upload and save failed");throw h(e),e}finally{u(!1)}},[t,s,e]),isUploading:i||l||c,error:p||n,progress:o,reset:(0,r.useCallback)(()=>{a(),h(null),u(!1)},[a])}}function v(e){let{addMediaAsset:t,removeMediaAsset:i,updateMediaAsset:n,setMediaAssets:o}=(0,h.D)(),{createMediaAsset:a,deleteMediaAssets:s,refreshMediaAssets:l,isCreating:d,isDeleting:u,isOperating:p}=(0,c.Sx)(e||""),m=(0,r.useCallback)(async r=>{if(!e)return null;try{let e=(await a({type:r.resource_type,subtype:r.subtype,shot_id:r.shot_id,url:r.url,title:r.title||`${r.resource_type} asset`,metadata:r.metadata})).media_resource;return t(e),e}catch(t){i(r.id);let e=t instanceof Error?t.message:"Failed to add media asset";throw console.error("Failed to sync media asset to server:",t),Error(e)}},[t,i,a,e]);return{addMediaAsset:m,removeMediaAsset:(0,r.useCallback)(async t=>{let r=h.D.getState().mediaAssets;if(!r.find(e=>e.id===t))return;let n=[...r];if(i(t),e)try{await s([t])}catch(t){o(n);let e=t instanceof Error?t.message:"Failed to remove media asset";throw console.error("Failed to remove media asset from server:",t),Error(e)}},[i,o,s,e]),updateMediaAsset:(0,r.useCallback)(e=>{n(e)},[n]),refreshMediaAssets:(0,r.useCallback)(()=>{e&&l()},[l,e]),isCreating:d,isDeleting:u,isOperating:p}}let b=()=>{let e=(0,h.D)(p.df),t=(0,h.D)(e=>e.mediaAssets);return(0,r.useMemo)(()=>t.find(t=>t.id===(null==e?void 0:e.mediaAssetId)),[e,t])},y=()=>{let e=b(),t=(0,h.D)(p.df);return(null==e?void 0:e.resource_type)==="image"?"image":(null==e?void 0:e.resource_type)==="video"?"video":(null==e?void 0:e.resource_type)==="audio"&&"music"===e.subtype?"music":(null==e?void 0:e.resource_type)==="audio"&&"voiceover"===e.subtype?"voiceover":(null==t?void 0:t.type)==="caption"?"caption":"unknown"},w=e=>{let{type:t,subtype:i,sort:o="desc"}=e,a=(0,p.hs)(t,i),s=(0,n.B)(e=>e.uploadingAssets),l=(0,r.useMemo)(()=>s.filter(e=>e.type===t&&(!i||e.subtype===i)),[s,t,i]);return(0,r.useMemo)(()=>[...a,...l].sort((e,t)=>{var i,r;let n=(null===(i=e.created_at)||void 0===i?void 0:i._seconds)||0,a=(null===(r=t.created_at)||void 0===r?void 0:r._seconds)||0;return"asc"===o?n-a:a-n}),[a,l,o])},C=(e,t)=>{let[i]=(0,u.On)(t);return(0,r.useMemo)(()=>i.some(t=>t.items.some(t=>t.mediaAssetId===e)),[i,e])}},69260:function(e,t,i){i.d(t,{q:function(){return a}});var r=i(75271),n=i(21964),o=i(94372);function a(){let{uploadFiles:e,isUploading:t,error:i,fileProgress:a,reset:s}=function(){let[e,t]=(0,r.useState)({}),i=(0,r.useCallback)(e=>{t(t=>({...t,[e.fileName]:e}))},[]),a=(0,r.useCallback)(()=>{t({})},[]),s=(0,n.D)({mutationFn:async e=>(t({}),await (0,o.N)(e,{onProgress:i})),onError:e=>{console.error("Media upload failed:",e)},onSuccess:e=>{}});return{uploadFiles:s.mutateAsync,isUploading:s.isLoading,error:s.error,fileProgress:e,reset:a}}();return{uploadFile:(0,r.useCallback)(async t=>(await e([t])).results[0],[e]),isUploading:t,error:i,progress:Object.values(a)[0],reset:s}}},76029:function(e,t,i){i.d(t,{N:function(){return a}});var r=i(75271),n=i(96966),o=i(15526);let a=e=>{let{playerRef:t}=e,i=o.wK.use.isPlaying(),a=o.wK.use.setCurrentTimeInFrames(),s=o.wK.use.currentTimeInFrames(),l=o.wK.use.togglePlay();(0,r.useEffect)(()=>{t.current&&!i&&t.current.pause()},[i,t]),(0,r.useEffect)(()=>{t.current&&t.current.getCurrentFrame()!==s&&t.current.seekTo(s)},[t,s]);let d=(0,n.d)(t);(0,r.useEffect)(()=>{(null==t?void 0:t.current)&&(0===d&&l(!1),a(d))},[t,d,a,l])}},6966:function(e,t,i){i.d(t,{Q:function(){return d}});var r=i(75271),n=i(1188),o=i(98939),a=i(90999),s=i(95239);let l=()=>{let e=(0,a.D)(e=>e.tracks),t=(0,a.D)(e=>e.mediaAssets);return{getTrackByType:(0,r.useCallback)((i,r)=>e.find(n=>i&&r?e.filter(e=>e.type===i).find(e=>{var i,n;return e&&(null==e?void 0:e.subtype)===void 0?(null===(i=e.items[0])||void 0===i?void 0:i.mediaAssetId)===(null===(n=t.find(e=>e.id===r))||void 0===n?void 0:n.id):e.subtype===r}):s.wD.getTrackCategory(n,t)===i),[e,t])}},d=()=>{let e=(0,n.jU)(e=>e.updateShot),t=(0,a.D)(e=>e.updateItemInTrack),i=(0,a.D)(e=>e.mediaAssets),s=(0,n.jU)(e=>{var t,i;return null===(i=e.story)||void 0===i?void 0:null===(t=i.storyboard)||void 0===t?void 0:t.shots_map}),{getTrackByType:d}=l();return{updateShot:(0,r.useCallback)(async(r,n,a)=>{let{rebuildTimeline:l=!1}=a||{};if(!l){var c,u;let e=n.active_image_id&&n.active_image_url,a=n.active_video_id&&n.active_video_url,l=n.active_voice_over_audio_id&&n.active_voice_over_audio_url,p=s[r];if(a){let e=d("video"),r=null==e?void 0:e.items.find(e=>e.mediaAssetId===(null==p?void 0:p.active_video_id)),a=i.find(e=>e.id===n.active_video_id),s=null==a?void 0:null===(c=a.metadata)||void 0===c?void 0:c.duration,l=(null==r?void 0:r.speed)||1;r&&t(e.id,{id:r.id,mediaAssetId:n.active_video_id,durationInFrames:Math.floor(s*o.UG/l)})}else if(e){let e=d("image"),i=null==e?void 0:e.items.find(e=>e.mediaAssetId===(null==p?void 0:p.active_image_id));i&&t(e.id,{id:i.id,mediaAssetId:n.active_image_id,durationInFrames:Math.floor(o.H6*o.UG)})}else if(l){let e=d("audio"),r=null==e?void 0:e.items.find(e=>e.mediaAssetId===(null==p?void 0:p.active_voice_over_audio_id)),a=i.find(e=>e.id===n.active_voice_over_audio_id),s=(null==r?void 0:r.speed)||1;r&&t(e.id,{id:r.id,mediaAssetId:n.active_voice_over_audio_id,durationInFrames:Math.floor((null==a?void 0:null===(u=a.metadata)||void 0===u?void 0:u.duration)*o.UG/s)})}}await e(r,n,{rebuildTimeline:l})},[e,s,t,d,i])}}},42238:function(e,t,i){i.d(t,{K:function(){return o}});var r=i(75271),n=i(25770);let o=()=>(0,r.useCallback)(()=>{var e;let t;let i=n.D.getState();if(!i.hasInitialized)return;let r=(e=i.tracks,t=0,0===e.length?0:(e.forEach(e=>{e.items.forEach(e=>{let i=e.startTimeInFrames+e.durationInFrames;i>t&&(t=i)})}),t));i.outputSettings.totalDurationInFrames!==r&&i.updateOutputSettings({totalDurationInFrames:r})},[])},88295:function(e,t,i){i.d(t,{Eh:function(){return s},On:function(){return l},hH:function(){return a}});var r=i(75271),n=i(90999),o=i(95239);let a=()=>{let e=(0,n.D)(e=>e.tracks),t=(0,n.D)(e=>e.mediaAssets);return[(0,r.useMemo)(()=>e.filter(e=>"music"===o.wD.getTrackCategory(e,t)),[e,t])]},s=()=>{let e=(0,n.D)(e=>e.tracks),t=(0,n.D)(e=>e.mediaAssets);return[(0,r.useMemo)(()=>e.filter(e=>"voiceover"===o.wD.getTrackCategory(e,t)),[e,t])]},l=e=>{let t=(0,n.D)(e=>e.tracks),i=(0,n.D)(e=>e.mediaAssets);return[(0,r.useMemo)(()=>t.filter(t=>e.includes(o.wD.getTrackCategory(t,i))),[t,i,e])]}},61845:function(e,t,i){i.d(t,{t:function(){return n}});var r=i(75271);function n(e){let[t,i]=(0,r.useState)(0),n=(0,r.useRef)(null),o=(0,r.useRef)(0);return(0,r.useEffect)(()=>{let t=e.current;if(!t)return;o.current=t.scrollTop,i(t.scrollTop);let r=()=>{o.current=t.scrollTop,null==n.current&&(n.current=window.requestAnimationFrame(()=>{n.current=null,i(o.current)}))};return t.addEventListener("scroll",r,{passive:!0}),()=>{null!=n.current&&(window.cancelAnimationFrame(n.current),n.current=null),t.removeEventListener("scroll",r)}},[e]),t}},35713:function(e,t,i){i.d(t,{C:function(){return o}});var r=i(75271),n=i(98939);function o(e){let{trackLengthInPixel:t,currentTimeInFrames:i,totalDurationInFrames:o,scrollContainerRef:a,playheadRef:s}=e,l=(0,r.useRef)(t);(0,r.useLayoutEffect)(()=>{let e=l.current;if(e!==t&&e>0&&o>0&&a.current){let r=a.current.scrollLeft,l=i/o*e,d=i/o*t,c=n.Fp+l,u=n.Fp+d;(null==s?void 0:s.current)&&s.current.updateVisualPosition(i),a.current.scrollLeft=Math.max(0,u-(c-r))}l.current=t},[t,i,o,a,s])}},1299:function(e,t,i){i.d(t,{cP:function(){return r.cP},dt:function(){return o.d},wK:function(){return n.wK}});var r=i(14719);i(98939);var n=i(25770),o=i(85872)},25770:function(e,t,i){i.d(t,{D:function(){return n.D},Z_:function(){return r.Z_},df:function(){return r.df},wK:function(){return r.wK}});var r=i(15526),n=i(90999)},15526:function(e,t,i){i.d(t,{CN:function(){return d},WL:function(){return s},Z_:function(){return o},df:function(){return a},hs:function(){return l},wK:function(){return n}});var r=i(90999);let n=(0,i(57170).N)(r.D),o=(e,t)=>e.mediaAssets.find(e=>e.id===t),a=e=>{if(!e.selectedItemIds||1!==e.selectedItemIds.length)return;let t=e.selectedItemIds[0];for(let i of e.tracks){let e=i.items.find(e=>e.id===t);if(e)return e}},s=()=>({activeTab:(0,r.D)(e=>e.mediaAssetTab),setActiveTab:n.use.setMediaAssetsActiveTab()});function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc";return n.use.mediaAssets().filter(i=>i.resource_type===e&&(!t||i.subtype===t)).sort((e,t)=>{var r,n,o,a;return"asc"===i?((null===(o=e.created_at)||void 0===o?void 0:o._seconds)||0)-((null===(a=t.created_at)||void 0===a?void 0:a._seconds)||0):((null===(r=t.created_at)||void 0===r?void 0:r._seconds)||0)-((null===(n=e.created_at)||void 0===n?void 0:n._seconds)||0)})}let d=(e,t)=>e.tracks.some(e=>e.items.some(e=>e.mediaAssetId===t))},90999:function(e,t,i){i.d(t,{D:function(){return m}});var r=i(2345),n=i(47469),o=i(81479),a=i(79855),s=i(16581),l=i(83918),d=i(17856),c=i(53659),u=i(95239);let p={aspectRatio:"16:9",width:1920,height:1080,totalDurationInFrames:20*s.UG},h={hasInitialized:!1,isLoading:!1,error:void 0,mediaAssets:[],tracks:[],globalConfig:s.Kz,outputSettings:p,selectedItemIds:[],selectedMediaAssetId:void 0,selectedGroupId:void 0,currentTimeInFrames:0,isPlaying:!1,previewingMediaAsset:void 0,mediaAssetTab:"video",storyId:void 0,draggingSelectionItemIds:[]},m=(0,r.U)()((0,n.n)((e,t)=>{let i={},r=(e,t)=>"image"===e.type||"audio"===e.type?e.durationInFrames:"video"===e.type?e.sourceTrimEndFrames-e.sourceTrimStartFrames>0?e.sourceTrimEndFrames-e.sourceTrimStartFrames:Number.isNaN(Number(e.sourceTrimEndFrames))||Number.isNaN(Number(e.sourceTrimStartFrames))?t.metadata.frames:0:void 0,n=(e,t)=>"image"===e.type?1:"audio"===e.type?t.metadata.duration*s.UG:"video"===e.type?t.metadata.frames:void 0;return{...h,init:t=>{let{storyId:i,mediaAssets:r,tracks:n,globalConfig:o=s.Kz}=t;try{let t=n.map(e=>({...e,items:e.items.map(e=>({...e}))})),a=t.findIndex(e=>e.isPrimary);if(-1===a){let e=t.findIndex(e=>"video"===e.type);-1!==e&&(t=t.map((t,i)=>({...t,isPrimary:i===e})),a=e)}else t=t.map((e,t)=>({...e,isPrimary:t===a}));if(-1!==a){let e=t[a];e.items=[...e.items].sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),(0,d.AO)(e.items,0)}let l=(0,d.GQ)(t,r,o);e(e=>{e.storyId=i,e.mediaAssets=r,e.tracks=t,e.globalConfig={...s.Kz,...o},e.outputSettings={...e.outputSettings,width:l.width,height:l.height,aspectRatio:l.aspectRatio,totalDurationInFrames:l.totalDurationInFrames},e.hasInitialized=!0,e.isLoading=!1,e.error=void 0})}catch(i){let t=i instanceof Error?i.message:"Failed to initialize timeline";throw e(e=>{e.isLoading=!1,e.error=t}),i}},syncMediaAssetsFromServer:async i=>{try{let r=(await (0,c.oX)(i)).media_resources.map(u.wD.convertStoryMediaResourceToMediaAssetItem),n=t(),o=n.hasInitialized,a=[...n.mediaAssets];r.forEach(e=>{let t=a.findIndex(t=>t.id===e.id);-1===t?a.push(e):a[t]={...e,...a[t]}}),e(e=>{if(e.mediaAssets=a,!o)return;let t=(0,d.GQ)(e.tracks,a,e.globalConfig);e.outputSettings={...e.outputSettings,width:t.width,height:t.height,aspectRatio:t.aspectRatio,totalDurationInFrames:t.totalDurationInFrames}})}catch(e){console.error("Failed to sync media assets from server:",e)}},setLoading:t=>e(e=>{e.isLoading=t}),setError:t=>e(e=>{e.error=t}),clearError:()=>e(e=>{e.error=void 0}),addMediaAsset:t=>e(e=>{e.mediaAssets.some(e=>e.id===t.id)||e.mediaAssets.push(t)}),removeMediaAsset:t=>e(e=>{if(new l.O({tracks:e.tracks,mediaAssets:e.mediaAssets}).mediaAssetInUse.some(e=>e.id===t)){console.error(`Cannot remove media asset ${t} that is in use`);return}e.mediaAssets=e.mediaAssets.filter(e=>e.id!==t)}),updateMediaAsset:t=>e(e=>{let i=e.mediaAssets.findIndex(e=>e.id===t.id);-1!==i&&(e.mediaAssets[i]={...e.mediaAssets[i],...t})}),setMediaAssets:t=>e(e=>{e.mediaAssets=t}),setTracks:t=>e(e=>{e.tracks=t}),addTrack:(t,i)=>e(e=>{e.tracks.splice(i,0,t)}),removeTrack:t=>{let{trackId:i,trackIndex:r}=t;return e(e=>{void 0!==i?e.tracks.find(e=>e.id===i)?e.tracks=e.tracks.filter(e=>e.id!==i):console.warn("[timelineStore] removeTrack: Track not found by id",{trackId:i}):void 0!==r?e.tracks[r]?e.tracks=e.tracks.filter((e,t)=>t!==r):console.warn("[timelineStore] removeTrack: Track not found by index",{trackIndex:r}):console.warn("[timelineStore] removeTrack: Neither trackId nor trackIndex provided",{trackId:i,trackIndex:r})})},rebuildTimeline:()=>new Promise(t=>e(e=>{let i=(0,o.HK)();e.tracks=i.tracks,e.mediaAssets=i.mediaAssets;let r=(0,d.GQ)(e.tracks,e.mediaAssets,e.globalConfig);e.outputSettings={...e.outputSettings,width:r.width,height:r.height,aspectRatio:r.aspectRatio,totalDurationInFrames:r.totalDurationInFrames},t()})),updateTrack:t=>e(e=>{let i=e.tracks.findIndex(e=>e.id===t.id);-1!==i&&(e.tracks[i]={...e.tracks[i],...t})}),addItemToTrack:(t,i)=>e(e=>{let r=e.tracks.find(e=>e.id===t);r&&!r.items.some(e=>e.id===i.id)&&(r.items.push(i),r.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),r.isPrimary&&(0,d.AO)(r.items,0))}),removeItemFromTrack:function(t,r){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return e(e=>{let o=e.tracks.find(e=>e.id===t);if(!o){console.warn("[timelineStore] removeItemFromTrack: Track not found",{trackId:t,itemId:r,needToUpdateSubsequentItems:n});return}let a=o.items.find(e=>e.id===r),s=o.items.findIndex(e=>e.id===r),l=null==o?void 0:o.isPrimary;if(!a){console.warn("[timelineStore] removeItemFromTrack: Item not found in track",{trackId:t,itemId:r,needToUpdateSubsequentItems:n});return}if(o.items=o.items.filter(e=>e.id!==r),n&&l&&(0,d.AO)(o.items,0===s?0:s-1),l||0!==o.items.length||(e.tracks=e.tracks.filter(e=>e.id!==t)),l&&(null==a?void 0:a.shotId)&&i.onShotRemove)try{i.onShotRemove(a.shotId)}catch(e){console.error("[timelineStore] Failed to remove shot from videoEditorStore:",e,{shotId:a.shotId})}})},updateItemInTrack:function(t,i){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return new Promise(n=>e(e=>{let o=e.tracks.find(e=>e.id===t);if(o){let e=o.items.findIndex(e=>e.id===i.id);if(-1!==e){let t={...i};void 0!==t.durationInFrames&&(t.durationInFrames=Math.max(1,t.durationInFrames)),o.items[e]={...o.items[e],...t},o.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),r&&o.isPrimary&&(0,d.AO)(o.items,0===e?0:e-1)}}n()}))},reorderItemsInTrack:(t,r)=>e(e=>{let n=e.tracks.find(e=>e.id===t);if(n&&r.length===n.items.length){let e=[...n.items],t=Object.fromEntries(n.items.map(e=>[e.id,e])),o=r.map(e=>t[e]);if(n.isPrimary){let e=0;o.forEach(t=>{t.startTimeInFrames=e,e+=t.durationInFrames})}if(n.items=o,n.isPrimary&&"video"===n.type&&i.onShotsReorder)try{let t=e.map(e=>e.id),n=-1,o=-1;for(let[e,i]of t.entries())if(i!==r[e]){n=e,o=r.indexOf(i);break}-1!==n&&-1!==o&&n!==o&&i.onShotsReorder(n,o)}catch(e){console.error("Failed to sync shot reorder with videoEditorStore:",e)}}}),updateOutputSettings:t=>e(e=>{e.outputSettings={...e.outputSettings,...t}}),updateGlobalConfig:t=>e(e=>{if(e.globalConfig={...e.globalConfig,...t},i.onGlobalConfigUpdate)try{i.onGlobalConfigUpdate(t)}catch(e){console.error("Failed to sync global config with videoEditorStore:",e)}}),updateTotalDurationInFrames:()=>e(e=>{let t=0;e.tracks.forEach(e=>{e.items.forEach(e=>{let i=e.startTimeInFrames+e.durationInFrames;i>t&&(t=i)})}),e.outputSettings.totalDurationInFrames=Math.max(e.outputSettings.totalDurationInFrames,t)}),updateItemSpeed:(t,i)=>e(e=>{let r,n;for(let i of e.tracks){let e=i.items.find(e=>e.id===t);if(e){r=e,n=i;break}}if(!r||!n)return;let o=r.durationInFrames,a=Math.max(1,Math.round(o*(r.speed||1)/i)),s=o-a,l=[];if(r.groupId)for(let t of e.tracks)for(let e=0;e<t.items.length;e++){let i=t.items[e];i.groupId===r.groupId&&l.push({item:i,track:t,index:e})}else{let e=n.items.findIndex(e=>e.id===t);-1!==e&&l.push({item:r,track:n,index:e})}for(let{item:e}of l)e.speed=i,e.durationInFrames=a;for(let e of new Set(l.map(e=>{let{track:t}=e;return t})))for(let{index:t}of l.filter(t=>{let{track:i}=t;return i===e}))for(let i=t+1;i<e.items.length;i++)e.items[i].startTimeInFrames-=s;let d=0;e.tracks.forEach(e=>{e.items.forEach(e=>{let t=e.startTimeInFrames+e.durationInFrames;t>d&&(d=t)})}),e.outputSettings.totalDurationInFrames=Math.max(e.outputSettings.totalDurationInFrames,d)}),shiftItemsFromIndex:(t,i,r,n)=>e(e=>{let o=e.tracks.find(e=>e.id===t),a=null==o?void 0:o.items.find(e=>e.id===n);if(!a){console.warn("Item not found:",{resizedItemId:n});return}let s=r-a.startTimeInFrames;if(o&&-1!==i){for(let e=i;e<o.items.length;e++){let t=o.items[e].startTimeInFrames;o.items[e]={...o.items[e],startTimeInFrames:t+s}}o.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames)}}),adjustSourceTrim:(i,o,a,s)=>{e(e=>{let l=e.tracks.find(e=>e.id===i),d=null==l?void 0:l.items.find(e=>e.id===o),c=e.mediaAssets.find(e=>e.id===(null==d?void 0:d.mediaAssetId));if(!d||!l){console.warn("[adjustSourceTrim] Item or track not found:",{itemId:o,trackId:i});return}let u=r(d,c),p=n(d,c),h=s*u/d.durationInFrames;if("left"===a){let e=(d.sourceTrimStartFrames||0)+h,t=d.startTimeInFrames+s,i=d.durationInFrames-s;if(e<-.01||i<=0){console.warn("[adjustSourceTrim] Invalid left edge values (defensive check):",{newSourceTrimStartFrames:e,newStartTimeInFrames:t,newDurationInFrames:i,deltaFramesInTimeline:s});return}d.sourceTrimStartFrames=Math.max(0,e),d.startTimeInFrames=t,d.durationInFrames=i}else{let e=(d.sourceTrimEndFrames||p)+h,t=d.durationInFrames+s,i=e>p+.01,r=e>(d.sourceTrimEndFrames||p);if(i&&"image"!==d.type&&r||t<=0){console.warn("[adjustSourceTrim] Invalid right edge values (defensive check):",{newSourceTrimEndFrames:e,newDurationInFrames:t,totalFramesInSource:p,itemType:d.type,deltaFramesInTimeline:s,isExtendingBeyondSource:i,isExtendingFromCurrent:r});return}d.sourceTrimEndFrames=e,d.durationInFrames=t;let n=l.items.findIndex(e=>e.id===o);if(-1!==n){for(let e=n+1;e<l.items.length;e++)l.items[e]={...l.items[e],startTimeInFrames:l.items[e].startTimeInFrames+s};l.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames)}}t().updateTotalDurationInFrames()})},resizeCaptionItem:(i,r,n,o)=>{e(e=>{let a=e.tracks.find(e=>e.id===i),s=null==a?void 0:a.items.find(e=>e.id===r);if(!a||!s||"caption"!==s.type){console.warn("[resizeCaptionItem] Invalid track or item:",{trackId:i,itemId:r});return}if("left"===n){let e=s.startTimeInFrames+o,t=s.durationInFrames-o;if(e<0||t<=0){console.warn("[resizeCaptionItem] Invalid left edge values (defensive check):",{newStart:e,newDuration:t,deltaFramesInTimeline:o});return}s.startTimeInFrames=e,s.durationInFrames=t}else{let e=s.durationInFrames+o;if(e<=0){console.warn("[resizeCaptionItem] Invalid right edge values (defensive check):",{newDuration:e,deltaFramesInTimeline:o});return}s.durationInFrames=e}a.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),t().updateTotalDurationInFrames()})},selectItem:t=>e(e=>{e.selectedItemIds=t?[t]:[]}),toggleSelectItem:t=>e(e=>{let i=e.selectedItemIds.includes(t);e.selectedItemIds=i?e.selectedItemIds.filter(e=>e!==t):[...e.selectedItemIds,t]}),selectGroup:t=>e(e=>{e.selectedGroupId=t??void 0}),selectMediaAsset:t=>e(e=>{e.selectedMediaAssetId=t??void 0}),clearAllSelections:()=>e(e=>{e.selectedItemIds=[],e.selectedGroupId=void 0,e.selectedMediaAssetId=void 0}),setCurrentTimeInFrames:t=>e(e=>{e.currentTimeInFrames=Math.max(0,Math.floor(t))}),togglePlay:t=>e(e=>{e.isPlaying=void 0===t?!e.isPlaying:t}),setMediaAssetsActiveTab:t=>e(e=>{e.mediaAssetTab=t}),setPreviewingMediaAsset:t=>e(e=>{e.previewingMediaAsset=t}),addMediaAssetToTrack:(t,r,n,o)=>e(e=>{let s=e.tracks.find(e=>e.id===t);if(s){let t=e.mediaAssets.find(e=>e.id===r);if(t){let r=(0,d.hb)(n,s.items),l=(0,d.YI)(t,r,o,e.globalConfig.fps);s.items.splice(n,0,l),(0,d.AO)(s.items,n+1);let c=(0,d.GQ)(e.tracks,e.mediaAssets);if(e.outputSettings.totalDurationInFrames=c.totalDurationInFrames,"video"===s.type&&i.onShotAdd)try{let e=null;if(t.shot_id){let i=a.B.getState().getShotById(t.shot_id);i&&i.is_hidden?(i.is_hidden=!1,i.hidden_at=null,e=i):e=u.wD.createUploadedShotFromMediaAsset(t)}else e=u.wD.createUploadedShotFromMediaAsset(t);e&&(l.shotId=e.shot_id,i.onShotAdd(e,n))}catch(e){console.error("Failed to add shot to videoEditorStore:",e)}}}}),addMediaAssetToTrackAtTime:(t,r,n,o)=>e(e=>{let s;let l=e.tracks.find(e=>e.id===t);if(!l){console.error("[TimelineStore] Track not found:",t);return}let c=e.mediaAssets.find(e=>e.id===r);if(!c){console.error("[TimelineStore] Media asset not found:",r);return}let p=Number.isFinite(n)?Math.max(0,Math.floor(n)):0,h=o;if((0,d.yZ)(l)){let t=(0,d.YI)(c,0,void 0,e.globalConfig.fps).durationInFrames,i=(0,d.H7)(l.items,p,t);s=(0,d.YI)(c,i,void 0,e.globalConfig.fps),l.items.push(s),l.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames)}else{if(void 0===h){let e=l.items.findIndex(e=>e.startTimeInFrames>p);h=-1===e?l.items.length:e}let t=(0,d.hb)(h,l.items);s=(0,d.YI)(c,t,void 0,e.globalConfig.fps),l.items.splice(h,0,s),(0,d.AO)(l.items,h+1)}let m=(0,d.GQ)(e.tracks,e.mediaAssets);if(e.outputSettings.totalDurationInFrames=m.totalDurationInFrames,l.isPrimary&&"video"===l.type&&i.onShotAdd)try{let e=void 0!==h?h:l.items.length-1,t=null;if(c.shot_id){let e=a.B.getState().getShotById(c.shot_id);e&&e.is_hidden?(e.is_hidden=!1,e.hidden_at=null,t=e):t=u.wD.createUploadedShotFromMediaAsset(c)}else t=u.wD.createUploadedShotFromMediaAsset(c);t&&(s.shotId=t.shot_id,i.onShotAdd(t,e))}catch(e){console.error("Failed to add shot to videoEditorStore:",e)}}),moveItemToPosition:(t,i,r)=>e(e=>{let n=e.tracks.find(e=>e.id===t);if(!n){console.error("[TimelineStore] Track not found for moveItemToPosition:",t);return}let o=n.items.find(e=>e.id===i);if(!o){console.error("[TimelineStore] Item not found for moveItemToPosition:",i);return}if((0,d.yZ)(n)){let t=(0,d.H7)(n.items,r,o.durationInFrames,i);o.startTimeInFrames=t,n.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames);let a=(0,d.GQ)(e.tracks,e.mediaAssets);e.outputSettings.totalDurationInFrames=a.totalDurationInFrames}else console.warn("[TimelineStore] Cannot move items freely on primary track")}),replaceTimelineItemWithMediaAsset:(t,i,r)=>e(e=>{let n=e.tracks.find(e=>e.id===t);if(n){let o=n.items.findIndex(e=>e.id===i);if(-1!==o){let a=n.items[o];e.removeItemFromTrack(t,i),e.addMediaAssetToTrack(t,r,o,a.durationInFrames)}}}),setShotSyncCallbacks:e=>{i={...e}},setDraggingSelectionItemIds:t=>e(e=>{e.draggingSelectionItemIds=t}),clearDraggingSelection:()=>e(e=>{e.draggingSelectionItemIds=[]}),applyMultiSelectBlockMove:(i,r,n,o)=>{e(e=>{let a=e.tracks.find(e=>e.id===i);if(!a){console.warn("Target track not found for multi-select drag");return}let s=(0,d.fu)(a.items,o,r,n);a.items=s,t().updateTotalDurationInFrames()})}}}))},44006:function(e,t,i){i.d(t,{Cq:function(){return k},DP:function(){return x},Dt:function(){return h},EU:function(){return f},Fd:function(){return C},UG:function(){return p},d_:function(){return w},ez:function(){return j},tf:function(){return m}});var r=i(75271),n=i(75616),o=i(21964),a=i(10986),s=i(26930),l=i(46973),d=i(47485),c=i(93928),u=i(65027);let p=30,h=()=>/Android/i.test(navigator.userAgent),m=()=>{let{enqueueSnackbar:e}=(0,a.Ds)(),t=(0,n.NL)();return(0,o.D)({mutationFn:async e=>{let t=c.zK.safeParse(e);if(!t.success)throw Error(`Validation failed: ${t.error.errors.map(e=>e.message).join(", ")}`);return(await l.ZP.post("/action-video/create",t.data,{headers:{"Content-Type":"application/json"}})).data},onSuccess:async e=>{await t.invalidateQueries([u.B4])},onError:t=>{var i;let r="Failed to create action video";(null===(i=t.response)||void 0===i?void 0:i.data)&&"object"==typeof t.response.data?r=t.response.data.error||t.message:t.message&&(r=t.message),e(r,{variant:"error"}),console.error("Failed to create action video:",t)}})};function x(e){return c.zK.safeParse(e).success}async function g(e){return new Promise(t=>{let i=0,r=0,n=0,o=setTimeout(()=>{i>=2?t(Math.max(15,Math.min(60,Math.round((i-1)*1e3/(n-r))))):t(30)},5e3),a=(s,l)=>{if(1==++i&&(r=s),n=s,i>=30){clearTimeout(o),t(Math.max(15,Math.min(60,Math.round((i-1)*1e3/(n-r)))));return}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(a)};"requestVideoFrameCallback"in e?e.requestVideoFrameCallback(a):(clearTimeout(o),t(30))})}async function f(e,t){if(!(e.type.includes("webm")||t.toLowerCase().includes(".webm")))return new File([e],t,{type:e.type});try{return await v(e,t)}catch(i){return console.warn("⚠️ WebM metadata enhancement failed, using original file:",i),new File([e],t,{type:e.type})}}async function v(e,t){if(!e||0===e.size)throw Error("Invalid video blob: blob is null, undefined, or has zero size");if(!t||""===t.trim())throw Error("Invalid fileName: filename is empty or null");try{var r;let n;let o=30;try{let t=URL.createObjectURL(e),i=await new Promise((e,i)=>{let r=document.createElement("video");r.preload="metadata",r.muted=!0;let o=setTimeout(()=>{r.remove(),URL.revokeObjectURL(t),i(Error("Timeout waiting for video metadata"))},1e4);r.addEventListener("loadedmetadata",async()=>{clearTimeout(o);let n=r.duration;if(Number.isNaN(n)||!Number.isFinite(n)||n<=0){r.remove(),URL.revokeObjectURL(t),i(Error(`Invalid video duration: ${n}`));return}let a=30;if("requestVideoFrameCallback"in r)try{a=await g(r)}catch(e){console.warn("Failed to estimate FPS, using default:",e)}r.remove(),URL.revokeObjectURL(t),e({duration:n,fps:a})}),r.addEventListener("error",e=>{clearTimeout(o),r.remove(),URL.revokeObjectURL(t),i(Error(`Failed to load video metadata: ${e.type}`))}),r.addEventListener("canplay",async()=>{if(r.duration&&r.duration>0&&!n){clearTimeout(o);let i=r.duration,n=30;if("requestVideoFrameCallback"in r)try{n=await g(r)}catch(e){console.warn("Failed to estimate FPS for webm, using default:",e)}r.remove(),URL.revokeObjectURL(t),e({duration:i,fps:n})}}),r.src=t});n=i.duration,o=i.fps}catch(e){console.warn("Failed to extract video metadata:",e)}let a=(r=o)>=15&&r<=60?r:[24,25,30,60].reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e),{FFmpeg:s}=await Promise.resolve().then(i.bind(i,52846)),{fetchFile:l}=await i.e(5635).then(i.bind(i,75635)),d=new s;d.on("log",e=>{let{message:t}=e}),await d.load();let c=Date.now(),u={"video/webm":"webm","video/mp4":"mp4","video/avi":"avi","video/mov":"mov","video/quicktime":"mov","video/x-msvideo":"avi"}[e.type]||"webm",p=`input_${c}.${u}`,h=`output_${c}.mp4`,m=["-i",p,"-c","copy","-avoid_negative_ts","make_zero","-fflags","+genpts","-movflags","+faststart"],x=["-i",p,"-c:v","libx264","-preset","ultrafast","-crf","28","-r",a.toString(),"-vsync","cfr","-c:a","copy","-avoid_negative_ts","make_zero","-fflags","+genpts","-movflags","+faststart"];"webm"===u&&(m.push("-f","mp4"),x.push("-f","mp4")),n&&n>0&&(m.push("-metadata",`duration=${n}`),x.push("-metadata",`duration=${n}`)),m.push(h),x.push(h),await d.writeFile(p,await l(e));try{await d.exec(m)}catch(e){console.warn("Fast copy failed, trying re-encode approach:",e);try{await d.exec(x)}catch(t){console.warn("Re-encode failed, trying alternative approach:",t);let e=["-i",p,"-c:v","libx264","-preset","ultrafast","-crf","30","-r",a.toString(),"-g","60","-c:a","copy","-f","mp4",h];await d.exec(e)}}let f=await d.readFile(h);if(await d.deleteFile(p),await d.deleteFile(h),!f||0===f.length)throw Error("FFmpeg output is empty or invalid");let v=new Blob([f],{type:"video/mp4"});if(0===v.size)throw Error("Generated blob has zero size");return new File([v],t,{type:"video/mp4"})}catch(i){if(console.error("Failed to fix video metadata with FFmpeg:",i),0===e.size)throw Error("Original video blob has zero size, cannot create valid file");return new File([e],t,{type:e.type||"video/webm"})}}async function b(e){let t=(await fetch(e,{method:"HEAD"})).headers.get("content-length");return t?Number.parseInt(t):0}async function y(e){return new Promise((t,i)=>{let r=new Image,n=e instanceof File?URL.createObjectURL(e):e;r.addEventListener("load",()=>{t({width:r.width,height:r.height})}),r.addEventListener("error",()=>{i(Error(`Failed to load image from ${e instanceof File?"file":"URL"}`))}),r.src=n})}let w=3,C=30,j=(e,t)=>{let{mutateAsync:i}=(0,d.x)();return(0,r.useCallback)(async(r,n)=>{try{let{validateDuration:o=!1}=n||{},a=0,l=0;if("string"==typeof r){let e=await i(r);l=e.duration,a=e.size}else a=r.size,l=await (0,s.u5)(r);if(e.maxVideoSize&&a>1048576*e.maxVideoSize)return t(`Video file size must be ${e.maxVideoSize}MB or less`),!1;if(o){let i=function(e,t){let i=(null==t?void 0:t.minVideoDuration)??w,r=(null==t?void 0:t.maxVideoDuration)??C;return e<i?`Video too short. Minimum: ${i}s, your video: ${e.toFixed(1)}s`:e>r?`Video too long. Maximum: ${r}s, your video: ${e.toFixed(1)}s`:""}(l,e);if(i)return t(i),!1}return!0}catch(e){return console.error("Failed to validate video file:",e),!0}},[i,e,t])},k=(e,t)=>(0,r.useCallback)(async i=>{try{let r=0;if(r="string"==typeof i?await b(i):i.size,e.maxImageSize&&r>1048576*e.maxImageSize)return t(`Image file size must be ${e.maxImageSize}MB or less`),!1;if(e.imageAspectRatios&&e.imageAspectRatios.length>0){let r=await y(i),n=r.width/r.height;if(n<e.imageAspectRatios[0]||n>e.imageAspectRatios[1])return t(`Image aspect ratio must be between ${e.imageAspectRatios[0]} and ${e.imageAspectRatios[1]}`),!1}return!0}catch(e){return console.error("Failed to validate image file:",e),!0}},[e,t])},45029:function(e,t,i){i.d(t,{I:function(){return u}});var r=i(75271),n=i(29634),o=i(94959),a=i(19005),s=i(60720);let l=()=>`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.05,t=Math.max(1e-4,Math.min(1,e)),i=Math.floor(1/t),r=[];for(let e=0;e<=i;e+=1){let i=Math.round(e*t*1e4)/1e4;i>=0&&i<=1&&r.push(i)}return 1!==r.at(-1)&&r.push(1),0!==r.at(0)&&r.unshift(0),Array.from(new Set(r)).sort((e,t)=>e-t)}class c{createCredentialAndSession(e,t){e.userId||(e.userId=this.opts.uid??""),e.recommId||(e.recommId=this.recommId??"");let i=this.createPlaySessionWithCredential(e,t);return{credential:e,sessionId:i}}async startPlayWithCredential(e,t){return this.logPlayStart({...e,sessionId:t})}createPlaySessionWithCredential(e,t){let i=`${e.userId??""}::${e.itemId}`,r=this.playingSessions.get(i),n=t??(null==r?void 0:r.sessionId)??l(),o=e.recommId??(null==r?void 0:r.recommId);if(r){var a;r.sessionId=n,r.lastPortion=0,r.recommId=o,null===(a=r.milestonesHit)||void 0===a||a.add(0)}else r={sessionId:n,lastPortion:0,recommId:o,milestonesHit:new Set([0])},this.playingSessions.set(i,r);return n}async updatePlayWithCredential(e){let{credential:t,sessionId:i,portion:r}=e;await this.updatePortion({...t,sessionId:i,portion:r})}endPlayWithCredential(e){this.endSession(e.userId,e.itemId)}async send(e){try{return await this.client.send(e)}catch(e){throw e}}dispatch(e){let t=this.withFixedRecommId(e.p);if(!t.recommId&&this.opts.onlySendWithRecommId)return Promise.resolve();if(!t.userId)return Promise.reject("userId is required");switch(e.type){case"AddDetailView":return this.send(new s.AddDetailView(t.userId,t.itemId,{recommId:t.recommId,timestamp:t.timestamp,cascadeCreate:t.cascadeCreate??!0}));case"SetViewPortion":{let e=Math.max(0,Math.min(1,t.portion));return this.send(new s.SetViewPortion(t.userId,t.itemId,e,{sessionId:t.sessionId,recommId:t.recommId,timestamp:t.timestamp,cascadeCreate:t.cascadeCreate??!0}))}case"AddCartAddition":return this.send(new s.AddCartAddition(t.userId,t.itemId,{recommId:t.recommId,timestamp:t.timestamp,cascadeCreate:t.cascadeCreate??!0}));case"AddBookmark":return this.send(new s.AddBookmark(t.userId,t.itemId,{recommId:t.recommId,timestamp:t.timestamp,cascadeCreate:t.cascadeCreate??!0}));case"AddPurchase":return this.send(new s.AddPurchase(t.userId,t.itemId,{price:t.price,amount:t.amount,recommId:t.recommId,timestamp:t.timestamp,cascadeCreate:t.cascadeCreate??!0}));default:return Promise.resolve()}}withFixedRecommId(e){let t={recommId:e.recommId,userId:e.userId};return this.opts.recommId&&!t.recommId&&(t.recommId=this.recommId),!t.userId&&this.opts.uid&&(t.userId=this.opts.uid),Object.assign({},e,t)}async logView(e){try{await this.dispatch({type:"AddDetailView",p:e})}catch{}}async logPlayStart(e){let t=`${e.userId}::${e.itemId}`,i=this.playingSessions.get(t),r=e.sessionId??(null==i?void 0:i.sessionId)??l(),n=e.recommId??(null==i?void 0:i.recommId),o={type:"SetViewPortion",p:{...e,sessionId:r,portion:0,recommId:n}};try{await this.dispatch(o)}catch{}if(i){var a;i.sessionId=r,i.lastPortion=0,i.recommId=n,null===(a=i.milestonesHit)||void 0===a||a.add(0)}else i={sessionId:r,lastPortion:0,recommId:n,milestonesHit:new Set([0])},this.playingSessions.set(t,i);return r}async updatePortion(e){let t=`${e.userId}::${e.itemId}`,i=this.playingSessions.get(t),r=Math.max(0,Math.min(1,e.portion));if(!i||i.sessionId!==e.sessionId)return this.firePortion(e);if(r<=i.lastPortion+.001)return;let n=this.opts.milestonePercents.filter(e=>{var t;return e<=r&&!(null===(t=i.milestonesHit)||void 0===t?void 0:t.has(e))});if(n.length>0){await Promise.all(n.map(t=>this.firePortion({...e,portion:t}))),n.forEach(e=>{var t;return null===(t=i.milestonesHit)||void 0===t?void 0:t.add(e)});let t=n.at(-1);i.lastPortion=t??i.lastPortion}}async logShare(e){try{await this.dispatch({type:"AddCartAddition",p:e})}catch{}}async logDownload(e){try{await this.dispatch({type:"AddBookmark",p:e})}catch{}}async logMainCTAConverted(e){try{await this.dispatch({type:"AddPurchase",p:e})}catch{}}async firePortion(e){try{await this.dispatch({type:"SetViewPortion",p:e})}catch{}}createSession(e){let t=`${e.userId}::${e.itemId}`,i=e.sessionId??l(),r=e.recommId;return this.playingSessions.set(t,{sessionId:i,lastPortion:0,recommId:r}),i}endSession(e,t){let i=`${e}::${t}`;this.playingSessions.delete(i)}constructor(e){this.playingSessions=new Map,this.opts={milestonePercents:e.milestonePercents??d(.05),onlySendWithRecommId:e.onlySendWithRecommId??!0,recommId:e.recommId??void 0,uid:e.uid??void 0,...e},this.recommId=e.recommId,this.client=new s.ApiClient("openart-prod","u7GVn1sl8VCmSHqHE8ZLYjIHHltSIdUn7ZEDUZeAWPTieH0WlLghq1M7s3wE25ug",{region:"us-west"}),this.playingSessions=new Map}}new c({milestonePercents:d(.1),onlySendWithRecommId:!0});let u=()=>{let e=(0,o.c)(),{data:t}=(0,a.CD)(),i=n.Z.get("unique_device_id"),s=(null==t?void 0:t.id)||i;return(0,r.useMemo)(()=>new c({milestonePercents:d(.1),onlySendWithRecommId:!0,recommId:e,uid:s}),[s,e])}},94959:function(e,t,i){i.d(t,{c:function(){return o},n:function(){return n}});var r=i(75271);let n=(0,r.createContext)(null),o=()=>(0,r.useContext)(n)},93928:function(e,t,i){i.d(t,{NT:function(){return a},ak:function(){return o},zK:function(){return n}});var r=i(84291);let n=r.Ry({characterUrl:r.Z_().url("Must be a valid media URL"),characterType:r.Km(["image","video"]),referenceUrl:r.Z_().url("Must be a valid video URL"),referenceType:r.Km(["video"]),model:r.Km(["runway-act2","wan2.2-v1"],{errorMap:()=>({message:"Invalid model selected"})}),ratio:r.Km(["1280:720","720:1280","960:960","1104:832","832:1104","1584:672"]).catch("1280:720"),expressionIntensity:r.Rx().min(1).max(5).optional(),description:r.Z_().optional(),prompt:r.Z_().default("Imitate the actions in the video"),segmentTarget:r.Z_().default("object"),wan22Type:r.Km(["motion_sync","full_scene"]).optional(),resolution:r.Rx().optional()}),o={"runway-act2":{featureKeys:["app.action-video.runway-act2"],mediaType:"video",name:"runway-act2",displayName:"Runway Act-Two",minVideoDuration:3,maxVideoDuration:30,maxVideoSize:32,maxImageSize:16,imageAspectRatios:[.5,2],supportDescription:!1,description:"Perfect for natural, multi-speaker conversations.",iconColor:"#E91E63",iconUrl:"https://cdn.openart.ai/assets/runway-icon.png"},"wan2.2-v1":{featureKeys:["app.action-video.wan2.2-v1"],mediaType:"image",name:"wan2.2-v1",displayName:"OpenArt Motion",minVideoDuration:3,maxVideoDuration:30,supportDescription:!1,description:"seamlessly swaps faces or features in videos for realistic human transformations.",iconColor:"#E91E63",iconUrl:"https://cdn.openart.ai/music_video/openart_model_log.png"}},a=["video/mp4","video/webm","video/ogg","video/mov","video/quicktime","video/h264"]},32687:function(e,t,i){i.d(t,{MU:function(){return l},P3:function(){return s},Pu:function(){return c},ij:function(){return u},l9:function(){return d},vB:function(){return p}});var r=i(32880),n=i(48725),o=i(22219),a=i(92157);function s(e){let t={};if(!e||0===e.length)return t;let i=r.LexoRank.middle();for(let r=0;r<e.length;r++){let n=e[r],o={...n,lexorank:i.toString()};t[n.shot_id]=o,r<e.length-1&&(i=i.genNext())}return t}function l(e){return(0,n.Z)(e)?[]:(0,o.Z)((0,a.Z)(e),e=>(null==e?void 0:e.lexorank)?r.LexoRank.parse(e.lexorank):(console.error("Shot has no lexorank",e),r.LexoRank.max()))}function d(e,t,i,n){let o;let a={...e};if(i||n){if(i){if(n){let t=e[i],a=e[n];if(!t)throw Error(`Before shot with ID ${i} not found`);if(!a)throw Error(`After shot with ID ${n} not found`);let s=r.LexoRank.parse(t.lexorank),l=r.LexoRank.parse(a.lexorank);o=s.between(l)}else{let t=e[i];if(!t)throw Error(`Before shot with ID ${i} not found`);o=r.LexoRank.parse(t.lexorank).genNext()}}else{let t=e[n];if(!t)throw Error(`After shot with ID ${n} not found`);o=r.LexoRank.parse(t.lexorank).genPrev()}}else o=r.LexoRank.middle();let s={...t,lexorank:o.toString()};return a[t.shot_id]=s,a}function c(e,t,i,r){let{[t]:n,...o}=e;if(!n)throw Error(`Shot with ID ${t} not found`);let{lexorank:a,...s}=n;return d(o,s,i,r)}function u(e,t){let i={...e};return i[t]&&("auto"===i[t].shot_type?i[t]={...i[t],is_hidden:!0,hidden_at:Math.floor(Date.now()/1e3)}:delete i[t]),i}function p(e,t,i){let r=e[t];if(!r)throw Error(`Shot with ID ${t} not found`);return{...e,[t]:{...r,...i}}}},95239:function(e,t,i){i.d(t,{B4:function(){return c},HP:function(){return l},hM:function(){return d},wD:function(){return u}});var r=i(67197),n=i(81479),o=i(77913),a=i(32687);let s=o.UG,l="failed-video-resource-id",d="https://cdn.openart.ai/assets/whats_new/file_Wx-fkUz9_1750754633802.mp4";function c(e,t,i,n,o){let a=s*o||3*s,l={...e,id:e.id||"",resource_type:"video",title:t,url:e.url||"",metadata:(null==e?void 0:e.metadata)||{frames:a,duration:o||3,width:1920,height:1080,fps:s}};return{timelineItem:{id:(0,r.x0)(),mediaAssetId:e.id,shotId:null==e?void 0:e.shot_id,type:"overlay",title:t,startTimeInFrames:i,durationInFrames:a,sourceTrimStartFrames:0,sourceTrimEndFrames:a,speed:1,volume:1,status:"failed",statusMessage:e.status_message||"Generation Error",overlayConfig:{type:"error",message:"Oops, our spell slipped! Credits refunded —you can regenerate this shot in the editor."}},mediaAsset:l,duration:a}}let u={isValidTrack:e=>!!e&&"string"==typeof e.type&&"string"==typeof e.name&&"string"==typeof e.id&&Array.isArray(e.items),isValidMediaAsset:e=>!!e&&"string"==typeof e.id&&"string"==typeof e.url,getMediaAssetByTimelineItem:(e,t)=>t.find(t=>t.id===e.mediaAssetId),mapMediaAssetTypeToMediaResourceType(e){switch(e){case"image":return{type:"image",subtype:void 0};case"video":return{type:"video",subtype:void 0};case"music":return{type:"audio",subtype:"music"};case"voiceover":return{type:"audio",subtype:"voiceover"};case"caption":return{type:"file",subtype:"caption"}}},mapMediaResourceTypeToMediaAssetCategory(e,t){switch(e){case"image":return"image";case"video":return"video";case"audio":switch(t){case"music":default:return"music";case"voiceover":return"voiceover"}case"file":if("caption"===t)return"caption";return"video";default:return"video"}},convertStoryMediaResourceToMediaAssetItem:e=>({...e,id:e.id||""}),getTrackCategory(e,t){if("video"===e.type)return"video";if("audio"===e.type){let i=e.items[0];if(!i)return"voiceover"===e.subtype?"voiceover":"music";let r=t.find(e=>e.id===i.mediaAssetId);return r?(null==r?void 0:r.subtype)==="voiceover"?"voiceover":(r.subtype,"music"):"voiceover"===e.subtype?"voiceover":"music"}return"file"===e.type?"caption":"video"},findMediaAsset:(e,t)=>t&&e.find(e=>e.id===t)||null,getOrCreateVideoTrack(e){let t=e.tracks.find(e=>"video"===e.type);return t||(t={id:`track_video_${(0,r.x0)()}`,type:"video",name:"Video Track",items:[]},e.tracks.push(t)),t},getOrCreateVoiceoverTrack(e){let t=e.tracks.find(e=>"audio"===e.type&&"voiceover"===e.subtype);return t||(t={id:`track_voiceover_${(0,r.x0)()}`,type:"audio",subtype:"voiceover",name:"Voiceover Track",items:[]},e.tracks.push(t)),t},validateShotMediaAssets(e,t){if(e.active_video_id&&!this.findMediaAsset(t,e.active_video_id))throw Error(`Video media asset with ID ${e.active_video_id} not found for shot ${e.shot_id}`);if(e.active_image_id&&!this.findMediaAsset(t,e.active_image_id))throw Error(`Image media asset with ID ${e.active_image_id} not found for shot ${e.shot_id}`);if(e.active_voice_over_audio_id&&!this.findMediaAsset(t,e.active_voice_over_audio_id))throw Error(`Audio media asset with ID ${e.active_voice_over_audio_id} not found for shot ${e.shot_id}`)},getShotByMediaAsset(e,t){if(!e)return null;switch(e.resource_type){case"video":return t.find(t=>t.active_video_id===e.id);case"image":return t.find(t=>t.active_image_id===e.id);case"audio":if("voiceover"===e.subtype)return t.find(t=>t.active_voice_over_audio_id===e.id);return null;default:return null}},createUploadedShotFromMediaAsset(e,t){let i=(0,n.To)({shot_type:"video"===e.resource_type?"uploaded_video":"uploaded_image",video_prompt:""});return"video"===e.resource_type?(i.active_video_id=e.id,i.active_video_url=e.url):(i.active_image_id=e.id,i.active_image_url=e.url),i},generateTimelineItems(e,t,i,r,n){var o,a,l,d;let c=0,u=1;if(t&&i){let e=(null===(o=t.metadata)||void 0===o?void 0:o.duration)*s||0,r=(null===(a=i.metadata)||void 0===a?void 0:a.duration)*s||0;r>0?(u=e/r,c=r):c=e}else if(t)c=(null===(l=t.metadata)||void 0===l?void 0:l.duration)*s||0;else{if(!i)return{videoItem:null,voiceoverItem:null,nextStartTime:r};c=(null===(d=i.metadata)||void 0===d?void 0:d.duration)*s||0}return c=!Number.isFinite(c)||c<=0?s:Math.max(c,s),{videoItem:t?this.createVideoItem(e,t,r,c,u,n):null,voiceoverItem:i?this.createVoiceoverItem(e,i,r,c,n):null,nextStartTime:r+c}},createVideoItem(e,t,i,r,n,o){var a;return{id:`video-${e.shot_id}-${Date.now()}`,mediaAssetId:t.id,shotId:e.shot_id,type:"video",title:`Video for ${e.shot_id}`,startTimeInFrames:i,durationInFrames:r,sourceTrimStartFrames:0,sourceTrimEndFrames:(null===(a=t.metadata)||void 0===a?void 0:a.frames)||r,speed:n,volume:1,...o&&{groupId:o}}},createVoiceoverItem:(e,t,i,r,n)=>({id:`voiceover-${e.shot_id}-${Date.now()}`,mediaAssetId:t.id,shotId:e.shot_id,type:"audio",title:`Voiceover for ${e.shot_id}`,startTimeInFrames:i,durationInFrames:r,sourceTrimStartFrames:0,sourceTrimEndFrames:r,speed:1,volume:1,...n&&{groupId:n}}),updateSubsequentItemStartTimes(e,t){if(!(t<0)&&!(t>=e.length))for(let i=t;i<e.length;i++)if(0===i)e[i].startTimeInFrames=0;else{let t=e[i-1];e[i].startTimeInFrames=t.startTimeInFrames+t.durationInFrames}},getTimelineItemsByShot(e,t){let i=[];return e.tracks.forEach(e=>{e.items.forEach(e=>{e.shotId===t&&i.push(e)})}),i},removeTimelineItemsByShot(e,t){e.tracks.forEach(e=>{let i=e.items.length;e.items=e.items.filter(e=>e.shotId!==t),e.items.length<i&&(e.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),this.updateSubsequentItemStartTimes(e.items,0))})},insertTimelineItemsForShot(e,t,i){let r=e.mediaAssets,n=this.findMediaAsset(r,t.active_video_id),o=this.findMediaAsset(r,t.active_voice_over_audio_id);if(!n&&!o)return;let a=n?this.getOrCreateVideoTrack(e):null,s=o?this.getOrCreateVoiceoverTrack(e):null,l=0;if(i>0&&a&&a.items.length>0){let e=a.items[Math.min(i-1,a.items.length-1)];e&&(l=e.startTimeInFrames+e.durationInFrames)}let d=n&&o?`group-${t.shot_id}`:void 0,c=this.generateTimelineItems(t,n,o,l,d);c.videoItem&&a&&(a.items.splice(i,0,c.videoItem),this.updateSubsequentItemStartTimes(a.items,i+1)),c.voiceoverItem&&s&&(s.items.splice(i,0,c.voiceoverItem),this.updateSubsequentItemStartTimes(s.items,i+1))},addShot(e,t,i,r){let n={...e};n.storyboard||(n.storyboard={shots_map:{}}),n.storyboard.shots_map||(n.storyboard.shots_map={}),n.video_editor_timeline||(n.video_editor_timeline={tracks:[],mediaAssets:[],globalConfig:o.Kz}),this.validateShotMediaAssets(t,n.video_editor_timeline.mediaAssets),n.storyboard.shots_map=(0,a.l9)(n.storyboard.shots_map,t,i||null,r||null);let s=(0,a.MU)(n.storyboard.shots_map).findIndex(e=>e.shot_id===t.shot_id);return this.insertTimelineItemsForShot(n.video_editor_timeline,t,s),n},deleteShot(e,t){var i;let r={...e};return(null===(i=r.storyboard)||void 0===i?void 0:i.shots_map)&&r.video_editor_timeline&&(r.storyboard.shots_map=(0,a.ij)(r.storyboard.shots_map,t),this.removeTimelineItemsByShot(r.video_editor_timeline,t)),r},updateShot(e,t){var i;let r={...e};return(null===(i=r.storyboard)||void 0===i?void 0:i.shots_map)&&r.video_editor_timeline&&(this.validateShotMediaAssets(t,r.video_editor_timeline.mediaAssets),r.storyboard.shots_map=(0,a.vB)(r.storyboard.shots_map,t.shot_id,t),this.updateTimelineItemsForShot(r.video_editor_timeline,t)),r},reorderShots(e,t,i,r){var n;let o={...e};if(!(null===(n=o.storyboard)||void 0===n?void 0:n.shots_map)||!o.video_editor_timeline)return o;o.storyboard.shots_map=(0,a.Pu)(o.storyboard.shots_map,t,i||null,r||null);let s=this.getTimelineItemsByShot(o.video_editor_timeline,t);o.video_editor_timeline.tracks.forEach(e=>{e.items=e.items.filter(e=>e.shotId!==t)});let l=(0,a.MU)(o.storyboard.shots_map).findIndex(e=>e.shot_id===t);return s.forEach(e=>{let t=o.video_editor_timeline.tracks.find(t=>t.type===e.type&&("audio"!==e.type||"voiceover"===t.subtype));if(t){let i=0;if(l>0){let e=t.items.filter((e,t)=>t<l);if(e.length>0){let t=e.at(-1);i=t.startTimeInFrames+t.durationInFrames}}let r={...e,startTimeInFrames:i};t.items.splice(l,0,r)}}),o.video_editor_timeline.tracks.forEach(e=>{e.items.sort((e,t)=>e.startTimeInFrames-t.startTimeInFrames),this.updateSubsequentItemStartTimes(e.items,0)}),o},addTimelineItem(e,t,i,r){var n;let s={...e};s.video_editor_timeline||(s.video_editor_timeline={tracks:[],mediaAssets:[],globalConfig:o.Kz});let l=s.video_editor_timeline.tracks.find(e=>e.id===r);if(!l)throw Error(`Track with ID ${r} not found`);let d=this.findMediaAsset(s.video_editor_timeline.mediaAssets,t.mediaAssetId);if(!d)throw Error(`Media asset with ID ${t.mediaAssetId} not found`);if(l.items.splice(i,0,t),this.updateSubsequentItemStartTimes(l.items,i+1),t.shotId&&(null===(n=s.storyboard)||void 0===n?void 0:n.shots_map)&&!s.storyboard.shots_map[t.shotId]){let e={shot_id:t.shotId,shot_type:"manual",active_video_id:"video"===t.type?t.mediaAssetId:void 0,active_image_id:"image"===t.type?t.mediaAssetId:void 0,active_voice_over_audio_id:"audio"===t.type?t.mediaAssetId:void 0,active_video_url:"video"===t.type?d.url:void 0,active_image_url:"image"===t.type?d.url:void 0,active_voice_over_audio_url:"audio"===t.type?d.url:void 0},r=(0,a.MU)(s.storyboard.shots_map),n=i>0?r[i-1]:null,o=i<r.length?r[i]:null;s.storyboard.shots_map=(0,a.l9)(s.storyboard.shots_map,e,(null==n?void 0:n.shot_id)||null,(null==o?void 0:o.shot_id)||null)}return s},deleteTimelineItem(e,t,i){var r;let n={...e};if(!n.video_editor_timeline)return n;let o=n.video_editor_timeline.tracks.find(e=>e.id===i);if(!o)throw Error(`Track with ID ${i} not found`);let s=o.items.find(e=>e.id===t);return s&&(o.items=o.items.filter(e=>e.id!==t),s.shotId&&(null===(r=n.storyboard)||void 0===r?void 0:r.shots_map)&&(n.storyboard.shots_map=(0,a.ij)(n.storyboard.shots_map,s.shotId))),n},updateTimelineItem(e,t,i){let r={...e};if(!r.video_editor_timeline)return r;let n=r.video_editor_timeline.tracks.find(e=>e.id===i);if(!n)throw Error(`Track with ID ${i} not found`);let o=n.items.findIndex(e=>e.id===t.id);if(-1===o)throw Error(`Timeline item with ID ${t.id} not found`);let s=n.items[o];if(n.items[o]={...s,...t},s.durationInFrames!==t.durationInFrames&&this.updateSubsequentItemStartTimes(n.items,o+1),void 0!==t.mediaAssetId&&s.mediaAssetId!==t.mediaAssetId){var l;let e=this.findMediaAsset(r.video_editor_timeline.mediaAssets,t.mediaAssetId);if(!e)throw Error(`Media asset with ID ${t.mediaAssetId} not found`);let i=n.items[o].shotId;if(i&&(null===(l=r.storyboard)||void 0===l?void 0:l.shots_map)){let s={};switch(n.items[o].type){case"video":s.active_video_id=t.mediaAssetId,s.active_video_url=e.url;break;case"image":s.active_image_id=t.mediaAssetId,s.active_image_url=e.url;break;case"audio":s.active_voice_over_audio_id=t.mediaAssetId,s.active_voice_over_audio_url=e.url}Object.keys(s).length>0&&(r.storyboard.shots_map=(0,a.vB)(r.storyboard.shots_map,i,s))}}return r},reorderTimelineItems(e,t,i){var r;let n={...e};if(!n.video_editor_timeline)return n;let o=n.video_editor_timeline.tracks.find(e=>e.id===i);if(!o)throw Error(`Track with ID ${i} not found`);let a=Object.fromEntries(o.items.map(e=>[e.id,e])),s=t.map(e=>{let t=a[e];if(!t)throw Error(`Timeline item with ID ${e} not found`);return t});if(o.items=s,this.updateSubsequentItemStartTimes(o.items,0),"video"===o.type&&(null===(r=n.storyboard)||void 0===r?void 0:r.shots_map)){let e=s.map(e=>e.shotId).filter(Boolean);e.length>0&&this.reorderShotsByIds(n,e)}return n},addMediaAsset:(e,t)=>({...e,video_editor_timeline:{...e.video_editor_timeline,mediaAssets:[...e.video_editor_timeline.mediaAssets,t]}}),addMediaAssets:(e,t)=>({...e,video_editor_timeline:{...e.video_editor_timeline,mediaAssets:[...e.video_editor_timeline.mediaAssets,...t]}}),removeMediaAsset(e,t){var i;let r={...e};return!r.video_editor_timeline||r.video_editor_timeline.tracks.some(e=>e.items.some(e=>e.mediaAssetId===t))||(null===(i=r.storyboard)||void 0===i?void 0:i.shots_map)&&Object.values(r.storyboard.shots_map).some(e=>e.active_video_id===t||e.active_image_id===t||e.active_voice_over_audio_id===t)||(r.video_editor_timeline={...r.video_editor_timeline,mediaAssets:r.video_editor_timeline.mediaAssets.filter(e=>e.id!==t)}),r},updateTimelineItemsForShot(e,t){let i=e.mediaAssets;e.tracks.forEach(e=>{e.items.forEach(e=>{if(e.shotId===t.shot_id){let r=e.mediaAssetId;"video"===e.type&&t.active_video_id?this.findMediaAsset(i,t.active_video_id)&&(r=t.active_video_id):"image"===e.type&&t.active_image_id?this.findMediaAsset(i,t.active_image_id)&&(r=t.active_image_id):"audio"===e.type&&t.active_voice_over_audio_id&&this.findMediaAsset(i,t.active_voice_over_audio_id)&&(r=t.active_voice_over_audio_id),e.mediaAssetId=r}})})},reorderShotsByIds(e,t){var i;if(!(null===(i=e.storyboard)||void 0===i?void 0:i.shots_map))return;let r=t.map(t=>{let i=e.storyboard.shots_map[t];if(!i)throw Error(`Shot with ID ${t} not found`);let{lexorank:r,...n}=i;return n});e.storyboard.shots_map=(0,a.P3)(r)}}},92295:function(e,t,i){i.d(t,{Z:function(){return n}});var r=i(75271);function n(){let[e,t]=(0,r.useState)({widthValue:void 0,heightValue:void 0,width:"100dvw",height:"100dvh"});return(0,r.useEffect)(()=>{function e(){t({widthValue:window.innerWidth,heightValue:window.innerHeight,width:`${window.innerWidth}px`,height:`${window.innerHeight}px`})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3173],{43480:function(e,t,r){r.d(t,{u:function(){return E}});var o=r(52676),a=r(49218),i=r(49049),n=r(47485),l=r(27806),s=r(29984),c=r(80110),d=r(46890),u=r(60588),p=r(89228),m=r(20198),v=r(60464),h=r(59147),x=r(9440),f=r(75271),y=r(22988),g=r(6721),b=r(23638),j=r(39204);let C=(0,f.forwardRef)((e,t)=>{let{videoUrl:r,onDelete:a,poster:i,onFrameExtract:n,extractFrameOnPause:s}=e,[c,d]=(0,f.useState)(!1),[u,p]=(0,f.useState)(!1),m=(0,f.useRef)(null),v=(0,f.useCallback)(()=>{let e=m.current;if(e&&n){if(!e.videoWidth||!e.videoHeight){console.warn("Video dimensions not available yet");return}try{let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;let r=t.getContext("2d");if(!r){console.error("Failed to get canvas context");return}r.drawImage(e,0,0,t.width,t.height);let o=t.toDataURL("image/png");n(o,e.currentTime)}catch(e){e instanceof DOMException&&"SecurityError"===e.name?console.error("CORS error: Video server needs to allow cross-origin access. Make sure the video server sends proper CORS headers (Access-Control-Allow-Origin)."):e&&"object"==typeof e&&"name"in e&&"SecurityError"===e.name?console.error("CORS error: Video server needs to allow cross-origin access. Make sure the video server sends proper CORS headers (Access-Control-Allow-Origin)."):console.error("Error extracting frame:",e)}}},[n]);(0,f.useImperativeHandle)(t,()=>({extractFrame:v}),[v]),(0,f.useEffect)(()=>{let e=m.current;if(!e)return;let t=()=>{p(!1)};return e.addEventListener("ended",t),()=>{e.removeEventListener("ended",t)}},[r]);let h=(0,f.useCallback)(e=>{e.stopPropagation(),m.current&&m.current.pause(),p(!1),null==a||a()},[a]);return(0,o.jsxs)(y.Z,{onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),sx:{position:"relative",width:"100%",height:158,borderRadius:1,overflow:"hidden",backgroundSize:"100% 100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,o.jsx)("video",{ref:m,src:r,poster:i,controls:!0,style:{width:"100%",height:"100%"},preload:"metadata",playsInline:!0,crossOrigin:"anonymous",onTouchEnd:()=>d(!0),onPause:()=>{p(!1),s&&n&&setTimeout(()=>{v()},50)},onPlay:()=>{p(!0)},onLoadedMetadata:()=>{let e=m.current;if(e&&n){if(0!==e.currentTime){e.currentTime=0;let t=()=>{setTimeout(()=>{v()},100),e.removeEventListener("seeked",t)};e.addEventListener("seeked",t)}else if(e.readyState>=2)setTimeout(()=>{v()},100);else{let t=()=>{setTimeout(()=>{v()},100),e.removeEventListener("canplay",t)};e.addEventListener("canplay",t)}}},onSeeked:()=>{s&&n&&setTimeout(()=>{v()},50)}}),(0,o.jsx)(b.M,{children:c&&a?(0,o.jsx)(j.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{position:"absolute",top:8,right:8},children:(0,o.jsx)(g.Z,{size:"small",onClick:h,sx:{color:"white",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"5px","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:(0,o.jsx)(l.PhTrash,{size:16,color:"var(--Gray-900, #FFF)"})})}):null})]})});C.displayName="VideoPlayer";var k=r(32964),w=r(70811),R=r(4528),S=r(89252);let U=[{id:"upload",label:"Upload",icon:l.PhCloudArrowUp},{id:"history",label:"History",icon:l.PhClockCounterClockwise}],L=e=>new Promise(t=>{try{let r=document.createElement("video");r.preload="metadata";let o=URL.createObjectURL(e);r.addEventListener("loadedmetadata",()=>{URL.revokeObjectURL(o);let e=r.videoWidth,a=r.videoHeight,i=e/a;i<.5||i>2?t(!1):t(!0)}),r.src=o}catch(e){return console.error("Failed to validate aspect ratio:",e),!0}}),E=(0,f.forwardRef)((e,t)=>{let{content:r,modelConfig:y,cdnFolder:g,onSelectSource:E,onRemove:M,onFrameExtract:Z,videoIcon:P,contentText:D,contentSubText:F}=e,z=(0,f.useRef)(null),[V,O]=(0,f.useState)(!1),[T,I]=(0,f.useState)(null),[A,_]=(0,f.useState)(""),H=(0,f.useRef)(null),N=(0,f.useRef)(null),[$,G]=(0,f.useState)(!1),{mutateAsync:W}=(0,n.x)(),B=(0,x.ez)(y,_),[K,q]=(0,f.useState)(null);(0,f.useImperativeHandle)(t,()=>({extractFrame:()=>{var e;null===(e=N.current)||void 0===e||e.extractFrame()}}),[]);let{uploadFile:Q,isUploading:X,progress:J,reset:Y}=(0,i.k)({cdnFolder:g,onSuccess:async e=>{K&&(URL.revokeObjectURL(K),q(null));try{let t=await W(e.url),r=(e.url.split("/").pop()||"Uploaded Video").replace(/\.[^/.]+$/,"");E("video","upload",e.url,{duration:t.duration,name:r})}catch(t){console.error("Failed to get video duration:",t),E("video","upload",e.url,{duration:void 0,name:"Uploaded Video"})}G(!1)},onError:e=>{K&&(URL.revokeObjectURL(K),q(null)),_(e.message),G(!1)}}),ee=(0,f.useCallback)(async e=>{_(""),Y();try{G(!0);let t=URL.createObjectURL(e);if(q(t),!await B(e,{validateDuration:!0})){URL.revokeObjectURL(t),q(null),G(!1);return}if(!await L(e)){_("Video aspect ratio must be between 0.5 and 2"),URL.revokeObjectURL(t),q(null),G(!1);return}await Q(e)}catch(e){console.error("Video validation failed:",e),_("Failed to validate video"),K&&(URL.revokeObjectURL(K),q(null)),G(!1)}},[Y,Q,B,K]),et=(e,t)=>{if(t.stopPropagation(),t.preventDefault(),"upload"===e.id){var r;null===(r=H.current)||void 0===r||r.click(),er()}else"history"===e.id&&(ea(),er())},er=()=>{I(null)},eo=(0,f.useCallback)(async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&await ee(r),H.current&&(H.current.value="")},[ee]),{handleShowModal:ea}=(0,a.p)({type:"video",maxSelectionCount:1,onClose:async e=>{if(e&&e.length>0){let t=e[0];if(t.match(/\.(mp4|webm|mov|avi|mkv|qt)$/i)){if(!await B(t,{validateDuration:!0}))return;try{let e=await W(t);E("video","history",t,{duration:e.duration,name:"History Video"})}catch(e){console.error("Failed to get video metadata:",e),E("video","history",t)}}}}}),ei=async e=>{e.preventDefault(),e.stopPropagation(),O(!1);let t=Array.from(e.dataTransfer.files)[0];if(t&&t.type.startsWith("video/")){if(!await B(t,{validateDuration:!0}))return;if(!await L(t)){_("Video aspect ratio must be between 0.5 and 2");return}await ee(t)}};return X||$?(0,o.jsxs)(k.Z,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:158,gap:1,p:2,borderRadius:1,border:"2px dashed",borderColor:e=>e.palette.Colors.Gray["300"],backgroundColor:e=>e.palette.Colors.Gray["100"]},children:[K?(0,o.jsx)(k.Z,{component:"video",src:K,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",zIndex:0},muted:!0,playsInline:!0,preload:"metadata"}):(0,o.jsx)(k.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:e=>e.palette.Colors.Gray["100"],zIndex:0}}),(0,o.jsxs)(k.Z,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",gap:1,backgroundColor:"rgba(0, 0, 0, 0.5)",borderRadius:2,padding:2},children:[(0,o.jsx)(s.Z,{size:24,sx:{color:"white"}}),(0,o.jsx)(c.Z,{variant:"body2",sx:{textAlign:"center",color:"white",fontWeight:500},children:X?`Uploading... ${J}%`:$?"Processing...":"Preparing video..."})]}),X?(0,o.jsx)(k.Z,{sx:{position:"absolute",bottom:0,left:0,right:0,zIndex:10,p:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:(0,o.jsx)(d.Z,{variant:"determinate",value:J,sx:{height:4,borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.3)","& .MuiLinearProgress-bar":{backgroundColor:e=>e.palette.primary.main}}})}):null]}):r&&r.url?(0,o.jsx)(j.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,ease:"easeOut"},children:(0,o.jsx)(C,{ref:N,videoUrl:r.url,onDelete:()=>{null==M||M()},onFrameExtract:Z,extractFrameOnPause:!!Z})},"video-player"):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.Z,{ref:z,onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),O(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&O(!1)},onDrop:ei,sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,p:2,px:1,borderRadius:1,border:"1px dashed",borderColor:e=>e.palette.Colors.Gray["300"],minHeight:"168px",cursor:"pointer",transition:"all 0.2s",backgroundColor:V?"rgba(0, 0, 0, 0.1)":S.P},children:(0,o.jsx)(b.M,{mode:"wait",children:V?(0,o.jsxs)(j.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,padding:"16px 24px",borderRadius:8},children:[(0,o.jsx)(l.PhUploadSimple,{size:40}),(0,o.jsx)(c.Z,{variant:"body2",fontWeight:500,children:"Drop video here"})]},"dragover"):(0,o.jsxs)(j.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,borderRadius:8},children:[(0,o.jsx)(w.Z,{direction:"column",spacing:3,alignItems:"center",children:(0,o.jsx)(k.Z,{component:"div",sx:{orderRadius:"8px"},onClick:e=>{I(e.currentTarget)},style:{cursor:"pointer"},children:(0,o.jsxs)(w.Z,{direction:"column",spacing:1,alignItems:"center",children:[(0,o.jsx)(k.Z,{component:"div",children:P||(0,o.jsx)(l.CustomAddVideo,{size:32,color:"#fff"})}),(0,o.jsxs)(k.Z,{component:"div",sx:{textAlign:"center"},children:[D&&(0,o.jsx)(k.Z,{component:"div",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"14px"},children:D}),F&&(0,o.jsx)(k.Z,{component:"div",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"14px",mt:.5,cursor:"pointer"},children:F}),!D&&!F&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.Z,{component:"div",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"14px"},children:"Drag & drop a Video"}),(0,o.jsx)(k.Z,{component:"div",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"14px"},children:"Or from Generation History"})]})]})]})})}),!!A&&(0,o.jsx)(c.Z,{variant:"caption",sx:{color:"#ff4444",fontSize:"11px",textAlign:"center",fontWeight:500,mt:1},children:A})]},"default")})}),(0,o.jsx)(u.ZP,{open:!!T,anchorEl:T,onClose:er,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{mt:.5,boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.1)",minWidth:120}}},disableScrollLock:!0,children:(0,o.jsx)(p.Z,{sx:{p:0},children:null==U?void 0:U.map(e=>(0,o.jsxs)(m.Z,{onClick:t=>et(e,t),sx:{py:1,px:2,"&:hover":{backgroundColor:e=>e.palette.Colors.Gray["100"]}},children:[(0,o.jsx)(v.Z,{children:(0,o.jsx)(e.icon,{size:18})}),(0,o.jsx)(h.Z,{primary:e.label,primaryTypographyProps:{fontSize:14}})]},e.id))})}),(0,o.jsx)("input",{ref:H,type:"file",accept:R.NT.join(","),onChange:eo,style:{display:"none"}})]})});E.displayName="ContentCard"},80560:function(e,t,r){r.d(t,{CC:function(){return n},Ks:function(){return l},SM:function(){return i},dC:function(){return a}}),r(47485),r(75271),r(26930);var o=r(38218);r(1063);let a=e=>Math.ceil(e),i=e=>{let{resolution:t,featureKeys:r}=e,a={};return r.forEach(e=>{let r=(0,o.UC)(e),i=(null==r?void 0:r.credit)??0,n=0;1080===t&&(n=30),a[e]=i+n}),a},n=e=>{let{model:t,featureKeys:r,resolution:a}=e,i={};return"openart-restyle"===t&&r.forEach(e=>{let t=(0,o.UC)(e),r=(null==t?void 0:t.credit)??0,n=0;480===a?n=0:720===a?n=10:1080===a&&(n=25),i[e]=r+n}),i},l=e=>{let{model:t,modeType:r,featureKeys:a,resolution:i}=e,n={};switch(t){case"wan2.2-v1":a.forEach(e=>{let t=(0,o.UC)(e),a=(null==t?void 0:t.credit)??0,l=0;"full_scene"===r?1080===i&&(l=5):"face_only"===r?l=1080===i?20:10:"body_only"===r&&(l=1080===i?15:5),n[e]=a+l});break;case"openart-extend-fun":case"openart-extend-aio":a.forEach(e=>{let t=(0,o.UC)(e),r=(null==t?void 0:t.credit)??0,a=0;1080===i&&(a=10),n[e]=r+a});break;case"openart-replace-character":a.forEach(e=>{let t=(0,o.UC)(e),a=(null==t?void 0:t.credit)??0,l=0;"face"===r?l=1080===i?20:10:"body"===r?l=1080===i?15:5:"mask"===r&&(l=1080===i?15:5),n[e]=a+l})}return n}},1063:function(e,t,r){r.d(t,{id:function(){return p},Ge:function(){return v}});var o=r(47469),a=r(2345),i=r(99664),n=r(52676),l=(0,i.Z)((0,n.jsx)("path",{d:"M20.5 6c-2.61.7-5.67 1-8.5 1s-5.89-.3-8.5-1L3 8c1.86.5 4 .83 6 1v13h2v-6h2v6h2V9c2-.17 4.14-.5 6-1zM12 6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}),"AccessibilityNewOutlined"),s=(0,i.Z)([(0,n.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"0"),(0,n.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"1"),(0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m0-4c-1.48 0-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5s4.32-1.45 5.12-3.5h-1.67c-.69 1.19-1.97 2-3.45 2"},"2")],"SentimentSatisfiedAltSharp"),c=(0,i.Z)((0,n.jsx)("path",{d:"M7 16c.55 0 1 .45 1 1 0 1.1-.9 2-2 2-.17 0-.33-.02-.5-.05.31-.55.5-1.21.5-1.95 0-.55.45-1 1-1M18.67 3c-.26 0-.51.1-.71.29L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41l-1.34-1.34c-.2-.2-.45-.29-.7-.29M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3"}),"BrushOutlined"),d=r(75271);let u=[{label:"Body",value:"body",iconComponent:l,iconProps:{sx:{marginRight:1}},placement:"bottom-start",ariaLabel:"Body",title:"Replace the entire body of the character while keeping the video’s motion and background intact."},{label:"Face",value:"face",iconComponent:s,iconProps:{sx:{marginRight:1}},placement:"bottom",ariaLabel:"Face",title:"Replace only the face of the character — the body, motion, and background stay the same."},{label:"Mask",value:"mask",iconComponent:c,iconProps:{sx:{marginRight:1}},placement:"bottom-end",ariaLabel:"Mask",title:"Manually select which character to replace if the video contains multiple subjects."}],p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;return e.map(e=>{let{iconComponent:t,iconProps:r={},...o}=e;return{...o,icon:d.createElement(t,r)}})}(),m={content:null,visual:null,selectedModel:"openart-replace-character",resolution:720,replaceType:"body",prompt:"",currentFrameUrl:"",currentFrameTime:0,maskImageUrl:""},v=(0,a.U)()((0,o.n)((e,t)=>({...m,setContent:t=>e(e=>{e.content=t}),clearContent:()=>e(e=>{e.content=null}),setVisual:t=>e(e=>{e.visual=t}),clearVisual:()=>e(e=>{e.visual=null}),setSelectedModel:t=>e(e=>{e.selectedModel=t}),setResolution:t=>e(e=>{e.resolution=t}),setReplaceType:t=>e(e=>{e.replaceType=t}),setPrompt:t=>e(e=>{e.prompt=t}),setCurrentFrame:(t,r)=>e(e=>{e.currentFrameUrl=t,e.currentFrameTime=r,null===t&&null===r&&null!==e.maskImageUrl&&(e.maskImageUrl=null)}),setMaskImageUrl:t=>e(e=>{e.maskImageUrl=t}),reset:()=>e(()=>({...m}))})))},9440:function(e,t,r){r.d(t,{F:function(){return v},XB:function(){return m},ez:function(){return p}});var o=r(46973),a=r(47485),i=r(4528),n=r(75616),l=r(21964),s=r(10986),c=r(75271),d=r(26930),u=r(65027);let p=(e,t)=>{let{mutateAsync:r}=(0,a.x)();return(0,c.useCallback)(async(o,a)=>{try{let{validateDuration:i=!1}=a||{},n=0,l=0;if("string"==typeof o){let e=await r(o);l=e.duration,n=e.size}else n=o.size,l=await (0,d.u5)(o);if(e.maxVideoSize&&n>1048576*e.maxVideoSize)return t(`Video file size must be ${e.maxVideoSize}MB or less`),!1;if(i){let r=function(e,t){let r=(null==t?void 0:t.minVideoDuration)??3,o=(null==t?void 0:t.maxVideoDuration)??30;return e<r?`Video too short. Minimum: ${r}s, your video: ${e.toFixed(1)}s`:e>o?`Video too long. Maximum: ${o}s, your video: ${e.toFixed(1)}s`:""}(l,e);if(r)return t(r),!1}return!0}catch(e){return console.error("Failed to validate video file:",e),!0}},[r,e,t])};function m(e){return i.SM.safeParse(e).success}let v=()=>{let{enqueueSnackbar:e}=(0,s.Ds)(),t=(0,n.NL)();return(0,l.D)({mutationFn:async e=>{let t=i.SM.safeParse(e);if(!t.success)throw Error(`Validation failed: ${t.error.errors.map(e=>e.message).join(", ")}`);return(await o.ZP.post("/restyle-video/create",t.data,{headers:{"Content-Type":"application/json"}})).data},onSuccess:async e=>{await t.invalidateQueries([u.B4])},onError:t=>{var r;let o="Failed to create restyle video";(null===(r=t.response)||void 0===r?void 0:r.data)&&"object"==typeof t.response.data?o=t.response.data.error||t.message:t.message&&(o=t.message),e(o,{variant:"error"}),console.error("Failed to create restyle video:",t)}})}},4528:function(e,t,r){r.d(t,{NT:function(){return n},SM:function(){return a},jj:function(){return i}});var o=r(84291);let a=o.Ry({sourceVideoUrl:o.Z_().url("Must be a valid video URL"),sourceVideoType:o.Km(["video"]),model:o.Km(["openart-restyle"],{errorMap:()=>({message:"Invalid model selected"})}),stylePrompt:o.Z_().default("Restyle the video to a new style"),resolution:o.Rx().default(500),styleLabel:o.Z_().default(""),cfgStrength:o.Rx().min(1.2).max(2).default(1.6)}),i={"openart-restyle":{featureKeys:["app.restyle-video.openart-restyle"],mediaType:"video",name:"openart-restyle",displayName:"OpenArt Restyle",minVideoDuration:3,maxVideoDuration:20,supportDescription:!1,description:"Restyle any video to a new style.",iconColor:"#E91E63",iconUrl:"https://cdn.openart.ai/music_video/openart_model_log.png"}},n=["video/mp4","video/webm","video/ogg","video/mov","video/quicktime","video/h264"]}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8245],{18245:function(e,t,i){i.d(t,{u:function(){return k}});var r=i(52676),l=i(75271),a=i(22988),o=i(27574),n=i(80110),s=i(56407),d=i(24181),u=i(29984),c=i(57672),p=i(75616),x=i(53874),g=i(45603),h=i(92665),f=i(39964),m=i(61110),v=i(68695),y=i(86547),_=i(14360),j=i(6045),b=i(57671),Z=i(72757),w=i(97779),C=i(19005);function k(e){let{userId:t="",maxHeight:i="70vh",showSkeleton:s=!1,sx:d,showTitle:k=!0,pageSize:S=15}=e,{isMobile:M}=(0,w.j)(),R=(0,c.Z)(),z=(0,p.NL)(),D=(0,l.useRef)(null),E=(0,y.F)(e=>e.mockingGenerations),F=(0,l.useMemo)(()=>E.filter(e=>{var t;return"audio"===e.type||(null===(t=e.params)||void 0===t?void 0:t.resource_type)==="audio"}),[E]),$=(0,y.F)(e=>e.removeMockingGenerationsByResourceId),q=(0,l.useMemo)(()=>({userId:t,resource_type:"audio",page_size:S}),[t,S]),{data:A,isFetching:P,error:H,status:L,fetchNextPage:Q,hasNextPage:N,isFetchingNextPage:O}=(0,b.iq)(q,!0),{combinedData:W,realAudioIds:B}=(0,l.useMemo)(()=>{let e=(0,g.Z)((0,h.Z)(null==A?void 0:A.pages,e=>{var t;return(null===(t=e.items)||void 0===t?void 0:t.filter(e=>"audio"===e.resource_type))||[]})),i=e.map(e=>e.id).filter(Boolean),r=[...F.map(e=>{var i,r,l,a,o,n,s;return{id:e.requestId||"",url:"",prompt:(null===(i=e.params)||void 0===i?void 0:i.text)||(null===(r=e.params)||void 0===r?void 0:r.prompt)||"",resource_type:"audio",status:"generating",ai_model:`${(null===(l=e.params)||void 0===l?void 0:l.provider)||"elevenlabs"}/${(null===(a=e.params)||void 0===a?void 0:a.model_id)||"eleven_multilingual_v2"}`,configs:{voice_id:(null===(o=e.params)||void 0===o?void 0:o.voice_id)||"",model_id:(null===(n=e.params)||void 0===n?void 0:n.model_id)||"eleven_multilingual_v2",provider:(null===(s=e.params)||void 0===s?void 0:s.provider)||"elevenlabs"},user_id:t||"",credit_payload:null,album_ids:[],is_downloaded:!1,is_deleted:!1,workflow_run_id:e.workflowRunId,generation_media_resource_id:e.generation_media_resource_id,created_at:new Date().toISOString(),is_starred:!1,failed_reason:void 0}}),...e];return{combinedData:(0,f.Z)(r,e=>{let t=F.find(t=>t.requestId===e.id);return(null==t?void 0:t.generation_media_resource_id)?t.generation_media_resource_id:e.id||"unknown"}).filter(e=>{let t=F.find(t=>t.requestId===e.id);return null==t||!t.generation_media_resource_id||!i.includes(t.generation_media_resource_id)}),realAudioIds:i}},[A,F,t]),K=(0,l.useRef)(new Set);(0,l.useEffect)(()=>{if(B.length>0){let e=B.filter(e=>!K.current.has(e));e.length>0&&($(e),e.forEach(e=>K.current.add(e)))}},[B,$]),(0,l.useEffect)(()=>{let e=K.current;return()=>{e.clear()}},[]);let T=(0,l.useMemo)(()=>W.map(e=>("pending"===e.status||"generating"===e.status)&&e.workflow_run_id?e.workflow_run_id:null).filter(e=>!!e&&"undefined"!==e),[W]),Y=(0,l.useCallback)(async(e,t)=>{"failed"===t.status&&await Promise.all([z.invalidateQueries(["useGenerationHistories"]),z.invalidateQueries([C.uE]),z.invalidateQueries([C.OK])]);let i=z.getQueryCache().getAll().filter(e=>"useGenerationHistories"===e.queryKey[0]);for(let r of i)r.state.data&&z.setQueryData(r.queryKey,(0,x.Uy)(i=>{if(!(null==i?void 0:i.pages))return;let r=!1;for(let l of i.pages)if(l.items){for(let i of l.items)if("audio"===i.resource_type&&i.workflow_run_id===e){r=!0,t.status&&(i.status=t.status),t.audio?Object.assign(i,t.audio):"completed"===t.status&&(i.status="completed"),"failed"===t.status&&t.error&&(i.failed_reason=t.error);return}}r||i.pages.flatMap(e=>(e.items||[]).filter(e=>"audio"===e.resource_type))}))},[z]);(0,v.X)(T,T.length>0,Y);let{LoadMoreTrigger:U}=function(e){let{hasNextPage:t,isFetchingNextPage:i,isFetching:o,fetchNextPage:s,dataLength:d}=e,p=(0,c.Z)(),x=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!t||i||o)return;let e=new IntersectionObserver(e=>{e[0].isIntersecting&&s()},{root:null,rootMargin:"100px",threshold:.1}),r=x.current;return r&&e.observe(r),()=>{r&&e.unobserve(r)}},[t,i,o,s]),{LoadMoreTrigger:(0,l.useCallback)(()=>(0,r.jsxs)(r.Fragment,{children:[!!t&&(0,r.jsx)(a.Z,{ref:x,sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:2,mb:2,height:"40px"},children:i?(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(u.Z,{size:20,sx:{color:p.palette.Colors.Gray["500"]}}),(0,r.jsx)(n.Z,{variant:"body2",sx:{color:p.palette.Colors.Gray["500"],fontSize:"14px"},children:"Loading more..."})]}):(0,r.jsx)(a.Z,{sx:{height:"1px",width:"100%"}})}),!t&&!i&&d>0&&(0,r.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:2,mb:2,py:2},children:(0,r.jsx)(n.Z,{variant:"body2",sx:{color:p.palette.Colors.Gray["500"],fontSize:"14px",fontStyle:"italic"},children:"All audio loaded! (づ｡◕‿‿◕｡)づ"})})]}),[t,i,d,p.palette.Colors.Gray])}}({hasNextPage:N,isFetchingNextPage:O,isFetching:P,fetchNextPage:Q,dataLength:W.length}),{handlePlayAudio:X,currentPlayingId:J,isPlaying:V,duration:ee,playbackAnchor:et}=(0,Z.b)(),ei=(0,l.useCallback)(e=>{X({...e,id:e.id||"",title:e.prompt||e.id||"Audio"})},[X]),er=d||{},el=(0,l.useMemo)(()=>s||"loading"===L&&0===W.length,[s,L,W.length]);return((0,j.S)(D,"back-to-top-audio-history",!el,100),H&&0===W.length)?(0,r.jsx)(a.Z,{sx:{p:2,...er},children:(0,r.jsx)(o.Z,{severity:"error",children:"Failed to load audio history. Please try again."})}):P||0!==W.length?(0,r.jsxs)(a.Z,{sx:{height:"100%",maxHeight:i,overflow:"hidden",display:"flex",flexDirection:"column",...er},children:[k?(0,r.jsx)(a.Z,{sx:{px:M?.5:1.5,pt:.75,pb:0,pl:M?.5:2.75},children:(0,r.jsx)(n.Z,{variant:"h6",sx:{fontFamily:"Poppins",fontSize:"20px",fontWeight:700,color:R.palette.Colors.Gray["900"],lineHeight:"160%",letterSpacing:"-0.4px",mb:.5},children:"Generations"})}):null,el?(0,r.jsx)(I,{sx:er}):(0,r.jsx)(a.Z,{ref:D,sx:{flex:1,overflowY:"auto",px:M?.5:2,pb:2,pt:.75,...(0,_.SZ)(6),..._.ji},children:(0,r.jsxs)(a.Z,{sx:{display:"grid",gridTemplateColumns:{md:"100%",lg:"50% 50%"},gap:1},children:[W.map((e,t)=>{var i;return(0,r.jsx)(m.F,{item:e,isPlaying:!!(V&&J===e.id),onPlayToggle:()=>ei(e),playbackAnchor:J===e.id?et:null,audioDurationSec:J===e.id?ee:null===(i=e.metadata)||void 0===i?void 0:i.duration},e.id||`${t}`)}),(0,r.jsx)(a.Z,{sx:{gridColumn:"1 / -1"},children:(0,r.jsx)(U,{})})]})})]}):(0,r.jsx)(G,{sx:er})}function G(e){let{sx:t}=e,i=(0,c.Z)();return(0,r.jsxs)(a.Z,{sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",minHeight:300,height:"100%",...t},children:[(0,r.jsx)(a.Z,{component:"img",src:"https://cdn.openart.ai/assets/internal/uploads/image_NCgBkyfI_358x294_1753153522450.webp",sx:{mb:3,width:"179px",height:"147px",opacity:.8}}),(0,r.jsx)(n.Z,{variant:"h6",sx:{fontFamily:"Poppins",fontSize:"18px",fontWeight:600,color:i.palette.Colors.Gray["700"],mb:1},children:"Your creative space is empty"}),(0,r.jsx)(n.Z,{variant:"body2",sx:{fontSize:"14px",color:i.palette.Colors.Gray["500"],maxWidth:300},children:"Let's bring it to life ✨"})]})}function I(e){let{sx:t}=e,i=(0,c.Z)(),{isMobile:l}=(0,w.j)();return(0,r.jsx)(a.Z,{sx:{height:"100%",maxHeight:"70vh",overflow:"hidden",display:"flex",flexDirection:"column",...t},children:(0,r.jsx)(a.Z,{sx:{flex:1,px:l?.5:2,pb:2},children:(0,r.jsx)(s.Z,{spacing:1,children:[0,1,2,3,4,5].map(e=>(0,r.jsxs)(a.Z,{sx:{px:1.5,py:1,borderRadius:"8px",background:`linear-gradient(90deg, ${i.palette.Colors.Gray["100"]} 0%, ${i.palette.Colors.Gray["50"]} 100%)`,display:"flex",alignItems:"center",gap:1.5},children:[(0,r.jsx)(d.Z,{variant:"rounded",width:36,height:36,sx:{borderRadius:"6px",bgcolor:i.palette.Colors.Gray["200"],flexShrink:0}}),(0,r.jsxs)(a.Z,{sx:{flex:1,minWidth:0},children:[(0,r.jsx)(d.Z,{variant:"text",width:`${60+30*Math.random()}%`,height:20,sx:{mb:.5,bgcolor:i.palette.Colors.Gray["200"]}}),(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(d.Z,{variant:"rounded",width:40,height:16,sx:{borderRadius:"2px",bgcolor:i.palette.Colors.Gray["100"]}}),(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,r.jsx)(d.Z,{variant:"circular",width:18,height:18,sx:{bgcolor:i.palette.Colors.Gray["100"]}}),(0,r.jsx)(d.Z,{variant:"text",width:80,height:16,sx:{bgcolor:i.palette.Colors.Gray["100"]}})]})]})]})]},`skeleton-${e}`))})})})}}}]);
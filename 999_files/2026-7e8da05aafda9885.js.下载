"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2026],{92026:function(e,t,a){a.d(t,{U:function(){return z}});var n=a(52676),i=a(75271),r=a(56407),l=a(80110),o=a(22988),s=a(68836),d=a(81159),c=a(72509),h=a(69502),u=a(89252),g=a(79446),p=a(8765),m=a(58684),w=a(97792),x=a(11955),v=a(72660),f=a(43807),j=a(43246),C=a(67936),b=a(62074),y=a(34216);let Z=e=>new Promise((t,a)=>{let n=new Image;n.addEventListener("load",()=>t(n)),n.addEventListener("error",e=>a(e)),n.setAttribute("crossOrigin","anonymous"),n.src=e});function E(e){return e*Math.PI/180}async function k(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n??(n={horizontal:!1,vertical:!1});let i=await Z(e),r=document.createElement("canvas"),l=r.getContext("2d");if(!l)return null;let o=E(a),{width:s,height:d}=function(e,t,a){let n=E(a);return{width:Math.abs(Math.cos(n)*e)+Math.abs(Math.sin(n)*t),height:Math.abs(Math.sin(n)*e)+Math.abs(Math.cos(n)*t)}}(i.width,i.height,a);r.width=s,r.height=d,l.translate(s/2,d/2),l.rotate(o),l.scale(n.horizontal?-1:1,n.vertical?-1:1),l.translate(-i.width/2,-i.height/2),l.drawImage(i,0,0);let c=document.createElement("canvas"),h=c.getContext("2d");return h?(c.width=t.width,c.height=t.height,h.drawImage(r,t.x,t.y,t.width,t.height,0,0,t.width,t.height),new Promise((e,t)=>{c.toBlob(t=>{e(URL.createObjectURL(t))},"image/jpeg")})):null}var L=a(91717),S=a(28989);function M(e){let{imageUrl:t,allowedAspects:a,onCropped:s,onCroppedFile:d,onClose:c,title:h,open:u}=e,g=(0,i.useMemo)(()=>a&&a.length>0?a:[{name:"1:1",value:1}],[a]),[p,Z]=(0,i.useState)(g[0].value),[E,M]=(0,i.useState)(1),[R,I]=(0,i.useState)(0),[P,U]=(0,i.useState)({x:0,y:0}),[z,A]=(0,i.useState)(null),[F,D]=(0,L.i3)(),O=(0,i.useCallback)((e,t)=>{A(t)},[]),_=(0,i.useCallback)(async()=>{try{if(!z)return;let e=await k(t,z,R,{horizontal:!1,vertical:!1}),a=g.find(e=>e.value===p),n=(null==a?void 0:a.name)??String(p),i=await fetch(e).then(e=>e.blob()),r=new File([i],`crop_${n}.jpg`,{type:"image/jpeg"});if(d)d(r);else{let e=await F({file:r});s(e.imageUrl)}c()}catch(e){(0,S.cB)(e)}},[z,t,c,s,d,R,p,F,g]);return(0,n.jsxs)(w.Z,{open:u,onClose:c,sx:{"& .MuiDialog-paper":{maxWidth:{xs:"100%",md:920},width:"100%"}},children:[(0,n.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:2},children:[(0,n.jsx)("span",{children:h||"Crop Image"}),(0,n.jsx)(y.h,{dark:!1,onClick:c,sx:{ml:"auto"}})]}),(0,n.jsx)(v.Z,{children:(0,n.jsxs)(r.Z,{spacing:3,direction:{xs:"column",md:"row"},children:[(0,n.jsx)(o.Z,{sx:{flex:1,position:"relative",width:"100%",height:420,backgroundColor:"#111",borderRadius:1,overflow:"hidden"},children:(0,n.jsx)(b.ZP,{image:t,crop:P,zoom:E,rotation:R,aspect:p,onCropChange:U,onZoomChange:M,onRotationChange:I,onCropComplete:O,restrictPosition:!0,showGrid:!1})}),(0,n.jsxs)(r.Z,{spacing:2,sx:{flex:1},children:[(0,n.jsxs)(r.Z,{spacing:1,children:[(0,n.jsx)(l.Z,{variant:"subtitle2",children:"Aspect"}),(0,n.jsx)(f.Z,{size:"small",value:p,onChange:e=>Z(Number(e.target.value)),sx:{width:220},children:g.map(e=>(0,n.jsx)(j.Z,{value:e.value,children:e.name},e.name))})]}),(0,n.jsxs)(r.Z,{spacing:1,children:[(0,n.jsx)(l.Z,{variant:"subtitle2",children:"Zoom"}),(0,n.jsx)(C.ZP,{value:E,min:1,max:3,step:.05,onChange:(e,t)=>M(t)})]}),(0,n.jsxs)(r.Z,{spacing:1,children:[(0,n.jsx)(l.Z,{variant:"subtitle2",children:"Rotate"}),(0,n.jsx)(C.ZP,{value:R,min:0,max:360,step:1,onChange:(e,t)=>I(t)})]}),(0,n.jsx)(m.Z,{loading:D,variant:"primary",onClick:_,sx:{height:44},children:"Save"})]})]})})]})}var R=a(27806),I=a(46973);let P=(0,n.jsxs)(r.Z,{justifyContent:"center",alignItems:"center",spacing:1,children:[(0,n.jsx)(R.MaterialSymbolsAddPhotoAlternateOutline,{size:32}),(0,n.jsxs)(l.Z,{fontSize:12,fontWeight:500,color:u.d6,align:"center",children:["Drag & drop an image",(0,n.jsx)("br",{}),"Or from Generation History"]})]}),U=async()=>({}),z=e=>{let{height:t=148,disabled:a,value:r,uploadUrl:m,onChange:w,onSelectImage:x=U,title:v=P,checker:f,cropAspects:j}=e,C=(0,g.B)(),[b,y]=(0,i.useState)(null),[Z,E]=(0,i.useState)(!1),[k,L]=(0,i.useState)(""),S=(0,i.useRef)(null),{showModal:z}=function(e){let{allowedAspects:t,onCropped:a,onCroppedFile:n,title:i}=e,{showModal:r}=(0,p.dd)();return{showModal:e=>{r(M,{imageUrl:e,allowedAspects:t,title:i,onCropped:e=>{null==a||a(e)},onCroppedFile:e=>{null==n||n(e)},onClose:()=>{}})}}}({allowedAspects:j,title:"Crop Image",onCroppedFile:async e=>{try{y({...e,preview:URL.createObjectURL(e)}),E(!0);let t=new FormData;t.append("file",e);let a=await I.ZP.post(`${m}?return_raw=1`,t,{headers:{"Content-Type":"multipart/form-data"}});200===a.status&&a.data&&await A(a.data)&&w(a.data)}finally{E(!1)}}}),A=async e=>"function"!=typeof f||await f(e),F=async e=>{L("");try{let t=e[0];if(!t)return;let a=URL.createObjectURL(t);if(t){if(j&&j.length>0){let e=new Image;await new Promise((t,n)=>{let i=()=>{e.removeEventListener("load",i),e.removeEventListener("error",r),t()},r=()=>{e.removeEventListener("load",i),e.removeEventListener("error",r),n(Error("Failed to load image for resolution check"))};e.addEventListener("load",i),e.addEventListener("error",r),e.src=a}),z(a);return}y({...t,preview:a}),E(!0);let e=new FormData;e.append("file",t);let n=j&&j.length>0?`${m}?return_raw=1`:m,i=await I.ZP.post(n,e,{headers:{"Content-Type":"multipart/form-data"}});200===i.status&&i.data&&await A(i.data)&&w(i.data)}}catch(a){let e=a.message||"An error occurred while uploading the image";if(a instanceof s.AxiosError){var t;let n=null===(t=a.response)||void 0===t?void 0:t.data;"string"==typeof n?e=n:(null==n?void 0:n.message)&&(e=n.message)}y(null),L(e),w(null)}finally{E(!1)}},{UploadContextMenu:D,handleMenuOpen:O}=(0,c.w)({onChange:async e=>{if(e&&e.length>0&&!a)try{L("");let t=await (null==x?void 0:x(e[0])),a={imageUrl:e[0],height:0,width:0,...t},n=new Image;n.addEventListener("load",async()=>{a.height=n.height,a.width=n.width,j&&j.length>0?z(e[0]):(E(!0),y({preview:e[0]}),await A(a)&&w(a),E(!1))}),n.addEventListener("error",()=>{L("Failed to load image dimensions"),y(null),w(null),E(!1)}),n.src=e[0]}catch{L("Failed to process image from history"),y(null),w(null),E(!1)}},onClickUpload:()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.triggerInputClick()},maxSelectionCount:1,showCharacter:!0});return(0,i.useEffect)(()=>{r?y({preview:r}):y(null)},[r]),(0,n.jsxs)(o.Z,{sx:{borderRadius:u.zO,border:"1px dashed #464749",position:"relative"},children:[(0,n.jsx)(h.Z,{ref:S,disabled:a,buttonVariant:!0,sx:{width:"100%",height:t,border:"none",backgroundColor:"transparent",borderRadius:1,margin:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},dropZoneSx:{borderRadius:.5,width:"100%",padding:0},file:b,isUploading:Z,maxSize:10485760,onDrop:F,onAreaClick:a?void 0:e=>C({onAuthenticated:O,e}),title:v,accept:{"image/png":[],"image/jpeg":[],"image/webp":[]},caption:(()=>{if(k)return(0,n.jsx)(l.Z,{variant:"caption",sx:{padding:"0 8px",display:"inline-block",position:"absolute",bottom:0,left:"50%",transform:"translateX(-50%)",pointerEvents:"none",width:"100%"},color:"error.main",children:k})})()}),D,b&&!Z?(0,n.jsx)(d.Z,{title:"Delete the image",icon:R.FaTrash,iconSize:20,sx:{position:"absolute",top:8,right:8,cursor:"pointer"},onClick:()=>{y(null),w(null)}}):null]})}}}]);
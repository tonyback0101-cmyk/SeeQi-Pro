/**
 * 舌苔象意 → 气运偏移逻辑
 * 东方象义 × 中医保健（非医疗）
 * 与 dream/palm 规则同级，供 scoreTongueForQiV2 使用
 */

// ---------------------------------------------
// 舌苔象意 → 气运偏移逻辑
// 东方象义 × 中医保健（非医疗）
// 用于 scoreTongueForQiV2()
// ---------------------------------------------

export const tongueQiRuleMap: Record<string, number> = {
  // 舌色
  "淡白": -6, // 气弱
  "淡红": +2, // 中性偏顺
  "红": +4, // 气机偏旺，有动能
  "深红": -2, // 过火
  "绛": -6, // 火重，需稳
  "紫": -6, // 气滞
  "紫暗": -8,
  "青紫": -8,

  // 舌苔颜色
  "薄白": +2, // 平和
  "厚白": -4, // 运化偏弱
  "薄黄": +1, // 中性
  "厚黄": -5, // 内火与湿
  "黄腻": -6, // 湿热
  "黑腻": -8,
  "灰黑": -8,

  // 舌苔形态 / 质地
  "腻苔": -4,
  "水滑": -2, // 偏寒，动作差
  "干燥": -5,
  "粗糙": -4,
  "松散": -3,
  "根不牢": -4,
  "光剥": -5,

  // 舌形
  "胖大": -4,
  "薄小": -3,
  "有齿痕": -4,
  "裂纹": -4,
  "舌尖红": -2,
  "舌边红": -3,
  "舌中红": -1,

  // 舌体状态
  "偏干": -4,
  "偏湿": -4,
  "湿润": +2,
  "淡滞": -3,
  "有瘀点": -5,

  // 气机象
  "湿滞": -6,
  "虚寒": -4,
  "气虚": -4,
  "气滞": -5,
  "气郁": -6,
  "火旺": +4, // 有动能但需稳
  "阴虚": -4,
  "阳虚": -4,
  "轻虚弱": -3,
  "精力低": -4,
  "过劳": -5,
};

// ---------------------------------------------
// 主打分函数：scoreTongueForQiV2
// 替代旧版 scoreTongueForQi，
// 直接通过“象意词库匹配”实现更精准的当日能量判断
// ---------------------------------------------

export function scoreTongueForQiV2(summaryText: string): number {
  if (!summaryText) return 50;

  let score = 50;
  const keys = Object.keys(tongueQiRuleMap);

  for (const key of keys) {
    if (summaryText.includes(key)) {
      score += tongueQiRuleMap[key];
    }
  }

  // 限制舌苔对当日气运的影响力度（当日能量层 → 中等权重）
  score = Math.max(20, Math.min(80, score));
  return score;
}





